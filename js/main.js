/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*! Copyright Twitter Inc. and other contributors. Licensed under MIT */

/* VelocityJS.org UI Pack (5.0.4). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License. Portions copyright Daniel Eden, Christian Pucci. */

/*!
 * clipboard.js v1.5.10
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT Â© Zeno Rocha
 */

/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/

/*
 * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined
 * in FIPS 180-1
 * Version 2.2 Copyright Paul Johnston 2000 - 2009.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for details.
 */

/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! strophe.js v1.1.3 - built on 20-01-2014 */

/**
 * Copyright 2015 Razer Inc. All rights reserved.
 */

/*! modernizr 3.3.1 (Custom Build) | MIT *
 * http://modernizr.com/download/?-contenteditable-cssanimations-datachannel-emoji-es6object-es6string-filereader-filesystem-flash-getusermedia-notification-peerconnection-promises-svg-webworkers-setclasses !*/

function hex_sha1(e){return rstr2hex(rstr_sha1(str2rstr_utf8(e)))}function b64_sha1(e){return rstr2b64(rstr_sha1(str2rstr_utf8(e)))}function any_sha1(e,t){return rstr2any(rstr_sha1(str2rstr_utf8(e)),t)}function hex_hmac_sha1(e,t){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_sha1(e,t){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_sha1(e,t,n){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function sha1_vm_test(){return hex_sha1("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function rstr_sha1(e){return binb2rstr(binb_sha1(rstr2binb(e),e.length*8))}function rstr_hmac_sha1(e,t){var n=rstr2binb(e);n.length>16&&(n=binb_sha1(n,e.length*8));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=binb_sha1(r.concat(rstr2binb(t)),512+t.length*8);return binb2rstr(binb_sha1(i.concat(o),672))}function rstr2hex(e){try{hexcase}catch(t){hexcase=0}var n=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i;for(var s=0;s<e.length;s++)i=e.charCodeAt(s),r+=n.charAt(i>>>4&15)+n.charAt(i&15);return r}function rstr2b64(e){try{b64pad}catch(t){b64pad=""}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=e.length;for(var s=0;s<i;s+=3){var o=e.charCodeAt(s)<<16|(s+1<i?e.charCodeAt(s+1)<<8:0)|(s+2<i?e.charCodeAt(s+2):0);for(var u=0;u<4;u++)s*8+u*6>e.length*8?r+=b64pad:r+=n.charAt(o>>>6*(3-u)&63)}return r}function rstr2any(e,t){var n=t.length,r=Array(),i,s,o,u,a=Array(Math.ceil(e.length/2));for(i=0;i<a.length;i++)a[i]=e.charCodeAt(i*2)<<8|e.charCodeAt(i*2+1);while(a.length>0){u=Array(),o=0;for(i=0;i<a.length;i++){o=(o<<16)+a[i],s=Math.floor(o/n),o-=s*n;if(u.length>0||s>0)u[u.length]=s}r[r.length]=o,a=u}var f="";for(i=r.length-1;i>=0;i--)f+=t.charAt(r[i]);var l=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));for(i=f.length;i<l;i++)f=t[0]+f;return f}function str2rstr_utf8(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t}function str2rstr_utf16le(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function str2rstr_utf16be(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function rstr2binb(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<24-n%32;return t}function binb2rstr(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function binb_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n=Array(80),r=1732584193,i=-271733879,s=-1732584194,o=271733878,u=-1009589776;for(var a=0;a<e.length;a+=16){var f=r,l=i,c=s,h=o,p=u;for(var d=0;d<80;d++){d<16?n[d]=e[a+d]:n[d]=bit_rol(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var v=safe_add(safe_add(bit_rol(r,5),sha1_ft(d,i,s,o)),safe_add(safe_add(u,n[d]),sha1_kt(d)));u=o,o=s,s=bit_rol(i,30),i=r,r=v}r=safe_add(r,f),i=safe_add(i,l),s=safe_add(s,c),o=safe_add(o,h),u=safe_add(u,p)}return Array(r,i,s,o,u)}function sha1_ft(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function safe_add(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function bit_rol(e,t){return e<<t|e>>>32-t}define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!templates/mainview.html",[],function(){return""}),define("text!templates/leftsectionview.html",[],function(){return'<div class="search"></div>\n<div class="recent"></div>\n<div class="content"></div>\n'}),define("text!templates/leftheaderview.html",[],function(){return'<div class="title">RECENT</div>\n<div class="razericons-message_new compose"></div>\n\n'});var twemoji=function(){function o(e){return document.createTextNode(e)}function u(e){return e.replace(r,p)}function a(e,t){return"".concat(t.base,t.size,"/",e,t.ext)}function f(e,t){var n=e.childNodes,r=n.length,s,o;while(r--)s=n[r],o=s.nodeType,o===3?t.push(s):o===1&&!i.test(s.nodeName)&&f(s,t);return t}function l(e,t){return w(t==="ï¸"?e.slice(0,-1):e.length===3&&e.charAt(1)==="ï¸"?e.charAt(0)+e.charAt(2):e)}function c(t,r){var i=f(t,[]),s=i.length,u,a,c,h,p,d,v,m,g,y,b,w,E,S;while(s--){c=!1,h=document.createDocumentFragment(),p=i[s],d=p.nodeValue,m=0;while(v=n.exec(d)){g=v.index,g!==m&&h.appendChild(o(d.slice(m,g))),b=v[0],w=v[1],E=v[2],m=g+b.length;if(E!=="ï¸Ž"){S=r.callback(l(w,E),r,E);if(S){y=new Image,y.onerror=e.onerror,y.setAttribute("draggable","false"),u=r.attributes(w,E);for(a in u)u.hasOwnProperty(a)&&a.indexOf("on")!==0&&!y.hasAttribute(a)&&y.setAttribute(a,u[a]);y.className=r.className,y.alt=b,y.src=S,c=!0,h.appendChild(y)}}y||h.appendChild(o(b)),y=null}c&&(m<d.length&&h.appendChild(o(d.slice(m))),p.parentNode.replaceChild(h,p))}return t}function h(e,t){return y(e,function(e,n,r){var i=e,s,o,a;if(r!=="ï¸Ž"){a=t.callback(l(n,r),t,r);if(a){i="<img ".concat('class="',t.className,'" ','draggable="false" ','alt="',e,'"',' src="',a,'"'),s=t.attributes(n,r);for(o in s)s.hasOwnProperty(o)&&o.indexOf("on")!==0&&i.indexOf(" "+o+"=")===-1&&(i=i.concat(" ",o,'="',u(s[o]),'"'));i=i.concat(">")}}return i})}function p(e){return t[e]}function d(){return null}function v(e){return typeof e=="number"?e+"x"+e:e}function m(e){var t=typeof e=="string"?parseInt(e,16):e;return t<65536?s(t):(t-=65536,s(55296+(t>>10),56320+(t&1023)))}function g(t,n){if(!n||typeof n=="function")n={callback:n};return(typeof t=="string"?h:c)(t,{callback:n.callback||a,attributes:typeof n.attributes=="function"?n.attributes:d,base:typeof n.base=="string"?n.base:e.base,ext:n.ext||e.ext,size:n.folder||v(n.size||e.size),className:n.className||e.className})}function y(e,t){return String(e).replace(n,t)}function b(e){n.lastIndex=0;var t=n.test(e);return n.lastIndex=0,t}function w(e,t){var n=[],r=0,i=0,s=0;while(s<e.length)r=e.charCodeAt(s++),i?(n.push((65536+(i-55296<<10)+(r-56320)).toString(16)),i=0):55296<=r&&r<=56319?i=r:n.push(r.toString(16));return n.join(t||"-")}var e={base:(location.protocol==="https:"?"https:":"http:")+"//twemoji.maxcdn.com/",ext:".png",size:"36x36",className:"emoji",convert:{fromCodePoint:m,toCodePoint:w},onerror:function(){this.parentNode&&this.parentNode.replaceChild(o(this.alt),this)},parse:g,replace:y,test:b},t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},n=/((?:\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddf0\ud83c\uddf7|\ud83c\uddef\ud83c\uddf5|\ud83c\uddee\ud83c\uddf9|\ud83c\uddec\ud83c\udde7|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\udde9\ud83c\uddea|\u0039\ufe0f?\u20e3|\u0038\ufe0f?\u20e3|\u0037\ufe0f?\u20e3|\u0036\ufe0f?\u20e3|\u0035\ufe0f?\u20e3|\u0034\ufe0f?\u20e3|\u0033\ufe0f?\u20e3|\u0032\ufe0f?\u20e3|\u0031\ufe0f?\u20e3|\u0030\ufe0f?\u20e3|\u0023\ufe0f?\u20e3|\ud83d\udeb3|\ud83d\udeb1|\ud83d\udeb0|\ud83d\udeaf|\ud83d\udeae|\ud83d\udea6|\ud83d\udea3|\ud83d\udea1|\ud83d\udea0|\ud83d\ude9f|\ud83d\ude9e|\ud83d\ude9d|\ud83d\ude9c|\ud83d\ude9b|\ud83d\ude98|\ud83d\ude96|\ud83d\ude94|\ud83d\ude90|\ud83d\ude8e|\ud83d\ude8d|\ud83d\ude8b|\ud83d\ude8a|\ud83d\ude88|\ud83d\ude86|\ud83d\ude82|\ud83d\ude81|\ud83d\ude36|\ud83d\ude34|\ud83d\ude2f|\ud83d\ude2e|\ud83d\ude2c|\ud83d\ude27|\ud83d\ude26|\ud83d\ude1f|\ud83d\ude1b|\ud83d\ude19|\ud83d\ude17|\ud83d\ude15|\ud83d\ude11|\ud83d\ude10|\ud83d\ude0e|\ud83d\ude08|\ud83d\ude07|\ud83d\ude00|\ud83d\udd67|\ud83d\udd66|\ud83d\udd65|\ud83d\udd64|\ud83d\udd63|\ud83d\udd62|\ud83d\udd61|\ud83d\udd60|\ud83d\udd5f|\ud83d\udd5e|\ud83d\udd5d|\ud83d\udd5c|\ud83d\udd2d|\ud83d\udd2c|\ud83d\udd15|\ud83d\udd09|\ud83d\udd08|\ud83d\udd07|\ud83d\udd06|\ud83d\udd05|\ud83d\udd04|\ud83d\udd02|\ud83d\udd01|\ud83d\udd00|\ud83d\udcf5|\ud83d\udcef|\ud83d\udced|\ud83d\udcec|\ud83d\udcb7|\ud83d\udcb6|\ud83d\udcad|\ud83d\udc6d|\ud83d\udc6c|\ud83d\udc65|\ud83d\udc2a|\ud83d\udc16|\ud83d\udc15|\ud83d\udc13|\ud83d\udc10|\ud83d\udc0f|\ud83d\udc0b|\ud83d\udc0a|\ud83d\udc09|\ud83d\udc08|\ud83d\udc07|\ud83d\udc06|\ud83d\udc05|\ud83d\udc04|\ud83d\udc03|\ud83d\udc02|\ud83d\udc01|\ud83d\udc00|\ud83c\udfe4|\ud83c\udfc9|\ud83c\udfc7|\ud83c\udf7c|\ud83c\udf50|\ud83c\udf4b|\ud83c\udf33|\ud83c\udf32|\ud83c\udf1e|\ud83c\udf1d|\ud83c\udf1c|\ud83c\udf1a|\ud83c\udf18|\ud83c\udccf|\ud83c\udd70|\ud83c\udd71|\ud83c\udd7e|\ud83c\udd8e|\ud83c\udd91|\ud83c\udd92|\ud83c\udd93|\ud83c\udd94|\ud83c\udd95|\ud83c\udd96|\ud83c\udd97|\ud83c\udd98|\ud83c\udd99|\ud83c\udd9a|\ud83d\udc77|\ud83d\udec5|\ud83d\udec4|\ud83d\udec3|\ud83d\udec2|\ud83d\udec1|\ud83d\udebf|\ud83d\udeb8|\ud83d\udeb7|\ud83d\udeb5|\ud83c\ude01|\ud83c\ude02|\ud83c\ude32|\ud83c\ude33|\ud83c\ude34|\ud83c\ude35|\ud83c\ude36|\ud83c\ude37|\ud83c\ude38|\ud83c\ude39|\ud83c\ude3a|\ud83c\ude50|\ud83c\ude51|\ud83c\udf00|\ud83c\udf01|\ud83c\udf02|\ud83c\udf03|\ud83c\udf04|\ud83c\udf05|\ud83c\udf06|\ud83c\udf07|\ud83c\udf08|\ud83c\udf09|\ud83c\udf0a|\ud83c\udf0b|\ud83c\udf0c|\ud83c\udf0f|\ud83c\udf11|\ud83c\udf13|\ud83c\udf14|\ud83c\udf15|\ud83c\udf19|\ud83c\udf1b|\ud83c\udf1f|\ud83c\udf20|\ud83c\udf30|\ud83c\udf31|\ud83c\udf34|\ud83c\udf35|\ud83c\udf37|\ud83c\udf38|\ud83c\udf39|\ud83c\udf3a|\ud83c\udf3b|\ud83c\udf3c|\ud83c\udf3d|\ud83c\udf3e|\ud83c\udf3f|\ud83c\udf40|\ud83c\udf41|\ud83c\udf42|\ud83c\udf43|\ud83c\udf44|\ud83c\udf45|\ud83c\udf46|\ud83c\udf47|\ud83c\udf48|\ud83c\udf49|\ud83c\udf4a|\ud83c\udf4c|\ud83c\udf4d|\ud83c\udf4e|\ud83c\udf4f|\ud83c\udf51|\ud83c\udf52|\ud83c\udf53|\ud83c\udf54|\ud83c\udf55|\ud83c\udf56|\ud83c\udf57|\ud83c\udf58|\ud83c\udf59|\ud83c\udf5a|\ud83c\udf5b|\ud83c\udf5c|\ud83c\udf5d|\ud83c\udf5e|\ud83c\udf5f|\ud83c\udf60|\ud83c\udf61|\ud83c\udf62|\ud83c\udf63|\ud83c\udf64|\ud83c\udf65|\ud83c\udf66|\ud83c\udf67|\ud83c\udf68|\ud83c\udf69|\ud83c\udf6a|\ud83c\udf6b|\ud83c\udf6c|\ud83c\udf6d|\ud83c\udf6e|\ud83c\udf6f|\ud83c\udf70|\ud83c\udf71|\ud83c\udf72|\ud83c\udf73|\ud83c\udf74|\ud83c\udf75|\ud83c\udf76|\ud83c\udf77|\ud83c\udf78|\ud83c\udf79|\ud83c\udf7a|\ud83c\udf7b|\ud83c\udf80|\ud83c\udf81|\ud83c\udf82|\ud83c\udf83|\ud83c\udf84|\ud83c\udf85|\ud83c\udf86|\ud83c\udf87|\ud83c\udf88|\ud83c\udf89|\ud83c\udf8a|\ud83c\udf8b|\ud83c\udf8c|\ud83c\udf8d|\ud83c\udf8e|\ud83c\udf8f|\ud83c\udf90|\ud83c\udf91|\ud83c\udf92|\ud83c\udf93|\ud83c\udfa0|\ud83c\udfa1|\ud83c\udfa2|\ud83c\udfa3|\ud83c\udfa4|\ud83c\udfa5|\ud83c\udfa6|\ud83c\udfa7|\ud83c\udfa8|\ud83c\udfa9|\ud83c\udfaa|\ud83c\udfab|\ud83c\udfac|\ud83c\udfad|\ud83c\udfae|\ud83c\udfaf|\ud83c\udfb0|\ud83c\udfb1|\ud83c\udfb2|\ud83c\udfb3|\ud83c\udfb4|\ud83c\udfb5|\ud83c\udfb6|\ud83c\udfb7|\ud83c\udfb8|\ud83c\udfb9|\ud83c\udfba|\ud83c\udfbb|\ud83c\udfbc|\ud83c\udfbd|\ud83c\udfbe|\ud83c\udfbf|\ud83c\udfc0|\ud83c\udfc1|\ud83c\udfc2|\ud83c\udfc3|\ud83c\udfc4|\ud83c\udfc6|\ud83c\udfc8|\ud83c\udfca|\ud83c\udfe0|\ud83c\udfe1|\ud83c\udfe2|\ud83c\udfe3|\ud83c\udfe5|\ud83c\udfe6|\ud83c\udfe7|\ud83c\udfe8|\ud83c\udfe9|\ud83c\udfea|\ud83c\udfeb|\ud83c\udfec|\ud83c\udfed|\ud83c\udfee|\ud83c\udfef|\ud83c\udff0|\ud83d\udc0c|\ud83d\udc0d|\ud83d\udc0e|\ud83d\udc11|\ud83d\udc12|\ud83d\udc14|\ud83d\udc17|\ud83d\udc18|\ud83d\udc19|\ud83d\udc1a|\ud83d\udc1b|\ud83d\udc1c|\ud83d\udc1d|\ud83d\udc1e|\ud83d\udc1f|\ud83d\udc20|\ud83d\udc21|\ud83d\udc22|\ud83d\udc23|\ud83d\udc24|\ud83d\udc25|\ud83d\udc26|\ud83d\udc27|\ud83d\udc28|\ud83d\udc29|\ud83d\udc2b|\ud83d\udc2c|\ud83d\udc2d|\ud83d\udc2e|\ud83d\udc2f|\ud83d\udc30|\ud83d\udc31|\ud83d\udc32|\ud83d\udc33|\ud83d\udc34|\ud83d\udc35|\ud83d\udc36|\ud83d\udc37|\ud83d\udc38|\ud83d\udc39|\ud83d\udc3a|\ud83d\udc3b|\ud83d\udc3c|\ud83d\udc3d|\ud83d\udc3e|\ud83d\udc40|\ud83d\udc42|\ud83d\udc43|\ud83d\udc44|\ud83d\udc45|\ud83d\udc46|\ud83d\udc47|\ud83d\udc48|\ud83d\udc49|\ud83d\udc4a|\ud83d\udc4b|\ud83d\udc4c|\ud83d\udc4d|\ud83d\udc4e|\ud83d\udc4f|\ud83d\udc50|\ud83d\udc51|\ud83d\udc52|\ud83d\udc53|\ud83d\udc54|\ud83d\udc55|\ud83d\udc56|\ud83d\udc57|\ud83d\udc58|\ud83d\udc59|\ud83d\udc5a|\ud83d\udc5b|\ud83d\udc5c|\ud83d\udc5d|\ud83d\udc5e|\ud83d\udc5f|\ud83d\udc60|\ud83d\udc61|\ud83d\udc62|\ud83d\udc63|\ud83d\udc64|\ud83d\udc66|\ud83d\udc67|\ud83d\udc68|\ud83d\udc69|\ud83d\udc6a|\ud83d\udc6b|\ud83d\udc6e|\ud83d\udc6f|\ud83d\udc70|\ud83d\udc71|\ud83d\udc72|\ud83d\udc73|\ud83d\udc74|\ud83d\udc75|\ud83d\udc76|\ud83d\udeb4|\ud83d\udc78|\ud83d\udc79|\ud83d\udc7a|\ud83d\udc7b|\ud83d\udc7c|\ud83d\udc7d|\ud83d\udc7e|\ud83d\udc7f|\ud83d\udc80|\ud83d\udc81|\ud83d\udc82|\ud83d\udc83|\ud83d\udc84|\ud83d\udc85|\ud83d\udc86|\ud83d\udc87|\ud83d\udc88|\ud83d\udc89|\ud83d\udc8a|\ud83d\udc8b|\ud83d\udc8c|\ud83d\udc8d|\ud83d\udc8e|\ud83d\udc8f|\ud83d\udc90|\ud83d\udc91|\ud83d\udc92|\ud83d\udc93|\ud83d\udc94|\ud83d\udc95|\ud83d\udc96|\ud83d\udc97|\ud83d\udc98|\ud83d\udc99|\ud83d\udc9a|\ud83d\udc9b|\ud83d\udc9c|\ud83d\udc9d|\ud83d\udc9e|\ud83d\udc9f|\ud83d\udca0|\ud83d\udca1|\ud83d\udca2|\ud83d\udca3|\ud83d\udca4|\ud83d\udca5|\ud83d\udca6|\ud83d\udca7|\ud83d\udca8|\ud83d\udca9|\ud83d\udcaa|\ud83d\udcab|\ud83d\udcac|\ud83d\udcae|\ud83d\udcaf|\ud83d\udcb0|\ud83d\udcb1|\ud83d\udcb2|\ud83d\udcb3|\ud83d\udcb4|\ud83d\udcb5|\ud83d\udcb8|\ud83d\udcb9|\ud83d\udcba|\ud83d\udcbb|\ud83d\udcbc|\ud83d\udcbd|\ud83d\udcbe|\ud83d\udcbf|\ud83d\udcc0|\ud83d\udcc1|\ud83d\udcc2|\ud83d\udcc3|\ud83d\udcc4|\ud83d\udcc5|\ud83d\udcc6|\ud83d\udcc7|\ud83d\udcc8|\ud83d\udcc9|\ud83d\udcca|\ud83d\udccb|\ud83d\udccc|\ud83d\udccd|\ud83d\udcce|\ud83d\udccf|\ud83d\udcd0|\ud83d\udcd1|\ud83d\udcd2|\ud83d\udcd3|\ud83d\udcd4|\ud83d\udcd5|\ud83d\udcd6|\ud83d\udcd7|\ud83d\udcd8|\ud83d\udcd9|\ud83d\udcda|\ud83d\udcdb|\ud83d\udcdc|\ud83d\udcdd|\ud83d\udcde|\ud83d\udcdf|\ud83d\udce0|\ud83d\udce1|\ud83d\udce2|\ud83d\udce3|\ud83d\udce4|\ud83d\udce5|\ud83d\udce6|\ud83d\udce7|\ud83d\udce8|\ud83d\udce9|\ud83d\udcea|\ud83d\udceb|\ud83d\udcee|\ud83d\udcf0|\ud83d\udcf1|\ud83d\udcf2|\ud83d\udcf3|\ud83d\udcf4|\ud83d\udcf6|\ud83d\udcf7|\ud83d\udcf9|\ud83d\udcfa|\ud83d\udcfb|\ud83d\udcfc|\ud83d\udd03|\ud83d\udd0a|\ud83d\udd0b|\ud83d\udd0c|\ud83d\udd0d|\ud83d\udd0e|\ud83d\udd0f|\ud83d\udd10|\ud83d\udd11|\ud83d\udd12|\ud83d\udd13|\ud83d\udd14|\ud83d\udd16|\ud83d\udd17|\ud83d\udd18|\ud83d\udd19|\ud83d\udd1a|\ud83d\udd1b|\ud83d\udd1c|\ud83d\udd1d|\ud83d\udd1e|\ud83d\udd1f|\ud83d\udd20|\ud83d\udd21|\ud83d\udd22|\ud83d\udd23|\ud83d\udd24|\ud83d\udd25|\ud83d\udd26|\ud83d\udd27|\ud83d\udd28|\ud83d\udd29|\ud83d\udd2a|\ud83d\udd2b|\ud83d\udd2e|\ud83d\udd2f|\ud83d\udd30|\ud83d\udd31|\ud83d\udd32|\ud83d\udd33|\ud83d\udd34|\ud83d\udd35|\ud83d\udd36|\ud83d\udd37|\ud83d\udd38|\ud83d\udd39|\ud83d\udd3a|\ud83d\udd3b|\ud83d\udd3c|\ud83d\udd3d|\ud83d\udd50|\ud83d\udd51|\ud83d\udd52|\ud83d\udd53|\ud83d\udd54|\ud83d\udd55|\ud83d\udd56|\ud83d\udd57|\ud83d\udd58|\ud83d\udd59|\ud83d\udd5a|\ud83d\udd5b|\ud83d\uddfb|\ud83d\uddfc|\ud83d\uddfd|\ud83d\uddfe|\ud83d\uddff|\ud83d\ude01|\ud83d\ude02|\ud83d\ude03|\ud83d\ude04|\ud83d\ude05|\ud83d\ude06|\ud83d\ude09|\ud83d\ude0a|\ud83d\ude0b|\ud83d\ude0c|\ud83d\ude0d|\ud83d\ude0f|\ud83d\ude12|\ud83d\ude13|\ud83d\ude14|\ud83d\ude16|\ud83d\ude18|\ud83d\ude1a|\ud83d\ude1c|\ud83d\ude1d|\ud83d\ude1e|\ud83d\ude20|\ud83d\ude21|\ud83d\ude22|\ud83d\ude23|\ud83d\ude24|\ud83d\ude25|\ud83d\ude28|\ud83d\ude29|\ud83d\ude2a|\ud83d\ude2b|\ud83d\ude2d|\ud83d\ude30|\ud83d\ude31|\ud83d\ude32|\ud83d\ude33|\ud83d\ude35|\ud83d\ude37|\ud83d\ude38|\ud83d\ude39|\ud83d\ude3a|\ud83d\ude3b|\ud83d\ude3c|\ud83d\ude3d|\ud83d\ude3e|\ud83d\ude3f|\ud83d\ude40|\ud83d\ude45|\ud83d\ude46|\ud83d\ude47|\ud83d\ude48|\ud83d\ude49|\ud83d\ude4a|\ud83d\ude4b|\ud83d\ude4c|\ud83d\ude4d|\ud83d\ude4e|\ud83d\ude4f|\ud83d\ude80|\ud83d\ude83|\ud83d\ude84|\ud83d\ude85|\ud83d\ude87|\ud83d\ude89|\ud83d\ude8c|\ud83d\ude8f|\ud83d\ude91|\ud83d\ude92|\ud83d\ude93|\ud83d\ude95|\ud83d\ude97|\ud83d\ude99|\ud83d\ude9a|\ud83d\udea2|\ud83d\udea4|\ud83d\udea5|\ud83d\udea7|\ud83d\udea8|\ud83d\udea9|\ud83d\udeaa|\ud83d\udeab|\ud83d\udeac|\ud83d\udead|\ud83d\udeb2|\ud83d\udeb6|\ud83d\udeb9|\ud83d\udeba|\ud83d\udebb|\ud83d\udebc|\ud83d\udebd|\ud83d\udebe|\ud83d\udec0|\ud83c\udde6|\ud83c\udde7|\ud83c\udde8|\ud83c\udde9|\ud83c\uddea|\ud83c\uddeb|\ud83c\uddec|\ud83c\udded|\ud83c\uddee|\ud83c\uddef|\ud83c\uddf0|\ud83c\uddf1|\ud83c\uddf2|\ud83c\uddf3|\ud83c\uddf4|\ud83c\uddf5|\ud83c\uddf6|\ud83c\uddf7|\ud83c\uddf8|\ud83c\uddf9|\ud83c\uddfa|\ud83c\uddfb|\ud83c\uddfc|\ud83c\uddfd|\ud83c\uddfe|\ud83c\uddff|\ud83c\udf0d|\ud83c\udf0e|\ud83c\udf10|\ud83c\udf12|\ud83c\udf16|\ud83c\udf17|\ue50a|\u3030|\u27b0|\u2797|\u2796|\u2795|\u2755|\u2754|\u2753|\u274e|\u274c|\u2728|\u270b|\u270a|\u2705|\u26ce|\u23f3|\u23f0|\u23ec|\u23eb|\u23ea|\u23e9|\u2122|\u27bf|\u00a9|\u00ae)|(?:(?:\ud83c\udc04|\ud83c\udd7f|\ud83c\ude1a|\ud83c\ude2f|\u3299|\u303d|\u2b55|\u2b50|\u2b1c|\u2b1b|\u2b07|\u2b06|\u2b05|\u2935|\u2934|\u27a1|\u2764|\u2757|\u2747|\u2744|\u2734|\u2733|\u2716|\u2714|\u2712|\u270f|\u270c|\u2709|\u2708|\u2702|\u26fd|\u26fa|\u26f5|\u26f3|\u26f2|\u26ea|\u26d4|\u26c5|\u26c4|\u26be|\u26bd|\u26ab|\u26aa|\u26a1|\u26a0|\u2693|\u267f|\u267b|\u3297|\u2666|\u2665|\u2663|\u2660|\u2653|\u2652|\u2651|\u2650|\u264f|\u264e|\u264d|\u264c|\u264b|\u264a|\u2649|\u2648|\u263a|\u261d|\u2615|\u2614|\u2611|\u260e|\u2601|\u2600|\u25fe|\u25fd|\u25fc|\u25fb|\u25c0|\u25b6|\u25ab|\u25aa|\u24c2|\u231b|\u231a|\u21aa|\u21a9|\u2199|\u2198|\u2197|\u2196|\u2195|\u2194|\u2139|\u2049|\u203c|\u2668)([\uFE0E\uFE0F]?)))/g,r=/[&<>'"]/g,i=/IFRAME|NOFRAMES|NOSCRIPT|SCRIPT|SELECT|STYLE|TEXTAREA/,s=String.fromCharCode;return e}();define("twemoji",["jquery"],function(e){return function(){var t,n;return t||e.twemoji}}(this)),define("text!rcemoji/emojiview.html",[],function(){return'<div class="emojiPicker">\r\n	<div class="tabpanel" data-tab="">\r\n		<div class="tab" data-tab="recent"><div class="emoji razericons-history"></div></div>\r\n		<div class="tab" data-tab="faces"><div class="emoji razericons-emoticon"></div></div>\r\n		<div class="tab" data-tab="nature"><div class="emoji razericons-flower"></div></div>\r\n		<div class="tab" data-tab="objects"><div class="emoji razericons-games"></div></div>\r\n		<div class="tab" data-tab="places"><div class="emoji razericons-car"></div></div>\r\n		<div class="tab" data-tab="flags"><div class="emoji razericons-flag"></div></div>\r\n		<div class="tab" data-tab="symbols"><div class="emoji razericons-sign"></div></div>\r\n	</div>\r\n	<div class="tabmaincontent">\r\n		<div class="tab-content" id="recent"></div>\r\n		<div class="tab-content" id="faces"></div>\r\n		<div class="tab-content" id="nature"></div>\r\n		<div class="tab-content" id="objects"></div>\r\n		<div class="tab-content" id="places"></div>\r\n		<div class="tab-content" id="flags"></div>\r\n		<div class="tab-content" id="symbols"></div>\r\n	</div>\r\n</div>\r\n\r\n'}),function(e){"function"==typeof define&&define.amd?define("nicescroll",["jquery"],e):e(jQuery)}(function(e){var t=!1,n=!1,r=5e3,i=2e3,s=0,o=["ms","moz","webkit","o"],u=window.requestAnimationFrame||!1,a=window.cancelAnimationFrame||!1;if(!u)for(var f in o){var l=o[f];u||(u=window[l+"RequestAnimationFrame"]),a||(a=window[l+"CancelAnimationFrame"]||window[l+"CancelRequestAnimationFrame"])}var c=window.MutationObserver||window.WebKitMutationObserver||!1,h={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:function(){var e=document.getElementsByTagName("script"),e=e[e.length-1].src.split("?")[0];return 0<e.split("/").length?e.split("/").slice(0,-1).join("/")+"/":""}()},p=!1,d=function(){if(p)return p;var e=document.createElement("DIV"),t={haspointerlock:"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document};t.isopera="opera"in window,t.isopera12=t.isopera&&"getUserMedia"in navigator,t.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),t.isie="all"in document&&"attachEvent"in e&&!t.isopera,t.isieold=t.isie&&!("msInterpolationMode"in e.style),t.isie7=t.isie&&!t.isieold&&(!("documentMode"in document)||7==document.documentMode),t.isie8=t.isie&&"documentMode"in document&&8==document.documentMode,t.isie9=t.isie&&"performance"in window&&9<=document.documentMode,t.isie10=t.isie&&"performance"in window&&10<=document.documentMode,t.isie9mobile=/iemobile.9/i.test(navigator.userAgent),t.isie9mobile&&(t.isie9=!1),t.isie7mobile=!t.isie9mobile&&t.isie7&&/iemobile/i.test(navigator.userAgent),t.ismozilla="MozAppearance"in e.style,t.iswebkit="WebkitAppearance"in e.style,t.ischrome="chrome"in window,t.ischrome22=t.ischrome&&t.haspointerlock,t.ischrome26=t.ischrome&&"transition"in e.style,t.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,t.hasmstouch=window.navigator.msPointerEnabled||!1,t.ismac=/^mac$/i.test(navigator.platform),t.isios=t.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),t.isios4=t.isios&&!("seal"in Object),t.isandroid=/android/i.test(navigator.userAgent),t.trstyle=!1,t.hastransform=!1,t.hastranslate3d=!1,t.transitionstyle=!1,t.hastransition=!1,t.transitionend=!1;for(var n=["transform","msTransform","webkitTransform","MozTransform","OTransform"],r=0;r<n.length;r++)if("undefined"!=typeof e.style[n[r]]){t.trstyle=n[r];break}t.hastransform=0!=t.trstyle,t.hastransform&&(e.style[t.trstyle]="translate3d(1px,2px,3px)",t.hastranslate3d=/translate3d/.test(e.style[t.trstyle])),t.transitionstyle=!1,t.prefixstyle="",t.transitionend=!1;for(var n="transition webkitTransition MozTransition OTransition OTransition msTransition KhtmlTransition".split(" "),i=" -webkit- -moz- -o- -o -ms- -khtml-".split(" "),s="transitionend webkitTransitionEnd transitionend otransitionend oTransitionEnd msTransitionEnd KhtmlTransitionEnd".split(" "),r=0;r<n.length;r++)if(n[r]in e.style){t.transitionstyle=n[r],t.prefixstyle=i[r],t.transitionend=s[r];break}t.ischrome26&&(t.prefixstyle=i[1]),t.hastransition=t.transitionstyle;e:{n=["-moz-grab","-webkit-grab","grab"];if(t.ischrome&&!t.ischrome22||t.isie)n=[];for(r=0;r<n.length;r++)if(i=n[r],e.style.cursor=i,e.style.cursor==i){n=i;break e}n="url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}return t.cursorgrabvalue=n,t.hasmousecapture="setCapture"in e,t.hasMutationObserver=!1!==c,p=t},v=function(o,f){function l(){var e=y.win;if("zIndex"in e)return e.zIndex();for(;0<e.length&&9!=e[0].nodeType;){var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function p(e,t,n){return t=e.css(t),e=parseFloat(t),isNaN(e)?(e=T[t]||0,n=3==e?n?y.win.outerHeight()-y.win.innerHeight():y.win.outerWidth()-y.win.innerWidth():1,y.isie8&&e&&(e+=1),n?e:0):e}function v(e,t,n,r){y._bind(e,t,function(r){r=r?r:window.event;var i={original:r,target:r.target||r.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==r.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return r.preventDefault?r.preventDefault():r.returnValue=!1,!1},stopImmediatePropagation:function(){r.stopImmediatePropagation?r.stopImmediatePropagation():r.cancelBubble=!0}};return"mousewheel"==t?(i.deltaY=-0.025*r.wheelDelta,r.wheelDeltaX&&(i.deltaX=-0.025*r.wheelDeltaX)):i.deltaY=r.detail,n.call(e,i)},r)}function g(e,t,n){var r,i;0==e.deltaMode?(r=-Math.floor(e.deltaX*(y.opt.mousescrollstep/54)),i=-Math.floor(e.deltaY*(y.opt.mousescrollstep/54))):1==e.deltaMode&&(r=-Math.floor(e.deltaX*y.opt.mousescrollstep),i=-Math.floor(e.deltaY*y.opt.mousescrollstep)),t&&y.opt.oneaxismousemode&&0==r&&i&&(r=i,i=0),r&&(y.scrollmom&&y.scrollmom.stop(),y.lastdeltax+=r,y.debounced("mousewheelx",function(){var e=y.lastdeltax;y.lastdeltax=0,y.rail.drag||y.doScrollLeftBy(e)},15));if(i){if(y.opt.nativeparentscrolling&&n&&!y.ispage&&!y.zoomactive)if(0>i){if(y.getScrollTop()>=y.page.maxh)return!0}else if(0>=y.getScrollTop())return!0;y.scrollmom&&y.scrollmom.stop(),y.lastdeltay+=i,y.debounced("mousewheely",function(){var e=y.lastdeltay;y.lastdeltay=0,y.rail.drag||y.doScrollBy(e)},15)}return e.stopImmediatePropagation(),e.preventDefault()}var y=this;this.version="3.5.4",this.name="nicescroll",this.me=f,this.opt={doc:e("body"),win:!1},e.extend(this.opt,h),this.opt.snapbackspeed=80;if(o)for(var b in y.opt)"undefined"!=typeof o[b]&&(y.opt[b]=o[b]);this.iddoc=(this.doc=y.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(y.opt.win?y.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==y.opt.win,this.win=y.opt.win||(this.ispage?e(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win,this.body=e("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=y.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.observerremover=this.observer=this.scrollmom=this.scrollrunning=this.isrtlmode=!1;do this.id="ascrail"+i++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=y.opt.overflowx,this.overflowy=y.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=d();var w=e.extend({},this.detected);this.ishwscroll=(this.canhwscroll=w.hastransform&&y.opt.hwacceleration)&&y.haswrapper,this.istouchcapable=!1,w.cantouch&&w.ischrome&&!w.isios&&!w.isandroid&&(this.istouchcapable=!0,w.cantouch=!1),w.cantouch&&w.ismozilla&&!w.isios&&!w.isandroid&&(this.istouchcapable=!0,w.cantouch=!1),y.opt.enablemouselockapi||(w.hasmousecapture=!1,w.haspointerlock=!1),this.delayed=function(e,t,n,r){var i=y.delaylist[e],s=(new Date).getTime();if(!r&&i&&i.tt)return!1;i&&i.tt&&clearTimeout(i.tt);if(i&&i.last+n>s&&!i.tt)y.delaylist[e]={last:s+n,tt:setTimeout(function(){y&&(y.delaylist[e].tt=0,t.call())},n)};else if(!i||!i.tt)y.delaylist[e]={last:s,tt:0},setTimeout(function(){t.call()},0)},this.debounced=function(e,t,n){var r=y.delaylist[e];(new Date).getTime(),y.delaylist[e]=t,r||setTimeout(function(){var t=y.delaylist[e];y.delaylist[e]=!1,t.call()},n)};var E=!1;this.synched=function(e,t){return y.synclist[e]=t,function(){E||(u(function(){E=!1;for(e in y.synclist){var t=y.synclist[e];t&&t.call(y),y.synclist[e]=!1}}),E=!0)}(),e},this.unsynched=function(e){y.synclist[e]&&(y.synclist[e]=!1)},this.css=function(e,t){for(var n in t)y.saved.css.push([e,n,e.css(n)]),e.css(n,t[n])},this.scrollTop=function(e){return"undefined"==typeof e?y.getScrollTop():y.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?y.getScrollLeft():y.setScrollLeft(e)},BezierClass=function(e,t,n,r,i,s,o){this.st=e,this.ed=t,this.spd=n,this.p1=r||0,this.p2=i||1,this.p3=s||0,this.p4=o||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*t)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}};if(this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},w.hastranslate3d&&w.isios&&this.doc.css("-webkit-backface-visibility","hidden");var S=function(){var e=y.doc.css(w.trstyle);return e&&"matrix"==e.substr(0,6)?e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1};this.getScrollTop=function(e){if(!e){if(e=S())return 16==e.length?-e[13]:-e[5];if(y.timerscroll&&y.timerscroll.bz)return y.timerscroll.bz.getNow()}return y.doc.translate.y},this.getScrollLeft=function(e){if(!e){if(e=S())return 16==e.length?-e[12]:-e[4];if(y.timerscroll&&y.timerscroll.bh)return y.timerscroll.bh.getNow()}return y.doc.translate.x},this.notifyScrollEvent=document.createEvent?function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),e.dispatchEvent(t)}:document.fireEvent?function(e){var t=document.createEventObject();e.fireEvent("onscroll"),t.cancelBubble=!0}:function(e,t){},w.hastranslate3d&&y.opt.enabletranslate3d?(this.setScrollTop=function(e,t){y.doc.translate.y=e,y.doc.translate.ty=-1*e+"px",y.doc.css(w.trstyle,"translate3d("+y.doc.translate.tx+","+y.doc.translate.ty+",0px)"),t||y.notifyScrollEvent(y.win[0])},this.setScrollLeft=function(e,t){y.doc.translate.x=e,y.doc.translate.tx=-1*e+"px",y.doc.css(w.trstyle,"translate3d("+y.doc.translate.tx+","+y.doc.translate.ty+",0px)"),t||y.notifyScrollEvent(y.win[0])}):(this.setScrollTop=function(e,t){y.doc.translate.y=e,y.doc.translate.ty=-1*e+"px",y.doc.css(w.trstyle,"translate("+y.doc.translate.tx+","+y.doc.translate.ty+")"),t||y.notifyScrollEvent(y.win[0])},this.setScrollLeft=function(e,t){y.doc.translate.x=e,y.doc.translate.tx=-1*e+"px",y.doc.css(w.trstyle,"translate("+y.doc.translate.tx+","+y.doc.translate.ty+")"),t||y.notifyScrollEvent(y.win[0])})}else this.getScrollTop=function(){return y.docscroll.scrollTop()},this.setScrollTop=function(e){return y.docscroll.scrollTop(e)},this.getScrollLeft=function(){return y.docscroll.scrollLeft()},this.setScrollLeft=function(e){return y.docscroll.scrollLeft(e)};this.getTarget=function(e){return e?e.target?e.target:e.srcElement?e.srcElement:!1:!1},this.hasParent=function(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n.id!=t;)n=n.parentNode||!1;return!1!==n};var T={thin:1,medium:3,thick:5};this.getOffset=function(){if(y.isfixed)return{top:parseFloat(y.win.css("top")),left:parseFloat(y.win.css("left"))};if(!y.viewport)return y.win.offset();var e=y.win.offset(),t=y.viewport.offset();return{top:e.top-t.top+y.viewport.scrollTop(),left:e.left-t.left+y.viewport.scrollLeft()}},this.updateScrollBar=function(e){if(y.ishwscroll)y.rail.css({height:y.win.innerHeight()}),y.railh&&y.railh.css({width:y.win.innerWidth()});else{var t=y.getOffset(),n=t.top,r=t.left,n=n+p(y.win,"border-top-width",!0);y.win.outerWidth(),y.win.innerWidth();var r=r+(y.rail.align?y.win.outerWidth()-p(y.win,"border-right-width")-y.rail.width:p(y.win,"border-left-width")),i=y.opt.railoffset;i&&(i.top&&(n+=i.top),y.rail.align&&i.left&&(r+=i.left)),y.locked||y.rail.css({top:n,left:r,height:e?e.h:y.win.innerHeight()}),y.zoom&&y.zoom.css({top:n+1,left:1==y.rail.align?r-20:r+y.rail.width+4}),y.railh&&!y.locked&&(n=t.top,r=t.left,e=y.railh.align?n+p(y.win,"border-top-width",!0)+y.win.innerHeight()-y.railh.height:n+p(y.win,"border-top-width",!0),r+=p(y.win,"border-left-width"),y.railh.css({top:e,left:r,width:y.railh.width}))}},this.doRailClick=function(e,t,n){var r;y.locked||(y.cancelEvent(e),t?(t=n?y.doScrollLeft:y.doScrollTop,r=n?(e.pageX-y.railh.offset().left-y.cursorwidth/2)*y.scrollratio.x:(e.pageY-y.rail.offset().top-y.cursorheight/2)*y.scrollratio.y,t(r)):(t=n?y.doScrollLeftBy:y.doScrollBy,r=n?y.scroll.x:y.scroll.y,e=n?e.pageX-y.railh.offset().left:e.pageY-y.rail.offset().top,n=n?y.view.w:y.view.h,r>=e?t(n):t(-n)))},y.hasanimationframe=u,y.hascancelanimationframe=a,y.hasanimationframe?y.hascancelanimationframe||(a=function(){y.cancelAnimationFrame=!0}):(u=function(e){return setTimeout(e,15-Math.floor(+(new Date)/1e3)%16)},a=clearInterval),this.init=function(){y.saved.css=[];if(w.isie7mobile||w.isoperamini)return!0;w.hasmstouch&&y.css(y.ispage?e("html"):y.win,{"-ms-touch-action":"none"}),y.zindex="auto",y.zindex=!y.ispage&&"auto"==y.opt.zindex?l()||"auto":y.opt.zindex,!y.ispage&&"auto"!=y.zindex&&y.zindex>s&&(s=y.zindex),y.isie&&0==y.zindex&&"auto"==y.opt.zindex&&(y.zindex="auto");if(!y.ispage||!w.cantouch&&!w.isieold&&!w.isie9mobile){var i=y.docscroll;y.ispage&&(i=y.haswrapper?y.win:y.doc),w.isie9mobile||y.css(i,{"overflow-y":"hidden"}),y.ispage&&w.isie7&&("BODY"==y.doc[0].nodeName?y.css(e("html"),{"overflow-y":"hidden"}):"HTML"==y.doc[0].nodeName&&y.css(e("body"),{"overflow-y":"hidden"})),w.isios&&!y.ispage&&!y.haswrapper&&y.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var o=e(document.createElement("div"));o.css({position:"relative",top:0,"float":"right",width:y.opt.cursorwidth,height:"0px","background-color":y.opt.cursorcolor,border:y.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":y.opt.cursorborderradius,"-moz-border-radius":y.opt.cursorborderradius,"border-radius":y.opt.cursorborderradius}),o.hborder=parseFloat(o.outerHeight()-o.innerHeight()),y.cursor=o;var u=e(document.createElement("div"));u.attr("id",y.id),u.addClass("nicescroll-rails");var a,f,h=["left","right"],p;for(p in h)f=h[p],(a=y.opt.railpadding[f])?u.css("padding-"+f,a+"px"):y.opt.railpadding[f]=0;u.append(o),u.width=Math.max(parseFloat(y.opt.cursorwidth),o.outerWidth())+y.opt.railpadding.left+y.opt.railpadding.right,u.css({width:u.width+"px",zIndex:y.zindex,background:y.opt.background,cursor:"default"}),u.visibility=!0,u.scrollable=!0,u.align="left"==y.opt.railalign?0:1,y.rail=u,o=y.rail.drag=!1,y.opt.boxzoom&&!y.ispage&&!w.isieold&&(o=document.createElement("div"),y.bind(o,"click",y.doZoom),y.zoom=e(o),y.zoom.css({cursor:"pointer","z-index":y.zindex,backgroundImage:"url("+y.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),y.opt.dblclickzoom&&y.bind(y.win,"dblclick",y.doZoom),w.cantouch&&y.opt.gesturezoom&&(y.ongesturezoom=function(e){return 1.5<e.scale&&y.doZoomIn(e),.8>e.scale&&y.doZoomOut(e),y.cancelEvent(e)},y.bind(y.win,"gestureend",y.ongesturezoom))),y.railh=!1;if(y.opt.horizrailenabled){y.css(i,{"overflow-x":"hidden"}),o=e(document.createElement("div")),o.css({position:"relative",top:0,height:y.opt.cursorwidth,width:"0px","background-color":y.opt.cursorcolor,border:y.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":y.opt.cursorborderradius,"-moz-border-radius":y.opt.cursorborderradius,"border-radius":y.opt.cursorborderradius}),o.wborder=parseFloat(o.outerWidth()-o.innerWidth()),y.cursorh=o;var d=e(document.createElement("div"));d.attr("id",y.id+"-hr"),d.addClass("nicescroll-rails"),d.height=Math.max(parseFloat(y.opt.cursorwidth),o.outerHeight()),d.css({height:d.height+"px",zIndex:y.zindex,background:y.opt.background}),d.append(o),d.visibility=!0,d.scrollable=!0,d.align="top"==y.opt.railvalign?0:1,y.railh=d,y.railh.drag=!1}y.ispage?(u.css({position:"fixed",top:"0px",height:"100%"}),u.align?u.css({right:"0px"}):u.css({left:"0px"}),y.body.append(u),y.railh&&(d.css({position:"fixed",left:"0px",width:"100%"}),d.align?d.css({bottom:"0px"}):d.css({top:"0px"}),y.body.append(d))):(y.ishwscroll?("static"==y.win.css("position")&&y.css(y.win,{position:"relative"}),i="HTML"==y.win[0].nodeName?y.body:y.win,y.zoom&&(y.zoom.css({position:"absolute",top:1,right:0,"margin-right":u.width+4}),i.append(y.zoom)),u.css({position:"absolute",top:0}),u.align?u.css({right:0}):u.css({left:0}),i.append(u),d&&(d.css({position:"absolute",left:0,bottom:0}),d.align?d.css({bottom:0}):d.css({top:0}),i.append(d))):(y.isfixed="fixed"==y.win.css("position"),i=y.isfixed?"fixed":"absolute",y.isfixed||(y.viewport=y.getViewport(y.win[0])),y.viewport&&(y.body=y.viewport,0==/fixed|relative|absolute/.test(y.viewport.css("position"))&&y.css(y.viewport,{position:"relative"})),u.css({position:i}),y.zoom&&y.zoom.css({position:i}),y.updateScrollBar(),y.body.append(u),y.zoom&&y.body.append(y.zoom),y.railh&&(d.css({position:i}),y.body.append(d))),w.isios&&y.css(y.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),w.isie&&y.opt.disableoutline&&y.win.attr("hideFocus","true"),w.iswebkit&&y.opt.disableoutline&&y.win.css({outline:"none"})),!1===y.opt.autohidemode?(y.autohidedom=!1,y.rail.css({opacity:y.opt.cursoropacitymax}),y.railh&&y.railh.css({opacity:y.opt.cursoropacitymax})):!0===y.opt.autohidemode||"leave"===y.opt.autohidemode?(y.autohidedom=e().add(y.rail),w.isie8&&(y.autohidedom=y.autohidedom.add(y.cursor)),y.railh&&(y.autohidedom=y.autohidedom.add(y.railh)),y.railh&&w.isie8&&(y.autohidedom=y.autohidedom.add(y.cursorh))):"scroll"==y.opt.autohidemode?(y.autohidedom=e().add(y.rail),y.railh&&(y.autohidedom=y.autohidedom.add(y.railh))):"cursor"==y.opt.autohidemode?(y.autohidedom=e().add(y.cursor),y.railh&&(y.autohidedom=y.autohidedom.add(y.cursorh))):"hidden"==y.opt.autohidemode&&(y.autohidedom=!1,y.hide(),y.locked=!1);if(w.isie9mobile)y.scrollmom=new m(y),y.onmangotouch=function(e){e=y.getScrollTop();var t=y.getScrollLeft();if(e==y.scrollmom.lastscrolly&&t==y.scrollmom.lastscrollx)return!0;var n=e-y.mangotouch.sy,r=t-y.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(r,2)+Math.pow(n,2)))){var i=0>n?-1:1,s=0>r?-1:1,o=+(new Date);y.mangotouch.lazy&&clearTimeout(y.mangotouch.lazy),80<o-y.mangotouch.tm||y.mangotouch.dry!=i||y.mangotouch.drx!=s?(y.scrollmom.stop(),y.scrollmom.reset(t,e),y.mangotouch.sy=e,y.mangotouch.ly=e,y.mangotouch.sx=t,y.mangotouch.lx=t,y.mangotouch.dry=i,y.mangotouch.drx=s,y.mangotouch.tm=o):(y.scrollmom.stop(),y.scrollmom.update(y.mangotouch.sx-r,y.mangotouch.sy-n),y.mangotouch.tm=o,n=Math.max(Math.abs(y.mangotouch.ly-e),Math.abs(y.mangotouch.lx-t)),y.mangotouch.ly=e,y.mangotouch.lx=t,2<n&&(y.mangotouch.lazy=setTimeout(function(){y.mangotouch.lazy=!1,y.mangotouch.dry=0,y.mangotouch.drx=0,y.mangotouch.tm=0,y.scrollmom.doMomentum(30)},100)))}},u=y.getScrollTop(),d=y.getScrollLeft(),y.mangotouch={sy:u,ly:u,dry:0,sx:d,lx:d,drx:0,lazy:!1,tm:0},y.bind(y.docscroll,"scroll",y.onmangotouch);else{if(w.cantouch||y.istouchcapable||y.opt.touchbehavior||w.hasmstouch){y.scrollmom=new m(y),y.ontouchstart=function(t){if(t.pointerType&&2!=t.pointerType)return!1;y.hasmoving=!1;if(!y.locked){if(w.hasmstouch)for(var n=t.target?t.target:!1;n;){var r=e(n).getNiceScroll();if(0<r.length&&r[0].me==y.me)break;if(0<r.length)return!1;if("DIV"==n.nodeName&&n.id==y.id)break;n=n.parentNode?n.parentNode:!1}y.cancelScroll();if((n=y.getTarget(t))&&/INPUT/i.test(n.nodeName)&&/range/i.test(n.type))return y.stopPropagation(t);!("clientX"in t)&&"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),y.forcescreen&&(r=t,t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY),y.rail.drag={x:t.clientX,y:t.clientY,sx:y.scroll.x,sy:y.scroll.y,st:y.getScrollTop(),sl:y.getScrollLeft(),pt:2,dl:!1};if(y.ispage||!y.opt.directionlockdeadzone)y.rail.drag.dl="f";else{var r=e(window).width(),i=e(window).height(),s=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),i=Math.max(0,o-i),r=Math.max(0,s-r);y.rail.drag.ck=!y.rail.scrollable&&y.railh.scrollable?0<i?"v":!1:y.rail.scrollable&&!y.railh.scrollable?0<r?"h":!1:!1,y.rail.drag.ck||(y.rail.drag.dl="f")}y.opt.touchbehavior&&y.isiframe&&w.isie&&(r=y.win.position(),y.rail.drag.x+=r.left,y.rail.drag.y+=r.top),y.hasmoving=!1,y.lastmouseup=!1,y.scrollmom.reset(t.clientX,t.clientY);if(!w.cantouch&&!this.istouchcapable&&!w.hasmstouch){if(!n||!/INPUT|SELECT|TEXTAREA/i.test(n.nodeName))return!y.ispage&&w.hasmousecapture&&n.setCapture(),y.opt.touchbehavior?(n.onclick&&!n._onclick&&(n._onclick=n.onclick,n.onclick=function(e){if(y.hasmoving)return!1;n._onclick.call(this,e)}),y.cancelEvent(t)):y.stopPropagation(t);/SUBMIT|CANCEL|BUTTON/i.test(e(n).attr("type"))&&(pc={tg:n,click:!1},y.preventclick=pc)}}},y.ontouchend=function(e){if(e.pointerType&&2!=e.pointerType)return!1;if(y.rail.drag&&2==y.rail.drag.pt&&(y.scrollmom.doMomentum(),y.rail.drag=!1,y.hasmoving&&(y.lastmouseup=!0,y.hideCursor(),w.hasmousecapture&&document.releaseCapture(),!w.cantouch)))return y.cancelEvent(e)};var v=y.opt.touchbehavior&&y.isiframe&&!w.hasmousecapture;y.ontouchmove=function(t,n){if(t.pointerType&&2!=t.pointerType)return!1;if(y.rail.drag&&2==y.rail.drag.pt){if(w.cantouch&&"undefined"==typeof t.original)return!0;y.hasmoving=!0,y.preventclick&&!y.preventclick.click&&(y.preventclick.click=y.preventclick.tg.onclick||!1,y.preventclick.tg.onclick=y.onpreventclick),t=e.extend({original:t},t),"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY);if(y.forcescreen){var r=t;t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY}r=ofy=0;if(v&&!n){var i=y.win.position(),r=-i.left;ofy=-i.top}var s=t.clientY+ofy,i=s-y.rail.drag.y,o=t.clientX+r,u=o-y.rail.drag.x,a=y.rail.drag.st-i;y.ishwscroll&&y.opt.bouncescroll?0>a?a=Math.round(a/2):a>y.page.maxh&&(a=y.page.maxh+Math.round((a-y.page.maxh)/2)):(0>a&&(s=a=0),a>y.page.maxh&&(a=y.page.maxh,s=0));if(y.railh&&y.railh.scrollable){var f=y.rail.drag.sl-u;y.ishwscroll&&y.opt.bouncescroll?0>f?f=Math.round(f/2):f>y.page.maxw&&(f=y.page.maxw+Math.round((f-y.page.maxw)/2)):(0>f&&(o=f=0),f>y.page.maxw&&(f=y.page.maxw,o=0))}r=!1;if(y.rail.drag.dl)r=!0,"v"==y.rail.drag.dl?f=y.rail.drag.sl:"h"==y.rail.drag.dl&&(a=y.rail.drag.st);else{var i=Math.abs(i),u=Math.abs(u),l=y.opt.directionlockdeadzone;if("v"==y.rail.drag.ck){if(i>l&&u<=.3*i)return y.rail.drag=!1,!0;u>l&&(y.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==y.rail.drag.ck){if(u>l&&i<=.3*u)return y.rail.drag=!1,!0;i>l&&(y.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}y.synched("touchmove",function(){y.rail.drag&&2==y.rail.drag.pt&&(y.prepareTransition&&y.prepareTransition(0),y.rail.scrollable&&y.setScrollTop(a),y.scrollmom.update(o,s),y.railh&&y.railh.scrollable?(y.setScrollLeft(f),y.showCursor(a,f)):y.showCursor(a),w.isie10&&document.selection.clear())}),w.ischrome&&y.istouchcapable&&(r=!1);if(r)return y.cancelEvent(t)}}}y.onmousedown=function(e,t){if(!y.rail.drag||1==y.rail.drag.pt){if(y.locked)return y.cancelEvent(e);y.cancelScroll(),y.rail.drag={x:e.clientX,y:e.clientY,sx:y.scroll.x,sy:y.scroll.y,pt:1,hr:!!t};var n=y.getTarget(e);return!y.ispage&&w.hasmousecapture&&n.setCapture(),y.isiframe&&!w.hasmousecapture&&(y.saved.csspointerevents=y.doc.css("pointer-events"),y.css(y.doc,{"pointer-events":"none"})),y.hasmoving=!1,y.cancelEvent(e)}},y.onmouseup=function(e){if(y.rail.drag&&(w.hasmousecapture&&document.releaseCapture(),y.isiframe&&!w.hasmousecapture&&y.doc.css("pointer-events",y.saved.csspointerevents),1==y.rail.drag.pt))return y.rail.drag=!1,y.hasmoving&&y.triggerScrollEnd(),y.cancelEvent(e)},y.onmousemove=function(e){if(y.rail.drag&&1==y.rail.drag.pt){if(w.ischrome&&0==e.which)return y.onmouseup(e);y.cursorfreezed=!0,y.hasmoving=!0;if(y.rail.drag.hr){y.scroll.x=y.rail.drag.sx+(e.clientX-y.rail.drag.x),0>y.scroll.x&&(y.scroll.x=0);var t=y.scrollvaluemaxw;y.scroll.x>t&&(y.scroll.x=t)}else y.scroll.y=y.rail.drag.sy+(e.clientY-y.rail.drag.y),0>y.scroll.y&&(y.scroll.y=0),t=y.scrollvaluemax,y.scroll.y>t&&(y.scroll.y=t);return y.synched("mousemove",function(){y.rail.drag&&1==y.rail.drag.pt&&(y.showCursor(),y.rail.drag.hr?y.doScrollLeft(Math.round(y.scroll.x*y.scrollratio.x),y.opt.cursordragspeed):y.doScrollTop(Math.round(y.scroll.y*y.scrollratio.y),y.opt.cursordragspeed))}),y.cancelEvent(e)}};if(w.cantouch||y.opt.touchbehavior)y.onpreventclick=function(e){if(y.preventclick)return y.preventclick.tg.onclick=y.preventclick.click,y.preventclick=!1,y.cancelEvent(e)},y.bind(y.win,"mousedown",y.ontouchstart),y.onclick=w.isios?!1:function(e){return y.lastmouseup?(y.lastmouseup=!1,y.cancelEvent(e)):!0},y.opt.grabcursorenabled&&w.cursorgrabvalue&&(y.css(y.ispage?y.doc:y.win,{cursor:w.cursorgrabvalue}),y.css(y.rail,{cursor:w.cursorgrabvalue}));else{var g=function(e){if(y.selectiondrag){if(e){var t=y.win.outerHeight();e=e.pageY-y.selectiondrag.top,0<e&&e<t&&(e=0),e>=t&&(e-=t),y.selectiondrag.df=e}0!=y.selectiondrag.df&&(y.doScrollBy(2*-Math.floor(y.selectiondrag.df/6)),y.debounced("doselectionscroll",function(){g()},50))}};y.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},y.onselectionstart=function(e){y.ispage||(y.selectiondrag=y.win.offset())},y.onselectionend=function(e){y.selectiondrag=!1},y.onselectiondrag=function(e){y.selectiondrag&&y.hasTextSelected()&&y.debounced("selectionscroll",function(){g(e)},250)}}w.hasmstouch&&(y.css(y.rail,{"-ms-touch-action":"none"}),y.css(y.cursor,{"-ms-touch-action":"none"}),y.bind(y.win,"MSPointerDown",y.ontouchstart),y.bind(document,"MSPointerUp",y.ontouchend),y.bind(document,"MSPointerMove",y.ontouchmove),y.bind(y.cursor,"MSGestureHold",function(e){e.preventDefault()}),y.bind(y.cursor,"contextmenu",function(e){e.preventDefault()})),this.istouchcapable&&(y.bind(y.win,"touchstart",y.ontouchstart),y.bind(document,"touchend",y.ontouchend),y.bind(document,"touchcancel",y.ontouchend),y.bind(document,"touchmove",y.ontouchmove)),y.bind(y.cursor,"mousedown",y.onmousedown),y.bind(y.cursor,"mouseup",y.onmouseup),y.railh&&(y.bind(y.cursorh,"mousedown",function(e){y.onmousedown(e,!0)}),y.bind(y.cursorh,"mouseup",y.onmouseup));if(y.opt.cursordragontouch||!w.cantouch&&!y.opt.touchbehavior)y.rail.css({cursor:"default"}),y.railh&&y.railh.css({cursor:"default"}),y.jqbind(y.rail,"mouseenter",function(){if(!y.win.is(":visible"))return!1;y.canshowonmouseevent&&y.showCursor(),y.rail.active=!0}),y.jqbind(y.rail,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}),y.opt.sensitiverail&&(y.bind(y.rail,"click",function(e){y.doRailClick(e,!1,!1)}),y.bind(y.rail,"dblclick",function(e){y.doRailClick(e,!0,!1)}),y.bind(y.cursor,"click",function(e){y.cancelEvent(e)}),y.bind(y.cursor,"dblclick",function(e){y.cancelEvent(e)})),y.railh&&(y.jqbind(y.railh,"mouseenter",function(){if(!y.win.is(":visible"))return!1;y.canshowonmouseevent&&y.showCursor(),y.rail.active=!0}),y.jqbind(y.railh,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}),y.opt.sensitiverail&&(y.bind(y.railh,"click",function(e){y.doRailClick(e,!1,!0)}),y.bind(y.railh,"dblclick",function(e){y.doRailClick(e,!0,!0)}),y.bind(y.cursorh,"click",function(e){y.cancelEvent(e)}),y.bind(y.cursorh,"dblclick",function(e){y.cancelEvent(e)})));!w.cantouch&&!y.opt.touchbehavior?(y.bind(w.hasmousecapture?y.win:document,"mouseup",y.onmouseup),y.bind(document,"mousemove",y.onmousemove),y.onclick&&y.bind(document,"click",y.onclick),!y.ispage&&y.opt.enablescrollonselection&&(y.bind(y.win[0],"mousedown",y.onselectionstart),y.bind(document,"mouseup",y.onselectionend),y.bind(y.cursor,"mouseup",y.onselectionend),y.cursorh&&y.bind(y.cursorh,"mouseup",y.onselectionend),y.bind(document,"mousemove",y.onselectiondrag)),y.zoom&&(y.jqbind(y.zoom,"mouseenter",function(){y.canshowonmouseevent&&y.showCursor(),y.rail.active=!0}),y.jqbind(y.zoom,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}))):(y.bind(w.hasmousecapture?y.win:document,"mouseup",y.ontouchend),y.bind(document,"mousemove",y.ontouchmove),y.onclick&&y.bind(document,"click",y.onclick),y.opt.cursordragontouch&&(y.bind(y.cursor,"mousedown",y.onmousedown),y.bind(y.cursor,"mousemove",y.onmousemove),y.cursorh&&y.bind(y.cursorh,"mousedown",function(e){y.onmousedown(e,!0)}),y.cursorh&&y.bind(y.cursorh,"mousemove",y.onmousemove))),y.opt.enablemousewheel&&(y.isiframe||y.bind(w.isie&&y.ispage?document:y.win,"mousewheel",y.onmousewheel),y.bind(y.rail,"mousewheel",y.onmousewheel),y.railh&&y.bind(y.railh,"mousewheel",y.onmousewheelhr)),!y.ispage&&!w.cantouch&&!/HTML|^BODY/.test(y.win[0].nodeName)&&(y.win.attr("tabindex")||y.win.attr({tabindex:r++}),y.jqbind(y.win,"focus",function(e){t=y.getTarget(e).id||!0,y.hasfocus=!0,y.canshowonmouseevent&&y.noticeCursor()}),y.jqbind(y.win,"blur",function(e){t=!1,y.hasfocus=!1}),y.jqbind(y.win,"mouseenter",function(e){n=y.getTarget(e).id||!0,y.hasmousefocus=!0,y.canshowonmouseevent&&y.noticeCursor()}),y.jqbind(y.win,"mouseleave",function(){n=!1,y.hasmousefocus=!1,y.rail.drag||y.hideCursor()}))}y.onkeypress=function(r){if(y.locked&&0==y.page.maxh)return!0;r=r?r:window.e;var i=y.getTarget(r);if(i&&/INPUT|TEXTAREA|SELECT|OPTION/.test(i.nodeName)&&(!i.getAttribute("type")&&!i.type||!/submit|button|cancel/i.tp)||e(i).attr("contenteditable"))return!0;if(y.hasfocus||y.hasmousefocus&&!t||y.ispage&&!t&&!n){i=r.keyCode;if(y.locked&&27!=i)return y.cancelEvent(r);var s=r.ctrlKey||!1,o=r.shiftKey||!1,u=!1;switch(i){case 38:case 63233:y.doScrollBy(72),u=!0;break;case 40:case 63235:y.doScrollBy(-72),u=!0;break;case 37:case 63232:y.railh&&(s?y.doScrollLeft(0):y.doScrollLeftBy(72),u=!0);break;case 39:case 63234:y.railh&&(s?y.doScrollLeft(y.page.maxw):y.doScrollLeftBy(-72),u=!0);break;case 33:case 63276:y.doScrollBy(y.view.h),u=!0;break;case 34:case 63277:y.doScrollBy(-y.view.h),u=!0;break;case 36:case 63273:y.railh&&s?y.doScrollPos(0,0):y.doScrollTo(0),u=!0;break;case 35:case 63275:y.railh&&s?y.doScrollPos(y.page.maxw,y.page.maxh):y.doScrollTo(y.page.maxh),u=!0;break;case 32:y.opt.spacebarenabled&&(o?y.doScrollBy(y.view.h):y.doScrollBy(-y.view.h),u=!0);break;case 27:y.zoomactive&&(y.doZoom(),u=!0)}if(u)return y.cancelEvent(r)}},y.opt.enablekeyboard&&y.bind(document,w.isopera&&!w.isopera12?"keypress":"keydown",y.onkeypress),y.bind(document,"keydown",function(e){e.ctrlKey&&(y.wheelprevented=!0)}),y.bind(document,"keyup",function(e){e.ctrlKey||(y.wheelprevented=!1)}),y.bind(window,"resize",y.lazyResize),y.bind(window,"orientationchange",y.lazyResize),y.bind(window,"load",y.lazyResize);if(w.ischrome&&!y.ispage&&!y.haswrapper){var b=y.win.attr("style"),u=parseFloat(y.win.css("width"))+1;y.win.css("width",u),y.synched("chromefix",function(){y.win.attr("style",b)})}y.onAttributeChange=function(e){y.lazyResize(250)},!y.ispage&&!y.haswrapper&&(!1!==c?(y.observer=new c(function(e){e.forEach(y.onAttributeChange)}),y.observer.observe(y.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),y.observerremover=new c(function(e){e.forEach(function(e){if(0<e.removedNodes.length)for(var t in e.removedNodes)if(e.removedNodes[t]==y.win[0])return y.remove()})}),y.observerremover.observe(y.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(y.bind(y.win,w.isie&&!w.isie9?"propertychange":"DOMAttrModified",y.onAttributeChange),w.isie9&&y.win[0].attachEvent("onpropertychange",y.onAttributeChange),y.bind(y.win,"DOMNodeRemoved",function(e){e.target==y.win[0]&&y.remove()}))),!y.ispage&&y.opt.boxzoom&&y.bind(window,"resize",y.resizeZoom),y.istextarea&&y.bind(y.win,"mouseup",y.lazyResize),y.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var E=function(t){y.iframexd=!1;try{var n="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(r){y.iframexd=!0,n=!1}if(y.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;y.forcescreen=!0,y.isiframe&&(y.iframe={doc:e(n),html:y.doc.contents().find("html")[0],body:y.doc.contents().find("body")[0]},y.getContentSize=function(){return{w:Math.max(y.iframe.html.scrollWidth,y.iframe.body.scrollWidth),h:Math.max(y.iframe.html.scrollHeight,y.iframe.body.scrollHeight)}},y.docscroll=e(y.iframe.body)),!w.isios&&y.opt.iframeautoresize&&!y.isiframe&&(y.win.scrollTop(0),y.doc.height(""),t=Math.max(n.getElementsByTagName("html")[0].scrollHeight,n.body.scrollHeight),y.doc.height(t)),y.lazyResize(30),w.isie7&&y.css(e(y.iframe.html),{"overflow-y":"hidden"}),y.css(e(y.iframe.body),{"overflow-y":"hidden"}),w.isios&&y.haswrapper&&y.css(e(n.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?y.bind(this.contentWindow,"scroll",y.onscroll):y.bind(n,"scroll",y.onscroll),y.opt.enablemousewheel&&y.bind(n,"mousewheel",y.onmousewheel),y.opt.enablekeyboard&&y.bind(n,w.isopera?"keypress":"keydown",y.onkeypress);if(w.cantouch||y.opt.touchbehavior)y.bind(n,"mousedown",y.ontouchstart),y.bind(n,"mousemove",function(e){y.ontouchmove(e,!0)}),y.opt.grabcursorenabled&&w.cursorgrabvalue&&y.css(e(n.body),{cursor:w.cursorgrabvalue});y.bind(n,"mouseup",y.ontouchend),y.zoom&&(y.opt.dblclickzoom&&y.bind(n,"dblclick",y.doZoom),y.ongesturezoom&&y.bind(n,"gestureend",y.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){E.call(y.doc[0],!1)},500),y.bind(this.doc,"load",E)}},this.showCursor=function(e,t){y.cursortimeout&&(clearTimeout(y.cursortimeout),y.cursortimeout=0);if(y.rail){y.autohidedom&&(y.autohidedom.stop().css({opacity:y.opt.cursoropacitymax}),y.cursoractive=!0);if(!y.rail.drag||1!=y.rail.drag.pt)"undefined"!=typeof e&&!1!==e&&(y.scroll.y=Math.round(1*e/y.scrollratio.y)),"undefined"!=typeof t&&(y.scroll.x=Math.round(1*t/y.scrollratio.x));y.cursor.css({height:y.cursorheight,top:y.scroll.y}),y.cursorh&&(!y.rail.align&&y.rail.visibility?y.cursorh.css({width:y.cursorwidth,left:y.scroll.x+y.rail.width}):y.cursorh.css({width:y.cursorwidth,left:y.scroll.x}),y.cursoractive=!0),y.zoom&&y.zoom.stop().css({opacity:y.opt.cursoropacitymax})}},this.hideCursor=function(e){!y.cursortimeout&&y.rail&&y.autohidedom&&(!y.hasmousefocus||"leave"!=y.opt.autohidemode)&&(y.cursortimeout=setTimeout(function(){if(!y.rail.active||!y.showonmouseevent)y.autohidedom.stop().animate({opacity:y.opt.cursoropacitymin}),y.zoom&&y.zoom.stop().animate({opacity:y.opt.cursoropacitymin}),y.cursoractive=!1;y.cursortimeout=0},e||y.opt.hidecursordelay))},this.noticeCursor=function(e,t,n){y.showCursor(t,n),y.rail.active||y.hideCursor(e)},this.getContentSize=y.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:y.haswrapper?function(){return{w:y.doc.outerWidth()+parseInt(y.win.css("paddingLeft"))+parseInt(y.win.css("paddingRight")),h:y.doc.outerHeight()+parseInt(y.win.css("paddingTop"))+parseInt(y.win.css("paddingBottom"))}}:function(){return{w:y.docscroll[0].scrollWidth,h:y.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!y||!y.win)return!1;if(!y.haswrapper&&!y.ispage){if("none"==y.win.css("display"))return y.visibility&&y.hideRail().hideRailHr(),!1;!y.hidden&&!y.visibility&&y.showRail().showRailHr()}var n=y.page.maxh,r=y.page.maxw,i=y.view.w;y.view={w:y.ispage?y.win.width():parseInt(y.win[0].clientWidth),h:y.ispage?y.win.height():parseInt(y.win[0].clientHeight)},y.page=t?t:y.getContentSize(),y.page.maxh=Math.max(0,y.page.h-y.view.h),y.page.maxw=Math.max(0,y.page.w-y.view.w);if(y.page.maxh==n&&y.page.maxw==r&&y.view.w==i){if(y.ispage)return y;n=y.win.offset();if(y.lastposition&&(r=y.lastposition,r.top==n.top&&r.left==n.left))return y;y.lastposition=n}return 0==y.page.maxh?(y.hideRail(),y.scrollvaluemax=0,y.scroll.y=0,y.scrollratio.y=0,y.cursorheight=0,y.setScrollTop(0),y.rail.scrollable=!1):y.rail.scrollable=!0,0==y.page.maxw?(y.hideRailHr(),y.scrollvaluemaxw=0,y.scroll.x=0,y.scrollratio.x=0,y.cursorwidth=0,y.setScrollLeft(0),y.railh.scrollable=!1):y.railh.scrollable=!0,y.locked=0==y.page.maxh&&0==y.page.maxw,y.locked?(y.ispage||y.updateScrollBar(y.view),!1):(!y.hidden&&!y.visibility?y.showRail().showRailHr():!y.hidden&&!y.railh.visibility&&y.showRailHr(),y.istextarea&&y.win.css("resize")&&"none"!=y.win.css("resize")&&(y.view.h-=20),y.cursorheight=Math.min(y.view.h,Math.round(y.view.h*(y.view.h/y.page.h))),y.cursorheight=y.opt.cursorfixedheight?y.opt.cursorfixedheight:Math.max(y.opt.cursorminheight,y.cursorheight),y.cursorwidth=Math.min(y.view.w,Math.round(y.view.w*(y.view.w/y.page.w))),y.cursorwidth=y.opt.cursorfixedheight?y.opt.cursorfixedheight:Math.max(y.opt.cursorminheight,y.cursorwidth),y.scrollvaluemax=y.view.h-y.cursorheight-y.cursor.hborder,y.railh&&(y.railh.width=0<y.page.maxh?y.view.w-y.rail.width:y.view.w,y.scrollvaluemaxw=y.railh.width-y.cursorwidth-y.cursorh.wborder),y.ispage||y.updateScrollBar(y.view),y.scrollratio={x:y.page.maxw/y.scrollvaluemaxw,y:y.page.maxh/y.scrollvaluemax},y.getScrollTop()>y.page.maxh?y.doScrollTop(y.page.maxh):(y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.scroll.x=Math.round(y.getScrollLeft()*(1/y.scrollratio.x)),y.cursoractive&&y.noticeCursor()),y.scroll.y&&0==y.getScrollTop()&&y.doScrollTo(Math.floor(y.scroll.y*y.scrollratio.y)),y)},this.resize=y.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,y.delayed("resize",y.resize,e),y},this._bind=function(e,t,n,r){y.events.push({e:e,n:t,f:n,b:r,q:!1}),e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},this.jqbind=function(t,n,r){y.events.push({e:t,n:n,f:r,q:!0}),e(t).bind(n,r)},this.bind=function(e,t,n,r){var i="jquery"in e?e[0]:e;"mousewheel"==t?"onwheel"in y.win?y._bind(i,"wheel",n,r||!1):(e="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll",v(i,e,n,r||!1),"DOMMouseScroll"==e&&v(i,"MozMousePixelScroll",n,r||!1)):i.addEventListener?(w.cantouch&&/mouseup|mousedown|mousemove/.test(t)&&y._bind(i,"mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove",function(e){if(e.touches){if(2>e.touches.length){var t=e.touches.length?e.touches[0]:e;t.original=e,n.call(this,t)}}else e.changedTouches&&(t=e.changedTouches[0],t.original=e,n.call(this,t))},r||!1),y._bind(i,t,n,r||!1),w.cantouch&&"mouseup"==t&&y._bind(i,"touchcancel",n,r||!1)):y._bind(i,t,function(e){return(e=e||window.event||!1)&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),!1===n.call(i,e)||!1===r?y.cancelEvent(e):!0})},this._unbind=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=!1},this.unbindAll=function(){for(var e=0;e<y.events.length;e++){var t=y.events[e];t.q?t.e.unbind(t.n,t.f):y._unbind(t.e,t.n,t.f,t.b)}},this.cancelEvent=function(e){return e=e.original?e.original:e?e:window.event||!1,e?(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1):!1},this.stopPropagation=function(e){return e=e.original?e.original:e?e:window.event||!1,e?e.stopPropagation?e.stopPropagation():(e.cancelBubble&&(e.cancelBubble=!0),!1):!1},this.showRail=function(){return 0!=y.page.maxh&&(y.ispage||"none"!=y.win.css("display"))&&(y.visibility=!0,y.rail.visibility=!0,y.rail.css("display","block")),y},this.showRailHr=function(){return y.railh?(0!=y.page.maxw&&(y.ispage||"none"!=y.win.css("display"))&&(y.railh.visibility=!0,y.railh.css("display","block")),y):y},this.hideRail=function(){return y.visibility=!1,y.rail.visibility=!1,y.rail.css("display","none"),y},this.hideRailHr=function(){return y.railh?(y.railh.visibility=!1,y.railh.css("display","none"),y):y},this.show=function(){return y.hidden=!1,y.locked=!1,y.showRail().showRailHr()},this.hide=function(){return y.hidden=!0,y.locked=!0,y.hideRail().hideRailHr()},this.toggle=function(){return y.hidden?y.show():y.hide()},this.remove=function(){y.stop(),y.cursortimeout&&clearTimeout(y.cursortimeout),y.doZoomOut(),y.unbindAll(),w.isie9&&y.win[0].detachEvent("onpropertychange",y.onAttributeChange),!1!==y.observer&&y.observer.disconnect(),!1!==y.observerremover&&y.observerremover.disconnect(),y.events=null,y.cursor&&y.cursor.remove(),y.cursorh&&y.cursorh.remove(),y.rail&&y.rail.remove(),y.railh&&y.railh.remove(),y.zoom&&y.zoom.remove();for(var t=0;t<y.saved.css.length;t++){var n=y.saved.css[t];n[0].css(n[1],"undefined"==typeof n[2]?"":n[2])}y.saved=!1,y.me.data("__nicescroll","");var r=e.nicescroll;r.each(function(e){if(this&&this.id===y.id){delete r[e];for(var t=++e;t<r.length;t++,e++)r[e]=r[t];r.length--,r.length&&delete r[r.length]}});for(var i in y)y[i]=null,delete y[i];y=null},this.scrollstart=function(e){return this.onscrollstart=e,y},this.scrollend=function(e){return this.onscrollend=e,y},this.scrollcancel=function(e){return this.onscrollcancel=e,y},this.zoomin=function(e){return this.onzoomin=e,y},this.zoomout=function(e){return this.onzoomout=e,y},this.isScrollable=function(t){t=t.target?t.target:t;if("OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var n=e(t),n=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(n))return t.clientHeight!=t.scrollHeight;t=t.parentNode?t.parentNode:!1}return!1},this.getViewport=function(t){for(t=t&&t.parentNode?t.parentNode:!1;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var n=e(t);if(/fixed|absolute/.test(n.css("position")))return n;var r=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(r)&&t.clientHeight!=t.scrollHeight||0<n.getNiceScroll().length)return n;t=t.parentNode?t.parentNode:!1}return t?e(t):!1},this.triggerScrollEnd=function(){if(y.onscrollend){var e=y.getScrollLeft(),t=y.getScrollTop();y.onscrollend.call(y,{type:"scrollend",current:{x:e,y:t},end:{x:e,y:t}})}},this.onmousewheel=function(e){if(!y.wheelprevented){if(y.locked)return y.debounced("checkunlock",y.resize,250),!0;if(y.rail.drag)return y.cancelEvent(e);"auto"==y.opt.oneaxismousemode&&0!=e.deltaX&&(y.opt.oneaxismousemode=!1);if(y.opt.oneaxismousemode&&0==e.deltaX&&!y.rail.scrollable)return y.railh&&y.railh.scrollable?y.onmousewheelhr(e):!0;var t=+(new Date),n=!1;y.opt.preservenativescrolling&&y.checkarea+600<t&&(y.nativescrollingarea=y.isScrollable(e),n=!0),y.checkarea=t;if(y.nativescrollingarea)return!0;if(e=g(e,!1,n))y.checkarea=0;return e}},this.onmousewheelhr=function(e){if(!y.wheelprevented){if(y.locked||!y.railh.scrollable)return!0;if(y.rail.drag)return y.cancelEvent(e);var t=+(new Date),n=!1;return y.opt.preservenativescrolling&&y.checkarea+600<t&&(y.nativescrollingarea=y.isScrollable(e),n=!0),y.checkarea=t,y.nativescrollingarea?!0:y.locked?y.cancelEvent(e):g(e,!0,n)}},this.stop=function(){return y.cancelScroll(),y.scrollmon&&y.scrollmon.stop(),y.cursorfreezed=!1,y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.noticeCursor(),y},this.getTransitionSpeed=function(e){var t=Math.round(10*y.opt.scrollspeed);return e=Math.min(t,Math.round(e/20*y.opt.scrollspeed)),20<e?e:0},y.opt.smoothscroll?y.ishwscroll&&w.hastransition&&y.opt.usetransition?(this.prepareTransition=function(e,t){var n=t?20<e?e:0:y.getTransitionSpeed(e),r=n?w.prefixstyle+"transform "+n+"ms ease-out":"";if(!y.lasttransitionstyle||y.lasttransitionstyle!=r)y.lasttransitionstyle=r,y.doc.css(w.transitionstyle,r);return n},this.doScrollLeft=function(e,t){var n=y.scrollrunning?y.newscrolly:y.getScrollTop();y.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=y.scrollrunning?y.newscrollx:y.getScrollLeft();y.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var r=y.getScrollTop(),i=y.getScrollLeft();(0>(y.newscrolly-r)*(t-r)||0>(y.newscrollx-i)*(e-i))&&y.cancelScroll(),0==y.opt.bouncescroll&&(0>t?t=0:t>y.page.maxh&&(t=y.page.maxh),0>e?e=0:e>y.page.maxw&&(e=y.page.maxw));if(y.scrollrunning&&e==y.newscrollx&&t==y.newscrolly)return!1;y.newscrolly=t,y.newscrollx=e,y.newscrollspeed=n||!1;if(y.timer)return!1;y.timer=setTimeout(function(){var n=y.getScrollTop(),r=y.getScrollLeft(),i,s;i=e-r,s=t-n,i=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(s,2))),i=y.newscrollspeed&&1<y.newscrollspeed?y.newscrollspeed:y.getTransitionSpeed(i),y.newscrollspeed&&1>=y.newscrollspeed&&(i*=y.newscrollspeed),y.prepareTransition(i,!0),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),0<i&&(!y.scrollrunning&&y.onscrollstart&&y.onscrollstart.call(y,{type:"scrollstart",current:{x:r,y:n},request:{x:e,y:t},end:{x:y.newscrollx,y:y.newscrolly},speed:i}),w.transitionend?y.scrollendtrapped||(y.scrollendtrapped=!0,y.bind(y.doc,w.transitionend,y.onScrollTransitionEnd,!1)):(y.scrollendtrapped&&clearTimeout(y.scrollendtrapped),y.scrollendtrapped=setTimeout(y.onScrollTransitionEnd,i)),y.timerscroll={bz:new BezierClass(n,y.newscrolly,i,0,0,.58,1),bh:new BezierClass(r,y.newscrollx,i,0,0,.58,1)},y.cursorfreezed||(y.timerscroll.tm=setInterval(function(){y.showCursor(y.getScrollTop(),y.getScrollLeft())},60))),y.synched("doScroll-set",function(){y.timer=0,y.scrollendtrapped&&(y.scrollrunning=!0),y.setScrollTop(y.newscrolly),y.setScrollLeft(y.newscrollx),y.scrollendtrapped||y.onScrollTransitionEnd()})},50)},this.cancelScroll=function(){if(!y.scrollendtrapped)return!0;var e=y.getScrollTop(),t=y.getScrollLeft();return y.scrollrunning=!1,w.transitionend||clearTimeout(w.transitionend),y.scrollendtrapped=!1,y._unbind(y.doc,w.transitionend,y.onScrollTransitionEnd),y.prepareTransition(0),y.setScrollTop(e),y.railh&&y.setScrollLeft(t),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),y.timerscroll=!1,y.cursorfreezed=!1,y.showCursor(e,t),y},this.onScrollTransitionEnd=function(){y.scrollendtrapped&&y._unbind(y.doc,w.transitionend,y.onScrollTransitionEnd),y.scrollendtrapped=!1,y.prepareTransition(0),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),y.timerscroll=!1;var e=y.getScrollTop(),t=y.getScrollLeft();y.setScrollTop(e),y.railh&&y.setScrollLeft(t),y.noticeCursor(!1,e,t),y.cursorfreezed=!1,0>e?e=0:e>y.page.maxh&&(e=y.page.maxh),0>t?t=0:t>y.page.maxw&&(t=y.page.maxw);if(e!=y.newscrolly||t!=y.newscrollx)return y.doScrollPos(t,e,y.opt.snapbackspeed);y.onscrollend&&y.scrollrunning&&y.triggerScrollEnd(),y.scrollrunning=!1}):(this.doScrollLeft=function(e,t){var n=y.scrollrunning?y.newscrolly:y.getScrollTop();y.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=y.scrollrunning?y.newscrollx:y.getScrollLeft();y.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){function r(){if(y.cancelAnimationFrame)return!0;y.scrollrunning=!0;if(c=1-c)return y.timer=u(r)||1;var e=0,t=sy=y.getScrollTop();if(y.dst.ay){var t=y.bzscroll?y.dst.py+y.bzscroll.getNow()*y.dst.ay:y.newscrolly,n=t-sy;if(0>n&&t<y.newscrolly||0<n&&t>y.newscrolly)t=y.newscrolly;y.setScrollTop(t),t==y.newscrolly&&(e=1)}else e=1;var i=sx=y.getScrollLeft();if(y.dst.ax){i=y.bzscroll?y.dst.px+y.bzscroll.getNow()*y.dst.ax:y.newscrollx,n=i-sx;if(0>n&&i<y.newscrollx||0<n&&i>y.newscrollx)i=y.newscrollx;y.setScrollLeft(i),i==y.newscrollx&&(e+=1)}else e+=1;2==e?(y.timer=0,y.cursorfreezed=!1,y.bzscroll=!1,y.scrollrunning=!1,0>t?t=0:t>y.page.maxh&&(t=y.page.maxh),0>i?i=0:i>y.page.maxw&&(i=y.page.maxw),i!=y.newscrollx||t!=y.newscrolly?y.doScrollPos(i,t):y.onscrollend&&y.triggerScrollEnd()):y.timer=u(r)||1}t="undefined"==typeof t||!1===t?y.getScrollTop(!0):t;if(y.timer&&y.newscrolly==t&&y.newscrollx==e)return!0;y.timer&&a(y.timer),y.timer=0;var i=y.getScrollTop(),s=y.getScrollLeft();(0>(y.newscrolly-i)*(t-i)||0>(y.newscrollx-s)*(e-s))&&y.cancelScroll(),y.newscrolly=t,y.newscrollx=e;if(!y.bouncescroll||!y.rail.visibility)0>y.newscrolly?y.newscrolly=0:y.newscrolly>y.page.maxh&&(y.newscrolly=y.page.maxh);if(!y.bouncescroll||!y.railh.visibility)0>y.newscrollx?y.newscrollx=0:y.newscrollx>y.page.maxw&&(y.newscrollx=y.page.maxw);y.dst={},y.dst.x=e-s,y.dst.y=t-i,y.dst.px=s,y.dst.py=i;var o=Math.round(Math.sqrt(Math.pow(y.dst.x,2)+Math.pow(y.dst.y,2)));y.dst.ax=y.dst.x/o,y.dst.ay=y.dst.y/o;var f=0,l=o;0==y.dst.x?(f=i,l=t,y.dst.ay=1,y.dst.py=0):0==y.dst.y&&(f=s,l=e,y.dst.ax=1,y.dst.px=0),o=y.getTransitionSpeed(o),n&&1>=n&&(o*=n),y.bzscroll=0<o?y.bzscroll?y.bzscroll.update(l,o):new BezierClass(f,l,o,0,1,0,1):!1;if(!y.timer){(i==y.page.maxh&&t>=y.page.maxh||s==y.page.maxw&&e>=y.page.maxw)&&y.checkContentSize();var c=1;y.cancelAnimationFrame=!1,y.timer=1,y.onscrollstart&&!y.scrollrunning&&y.onscrollstart.call(y,{type:"scrollstart",current:{x:s,y:i},request:{x:e,y:t},end:{x:y.newscrollx,y:y.newscrolly},speed:o}),r(),(i==y.page.maxh&&t>=i||s==y.page.maxw&&e>=s)&&y.checkContentSize(),y.noticeCursor()}},this.cancelScroll=function(){return y.timer&&a(y.timer),y.timer=0,y.bzscroll=!1,y.scrollrunning=!1,y}):(this.doScrollLeft=function(e,t){var n=y.getScrollTop();y.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=y.getScrollLeft();y.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var r=e>y.page.maxw?y.page.maxw:e;0>r&&(r=0);var i=t>y.page.maxh?y.page.maxh:t;0>i&&(i=0),y.synched("scroll",function(){y.setScrollTop(i),y.setScrollLeft(r)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var n=0,n=t?Math.floor((y.scroll.y-e)*y.scrollratio.y):(y.timer?y.newscrolly:y.getScrollTop(!0))-e;if(y.bouncescroll){var r=Math.round(y.view.h/2);n<-r?n=-r:n>y.page.maxh+r&&(n=y.page.maxh+r)}y.cursorfreezed=!1,py=y.getScrollTop(!0);if(0>n&&0>=py)return y.noticeCursor();if(n>y.page.maxh&&py>=y.page.maxh)return y.checkContentSize(),y.noticeCursor();y.doScrollTop(n)},this.doScrollLeftBy=function(e,t){var n=0,n=t?Math.floor((y.scroll.x-e)*y.scrollratio.x):(y.timer?y.newscrollx:y.getScrollLeft(!0))-e;if(y.bouncescroll){var r=Math.round(y.view.w/2);n<-r?n=-r:n>y.page.maxw+r&&(n=y.page.maxw+r)}y.cursorfreezed=!1,px=y.getScrollLeft(!0);if(0>n&&0>=px||n>y.page.maxw&&px>=y.page.maxw)return y.noticeCursor();y.doScrollLeft(n)},this.doScrollTo=function(e,t){t&&Math.round(e*y.scrollratio.y),y.cursorfreezed=!1,y.doScrollTop(e)},this.checkContentSize=function(){var e=y.getContentSize();(e.h!=y.page.h||e.w!=y.page.w)&&y.resize(!1,e)},y.onscroll=function(e){y.rail.drag||y.cursorfreezed||y.synched("scroll",function(){y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.railh&&(y.scroll.x=Math.round(y.getScrollLeft()*(1/y.scrollratio.x))),y.noticeCursor()})},y.bind(y.docscroll,"scroll",y.onscroll),this.doZoomIn=function(t){if(!y.zoomactive){y.zoomactive=!0,y.zoomrestore={style:{}};var n="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),r=y.win[0].style,i;for(i in n){var o=n[i];y.zoomrestore.style[o]="undefined"!=typeof r[o]?r[o]:""}return y.zoomrestore.style.width=y.win.css("width"),y.zoomrestore.style.height=y.win.css("height"),y.zoomrestore.padding={w:y.win.outerWidth()-y.win.width(),h:y.win.outerHeight()-y.win.height()},w.isios4&&(y.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0)),y.win.css({position:w.isios4?"absolute":"fixed",top:0,left:0,"z-index":s+100,margin:"0px"}),n=y.win.css("backgroundColor"),(""==n||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(n))&&y.win.css("backgroundColor","#fff"),y.rail.css({"z-index":s+101}),y.zoom.css({"z-index":s+102}),y.zoom.css("backgroundPosition","0px -18px"),y.resizeZoom(),y.onzoomin&&y.onzoomin.call(y),y.cancelEvent(t)}},this.doZoomOut=function(t){if(y.zoomactive)return y.zoomactive=!1,y.win.css("margin",""),y.win.css(y.zoomrestore.style),w.isios4&&e(window).scrollTop(y.zoomrestore.scrollTop),y.rail.css({"z-index":y.zindex}),y.zoom.css({"z-index":y.zindex}),y.zoomrestore=!1,y.zoom.css("backgroundPosition","0px 0px"),y.onResize(),y.onzoomout&&y.onzoomout.call(y),y.cancelEvent(t)},this.doZoom=function(e){return y.zoomactive?y.doZoomOut(e):y.doZoomIn(e)},this.resizeZoom=function(){if(y.zoomactive){var t=y.getScrollTop();y.win.css({width:e(window).width()-y.zoomrestore.padding.w+"px",height:e(window).height()-y.zoomrestore.padding.h+"px"}),y.onResize(),y.setScrollTop(Math.min(y.page.maxh,t))}},this.init(),e.nicescroll.push(this)},m=function(e){var t=this;this.nc=e,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+(new Date)},this.reset=function(e,n){t.stop();var r=t.time();t.steptime=0,t.lasttime=r,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=n,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,n){var r=t.time();t.steptime=r-t.lasttime,t.lasttime=r;var r=n-t.lasty,i=e-t.lastx,s=t.nc.getScrollTop(),o=t.nc.getScrollLeft(),s=s+r,o=o+i;t.snapx=0>o||o>t.nc.page.maxw,t.snapy=0>s||s>t.nc.page.maxh,t.speedx=i,t.speedy=r,t.lastx=e,t.lasty=n},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,n){var r=!1;0>n?(n=0,r=!0):n>t.nc.page.maxh&&(n=t.nc.page.maxh,r=!0),0>e?(e=0,r=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,r=!0),r?t.nc.doScrollPos(e,n,t.nc.opt.snapbackspeed):t.nc.triggerScrollEnd()},this.doMomentum=function(e){var n=t.time(),r=e?n+e:t.lasttime;e=t.nc.getScrollLeft();var i=t.nc.getScrollTop(),s=t.nc.page.maxh,o=t.nc.page.maxw;t.speedx=0<o?Math.min(60,t.speedx):0,t.speedy=0<s?Math.min(60,t.speedy):0,r=r&&60>=n-r;if(0>i||i>s||0>e||e>o)r=!1;e=t.speedx&&r?t.speedx:!1;if(t.speedy&&r&&t.speedy||e){var u=Math.max(16,t.steptime);50<u&&(e=u/50,t.speedx*=e,t.speedy*=e,u=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var a=t.lastscrollx,f=t.lastscrolly,l=function(){var e=600<t.time()-n?.04:.02;t.speedx&&(a=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=a,0>a||a>o)&&(e=.1),t.speedy&&(f=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=f,0>f||f>s)&&(e=.1),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft()!=t.chkx&&t.stop(),t.chkx=a,t.nc.setScrollLeft(a)),t.speedy&&(t.nc.getScrollTop()!=t.chky&&t.stop(),t.chky=f,t.nc.setScrollTop(f)),t.timer||(t.nc.hideCursor(),t.doSnapy(a,f))}),1>t.demulxy?t.timer=setTimeout(l,u):(t.stop(),t.nc.hideCursor(),t.doSnapy(a,f))};l()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},g=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(t,n,r){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollTop():g.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollTop(parseInt(n)):g.call(t,n),this}},e.fn.scrollTop=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollTop():g.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollTop(parseInt(t)):g.call(e(this),t)})};var y=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(t,n,r){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollLeft():y.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollLeft(parseInt(n)):y.call(t,n),this}},e.fn.scrollLeft=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollLeft():y.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollLeft(parseInt(t)):y.call(e(this),t)})};var b=function(t){var n=this;this.length=0,this.name="nicescrollarray",this.each=function(e){for(var t=0,r=0;t<n.length;t++)e.call(n[t],r++);return n},this.push=function(e){n[n.length]=e,n.length++},this.eq=function(e){return n[e]};if(t)for(var r=0;r<t.length;r++){var i=e.data(t[r],"__nicescroll")||!1;i&&(this[this.length]=i,this.length++)}return this};(function(e,t,n){for(var r=0;r<t.length;r++)n(e,t[r])})(b.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(t){return"undefined"==typeof t?new b(this):this[t]&&e.data(this[t],"__nicescroll")||!1},e.extend(e.expr[":"],{nicescroll:function(t){return e.data(t,"__nicescroll")?!0:!1}}),e.fn.niceScroll=function(t,n){"undefined"==typeof n&&"object"==typeof t&&!("jquery"in t)&&(n=t,t=!1);var r=new b;"undefined"==typeof n&&(n={}),t&&(n.doc=e(t),n.win=e(this));var i=!("doc"in n);return!i&&!("win"in n)&&(n.win=e(this)),this.each(function(){var t=e(this).data("__nicescroll")||!1;t||(n.doc=i?e(this):n.doc,t=new v(n,e(this)),e(this).data("__nicescroll",t)),r.push(t)}),1==r.length?r[0]:r},window.NiceScroll={getjQuery:function(){return e}},e.nicescroll||(e.nicescroll=new b,e.nicescroll.options=h)}),define("rcemoji/emojiview",["jquery","backbone","text!rcemoji/emojiview.html","velocity","nicescroll"],function(e,t,n,r,i){var s=t.View.extend({className:"emoji-picker-view",lastselectedtab:"",options:{},events:{"click div.tab":"switchTabs","click span.em":"onEmojiIconClicked"},niceScrolls:[],initialize:function(e){_.bindAll(this,"render","switchTabs","launchTab","close","launchAllTabs"),this.template=_.template(n),this.options=e,this.niceScrolls=[]},render:function(){this.$el.html(this.template()),this.launchAllTabs();var e=sessionStorage.getItem("emoji_last_active_tab");return e==null&&(e="faces"),this.makeTabActive(e),this},launchPicker:function(){console.error("launchPicker not used anymore"),console.trace(),e(".emojiPickerBox .pickericon").hasClass("open")?this.hidePicker():this.showPicker()},switchTabs:function(t){var n=e(t.currentTarget).data("tab");this.currentTab=n,this.makeTabActive(n);var r="-"+e(".emojiPicker").width()*(e(t.currentTarget).index()+1),r=-100*e(t.currentTarget).index();this.$("#"+this.lastselectedtab).css("transform","translateX("+r+"px)")},makeTabActive:function(e,t){this.lastselectedtab===""&&(this.lastselectedtab=e),this.$(".tabpanel .tab").removeClass("active"),this.$(".tabpanel .tab[data-tab="+e+"]").addClass("active"),this.$(".tabpanel").attr("data-tab",e),sessionStorage.setItem("emoji_last_active_tab",e),e=="recent"&&this.launchTab("recent");var n=this;setTimeout(function(){n.$(".tab-content").removeClass("active"),n.$("#"+e).addClass("active"),n.lastselectedtab=e,n.$(".tab-content").css("transform","translateX(0px)")},100)},launchTab:function(e){switch(e){case"recent":var t=this.renderRecent();break;case"faces":var t=this.renderFaces();break;case"nature":var t=this.renderNature();break;case"objects":var t=this.renderObjects();break;case"places":var t=this.renderPlaces();break;case"flags":var t=this.renderFlags();break;case"symbols":var t=this.renderSymbols();break;default:var t=this.renderFaces()}this.$("#"+e).html(t)},launchAllTabs:function(){var e=["recent","faces","nature","objects","places","flags","symbols"];for(index=0;index<e.length;++index){this.launchTab(e[index]),this.$("#"+e[index]).niceScroll({cursorborder:"0",cursorwidth:"10px",cursorcolor:"#404040",cursorborderradius:"0",horizrailenabled:!1});var t=this.$("#"+e[index]).getNiceScroll();this.niceScrolls.push(t)}},renderRecent:function(){recentEntries=JSON.parse(localStorage.getItem("commsweb_emoji_recent"));if(recentEntries){recentEntries=this.remove_duplicates(recentEntries),recentEntries=recentEntries.reverse();var t=e('<div class="emoji-list"></div>');e.each(recentEntries,function(e,n){var r=n.alt,i=n.src,s='<span alt="'+r+'" class="'+i+'"></span>';t.append(s)})}return t},renderFaces:function(){var e='<div class="emoji-list"><span   alt="ðŸ˜„" class="em emj1f604"  ></span><span   alt="ðŸ˜ƒ" class="em emj1f603"  ></span><span   alt="ðŸ˜€" class="em emj1f600"  ></span><span   alt="ðŸ˜Š" class="em emj1f60a"  ></span><span   alt="â˜º" class="em emj263a"  ></span><span   alt="ðŸ˜‰" class="em emj1f609"  ></span><span   alt="ðŸ˜" class="em emj1f60d"  ></span><span   alt="ðŸ˜˜" class="em emj1f618"  ></span><span   alt="ðŸ˜š" class="em emj1f61a"  ></span><span   alt="ðŸ˜—" class="em emj1f617"  ></span><span   alt="ðŸ˜™" class="em emj1f619"  ></span><span   alt="ðŸ˜œ" class="em emj1f61c"  ></span><span   alt="ðŸ˜" class="em emj1f61d"  ></span><span   alt="ðŸ˜›" class="em emj1f61b"  ></span><span   alt="ðŸ˜³" class="em emj1f633"  ></span><span   alt="ðŸ˜" class="em emj1f601"  ></span><span   alt="ðŸ˜”" class="em emj1f614"  ></span><span   alt="ðŸ˜Œ" class="em emj1f60c"  ></span><span   alt="ðŸ˜’" class="em emj1f612"  ></span><span   alt="ðŸ˜ž" class="em emj1f61e"  ></span><span   alt="ðŸ˜£" class="em emj1f623"  ></span><span   alt="ðŸ˜¢" class="em emj1f622"  ></span><span   alt="ðŸ˜‚" class="em emj1f602"  ></span><span   alt="ðŸ˜­" class="em emj1f62d"  ></span><span   alt="ðŸ˜ª" class="em emj1f62a"  ></span><span   alt="ðŸ˜¥" class="em emj1f625"  ></span><span   alt="ðŸ˜°" class="em emj1f630"  ></span><span   alt="ðŸ˜…" class="em emj1f605"  ></span><span   alt="ðŸ˜“" class="em emj1f613"  ></span><span   alt="ðŸ˜©" class="em emj1f629"  ></span><span   alt="ðŸ˜«" class="em emj1f62b"  ></span><span   alt="ðŸ˜¨" class="em emj1f628"  ></span><span   alt="ðŸ˜±" class="em emj1f631"  ></span><span   alt="ðŸ˜ " class="em emj1f620"  ></span><span   alt="ðŸ˜¡" class="em emj1f621"  ></span><span   alt="ðŸ˜¤" class="em emj1f624"  ></span><span   alt="ðŸ˜–" class="em emj1f616"  ></span><span   alt="ðŸ˜†" class="em emj1f606"  ></span><span   alt="ðŸ˜‹" class="em emj1f60b"  ></span><span   alt="ðŸ˜·" class="em emj1f637"  ></span><span   alt="ðŸ˜Ž" class="em emj1f60e"  ></span><span   alt="ðŸ˜´" class="em emj1f634"  ></span><span   alt="ðŸ˜µ" class="em emj1f635"  ></span><span   alt="ðŸ˜²" class="em emj1f632"  ></span><span   alt="ðŸ˜Ÿ" class="em emj1f61f"  ></span><span   alt="ðŸ˜¦" class="em emj1f626"  ></span><span   alt="ðŸ˜§" class="em emj1f627"  ></span><span   alt="ðŸ˜ˆ" class="em emj1f608"  ></span><span   alt="ðŸ‘¿" class="em emj1f47f"  ></span><span   alt="ðŸ˜®" class="em emj1f62e"  ></span><span   alt="ðŸ˜¬" class="em emj1f62c"  ></span><span   alt="ðŸ˜" class="em emj1f610"  ></span><span   alt="ðŸ˜•" class="em emj1f615"  ></span><span   alt="ðŸ˜¯" class="em emj1f62f"  ></span><span   alt="ðŸ˜¶" class="em emj1f636"  ></span><span   alt="ðŸ˜‡" class="em emj1f607"  ></span><span   alt="ðŸ˜" class="em emj1f60f"  ></span><span   alt="ðŸ˜‘" class="em emj1f611"  ></span><span   alt="ðŸ‘²" class="em emj1f472"  ></span><span   alt="ðŸ‘³" class="em emj1f473"  ></span><span   alt="ðŸ‘®" class="em emj1f46e"  ></span><span   alt="ðŸ‘·" class="em emj1f477"  ></span><span   alt="ðŸ’‚" class="em emj1f482"  ></span><span   alt="ðŸ‘¶" class="em emj1f476"  ></span><span   alt="ðŸ‘¦" class="em emj1f466"  ></span><span   alt="ðŸ‘§" class="em emj1f467"  ></span><span   alt="ðŸ‘¨" class="em emj1f468"  ></span><span   alt="ðŸ‘©" class="em emj1f469"  ></span><span   alt="ðŸ‘´" class="em emj1f474"  ></span><span   alt="ðŸ‘µ" class="em emj1f475"  ></span><span   alt="ðŸ‘±" class="em emj1f471"  ></span><span   alt="ðŸ‘¼" class="em emj1f47c"  ></span><span   alt="ðŸ‘¸" class="em emj1f478"  ></span><span   alt="ðŸ˜º" class="em emj1f63a"  ></span><span   alt="ðŸ˜¸" class="em emj1f638"  ></span><span   alt="ðŸ˜»" class="em emj1f63b"  ></span><span   alt="ðŸ˜½" class="em emj1f63d"  ></span><span   alt="ðŸ˜¼" class="em emj1f63c"  ></span><span   alt="ðŸ™€" class="em emj1f640"  ></span><span   alt="ðŸ˜¿" class="em emj1f63f"  ></span><span   alt="ðŸ˜¹" class="em emj1f639"  ></span><span   alt="ðŸ˜¾" class="em emj1f63e"  ></span><span   alt="ðŸ‘¹" class="em emj1f479"  ></span><span   alt="ðŸ‘º" class="em emj1f47a"  ></span><span   alt="ðŸ™ˆ" class="em emj1f648"  ></span><span   alt="ðŸ™‰" class="em emj1f649"  ></span><span   alt="ðŸ™Š" class="em emj1f64a"  ></span><span   alt="ðŸ’€" class="em emj1f480"  ></span><span   alt="ðŸ‘½" class="em emj1f47d"  ></span><span   alt="ðŸ’©" class="em emj1f4a9"  ></span><span   alt="ðŸ”¥" class="em emj1f525"  ></span><span   alt="âœ¨" class="em emj2728"  ></span><span   alt="ðŸŒŸ" class="em emj1f31f"  ></span><span   alt="ðŸ’«" class="em emj1f4ab"  ></span><span   alt="ðŸ’¥" class="em emj1f4a5"  ></span><span   alt="ðŸ’¢" class="em emj1f4a2"  ></span><span   alt="ðŸ’¦" class="em emj1f4a6"  ></span><span   alt="ðŸ’§" class="em emj1f4a7"  ></span><span   alt="ðŸ’¤" class="em emj1f4a4"  ></span><span   alt="ðŸ’¨" class="em emj1f4a8"  ></span><span   alt="ðŸ‘‚" class="em emj1f442"  ></span><span   alt="ðŸ‘€" class="em emj1f440"  ></span><span   alt="ðŸ‘ƒ" class="em emj1f443"  ></span><span   alt="ðŸ‘…" class="em emj1f445"  ></span><span   alt="ðŸ‘„" class="em emj1f444"  ></span><span   alt="ðŸ‘" class="em emj1f44d"  ></span><span   alt="ðŸ‘Ž" class="em emj1f44e"  ></span><span   alt="ðŸ‘Œ" class="em emj1f44c"  ></span><span   alt="ðŸ‘Š" class="em emj1f44a"  ></span><span   alt="âœŠ" class="em emj270a"  ></span><span   alt="âœŒ" class="em emj270c"  ></span><span   alt="ðŸ‘‹" class="em emj1f44b"  ></span><span   alt="âœ‹" class="em emj270b"  ></span><span   alt="ðŸ‘" class="em emj1f450"  ></span><span   alt="ðŸ‘†" class="em emj1f446"  ></span><span   alt="ðŸ‘‡" class="em emj1f447"  ></span><span   alt="ðŸ‘‰" class="em emj1f449"  ></span><span   alt="ðŸ‘ˆ" class="em emj1f448"  ></span><span   alt="ðŸ™Œ" class="em emj1f64c"  ></span><span   alt="ðŸ™" class="em emj1f64f"  ></span><span   alt="â˜" class="em emj261d"  ></span><span   alt="ðŸ‘" class="em emj1f44f"  ></span><span   alt="ðŸ’ª" class="em emj1f4aa"  ></span><span   alt="ðŸš¶" class="em emj1f6b6"  ></span><span   alt="ðŸƒ" class="em emj1f3c3"  ></span><span   alt="ðŸ’ƒ" class="em emj1f483"  ></span><span   alt="ðŸ‘«" class="em emj1f46b"  ></span><span   alt="ðŸ‘ª" class="em emj1f46a"  ></span><span   alt="ðŸ‘¬" class="em emj1f46c"  ></span><span   alt="ðŸ‘­" class="em emj1f46d"  ></span><span   alt="ðŸ’" class="em emj1f48f"  ></span><span   alt="ðŸ’‘" class="em emj1f491"  ></span><span   alt="ðŸ‘¯" class="em emj1f46f"  ></span><span   alt="ðŸ™†" class="em emj1f646"  ></span><span   alt="ðŸ™…" class="em emj1f645"  ></span><span   alt="ðŸ’" class="em emj1f481"  ></span><span   alt="ðŸ™‹" class="em emj1f64b"  ></span><span   alt="ðŸ’†" class="em emj1f486"  ></span><span   alt="ðŸ’‡" class="em emj1f487"  ></span><span   alt="ðŸ’…" class="em emj1f485"  ></span><span   alt="ðŸ‘°" class="em emj1f470"  ></span><span   alt="ðŸ™Ž" class="em emj1f64e"  ></span><span   alt="ðŸ™" class="em emj1f64d"  ></span><span   alt="ðŸ™‡" class="em emj1f647"  ></span><span   alt="ðŸŽ©" class="em emj1f3a9"  ></span><span   alt="ðŸ‘‘" class="em emj1f451"  ></span><span   alt="ðŸ‘’" class="em emj1f452"  ></span><span   alt="ðŸ‘Ÿ" class="em emj1f45f"  ></span><span   alt="ðŸ‘ž" class="em emj1f45e"  ></span><span   alt="ðŸ‘¡" class="em emj1f461"  ></span><span   alt="ðŸ‘ " class="em emj1f460"  ></span><span   alt="ðŸ‘¢" class="em emj1f462"  ></span><span   alt="ðŸ‘•" class="em emj1f455"  ></span><span   alt="ðŸ‘”" class="em emj1f454"  ></span><span   alt="ðŸ‘š" class="em emj1f45a"  ></span><span   alt="ðŸ‘—" class="em emj1f457"  ></span><span   alt="ðŸŽ½" class="em emj1f3bd"  ></span><span   alt="ðŸ‘–" class="em emj1f456"  ></span><span   alt="ðŸ‘˜" class="em emj1f458"  ></span><span   alt="ðŸ‘™" class="em emj1f459"  ></span><span   alt="ðŸ’¼" class="em emj1f4bc"  ></span><span   alt="ðŸ‘œ" class="em emj1f45c"  ></span><span   alt="ðŸ‘" class="em emj1f45d"  ></span><span   alt="ðŸ‘›" class="em emj1f45b"  ></span><span   alt="ðŸ‘“" class="em emj1f453"  ></span><span   alt="ðŸŽ€" class="em emj1f380"  ></span><span   alt="ðŸŒ‚" class="em emj1f302"  ></span><span   alt="ðŸ’„" class="em emj1f484"  ></span><span   alt="ðŸ’›" class="em emj1f49b"  ></span><span   alt="ðŸ’™" class="em emj1f499"  ></span><span   alt="ðŸ’œ" class="em emj1f49c"  ></span><span   alt="ðŸ’š" class="em emj1f49a"  ></span><span   alt="â¤" class="em emj2764"  ></span><span   alt="ðŸ’”" class="em emj1f494"  ></span><span   alt="ðŸ’—" class="em emj1f497"  ></span><span   alt="ðŸ’“" class="em emj1f493"  ></span><span   alt="ðŸ’•" class="em emj1f495"  ></span><span   alt="ðŸ’–" class="em emj1f496"  ></span><span   alt="ðŸ’ž" class="em emj1f49e"  ></span><span   alt="ðŸ’˜" class="em emj1f498"  ></span><span   alt="ðŸ’Œ" class="em emj1f48c"  ></span><span   alt="ðŸ’‹" class="em emj1f48b"  ></span><span   alt="ðŸ’" class="em emj1f48d"  ></span><span   alt="ðŸ’Ž" class="em emj1f48e"  ></span><span   alt="ðŸ‘¤" class="em emj1f464"  ></span><span   alt="ðŸ‘¥" class="em emj1f465"  ></span><span   alt="ðŸ’¬" class="em emj1f4ac"  ></span><span   alt="ðŸ‘£" class="em emj1f463"  ></span><span   alt="ðŸ’­" class="em emj1f4ad"  ></span></div>';return e},renderNature:function(){var e='<div class="emoji-list"><span  alt="ðŸ¶" class="em emj1f436" ></span><span  alt="ðŸº" class="em emj1f43a" ></span><span  alt="ðŸ±" class="em emj1f431" ></span><span  alt="ðŸ­" class="em emj1f42d" ></span><span  alt="ðŸ¹" class="em emj1f439" ></span><span  alt="ðŸ°" class="em emj1f430" ></span><span  alt="ðŸ¸" class="em emj1f438" ></span><span  alt="ðŸ¯" class="em emj1f42f" ></span><span  alt="ðŸ¨" class="em emj1f428" ></span><span  alt="ðŸ»" class="em emj1f43b" ></span><span  alt="ðŸ·" class="em emj1f437" ></span><span  alt="ðŸ½" class="em emj1f43d" ></span><span  alt="ðŸ®" class="em emj1f42e" ></span><span  alt="ðŸ—" class="em emj1f417" ></span><span  alt="ðŸµ" class="em emj1f435" ></span><span  alt="ðŸ’" class="em emj1f412" ></span><span  alt="ðŸ´" class="em emj1f434" ></span><span  alt="ðŸ‘" class="em emj1f411" ></span><span  alt="ðŸ˜" class="em emj1f418" ></span><span  alt="ðŸ¼" class="em emj1f43c" ></span><span  alt="ðŸ§" class="em emj1f427" ></span><span  alt="ðŸ¦" class="em emj1f426" ></span><span  alt="ðŸ¤" class="em emj1f424" ></span><span  alt="ðŸ¥" class="em emj1f425" ></span><span  alt="ðŸ£" class="em emj1f423" ></span><span  alt="ðŸ”" class="em emj1f414" ></span><span  alt="ðŸ" class="em emj1f40d" ></span><span  alt="ðŸ¢" class="em emj1f422" ></span><span  alt="ðŸ›" class="em emj1f41b" ></span><span  alt="ðŸ" class="em emj1f41d" ></span><span  alt="ðŸœ" class="em emj1f41c" ></span><span  alt="ðŸž" class="em emj1f41e" ></span><span  alt="ðŸŒ" class="em emj1f40c" ></span><span  alt="ðŸ™" class="em emj1f419" ></span><span  alt="ðŸš" class="em emj1f41a" ></span><span  alt="ðŸ " class="em emj1f420" ></span><span  alt="ðŸŸ" class="em emj1f41f" ></span><span  alt="ðŸ¬" class="em emj1f42c" ></span><span  alt="ðŸ³" class="em emj1f433" ></span><span  alt="ðŸ‹" class="em emj1f40b" ></span><span  alt="ðŸ„" class="em emj1f404" ></span><span  alt="ðŸ" class="em emj1f40f" ></span><span  alt="ðŸ€" class="em emj1f400" ></span><span  alt="ðŸƒ" class="em emj1f403" ></span><span  alt="ðŸ…" class="em emj1f405" ></span><span  alt="ðŸ‡" class="em emj1f407" ></span><span  alt="ðŸ‰" class="em emj1f409" ></span><span  alt="ðŸŽ" class="em emj1f40e" ></span><span  alt="ðŸ" class="em emj1f410" ></span><span  alt="ðŸ“" class="em emj1f413" ></span><span  alt="ðŸ•" class="em emj1f415" ></span><span  alt="ðŸ–" class="em emj1f416" ></span><span  alt="ðŸ" class="em emj1f401" ></span><span  alt="ðŸ‚" class="em emj1f402" ></span><span  alt="ðŸ²" class="em emj1f432" ></span><span  alt="ðŸ¡" class="em emj1f421" ></span><span  alt="ðŸŠ" class="em emj1f40a" ></span><span  alt="ðŸ«" class="em emj1f42b" ></span><span  alt="ðŸª" class="em emj1f42a" ></span><span  alt="ðŸ†" class="em emj1f406" ></span><span  alt="ðŸˆ" class="em emj1f408" ></span><span  alt="ðŸ©" class="em emj1f429" ></span><span  alt="ðŸ¾" class="em emj1f43e" ></span><span  alt="ðŸ’" class="em emj1f490" ></span><span  alt="ðŸŒ¸" class="em emj1f338" ></span><span  alt="ðŸŒ·" class="em emj1f337" ></span><span  alt="ðŸ€" class="em emj1f340" ></span><span  alt="ðŸŒ¹" class="em emj1f339" ></span><span  alt="ðŸŒ»" class="em emj1f33b" ></span><span  alt="ðŸŒº" class="em emj1f33a" ></span><span  alt="ðŸ" class="em emj1f341" ></span><span  alt="ðŸƒ" class="em emj1f343" ></span><span  alt="ðŸ‚" class="em emj1f342" ></span><span  alt="ðŸŒ¿" class="em emj1f33f" ></span><span  alt="ðŸŒ¾" class="em emj1f33e" ></span><span  alt="ðŸ„" class="em emj1f344" ></span><span  alt="ðŸŒµ" class="em emj1f335" ></span><span  alt="ðŸŒ´" class="em emj1f334" ></span><span  alt="ðŸŒ²" class="em emj1f332" ></span><span  alt="ðŸŒ³" class="em emj1f333" ></span><span  alt="ðŸŒ°" class="em emj1f330" ></span><span  alt="ðŸŒ±" class="em emj1f331" ></span><span  alt="ðŸŒ¼" class="em emj1f33c" ></span><span  alt="ðŸŒ" class="em emj1f310" ></span><span  alt="ðŸŒž" class="em emj1f31e" ></span><span  alt="ðŸŒ" class="em emj1f31d" ></span><span  alt="ðŸŒš" class="em emj1f31a" ></span><span  alt="ðŸŒ‘" class="em emj1f311" ></span><span  alt="ðŸŒ’" class="em emj1f312" ></span><span  alt="ðŸŒ“" class="em emj1f313" ></span><span  alt="ðŸŒ”" class="em emj1f314" ></span><span  alt="ðŸŒ•" class="em emj1f315" ></span><span  alt="ðŸŒ–" class="em emj1f316" ></span><span  alt="ðŸŒ—" class="em emj1f317" ></span><span  alt="ðŸŒ˜" class="em emj1f318" ></span><span  alt="ðŸŒœ" class="em emj1f31c" ></span><span  alt="ðŸŒ›" class="em emj1f31b" ></span><span  alt="ðŸŒ™" class="em emj1f319" ></span><span  alt="ðŸŒ" class="em emj1f30d" ></span><span  alt="ðŸŒŽ" class="em emj1f30e" ></span><span  alt="ðŸŒ" class="em emj1f30f" ></span><span  alt="ðŸŒ‹" class="em emj1f30b" ></span><span  alt="ðŸŒŒ" class="em emj1f30c" ></span><span  alt="ðŸŒ " class="em emj1f320" ></span><span  alt="â­" class="em emj2b50" ></span><span  alt="â˜€" class="em emj2600" ></span><span  alt="â›…" class="em emj26c5" ></span><span  alt="â˜" class="em emj2601" ></span><span  alt="âš¡" class="em emj26a1" ></span><span  alt="â˜”" class="em emj2614" ></span><span  alt="â„" class="em emj2744" ></span><span  alt="â›„" class="em emj26c4" ></span><span  alt="ðŸŒ€" class="em emj1f300" ></span><span  alt="ðŸŒ" class="em emj1f301" ></span><span  alt="ðŸŒˆ" class="em emj1f308" ></span><span  alt="ðŸŒŠ" class="em emj1f30a" ></span></div>';return e},renderObjects:function(){var e='<div class="emoji-list"><span alt="ðŸŽ" class="em emj1f38d"></span><span alt="ðŸ’" class="em emj1f49d"></span><span alt="ðŸŽŽ" class="em emj1f38e"></span><span alt="ðŸŽ’" class="em emj1f392"></span><span alt="ðŸŽ“" class="em emj1f393"></span><span alt="ðŸŽ" class="em emj1f38f"></span><span alt="ðŸŽ†" class="em emj1f386"></span><span alt="ðŸŽ‡" class="em emj1f387"></span><span alt="ðŸŽ" class="em emj1f390"></span><span alt="ðŸŽ‘" class="em emj1f391"></span><span alt="ðŸŽƒ" class="em emj1f383"></span><span alt="ðŸ‘»" class="em emj1f47b"></span><span alt="ðŸŽ…" class="em emj1f385"></span><span alt="ðŸŽ„" class="em emj1f384"></span><span alt="ðŸŽ" class="em emj1f381"></span><span alt="ðŸŽ‹" class="em emj1f38b"></span><span alt="ðŸŽ‰" class="em emj1f389"></span><span alt="ðŸŽŠ" class="em emj1f38a"></span><span alt="ðŸŽˆ" class="em emj1f388"></span><span alt="ðŸŽŒ" class="em emj1f38c"></span><span alt="ðŸ”®" class="em emj1f52e"></span><span alt="ðŸŽ¥" class="em emj1f3a5"></span><span alt="ðŸ“·" class="em emj1f4f7"></span><span alt="ðŸ“¹" class="em emj1f4f9"></span><span alt="ðŸ“¼" class="em emj1f4fc"></span><span alt="ðŸ’¿" class="em emj1f4bf"></span><span alt="ðŸ“€" class="em emj1f4c0"></span><span alt="ðŸ’½" class="em emj1f4bd"></span><span alt="ðŸ’¾" class="em emj1f4be"></span><span alt="ðŸ’»" class="em emj1f4bb"></span><span alt="ðŸ“±" class="em emj1f4f1"></span><span alt="â˜Ž" class="em emj260e"></span><span alt="ðŸ“ž" class="em emj1f4de"></span><span alt="ðŸ“Ÿ" class="em emj1f4df"></span><span alt="ðŸ“ " class="em emj1f4e0"></span><span alt="ðŸ“¡" class="em emj1f4e1"></span><span alt="ðŸ“º" class="em emj1f4fa"></span><span alt="ðŸ“»" class="em emj1f4fb"></span><span alt="ðŸ”Š" class="em emj1f50a"></span><span alt="ðŸ”‰" class="em emj1f509"></span><span alt="ðŸ”ˆ" class="em emj1f508"></span><span alt="ðŸ”‡" class="em emj1f507"></span><span alt="ðŸ””" class="em emj1f514"></span><span alt="ðŸ”•" class="em emj1f515"></span><span alt="ðŸ“¢" class="em emj1f4e2"></span><span alt="ðŸ“£" class="em emj1f4e3"></span><span alt="â³" class="em emj23f3"></span><span alt="âŒ›" class="em emj231b"></span><span alt="â°" class="em emj23f0"></span><span alt="âŒš" class="em emj231a"></span><span alt="ðŸ”“" class="em emj1f513"></span><span alt="ðŸ”’" class="em emj1f512"></span><span alt="ðŸ”" class="em emj1f50f"></span><span alt="ðŸ”" class="em emj1f510"></span><span alt="ðŸ”‘" class="em emj1f511"></span><span alt="ðŸ”Ž" class="em emj1f50e"></span><span alt="ðŸ’¡" class="em emj1f4a1"></span><span alt="ðŸ”¦" class="em emj1f526"></span><span alt="ðŸ”†" class="em emj1f506"></span><span alt="ðŸ”…" class="em emj1f505"></span><span alt="ðŸ”Œ" class="em emj1f50c"></span><span alt="ðŸ”‹" class="em emj1f50b"></span><span alt="ðŸ”" class="em emj1f50d"></span><span alt="ðŸ›" class="em emj1f6c1"></span><span alt="ðŸ›€" class="em emj1f6c0"></span><span alt="ðŸš¿" class="em emj1f6bf"></span><span alt="ðŸš½" class="em emj1f6bd"></span><span alt="ðŸ”§" class="em emj1f527"></span><span alt="ðŸ”©" class="em emj1f529"></span><span alt="ðŸ”¨" class="em emj1f528"></span><span alt="ðŸšª" class="em emj1f6aa"></span><span alt="ðŸš¬" class="em emj1f6ac"></span><span alt="ðŸ’£" class="em emj1f4a3"></span><span alt="ðŸ”«" class="em emj1f52b"></span><span alt="ðŸ”ª" class="em emj1f52a"></span><span alt="ðŸ’Š" class="em emj1f48a"></span><span alt="ðŸ’‰" class="em emj1f489"></span><span alt="ðŸ’°" class="em emj1f4b0"></span><span alt="ðŸ’´" class="em emj1f4b4"></span><span alt="ðŸ’µ" class="em emj1f4b5"></span><span alt="ðŸ’·" class="em emj1f4b7"></span><span alt="ðŸ’¶" class="em emj1f4b6"></span><span alt="ðŸ’³" class="em emj1f4b3"></span><span alt="ðŸ’¸" class="em emj1f4b8"></span><span alt="ðŸ“²" class="em emj1f4f2"></span><span alt="ðŸ“§" class="em emj1f4e7"></span><span alt="ðŸ“¥" class="em emj1f4e5"></span><span alt="ðŸ“¤" class="em emj1f4e4"></span><span alt="âœ‰" class="em emj2709"></span><span alt="ðŸ“©" class="em emj1f4e9"></span><span alt="ðŸ“¨" class="em emj1f4e8"></span><span alt="ðŸ“¯" class="em emj1f4ef"></span><span alt="ðŸ“«" class="em emj1f4eb"></span><span alt="ðŸ“ª" class="em emj1f4ea"></span><span alt="ðŸ“¬" class="em emj1f4ec"></span><span alt="ðŸ“­" class="em emj1f4ed"></span><span alt="ðŸ“®" class="em emj1f4ee"></span><span alt="ðŸ“¦" class="em emj1f4e6"></span><span alt="ðŸ“" class="em emj1f4dd"></span><span alt="ðŸ“„" class="em emj1f4c4"></span><span alt="ðŸ“ƒ" class="em emj1f4c3"></span><span alt="ðŸ“‘" class="em emj1f4d1"></span><span alt="ðŸ“Š" class="em emj1f4ca"></span><span alt="ðŸ“ˆ" class="em emj1f4c8"></span><span alt="ðŸ“‰" class="em emj1f4c9"></span><span alt="ðŸ“œ" class="em emj1f4dc"></span><span alt="ðŸ“‹" class="em emj1f4cb"></span><span alt="ðŸ“…" class="em emj1f4c5"></span><span alt="ðŸ“†" class="em emj1f4c6"></span><span alt="ðŸ“‡" class="em emj1f4c7"></span><span alt="ðŸ“" class="em emj1f4c1"></span><span alt="ðŸ“‚" class="em emj1f4c2"></span><span alt="âœ‚" class="em emj2702"></span><span alt="ðŸ“Œ" class="em emj1f4cc"></span><span alt="ðŸ“Ž" class="em emj1f4ce"></span><span alt="âœ’" class="em emj2712"></span><span alt="âœ" class="em emj270f"></span><span alt="ðŸ“" class="em emj1f4cf"></span><span alt="ðŸ“" class="em emj1f4d0"></span><span alt="ðŸ“•" class="em emj1f4d5"></span><span alt="ðŸ“—" class="em emj1f4d7"></span><span alt="ðŸ“˜" class="em emj1f4d8"></span><span alt="ðŸ“™" class="em emj1f4d9"></span><span alt="ðŸ““" class="em emj1f4d3"></span><span alt="ðŸ“”" class="em emj1f4d4"></span><span alt="ðŸ“’" class="em emj1f4d2"></span><span alt="ðŸ“š" class="em emj1f4da"></span><span alt="ðŸ“–" class="em emj1f4d6"></span><span alt="ðŸ”–" class="em emj1f516"></span><span alt="ðŸ“›" class="em emj1f4db"></span><span alt="ðŸ”¬" class="em emj1f52c"></span><span alt="ðŸ”­" class="em emj1f52d"></span><span alt="ðŸ“°" class="em emj1f4f0"></span><span alt="ðŸŽ¨" class="em emj1f3a8"></span><span alt="ðŸŽ¬" class="em emj1f3ac"></span><span alt="ðŸŽ¤" class="em emj1f3a4"></span><span alt="ðŸŽ§" class="em emj1f3a7"></span><span alt="ðŸŽ¼" class="em emj1f3bc"></span><span alt="ðŸŽµ" class="em emj1f3b5"></span><span alt="ðŸŽ¶" class="em emj1f3b6"></span><span alt="ðŸŽ¹" class="em emj1f3b9"></span><span alt="ðŸŽ»" class="em emj1f3bb"></span><span alt="ðŸŽº" class="em emj1f3ba"></span><span alt="ðŸŽ·" class="em emj1f3b7"></span><span alt="ðŸŽ¸" class="em emj1f3b8"></span><span alt="ðŸ‘¾" class="em emj1f47e"></span><span alt="ðŸŽ®" class="em emj1f3ae"></span><span alt="ðŸƒ" class="em emj1f0cf"></span><span alt="ðŸŽ´" class="em emj1f3b4"></span><span alt="ðŸ€„" class="em emj1f004"></span><span alt="ðŸŽ²" class="em emj1f3b2"></span><span alt="ðŸŽ¯" class="em emj1f3af"></span><span alt="ðŸˆ" class="em emj1f3c8"></span><span alt="ðŸ€" class="em emj1f3c0"></span><span alt="âš½" class="em emj26bd"></span><span alt="âš¾" class="em emj26be"></span><span alt="ðŸŽ¾" class="em emj1f3be"></span><span alt="ðŸŽ±" class="em emj1f3b1"></span><span alt="ðŸ‰" class="em emj1f3c9"></span><span alt="ðŸŽ³" class="em emj1f3b3"></span><span alt="â›³" class="em emj26f3"></span><span alt="ðŸšµ" class="em emj1f6b5"></span><span alt="ðŸš´" class="em emj1f6b4"></span><span alt="ðŸ" class="em emj1f3c1"></span><span alt="ðŸ‡" class="em emj1f3c7"></span><span alt="ðŸ†" class="em emj1f3c6"></span><span alt="ðŸŽ¿" class="em emj1f3bf"></span><span alt="ðŸ‚" class="em emj1f3c2"></span><span alt="ðŸŠ" class="em emj1f3ca"></span><span alt="ðŸ„" class="em emj1f3c4"></span><span alt="ðŸŽ£" class="em emj1f3a3"></span><span alt="â˜•" class="em emj2615"></span><span alt="ðŸµ" class="em emj1f375"></span><span alt="ðŸ¶" class="em emj1f376"></span><span alt="ðŸ¼" class="em emj1f37c"></span><span alt="ðŸº" class="em emj1f37a"></span><span alt="ðŸ»" class="em emj1f37b"></span><span alt="ðŸ¸" class="em emj1f378"></span><span alt="ðŸ¹" class="em emj1f379"></span><span alt="ðŸ·" class="em emj1f377"></span><span alt="ðŸ´" class="em emj1f374"></span><span alt="ðŸ•" class="em emj1f355"></span><span alt="ðŸ”" class="em emj1f354"></span><span alt="ðŸŸ" class="em emj1f35f"></span><span alt="ðŸ—" class="em emj1f357"></span><span alt="ðŸ–" class="em emj1f356"></span><span alt="ðŸ" class="em emj1f35d"></span><span alt="ðŸ›" class="em emj1f35b"></span><span alt="ðŸ¤" class="em emj1f364"></span><span alt="ðŸ±" class="em emj1f371"></span><span alt="ðŸ£" class="em emj1f363"></span><span alt="ðŸ¥" class="em emj1f365"></span><span alt="ðŸ™" class="em emj1f359"></span><span alt="ðŸ˜" class="em emj1f358"></span><span alt="ðŸš" class="em emj1f35a"></span><span alt="ðŸœ" class="em emj1f35c"></span><span alt="ðŸ²" class="em emj1f372"></span><span alt="ðŸ¢" class="em emj1f362"></span><span alt="ðŸ¡" class="em emj1f361"></span><span alt="ðŸ³" class="em emj1f373"></span><span alt="ðŸž" class="em emj1f35e"></span><span alt="ðŸ©" class="em emj1f369"></span><span alt="ðŸ®" class="em emj1f36e"></span><span alt="ðŸ¦" class="em emj1f366"></span><span alt="ðŸ¨" class="em emj1f368"></span><span alt="ðŸ§" class="em emj1f367"></span><span alt="ðŸŽ‚" class="em emj1f382"></span><span alt="ðŸ°" class="em emj1f370"></span><span alt="ðŸª" class="em emj1f36a"></span><span alt="ðŸ«" class="em emj1f36b"></span><span alt="ðŸ¬" class="em emj1f36c"></span><span alt="ðŸ­" class="em emj1f36d"></span><span alt="ðŸ¯" class="em emj1f36f"></span><span alt="ðŸŽ" class="em emj1f34e"></span><span alt="ðŸ" class="em emj1f34f"></span><span alt="ðŸŠ" class="em emj1f34a"></span><span alt="ðŸ‹" class="em emj1f34b"></span><span alt="ðŸ’" class="em emj1f352"></span><span alt="ðŸ‡" class="em emj1f347"></span><span alt="ðŸ‰" class="em emj1f349"></span><span alt="ðŸ“" class="em emj1f353"></span><span alt="ðŸ‘" class="em emj1f351"></span><span alt="ðŸˆ" class="em emj1f348"></span><span alt="ðŸŒ" class="em emj1f34c"></span><span alt="ðŸ" class="em emj1f350"></span><span alt="ðŸ" class="em emj1f34d"></span><span alt="ðŸ " class="em emj1f360"></span><span alt="ðŸ†" class="em emj1f346"></span><span alt="ðŸ…" class="em emj1f345"></span><span alt="ðŸŒ½" class="em emj1f33d"></span></div>';return e},renderPlaces:function(){var e='<div class="emoji-list"><span alt="ðŸ " class="em emj1f3e0"></span><span alt="ðŸ¡" class="em emj1f3e1"></span><span alt="ðŸ«" class="em emj1f3eb"></span><span alt="ðŸ¢" class="em emj1f3e2"></span><span alt="ðŸ£" class="em emj1f3e3"></span><span alt="ðŸ¥" class="em emj1f3e5"></span><span alt="ðŸ¦" class="em emj1f3e6"></span><span alt="ðŸª" class="em emj1f3ea"></span><span alt="ðŸ©" class="em emj1f3e9"></span><span alt="ðŸ¨" class="em emj1f3e8"></span><span alt="ðŸ’’" class="em emj1f492"></span><span alt="â›ª" class="em emj26ea"></span><span alt="ðŸ¬" class="em emj1f3ec"></span><span alt="ðŸ¤" class="em emj1f3e4"></span><span alt="ðŸŒ‡" class="em emj1f307"></span><span alt="ðŸŒ†" class="em emj1f306"></span><span alt="ðŸ¯" class="em emj1f3ef"></span><span alt="ðŸ°" class="em emj1f3f0"></span><span alt="â›º" class="em emj26fa"></span><span alt="ðŸ­" class="em emj1f3ed"></span><span alt="ðŸ—¼" class="em emj1f5fc"></span><span alt="ðŸ—¾" class="em emj1f5fe"></span><span alt="ðŸ—»" class="em emj1f5fb"></span><span alt="ðŸŒ„" class="em emj1f304"></span><span alt="ðŸŒ…" class="em emj1f305"></span><span alt="ðŸŒƒ" class="em emj1f303"></span><span alt="ðŸ—½" class="em emj1f5fd"></span><span alt="ðŸŒ‰" class="em emj1f309"></span><span alt="ðŸŽ " class="em emj1f3a0"></span><span alt="ðŸŽ¡" class="em emj1f3a1"></span><span alt="â›²" class="em emj26f2"></span><span alt="ðŸŽ¢" class="em emj1f3a2"></span><span alt="ðŸš¢" class="em emj1f6a2"></span><span alt="â›µ" class="em emj26f5"></span><span alt="ðŸš¤" class="em emj1f6a4"></span><span alt="ðŸš£" class="em emj1f6a3"></span><span alt="âš“" class="em emj2693"></span><span alt="ðŸš€" class="em emj1f680"></span><span alt="âœˆ" class="em emj2708"></span><span alt="ðŸ’º" class="em emj1f4ba"></span><span alt="ðŸš" class="em emj1f681"></span><span alt="ðŸš‚" class="em emj1f682"></span><span alt="ðŸšŠ" class="em emj1f68a"></span><span alt="ðŸš‰" class="em emj1f689"></span><span alt="ðŸš†" class="em emj1f686"></span><span alt="ðŸš„" class="em emj1f684"></span><span alt="ðŸš…" class="em emj1f685"></span><span alt="ðŸšˆ" class="em emj1f688"></span><span alt="ðŸš‡" class="em emj1f687"></span><span alt="ðŸš" class="em emj1f69d"></span><span alt="ðŸš‹" class="em emj1f68b"></span><span alt="ðŸšƒ" class="em emj1f683"></span><span alt="ðŸšŽ" class="em emj1f68e"></span><span alt="ðŸšŒ" class="em emj1f68c"></span><span alt="ðŸš" class="em emj1f68d"></span><span alt="ðŸš™" class="em emj1f699"></span><span alt="ðŸš˜" class="em emj1f698"></span><span alt="ðŸš—" class="em emj1f697"></span><span alt="ðŸš•" class="em emj1f695"></span><span alt="ðŸš–" class="em emj1f696"></span><span alt="ðŸš›" class="em emj1f69b"></span><span alt="ðŸšš" class="em emj1f69a"></span><span alt="ðŸš“" class="em emj1f693"></span><span alt="ðŸš”" class="em emj1f694"></span><span alt="ðŸš’" class="em emj1f692"></span><span alt="ðŸš‘" class="em emj1f691"></span><span alt="ðŸš" class="em emj1f690"></span><span alt="ðŸš²" class="em emj1f6b2"></span><span alt="ðŸš¡" class="em emj1f6a1"></span><span alt="ðŸšŸ" class="em emj1f69f"></span><span alt="ðŸš " class="em emj1f6a0"></span><span alt="ðŸšœ" class="em emj1f69c"></span><span alt="ðŸ’ˆ" class="em emj1f488"></span><span alt="ðŸš" class="em emj1f68f"></span><span alt="ðŸŽ«" class="em emj1f3ab"></span><span alt="ðŸš¦" class="em emj1f6a6"></span><span alt="ðŸš¥" class="em emj1f6a5"></span><span alt="âš " class="em emj26a0"></span><span alt="ðŸš§" class="em emj1f6a7"></span><span alt="ðŸ”°" class="em emj1f530"></span><span alt="â›½" class="em emj26fd"></span><span alt="ðŸ®" class="em emj1f3ee"></span><span alt="ðŸŽ°" class="em emj1f3b0"></span><span alt="â™¨" class="em emj2668"></span><span alt="ðŸ—¿" class="em emj1f5ff"></span><span alt="ðŸŽª" class="em emj1f3aa"></span><span alt="ðŸŽ­" class="em emj1f3ad"></span><span alt="ðŸ“" class="em emj1f4cd"></span><span alt="ðŸš©" class="em emj1f6a9"></span></div>';return e},renderSymbols:function(){var e='<div class="emoji-list"><span alt="1âƒ£" class="em emj31-20e3"></span><span alt="2âƒ£" class="em emj32-20e3"></span><span alt="3âƒ£" class="em emj33-20e3"></span><span alt="4âƒ£" class="em emj34-20e3"></span><span alt="5âƒ£" class="em emj35-20e3"></span><span alt="6âƒ£" class="em emj36-20e3"></span><span alt="7âƒ£" class="em emj37-20e3"></span><span alt="8âƒ£" class="em emj38-20e3"></span><span alt="9âƒ£" class="em emj39-20e3"></span><span alt="0âƒ£" class="em emj30-20e3"></span><span alt="ðŸ”Ÿ" class="em emj1f51f"></span><span alt="ðŸ”¢" class="em emj1f522"></span><span alt="#âƒ£" class="em emj23-20e3"></span><span alt="ðŸ”£" class="em emj1f523"></span><span alt="â¬†" class="em emj2b06"></span><span alt="â¬‡" class="em emj2b07"></span><span alt="â¬…" class="em emj2b05"></span><span alt="âž¡" class="em emj27a1"></span><span alt="ðŸ” " class="em emj1f520"></span><span alt="ðŸ”¡" class="em emj1f521"></span><span alt="ðŸ”¤" class="em emj1f524"></span><span alt="â†—" class="em emj2197"></span><span alt="â†–" class="em emj2196"></span><span alt="â†˜" class="em emj2198"></span><span alt="â†™" class="em emj2199"></span><span alt="â†”" class="em emj2194"></span><span alt="â†•" class="em emj2195"></span><span alt="ðŸ”„" class="em emj1f504"></span><span alt="â—€" class="em emj25c0"></span><span alt="â–¶" class="em emj25b6"></span><span alt="ðŸ”¼" class="em emj1f53c"></span><span alt="ðŸ”½" class="em emj1f53d"></span><span alt="â†©" class="em emj21a9"></span><span alt="â†ª" class="em emj21aa"></span><span alt="â„¹" class="em emj2139"></span><span alt="âª" class="em emj23ea"></span><span alt="â©" class="em emj23e9"></span><span alt="â«" class="em emj23eb"></span><span alt="â¬" class="em emj23ec"></span><span alt="â¤µ" class="em emj2935"></span><span alt="â¤´" class="em emj2934"></span><span alt="ðŸ†—" class="em emj1f197"></span><span alt="ðŸ”€" class="em emj1f500"></span><span alt="ðŸ”" class="em emj1f501"></span><span alt="ðŸ”‚" class="em emj1f502"></span><span alt="ðŸ†•" class="em emj1f195"></span><span alt="ðŸ†’" class="em emj1f192"></span><span alt="ðŸ†“" class="em emj1f193"></span><span alt="ðŸ†–" class="em emj1f196"></span><span alt="ðŸ“¶" class="em emj1f4f6"></span><span alt="ðŸŽ¦" class="em emj1f3a6"></span><span alt="ðŸˆ" class="em emj1f201"></span><span alt="ðŸˆ¯" class="em emj1f22f"></span><span alt="ðŸˆ³" class="em emj1f233"></span><span alt="ðŸˆµ" class="em emj1f235"></span><span alt="ðŸˆ´" class="em emj1f234"></span><span alt="ðŸˆ²" class="em emj1f232"></span><span alt="ðŸ‰" class="em emj1f250"></span><span alt="ðŸˆ¹" class="em emj1f239"></span><span alt="ðŸˆº" class="em emj1f23a"></span><span alt="ðŸˆ¶" class="em emj1f236"></span><span alt="ðŸˆš" class="em emj1f21a"></span><span alt="ðŸš»" class="em emj1f6bb"></span><span alt="ðŸš¹" class="em emj1f6b9"></span><span alt="ðŸšº" class="em emj1f6ba"></span><span alt="ðŸš¼" class="em emj1f6bc"></span><span alt="ðŸš¾" class="em emj1f6be"></span><span alt="ðŸš°" class="em emj1f6b0"></span><span alt="ðŸš®" class="em emj1f6ae"></span><span alt="ðŸ…¿" class="em emj1f17f"></span><span alt="â™¿" class="em emj267f"></span><span alt="ðŸš­" class="em emj1f6ad"></span><span alt="ðŸˆ·" class="em emj1f237"></span><span alt="ðŸˆ‚" class="em emj1f202"></span><span alt="â“‚" class="em emj24c2"></span><span alt="ðŸ›‚" class="em emj1f6c2"></span><span alt="ðŸ›„" class="em emj1f6c4"></span><span alt="ðŸ›…" class="em emj1f6c5"></span><span alt="ðŸ›ƒ" class="em emj1f6c3"></span><span alt="ðŸ‰‘" class="em emj1f251"></span><span alt="ãŠ™" class="em emj3299"></span><span alt="ãŠ—" class="em emj3297"></span><span alt="ðŸ†‘" class="em emj1f191"></span><span alt="ðŸ†˜" class="em emj1f198"></span><span alt="ðŸ†”" class="em emj1f194"></span><span alt="ðŸš«" class="em emj1f6ab"></span><span alt="ðŸ”ž" class="em emj1f51e"></span><span alt="ðŸ“µ" class="em emj1f4f5"></span><span alt="ðŸš¯" class="em emj1f6af"></span><span alt="ðŸš±" class="em emj1f6b1"></span><span alt="ðŸš³" class="em emj1f6b3"></span><span alt="ðŸš·" class="em emj1f6b7"></span><span alt="ðŸš¸" class="em emj1f6b8"></span><span alt="â›”" class="em emj26d4"></span><span alt="âœ³" class="em emj2733"></span><span alt="â‡" class="em emj2747"></span><span alt="âŽ" class="em emj274e"></span><span alt="âœ…" class="em emj2705"></span><span alt="âœ´" class="em emj2734"></span><span alt="ðŸ’Ÿ" class="em emj1f49f"></span><span alt="ðŸ†š" class="em emj1f19a"></span><span alt="ðŸ“³" class="em emj1f4f3"></span><span alt="ðŸ“´" class="em emj1f4f4"></span><span alt="ðŸ…°" class="em emj1f170"></span><span alt="ðŸ…±" class="em emj1f171"></span><span alt="ðŸ†Ž" class="em emj1f18e"></span><span alt="ðŸ…¾" class="em emj1f17e"></span><span alt="ðŸ’ " class="em emj1f4a0"></span><span alt="âž¿" class="em emj27bf"></span><span alt="â™»" class="em emj267b"></span><span alt="â™ˆ" class="em emj2648"></span><span alt="â™‰" class="em emj2649"></span><span alt="â™Š" class="em emj264a"></span><span alt="â™‹" class="em emj264b"></span><span alt="â™Œ" class="em emj264c"></span><span alt="â™" class="em emj264d"></span><span alt="â™Ž" class="em emj264e"></span><span alt="â™" class="em emj264f"></span><span alt="â™" class="em emj2650"></span><span alt="â™‘" class="em emj2651"></span><span alt="â™’" class="em emj2652"></span><span alt="â™“" class="em emj2653"></span><span alt="â›Ž" class="em emj26ce"></span><span alt="ðŸ”¯" class="em emj1f52f"></span><span alt="ðŸ§" class="em emj1f3e7"></span><span alt="ðŸ’¹" class="em emj1f4b9"></span><span alt="ðŸ’²" class="em emj1f4b2"></span><span alt="ðŸ’±" class="em emj1f4b1"></span><span alt="Â©" class="em emja9"></span><span alt="Â®" class="em emjae"></span><span alt="â„¢" class="em emj2122"></span><span alt="âŒ" class="em emj274c"></span><span alt="â€¼" class="em emj203c"></span><span alt="â‰" class="em emj2049"></span><span alt="â—" class="em emj2757"></span><span alt="â“" class="em emj2753"></span><span alt="â•" class="em emj2755"></span><span alt="â”" class="em emj2754"></span><span alt="â­•" class="em emj2b55"></span><span alt="ðŸ”" class="em emj1f51d"></span><span alt="ðŸ”š" class="em emj1f51a"></span><span alt="ðŸ”™" class="em emj1f519"></span><span alt="ðŸ”›" class="em emj1f51b"></span><span alt="ðŸ”œ" class="em emj1f51c"></span><span alt="ðŸ”ƒ" class="em emj1f503"></span><span alt="ðŸ•›" class="em emj1f55b"></span><span alt="ðŸ•§" class="em emj1f567"></span><span alt="ðŸ•" class="em emj1f550"></span><span alt="ðŸ•œ" class="em emj1f55c"></span><span alt="ðŸ•‘" class="em emj1f551"></span><span alt="ðŸ•" class="em emj1f55d"></span><span alt="ðŸ•’" class="em emj1f552"></span><span alt="ðŸ•ž" class="em emj1f55e"></span><span alt="ðŸ•“" class="em emj1f553"></span><span alt="ðŸ•Ÿ" class="em emj1f55f"></span><span alt="ðŸ•”" class="em emj1f554"></span><span alt="ðŸ• " class="em emj1f560"></span><span alt="ðŸ••" class="em emj1f555"></span><span alt="ðŸ•¡" class="em emj1f561"></span><span alt="ðŸ•–" class="em emj1f556"></span><span alt="ðŸ•¢" class="em emj1f562"></span><span alt="ðŸ•—" class="em emj1f557"></span><span alt="ðŸ•£" class="em emj1f563"></span><span alt="ðŸ•¤" class="em emj1f564"></span><span alt="ðŸ•™" class="em emj1f559"></span><span alt="ðŸ•¥" class="em emj1f565"></span><span alt="ðŸ•š" class="em emj1f55a"></span><span alt="ðŸ•¦" class="em emj1f566"></span><span alt="âž•" class="em emj2795"></span><span alt="âž–" class="em emj2796"></span><span alt="âž—" class="em emj2797"></span><span alt="â™ " class="em emj2660"></span><span alt="â™¥" class="em emj2665"></span><span alt="â™£" class="em emj2663"></span><span alt="â™¦" class="em emj2666"></span><span alt="ðŸ’®" class="em emj1f4ae"></span><span alt="ðŸ’¯" class="em emj1f4af"></span><span alt="âœ”" class="em emj2714"></span><span alt="â˜‘" class="em emj2611"></span><span alt="ðŸ”˜" class="em emj1f518"></span><span alt="ðŸ”—" class="em emj1f517"></span><span alt="âž°" class="em emj27b0"></span><span alt="ã€°" class="em emj3030"></span><span alt="ã€½" class="em emj303d"></span><span alt="ðŸ”±" class="em emj1f531"></span><span alt="â—¼" class="em emj25fc"></span><span alt="â—»" class="em emj25fb"></span><span alt="â—¾" class="em emj25fe"></span><span alt="â—½" class="em emj25fd"></span><span alt="â–ª" class="em emj25aa"></span><span alt="â–«" class="em emj25ab"></span><span alt="ðŸ”º" class="em emj1f53a"></span><span alt="ðŸ”²" class="em emj1f532"></span><span alt="ðŸ”³" class="em emj1f533"></span><span alt="âš«" class="em emj26ab"></span><span alt="ðŸ”´" class="em emj1f534"></span><span alt="ðŸ”µ" class="em emj1f535"></span><span alt="ðŸ”»" class="em emj1f53b"></span><span alt="â¬œ" class="em emj2b1c"></span><span alt="â¬›" class="em emj2b1b"></span><span alt="ðŸ”¶" class="em emj1f536"></span><span alt="ðŸ”·" class="em emj1f537"></span><span alt="ðŸ”¸" class="em emj1f538"></span><span alt="ðŸ”¹" class="em emj1f539"></span></div>';return e},renderFlags:function(){var e='<div class="emoji-list"><span alt="ðŸ‡¦ðŸ‡«" class="em emj1f1e6-1f1eb"></span><span alt="ðŸ‡¦ðŸ‡±" class="em emj1f1e6-1f1f1"></span><span alt="ðŸ‡©ðŸ‡¿" class="em emj1f1e9-1f1ff"></span><span alt="ðŸ‡¦ðŸ‡©" class="em emj1f1e6-1f1e9"></span><span alt="ðŸ‡¦ðŸ‡´" class="em emj1f1e6-1f1f4"></span><span alt="ðŸ‡¦ðŸ‡®" class="em emj1f1e6-1f1ee"></span><span alt="ðŸ‡¦ðŸ‡¬" class="em emj1f1e6-1f1ec"></span><span alt="ðŸ‡¦ðŸ‡·" class="em emj1f1e6-1f1f7"></span><span alt="ðŸ‡¦ðŸ‡²" class="em emj1f1e6-1f1f2"></span><span alt="ðŸ‡¦ðŸ‡¼" class="em emj1f1e6-1f1fc"></span><span alt="ðŸ‡¦ðŸ‡º" class="em emj1f1e6-1f1fa"></span><span alt="ðŸ‡¦ðŸ‡¹" class="em emj1f1e6-1f1f9"></span><span alt="ðŸ‡¦ðŸ‡¿" class="em emj1f1e6-1f1ff"></span><span alt="ðŸ‡§ðŸ‡¸" class="em emj1f1e7-1f1f8"></span><span alt="ðŸ‡§ðŸ‡­" class="em emj1f1e7-1f1ed"></span><span alt="ðŸ‡§ðŸ‡©" class="em emj1f1e7-1f1e9"></span><span alt="ðŸ‡§ðŸ‡§" class="em emj1f1e7-1f1e7"></span><span alt="ðŸ‡§ðŸ‡¾" class="em emj1f1e7-1f1fe"></span><span alt="ðŸ‡§ðŸ‡ª" class="em emj1f1e7-1f1ea"></span><span alt="ðŸ‡§ðŸ‡¿" class="em emj1f1e7-1f1ff"></span><span alt="ðŸ‡§ðŸ‡¯" class="em emj1f1e7-1f1ef"></span><span alt="ðŸ‡§ðŸ‡²" class="em emj1f1e7-1f1f2"></span><span alt="ðŸ‡§ðŸ‡¹" class="em emj1f1e7-1f1f9"></span><span alt="ðŸ‡§ðŸ‡´" class="em emj1f1e7-1f1f4"></span><span alt="ðŸ‡§ðŸ‡¦" class="em emj1f1e7-1f1e6"></span><span alt="ðŸ‡§ðŸ‡¼" class="em emj1f1e7-1f1fc"></span><span alt="ðŸ‡§ðŸ‡·" class="em emj1f1e7-1f1f7"></span><span alt="ðŸ‡§ðŸ‡³" class="em emj1f1e7-1f1f3"></span><span alt="ðŸ‡§ðŸ‡¬" class="em emj1f1e7-1f1ec"></span><span alt="ðŸ‡§ðŸ‡«" class="em emj1f1e7-1f1eb"></span><span alt="ðŸ‡§ðŸ‡®" class="em emj1f1e7-1f1ee"></span><span alt="ðŸ‡°ðŸ‡­" class="em emj1f1f0-1f1ed"></span><span alt="ðŸ‡¨ðŸ‡²" class="em emj1f1e8-1f1f2"></span><span alt="ðŸ‡¨ðŸ‡¦" class="em emj1f1e8-1f1e6"></span><span alt="ðŸ‡¨ðŸ‡»" class="em emj1f1e8-1f1fb"></span><span alt="ðŸ‡°ðŸ‡¾" class="em emj1f1f0-1f1fe"></span><span alt="ðŸ‡¨ðŸ‡«" class="em emj1f1e8-1f1eb"></span><span alt="ðŸ‡¹ðŸ‡©" class="em emj1f1f9-1f1e9"></span><span alt="ðŸ‡¨ðŸ‡±" class="em emj1f1e8-1f1f1"></span><span alt="ðŸ‡¨ðŸ‡³" class="em emj1f1e8-1f1f3"></span><span alt="ðŸ‡¨ðŸ‡´" class="em emj1f1e8-1f1f4"></span><span alt="ðŸ‡°ðŸ‡²" class="em emj1f1f0-1f1f2"></span><span alt="ðŸ‡¨ðŸ‡©" class="em emj1f1e8-1f1e9"></span><span alt="ðŸ‡¨ðŸ‡¬" class="em emj1f1e8-1f1ec"></span><span alt="ðŸ‡¨ðŸ‡·" class="em emj1f1e8-1f1f7"></span><span alt="ðŸ‡­ðŸ‡·" class="em emj1f1ed-1f1f7"></span><span alt="ðŸ‡¨ðŸ‡º" class="em emj1f1e8-1f1fa"></span><span alt="ðŸ‡¨ðŸ‡¾" class="em emj1f1e8-1f1fe"></span><span alt="ðŸ‡¨ðŸ‡¿" class="em emj1f1e8-1f1ff"></span><span alt="ðŸ‡©ðŸ‡°" class="em emj1f1e9-1f1f0"></span><span alt="ðŸ‡©ðŸ‡¯" class="em emj1f1e9-1f1ef"></span><span alt="ðŸ‡©ðŸ‡²" class="em emj1f1e9-1f1f2"></span><span alt="ðŸ‡©ðŸ‡´" class="em emj1f1e9-1f1f4"></span><span alt="ðŸ‡ªðŸ‡¨" class="em emj1f1ea-1f1e8"></span><span alt="ðŸ‡ªðŸ‡¬" class="em emj1f1ea-1f1ec"></span><span alt="ðŸ‡¸ðŸ‡»" class="em emj1f1f8-1f1fb"></span><span alt="ðŸ‡¬ðŸ‡¶" class="em emj1f1ec-1f1f6"></span><span alt="ðŸ‡ªðŸ‡·" class="em emj1f1ea-1f1f7"></span><span alt="ðŸ‡ªðŸ‡ª" class="em emj1f1ea-1f1ea"></span><span alt="ðŸ‡ªðŸ‡¹" class="em emj1f1ea-1f1f9"></span><span alt="ðŸ‡«ðŸ‡´" class="em emj1f1eb-1f1f4"></span><span alt="ðŸ‡«ðŸ‡¯" class="em emj1f1eb-1f1ef"></span><span alt="ðŸ‡«ðŸ‡®" class="em emj1f1eb-1f1ee"></span><span alt="ðŸ‡«ðŸ‡·" class="em emj1f1eb-1f1f7"></span><span alt="ðŸ‡µðŸ‡«" class="em emj1f1f5-1f1eb"></span><span alt="ðŸ‡¬ðŸ‡¦" class="em emj1f1ec-1f1e6"></span><span alt="ðŸ‡¬ðŸ‡²" class="em emj1f1ec-1f1f2"></span><span alt="ðŸ‡¬ðŸ‡ª" class="em emj1f1ec-1f1ea"></span><span alt="ðŸ‡©ðŸ‡ª" class="em emj1f1e9-1f1ea"></span><span alt="ðŸ‡¬ðŸ‡­" class="em emj1f1ec-1f1ed"></span><span alt="ðŸ‡¬ðŸ‡®" class="em emj1f1ec-1f1ee"></span><span alt="ðŸ‡¬ðŸ‡·" class="em emj1f1ec-1f1f7"></span><span alt="ðŸ‡¬ðŸ‡±" class="em emj1f1ec-1f1f1"></span><span alt="ðŸ‡¬ðŸ‡©" class="em emj1f1ec-1f1e9"></span><span alt="ðŸ‡¬ðŸ‡º" class="em emj1f1ec-1f1fa"></span><span alt="ðŸ‡¬ðŸ‡¹" class="em emj1f1ec-1f1f9"></span><span alt="ðŸ‡¬ðŸ‡³" class="em emj1f1ec-1f1f3"></span><span alt="ðŸ‡¬ðŸ‡¼" class="em emj1f1ec-1f1fc"></span><span alt="ðŸ‡¬ðŸ‡¾" class="em emj1f1ec-1f1fe"></span><span alt="ðŸ‡­ðŸ‡¹" class="em emj1f1ed-1f1f9"></span><span alt="ðŸ‡­ðŸ‡³" class="em emj1f1ed-1f1f3"></span><span alt="ðŸ‡­ðŸ‡°" class="em emj1f1ed-1f1f0"></span><span alt="ðŸ‡­ðŸ‡º" class="em emj1f1ed-1f1fa"></span><span alt="ðŸ‡®ðŸ‡¸" class="em emj1f1ee-1f1f8"></span><span alt="ðŸ‡®ðŸ‡³" class="em emj1f1ee-1f1f3"></span><span alt="ðŸ‡®ðŸ‡©" class="em emj1f1ee-1f1e9"></span><span alt="ðŸ‡®ðŸ‡·" class="em emj1f1ee-1f1f7"></span><span alt="ðŸ‡®ðŸ‡¶" class="em emj1f1ee-1f1f6"></span><span alt="ðŸ‡®ðŸ‡ª" class="em emj1f1ee-1f1ea"></span><span alt="ðŸ‡®ðŸ‡±" class="em emj1f1ee-1f1f1"></span><span alt="ðŸ‡®ðŸ‡¹" class="em emj1f1ee-1f1f9"></span><span alt="ðŸ‡¨ðŸ‡®" class="em emj1f1e8-1f1ee"></span><span alt="ðŸ‡¯ðŸ‡²" class="em emj1f1ef-1f1f2"></span><span alt="ðŸ‡¯ðŸ‡µ" class="em emj1f1ef-1f1f5"></span><span alt="ðŸ‡¯ðŸ‡ª" class="em emj1f1ef-1f1ea"></span><span alt="ðŸ‡¯ðŸ‡´" class="em emj1f1ef-1f1f4"></span><span alt="ðŸ‡°ðŸ‡¿" class="em emj1f1f0-1f1ff"></span><span alt="ðŸ‡°ðŸ‡ª" class="em emj1f1f0-1f1ea"></span><span alt="ðŸ‡°ðŸ‡®" class="em emj1f1f0-1f1ee"></span><span alt="ðŸ‡°ðŸ‡¼" class="em emj1f1f0-1f1fc"></span><span alt="ðŸ‡°ðŸ‡¬" class="em emj1f1f0-1f1ec"></span><span alt="ðŸ‡±ðŸ‡¦" class="em emj1f1f1-1f1e6"></span><span alt="ðŸ‡±ðŸ‡»" class="em emj1f1f1-1f1fb"></span><span alt="ðŸ‡±ðŸ‡§" class="em emj1f1f1-1f1e7"></span><span alt="ðŸ‡±ðŸ‡¸" class="em emj1f1f1-1f1f8"></span><span alt="ðŸ‡±ðŸ‡·" class="em emj1f1f1-1f1f7"></span><span alt="ðŸ‡±ðŸ‡¾" class="em emj1f1f1-1f1fe"></span><span alt="ðŸ‡±ðŸ‡®" class="em emj1f1f1-1f1ee"></span><span alt="ðŸ‡±ðŸ‡¹" class="em emj1f1f1-1f1f9"></span><span alt="ðŸ‡±ðŸ‡º" class="em emj1f1f1-1f1fa"></span><span alt="ðŸ‡²ðŸ‡´" class="em emj1f1f2-1f1f4"></span><span alt="ðŸ‡²ðŸ‡°" class="em emj1f1f2-1f1f0"></span><span alt="ðŸ‡²ðŸ‡¬" class="em emj1f1f2-1f1ec"></span><span alt="ðŸ‡²ðŸ‡¼" class="em emj1f1f2-1f1fc"></span><span alt="ðŸ‡²ðŸ‡¾" class="em emj1f1f2-1f1fe"></span><span alt="ðŸ‡²ðŸ‡»" class="em emj1f1f2-1f1fb"></span><span alt="ðŸ‡²ðŸ‡±" class="em emj1f1f2-1f1f1"></span><span alt="ðŸ‡²ðŸ‡¹" class="em emj1f1f2-1f1f9"></span><span alt="ðŸ‡²ðŸ‡­" class="em emj1f1f2-1f1ed"></span><span alt="ðŸ‡²ðŸ‡·" class="em emj1f1f2-1f1f7"></span><span alt="ðŸ‡²ðŸ‡º" class="em emj1f1f2-1f1fa"></span><span alt="ðŸ‡²ðŸ‡½" class="em emj1f1f2-1f1fd"></span><span alt="ðŸ‡«ðŸ‡²" class="em emj1f1eb-1f1f2"></span><span alt="ðŸ‡²ðŸ‡©" class="em emj1f1f2-1f1e9"></span><span alt="ðŸ‡²ðŸ‡¨" class="em emj1f1f2-1f1e8"></span><span alt="ðŸ‡²ðŸ‡³" class="em emj1f1f2-1f1f3"></span><span alt="ðŸ‡²ðŸ‡ª" class="em emj1f1f2-1f1ea"></span><span alt="ðŸ‡²ðŸ‡¸" class="em emj1f1f2-1f1f8"></span><span alt="ðŸ‡²ðŸ‡¦" class="em emj1f1f2-1f1e6"></span><span alt="ðŸ‡²ðŸ‡¿" class="em emj1f1f2-1f1ff"></span><span alt="ðŸ‡²ðŸ‡²" class="em emj1f1f2-1f1f2"></span><span alt="ðŸ‡³ðŸ‡¦" class="em emj1f1f3-1f1e6"></span><span alt="ðŸ‡³ðŸ‡·" class="em emj1f1f3-1f1f7"></span><span alt="ðŸ‡³ðŸ‡µ" class="em emj1f1f3-1f1f5"></span><span alt="ðŸ‡³ðŸ‡±" class="em emj1f1f3-1f1f1"></span><span alt="ðŸ‡³ðŸ‡¨" class="em emj1f1f3-1f1e8"></span><span alt="ðŸ‡³ðŸ‡¿" class="em emj1f1f3-1f1ff"></span><span alt="ðŸ‡³ðŸ‡®" class="em emj1f1f3-1f1ee"></span><span alt="ðŸ‡³ðŸ‡ª" class="em emj1f1f3-1f1ea"></span><span alt="ðŸ‡³ðŸ‡¬" class="em emj1f1f3-1f1ec"></span><span alt="ðŸ‡³ðŸ‡º" class="em emj1f1f3-1f1fa"></span><span alt="ðŸ‡°ðŸ‡µ" class="em emj1f1f0-1f1f5"></span><span alt="ðŸ‡³ðŸ‡´" class="em emj1f1f3-1f1f4"></span><span alt="ðŸ‡´ðŸ‡²" class="em emj1f1f4-1f1f2"></span><span alt="ðŸ‡µðŸ‡°" class="em emj1f1f5-1f1f0"></span><span alt="ðŸ‡µðŸ‡¼" class="em emj1f1f5-1f1fc"></span><span alt="ðŸ‡µðŸ‡¸" class="em emj1f1f5-1f1f8"></span><span alt="ðŸ‡µðŸ‡¦" class="em emj1f1f5-1f1e6"></span><span alt="ðŸ‡µðŸ‡¬" class="em emj1f1f5-1f1ec"></span><span alt="ðŸ‡µðŸ‡¾" class="em emj1f1f5-1f1fe"></span><span alt="ðŸ‡µðŸ‡ª" class="em emj1f1f5-1f1ea"></span><span alt="ðŸ‡µðŸ‡­" class="em emj1f1f5-1f1ed"></span><span alt="ðŸ‡µðŸ‡±" class="em emj1f1f5-1f1f1"></span><span alt="ðŸ‡µðŸ‡¹" class="em emj1f1f5-1f1f9"></span><span alt="ðŸ‡µðŸ‡·" class="em emj1f1f5-1f1f7"></span><span alt="ðŸ‡¶ðŸ‡¦" class="em emj1f1f6-1f1e6"></span><span alt="ðŸ‡·ðŸ‡´" class="em emj1f1f7-1f1f4"></span><span alt="ðŸ‡·ðŸ‡º" class="em emj1f1f7-1f1fa"></span><span alt="ðŸ‡·ðŸ‡¼" class="em emj1f1f7-1f1fc"></span><span alt="ðŸ‡¼ðŸ‡¸" class="em emj1f1fc-1f1f8"></span><span alt="ðŸ‡¸ðŸ‡²" class="em emj1f1f8-1f1f2"></span><span alt="ðŸ‡¸ðŸ‡¹" class="em emj1f1f8-1f1f9"></span><span alt="ðŸ‡¸ðŸ‡¦" class="em emj1f1f8-1f1e6"></span><span alt="ðŸ‡¸ðŸ‡³" class="em emj1f1f8-1f1f3"></span><span alt="ðŸ‡·ðŸ‡¸" class="em emj1f1f7-1f1f8"></span><span alt="ðŸ‡¸ðŸ‡¨" class="em emj1f1f8-1f1e8"></span><span alt="ðŸ‡¸ðŸ‡±" class="em emj1f1f8-1f1f1"></span><span alt="ðŸ‡¸ðŸ‡¬" class="em emj1f1f8-1f1ec"></span><span alt="ðŸ‡¸ðŸ‡°" class="em emj1f1f8-1f1f0"></span><span alt="ðŸ‡¸ðŸ‡®" class="em emj1f1f8-1f1ee"></span><span alt="ðŸ‡¸ðŸ‡§" class="em emj1f1f8-1f1e7"></span><span alt="ðŸ‡¸ðŸ‡´" class="em emj1f1f8-1f1f4"></span><span alt="ðŸ‡¿ðŸ‡¦" class="em emj1f1ff-1f1e6"></span><span alt="ðŸ‡°ðŸ‡·" class="em emj1f1f0-1f1f7"></span><span alt="ðŸ‡ªðŸ‡¸" class="em emj1f1ea-1f1f8"></span><span alt="ðŸ‡±ðŸ‡°" class="em emj1f1f1-1f1f0"></span><span alt="ðŸ‡¸ðŸ‡©" class="em emj1f1f8-1f1e9"></span><span alt="ðŸ‡¸ðŸ‡·" class="em emj1f1f8-1f1f7"></span><span alt="ðŸ‡¸ðŸ‡¿" class="em emj1f1f8-1f1ff"></span><span alt="ðŸ‡¸ðŸ‡ª" class="em emj1f1f8-1f1ea"></span><span alt="ðŸ‡¨ðŸ‡­" class="em emj1f1e8-1f1ed"></span><span alt="ðŸ‡¸ðŸ‡¾" class="em emj1f1f8-1f1fe"></span><span alt="ðŸ‡¹ðŸ‡¼" class="em emj1f1f9-1f1fc"></span><span alt="ðŸ‡¹ðŸ‡¯" class="em emj1f1f9-1f1ef"></span><span alt="ðŸ‡¹ðŸ‡¿" class="em emj1f1f9-1f1ff"></span><span alt="ðŸ‡¹ðŸ‡­" class="em emj1f1f9-1f1ed"></span><span alt="ðŸ‡¹ðŸ‡±" class="em emj1f1f9-1f1f1"></span><span alt="ðŸ‡¹ðŸ‡¬" class="em emj1f1f9-1f1ec"></span><span alt="ðŸ‡¹ðŸ‡´" class="em emj1f1f9-1f1f4"></span><span alt="ðŸ‡¹ðŸ‡¹" class="em emj1f1f9-1f1f9"></span><span alt="ðŸ‡¹ðŸ‡³" class="em emj1f1f9-1f1f3"></span><span alt="ðŸ‡¹ðŸ‡·" class="em emj1f1f9-1f1f7"></span><span alt="ðŸ‡¹ðŸ‡²" class="em emj1f1f9-1f1f2"></span><span alt="ðŸ‡¹ðŸ‡»" class="em emj1f1f9-1f1fb"></span><span alt="ðŸ‡ºðŸ‡¬" class="em emj1f1fa-1f1ec"></span><span alt="ðŸ‡ºðŸ‡¦" class="em emj1f1fa-1f1e6"></span><span alt="ðŸ‡¦ðŸ‡ª" class="em emj1f1e6-1f1ea"></span><span alt="ðŸ‡¬ðŸ‡§" class="em emj1f1ec-1f1e7"></span><span alt="ðŸ‡ºðŸ‡¾" class="em emj1f1fa-1f1fe"></span><span alt="ðŸ‡ºðŸ‡¸" class="em emj1f1fa-1f1f8"></span><span alt="ðŸ‡ºðŸ‡¿" class="em emj1f1fa-1f1ff"></span><span alt="ðŸ‡»ðŸ‡º" class="em emj1f1fb-1f1fa"></span><span alt="ðŸ‡»ðŸ‡¦" class="em emj1f1fb-1f1e6"></span><span alt="ðŸ‡»ðŸ‡ª" class="em emj1f1fb-1f1ea"></span><span alt="ðŸ‡»ðŸ‡³" class="em emj1f1fb-1f1f3"></span><span alt="ðŸ‡¼ðŸ‡«" class="em emj1f1fc-1f1eb"></span><span alt="ðŸ‡ªðŸ‡­" class="em emj1f1ea-1f1ed"></span><span alt="ðŸ‡¾ðŸ‡ª" class="em emj1f1fe-1f1ea"></span><span alt="ðŸ‡¿ðŸ‡²" class="em emj1f1ff-1f1f2"></span><span alt="ðŸ‡¿ðŸ‡¼" class="em emj1f1ff-1f1fc"></span></div>';return e},onEmojiIconClicked:function(t){var n=e(t.currentTarget).attr("alt"),r=e(t.currentTarget).attr("class");typeof this.options.onEmojiSelected!="undefined"&&this.options.onEmojiSelected(n,r,e(t.currentTarget)),this.saveRecentEmojis(n,r)},saveRecentEmojis:function(e,t){var n=JSON.parse(localStorage.getItem("commsweb_emoji_recent"));n==null&&(n=[]);var r={alt:e,src:t};n.push(r),localStorage.setItem("commsweb_emoji_recent",JSON.stringify(n))},remove_duplicates:function(e){var t={};for(var n=e.length-1;n>=0;n--){var r=JSON.stringify(e[n]);t[r]?e.splice(n,1):t[r]=!0}return e},close:function(){console.debug("close"),this.remove(),this.unbind();for(var e=0;e<this.niceScrolls.length;++e)this.niceScrolls[e].remove()}});return s}),define("rcemoji/rcemoji",["jquery","twemoji","rcemoji/emojiview"],function(e,t,n){var r=function(){return{parse:function(e){var n=t.parse(e,{base:"js/lib/twemoji/",folder:"icons",ext:".png"});return n=this._checkForFlag(n),n},unParse:function(t){var n="<span>"+t+"</span>",r=e(n);return r.find("img.emoji").each(function(){e(this).before(e(this).attr("alt")),e(this).remove()}),r.html()},htmlDecode:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes.length===0?"":t.childNodes[0].nodeValue},initialize:function(){console.debug("showPicker")},createEmojiView:function(e){var t=new n(e);return t},_unittest:function(){r._checkString("<span>Abc </span>"),r._checkString("<span>hello world</span>"),r._checkString("<span>ðŸ„</span>"),r._checkString("<span>test ðŸ•  adsfsafdasf ðŸŽ¸  adfsadfsadf ðŸž   asdfasdfasdf</span>"),r._checkString("hello ðŸŽ© ")},_checkString:function(e){var t=e,n=r.parse(t);console.debug("parsed string: '"+n+"'");var i=r.unParse(n);console.debug("unparsed string: '"+i+"'"),console.assert(i===t)},_checkForFlag:function(t){var n=["1f1e6","1f1e7","1f1e8","1f1e9","1f1ea","1f1eb","1f1ec","1f1ed","1f1ee","1f1ef","1f1f0","1f1f1","1f1f2","1f1f3","1f1f4","1f1f5","1f1f6","1f1f7","1f1f8","1f1f9","1f1fa","1f1fb","1f1fc","1f1fd","1f1fe","1f1ff"],r=-1,i=0,s="",o="",u=!1,a=e("<div>"+t+"</div>"),f=a.find("img.emoji").length;if(f>=2){var l=a.find("img.emoji");l.each(function(t){var f=e(this).attr("src"),l=e(this).attr("alt");imagename=f.split("/").pop(),imagename=imagename.replace(/\.png/,"");var c=n.indexOf(imagename);c!=-1&&(r==-1?(r=t,s=imagename,u=!0,e(this).remove()):t-r==1&&(s=s+"-"+imagename+".png",u=!0),u==1&&(o+=l,i++));if(i==2){s="js/lib/twemoji/icons/"+s;var h='<img class="emoji" draggable="false" alt="'+o+'" src="'+s+'">';a.find(this).replaceWith(h),r=-1,i=0,s="",o="",u=!1}})}return a.html()}}}();return r}),define("models/usermodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",i=t.Model.extend({defaults:{firstname:"",lastname:"",nickname:"",avatar:"",presence:"",comms_id:"",about:"",gender:"",birthday:"",language:"",location:""},initialize:function(){this._setEmojiName(),this.on("change:nickname",this._setEmojiName),this.changeAvatar(),this.on("change:avatar",this.changeAvatar)},_setEmojiName:function(){this.set("nickname_emoji",n.parse(this.escape("nickname")))},changeAvatar:function(){if(this.get("avatar")!==""&&this.get("avatar")!==r){var e=this.get("avatar").split("/"),t=e[e.length-1],n="https://dbq9ithrljsz0.cloudfront.net/"+t;this.set("avatar",n)}else this.set("avatar",r)}});return i}),define("views/leftheaderview",["jquery","underscore","backbone","text!templates/leftheaderview.html","models/usermodel"],function(e,t,n,r,i){var s=n.View.extend({tagName:"div",className:"left-header-view",events:{"click .compose":"_onComposeClicked"},settingsView:null,user:null,initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r)},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onComposeClicked:function(){this._onComposeOpened(),this.options.sharedObjects.router.navigate("compose",{trigger:!0})},_onComposeClosed:function(){this.$(".compose").removeClass("active")},_onComposeOpened:function(){this.$(".compose").addClass("active")}});return s}),define("text!templates/activityview.html",[],function(){return'<ul>\n</ul>\n<div class="noactivity hvalign">You have no activity yet</div>'}),define("text!templates/activityitem.html",[],function(){return'<% if (group_chat) { %>\n	<img class="group avatar" src="<%- avatar %>">\n<% } else { %>\n	<img class="avatar round" src="<%- avatar %>">\n<% } %>\n\n<div class="presence round <%- presence %>"></div>\n<div class="title textwrap"><%= name_emoji %></div>\n<div class="date"><%- date %></div>\n<div class="text textwrap"><%= message_emoji %></div>\n<div class="unread">\n    <div class="icon round"><span class="count"><%- unread %></span></div>\n\n    <div class="more"></div>\n</div>\n'}),define("text!templates/activityitemgroup.html",[],function(){return'\r\n<img class="group avatar" src="<%- avatar %>">\r\n<div class="date"><%- date %></div>\r\n<div class="title textwrap"><%= name_emoji %></div>\r\n<% if (sender && sender.nickname) { %>\r\n  <!-- <div class="sender textwrap"></div>-->\r\n	<div class="text textwrap"><span class="sender textwrap"><%= sender_name_emoji %></span><span class="message">&nbsp;-&nbsp;<%= message_emoji %></span></div>\r\n<% } else { %>\r\n	<div class="text textwrap"><%= message_emoji %></div>\r\n<% } %>\r\n<div class="unread">\r\n    <div class="icon round"><span class="count"><%- unread %></span></div>\r\n\r\n    <div class="more"></div>\r\n</div>\r\n'}),define("text!templates/ongoingcall.html",[],function(){return'<% if (group_chat) { %>\r\n	<img class="group avatar" src="<%- avatar %>">\r\n	<div class="razericons-call_out ongoingcallicon"></div>\r\n	<div class="overlay group"></div>\r\n<% } else { %>\r\n	<img class="avatar round" src="<%- avatar %>">\r\n	<div class="razericons-call_out ongoingcallicon"></div>\r\n	<div class="overlay round"></div>\r\n<% } %>\r\n\r\n<% if (!group_chat) { %>\r\n<div class="presence round <%- presence %>"></div>\r\n<% } %>\r\n<div class="title call textwrap"><%= name_emoji %></div>\r\n<div class="date"><%- date %></div>\r\n<div class="text call textwrap">Ongoing Call</div>\r\n<div class="unread">\r\n    <div class="icon round"><span class="count"><%- unread %></span></div>\r\n\r\n    <div class="more"></div>\r\n</div>\r\n'}),define("text!templates/missedcall.html",[],function(){return'<% if (group_chat) { %>\r\n	<img class="group avatar" src="<%- avatar %>">\r\n<% } else { %>	\r\n	<img class="avatar round" src="<%- avatar %>">\r\n	<% if (unread_missed_call > 0) { %>\r\n		<div class="razericons-call_cancel missedicon"></div>\r\n		<div class="overlay round"></div>\r\n	<% } %>\r\n<% } %>\r\n\r\n<% if (!group_chat) { %>\r\n<div class="presence round <%- presence %>"></div>\r\n<% } %>\r\n<div class="title textwrap"><%= name_emoji %></div>\r\n<div class="date"><%- date %></div>\r\n\r\n<% if (unread_missed_call === 1) { %>\r\n	<div class="text textwrap">You missed <%- unread_missed_call %> call</div>\r\n<% } else if (unread_missed_call > 1){ %>\r\n	<div class="text textwrap">You missed <%- unread_missed_call %> calls</div>\r\n<% } else { %>\r\n	<div class="text textwrap">Missed Call</div>\r\n<% } %>\r\n\r\n<div class="unread">\r\n    <div class="icon round"><span class="count"><%- unread %></span></div>\r\n    <div class="more"></div>\r\n</div>\r\n'}),define("text!templates/successfulcall.html",[],function(){return'<% if (group_chat) { %>\r\n	<img class="group avatar" src="<%- avatar %>">\r\n<% } else { %>\r\n	<img class="avatar round" src="<%- avatar %>">\r\n<% } %>\r\n\r\n<% if (!group_chat) { %>\r\n	<div class="presence round <%- presence %>"></div>\r\n<% } %>\r\n<div class="title call textwrap"><%= name_emoji %></div>\r\n<div class="date"><%- date %></div>\r\n<div class="text call textwrap">Call ended.\r\n<% if (duration !== undefined) { %>\r\n	<span> <%- duration %> seconds</span>\r\n<% } %>\r\n</div>\r\n<div class="unread">\r\n    <div class="icon round"><span class="count"><%- unread %></span></div>\r\n    <div class="more"></div>\r\n</div>\r\n'}),define("text!templates/cancelledcall.html",[],function(){return'<% if (group_chat) { %>\r\n	<img class="group avatar" src="<%- avatar %>">\r\n<% } else { %>\r\n	<img class="avatar round" src="<%- avatar %>">\r\n<% } %>\r\n\r\n<% if (!group_chat) { %>\r\n<div class="presence round <%- presence %>"></div>\r\n<% } %>\r\n<div class="title call textwrap"><%= name_emoji %></div>\r\n<div class="date"><%- date %></div>\r\n<div class="text call textwrap">Cancelled Call</div>\r\n<div class="unread">\r\n    <div class="icon round"><span class="count"><%- unread %></span></div>\r\n    <div class="more"></div>\r\n</div>\r\n'});var Utils=function(){var e="https://api.comms.razerzone.com/";return{getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))},htmlEncode:function(e){return $("<div/>").text(e).html()},capitalize:function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},openWindow:function(e,t,n,r,i,s,o,u){t=Math.round(t),n=Math.round(n),r=Math.round(r),i=Math.round(i),s=typeof s!="undefined"?s:!1,o=typeof o!="undefined"?o:!1,u=typeof u!="undefined"?u:!1,console.debug("url: "+e+" x: "+t+" y: "+n+" width: "+r+" height: "+i);if(typeof app!="undefined"){var a={url:e,x:t,y:n,width:r,height:i};s?cefstream.createChildWindow(a):CefUtils.createWindow(a,o,u)}else{var a="width="+r+" height="+i;a+=" left="+t,a+=" top="+n,console.debug("options: "+a),window.open(e,"",a)}},showUserProfile:function(t,n){console.debug("showUserProfile: "+t),console.assert(t!=="");var r="http://comms-svcs.razersynapse.com/webui/view-profile2/profile?buddyid="+t;n&&n!==""&&(r+="&api_key="+encodeURIComponent(n));var i="PROFILE",s='            <div class="view-profile" style="width:500px; height:410px;">             </div>             ',o='<div class="rc-box-center"><div class="add-friend-button rc-button" style="display:none;">ADD TO FRIENDS</div></div>';w2popup.open({title:i,body:s,width:520,height:550,modal:!1,buttons:o,onOpen:function(i){i.onComplete=function(){var i='                        <div class="loading disable-select" style="position:absolute;top:0;width:100%;height:100%;">                             <div class="rc-loader-small" style="display:block;"></div>                         </div>                         ';$(".w2ui-popup .view-profile").append(i),$.ajax({type:"GET",url:e+"/users/"+encodeURIComponent(t),headers:{Authorization:"Basic "+btoa(n+":"+"")},success:function(e){console.debug("GET /users/{userId} success:"),console.debug(e),typeof e.friend!="undefined"&&!e.friend?$(".w2ui-popup .w2ui-msg-buttons .add-friend-button").show():typeof e.friend=="undefined"?console.debug("API error, missing friend parameter"):console.debug("Already friends")},error:function(e){console.error("error: "),console.error(e)}});var s='<iframe frameborder="0" style="overflow:none;" id="user-profile" width="100%" height="0" src=""></iframe>';$(".w2ui-popup .view-profile").append(s),$(".w2ui-popup .view-profile iframe#user-profile").attr("src",r),$(".w2ui-popup .view-profile iframe#user-profile").load(function(){$(".w2ui-popup .view-profile .loading").hide(),$(".w2ui-popup .view-profile iframe#user-profile").attr("height","100%"),console.debug("iframe load finished"),$(".w2ui-msg-body").niceScroll({cursorborder:"",cursorcolor:"#404040"}),$(".w2ui-popup .w2ui-msg-buttons .add-friend-button").click(function(){CefUtils.sendMessage("addfriend",{userlist:[t]}),w2popup.close()})})}}})},replaceLastPath:function(e,t){var n=e,r="";for(var i=0;i<n.length-2;i++)n[i]!==""&&(r+="/",r+=n[i]);return r+="/"+t+"/",r},htmlEncode:function(e){return $("<div/>").text(e).html()},getCookie:function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return""},urlGetParameterByName:function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=n.exec(t);return r==null?"":decodeURIComponent(r[1].replace(/\+/g," "))},isImageUrl:function(e){var t=/^http.*(jpg|png|jpeg|bmp|svg|gif)$/i;return t.test(e)}}}();define("utils",function(e){return function(){var t,n;return t||e.Utils}}(this)),define("views/activity/activityitem",["jquery","underscore","backbone","text!templates/activityitem.html","text!templates/activityitemgroup.html","text!templates/ongoingcall.html","text!templates/missedcall.html","text!templates/successfulcall.html","text!templates/cancelledcall.html","utils"],function(e,t,n,r,i,s,o,u,a,f){var l=n.View.extend({tagName:"li",className:"activity-item-view grid",events:{click:"_onClick"},router:null,comms:null,initialize:function(e){t.bindAll(this,"render","close","_onRecentChatChange"),this.options=e,this.userTemplate=t.template(r),this.groupTemplate=t.template(i),this.ongoingTemplate=t.template(s),this.missedTemplate=t.template(o),this.successfulTemplate=t.template(u),this.cancelledTemplate=t.template(a),this.router=this.options.sharedObjects.router,this.comms=this.options.sharedObjects.comms;var n="recentChatChange."+this.model.get("chat_id");this.comms.ChatHistory.on(n,this._onRecentChatChange,this),this.model.on("change",this.render,this),this.model.on("change:removed",this.close),this.callHandler=this.options.sharedObjects.callHandler},render:function(){f.isImageUrl(this.model.get("message"))&&this.model.set("message","photo");if(this.model.get("type")==="missed_call")this.$el.html(this.missedTemplate(this.model.toJSON()));else if(this.model.get("type")==="canceled_call")this.$el.html(this.cancelledTemplate(this.model.toJSON()));else if(this.model.get("type")==="voice_call_end"){this.$el.html(this.successfulTemplate(this.model.toJSON()));if(this.model.has("duration")){var e=this.model.get("duration"),t=this.model.formatDuration(e);this.$(".text.call span").text(t)}}else this.model.get("type")==="voice_call_start"?(this.$el.html(this.ongoingTemplate(this.model.toJSON())),this.callHandler.voiceConnection||(this.$(".ongoingcallicon").hide(),this.$(".overlay").hide(),this.model.set("type","voice_call_end"))):this.model.get("group_chat")?(this.$el.html(this.groupTemplate(this.model.toJSON())),this.$el.addClass("group")):this.$el.html(this.userTemplate(this.model.toJSON()));return this.model.get("unread")>0?(this.$(".unread").show(),this.model.get("unread")>=99?(this.$(".unread div.more").show(),this.$(".unread span.count").hide()):this.$(".unread div.more").hide()):this.$(".unread").hide(),this.$el.data("id",this.model.get("chat_id")),this},close:function(){this.remove(),this.unbind(),this.model.off(null,null,this),this.comms.ChatHistory.off(null,null,this)},_onClick:function(){this.options.onItemClick(this),this.$el.addClass("active");var e="activity/"+encodeURIComponent(this.model.get("chat_id"));this.model.has("adhoc")&&this.model.get("adhoc")&&this.model.get("type")==="chat"&&(e+="?adhoc=1"),this.router.navigate(e,{trigger:!0})},_onRecentChatChange:function(e){this.model.set(e)}});return l}),define("models/recentchatmodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",i=t.Model.extend({defaults:{chat_id:"",avatar:"",name:"",message:"",unread:0,group_chat:!1,presence:"offline",name_emoji:"",message_emoji:"",removed:!1,adhoc:!1,announcement:!1,sender:{id:"",name:""},sender_name_emoji:""},idAttribute:"chat_id",initialize:function(){e.bindAll(this,"_setEmojiMessage","_setEmojiName","setSenderNickNameEmoji"),this._setEmojiMessage(),this._setEmojiName(),this.changeAvatar(),this.on("change:message",this._setEmojiMessage),this._setTimestampNew(),this.on("change:timestamp",this._setTimestampNew),this.on("change:avatar",this.changeAvatar),this.setSenderNickNameEmoji(),this.on("change:sender",this.setSenderNickNameEmoji)},_setEmojiMessage:function(){this.set("message_emoji",n.parse(this.escape("message")))},_setEmojiName:function(){this.set("name_emoji",n.parse(this.escape("name")))},_setTimestampNew:function(){var e=new Date(parseInt(this.get("timestamp"))*1e3),t=e.getHours(),n=this._pad(e.getDate(),2),r=this._pad(e.getMonth()+1,2),i=new Date,s=i.toLocaleDateString();if(s==e.toLocaleDateString()){var o=t+":"+this._pad(e.getMinutes(),2);this.set("date",o)}else{i.setDate(i.getDate()-1);if(i.toLocaleDateString()===e.toLocaleDateString())this.set("date","Yesterday");else{var i=new Date,s=i.toLocaleDateString();if(i.getFullYear()===e.getFullYear()){var u=n+"/"+r;this.set("date",u)}else this.set("date","Last Year")}}},_pad:function(e,t){var n=Math.pow(10,t);return e<n?(""+(n+e)).slice(1):""+e},changeAvatar:function(){if(this.get("avatar")!==""){var e=this.get("avatar");if(this.get("group_chat"))var t=e.replace("http://","https://");else if(e!==r)var n=e.split("/"),i=n[n.length-1],t="https://dbq9ithrljsz0.cloudfront.net/"+i;else t=e;this.set("avatar",t)}else this.get("group_chat")?this.set("avatar","assets/images/Grp_def.svg"):this.set("avatar",r)},setSenderNickNameEmoji:function(){var e;this.has("sender")&&(e=this.get("sender"));if(!e||!e.nickname||!e.id)return;var t=n.parse(e.nickname);this.set("sender_name_emoji",t)},formatDuration:function(e){var t="";if(e<60)e===1?t=e+" second":t=e+" seconds";else if(e<3600){var n=Math.floor(e/60),r=e-n*60,i,s;n===1?i="minute":i="minutes",r===1?s="second":s="seconds",r===0?t=n+" "+i:t=n+" "+i+" "+r+" "+s}else{var o=Math.floor(e/3600),n=Math.floor((e-o*3600)/60),r=e-o*3600-n*60,u;o===1?u="hour":u="hours",t=o+" "+u,n>0&&(n===1?t+=" 1 minute":t+=" "+n+" minutes")}return t}});return i}),define("collections/recentchatcollection",["underscore","backbone","models/recentchatmodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){var n=e.get("timestamp"),r=t.get("timestamp");return n>r?-1:n<r?1:0}});return r}),define("text!templates/friendrequest.html",[],function(){return'<% if (avatar === \'\') { %>\n    <img class="avatar" src="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png">\n<% } else { %>\n    <img class="avatar" src="<%- avatar %>">\n<% } %>\n<div class="title">Invite Received</div>\n<div class="text"><%= nickname_emoji %></div>\n<div class="delete"><span class="razericons-close"></span></div>\n<div class="confirm"><span class="razericons-validate"></span></div>\n\n'}),define("models/friendrequestmodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",i=t.Model.extend({defaults:{user_id:"",nickname:"",avatar:"",nickname_emoji:""},initialize:function(){this._setEmoji(),this.on("change:nickname",this._setEmoji),this.changeAvatar(),this.on("change:avatar",this.changeAvatar)},_setEmoji:function(){this.set("nickname_emoji",n.parse(this.escape("nickname")))},changeAvatar:function(){if(this.get("avatar")!==""&&this.get("avatar")!==r){var e=this.get("avatar").split("/"),t=e[e.length-1],n="https://s3.amazonaws.com/rzravatar/"+t;this.set("avatar",n)}else this.set("avatar",r)}});return i}),define("text!templates/viewprofile.html",[],function(){return'<div class="left">\r\n	<div class="title">PUBLIC PROFILE</div>\r\n	<div class="comms_logo"><img class="ths" src="assets/images/ths_large.svg"></div>\r\n	<div class="razer_logo razericons-razer"></div>\r\n</div>\r\n<div class="right">\r\n	<div class="content">\r\n	\r\n			<div class="row" style="height:130px">\r\n				<div class="avatarcontainer"><img src="<%- avatar %>" class="avatar round"></div>\r\n                <div class="edit-avatar"><div class="razericons-camera camera"/></div>\r\n                <input class="file-select-input" type="file" name="upload" accept="image/*">\r\n				<div class="data" style="margin-top:5px">							\r\n					<div class="name textwrap"><%- firstname %> <%- lastname %></div>\r\n					<div class="about"><%- about %></div>\r\n				</div>\r\n			</div>\r\n\r\n			<div class="infotext">\r\n				<% if(nickname_emoji !== "" ) { %>\r\n					<div class="row nickname-row">\r\n						<div class="label">NickName</div>\r\n						<div class="data"><%= nickname_emoji %></div>\r\n                        <input class="nickname-input" type="text"/>\r\n					</div>\r\n				<% } %>\r\n				<% if(comms_id !== "" ) { %>\r\n					<div class="row">\r\n						<div class="label">Razer ID</div>\r\n						<div class="data"><%- comms_id %></div>\r\n					</div>\r\n				<% } %>\r\n				<% if(gender !== "" ) { %>\r\n					<div class="row gender">\r\n						<div class="label">Gender</div>\r\n						<div class="data"><%- gender %></div>\r\n					</div>\r\n				<% } %>\r\n				<% if(birthday !== "" ) { %>\r\n					<div class="row dob">\r\n						<div class="label">Date of Birth</div>\r\n						<div class="data"><%- birthday %></div>\r\n					</div>\r\n				<% } %>\r\n				<% if(language !== "" ) { %>\r\n					<div class="row lang">\r\n						<div class="label">Language</div>\r\n						<div class="data"><%- language %></div>\r\n					</div>\r\n				<% } %>\r\n				<% if(location !== "" ) { %>\r\n					<div class="row location">\r\n						<div class="label">Location</div>\r\n						<div class="data"><%- location %></div>\r\n					</div>\r\n				<% } %>\r\n		</div>\r\n		<div class="loader hvalign"></div>				\r\n	</div>\r\n\r\n	\r\n	<div class="button_containers non-friend">\r\n		<div class="addfriend icon vertical-align"><div class="razericons-user_add add"></div></div>\r\n	</div>\r\n\r\n	<div class="button_containers friend">\r\n		<div class="icon vertical-align call"><div class="razericons-call"></div></div>\r\n		<div class="icon vertical-align message"><div class="razericons-message"></div></div>\r\n		<div class="icon vertical-align removefriend"><div class="razericons-user_delete"></div></div>\r\n	</div>\r\n\r\n	<div class="button_containers me">\r\n		<div class="edit-profile rc-button vertical-align">EDIT PROFILE</div>\r\n		<div class="cancel rc-button rc-button-cancel vertical-align">CANCEL</div>\r\n	</div>\r\n\r\n    <div class="button_containers blocked">\r\n		<div class="unblock rc-button vertical-align">UNBLOCK</div>\r\n    </div>\r\n\r\n    <div class="button_containers save">\r\n        <div class="save-profile rc-button vertical-align">SAVE</div>\r\n    </div>\r\n	\r\n</div>\r\n'});var rcDialog=function(){return{yesNo:function(e,t,n,r,i,s,o){if(typeof n=="undefined"||typeof t=="function")n=t,t=w2utils.lang("Confirmation");typeof t=="undefined"&&(console.log("title is undefined"),t=w2utils.lang("Confirmation"));if(typeof r=="undefined")var u="Yes";else var u=r;if(typeof i=="undefined")var a="No";else var a=i;$("#w2ui-popup").length>0?w2popup.message({width:490,height:285,opacity:.9,html:'<div class="dialog"><div class="alerticon '+s+'"></div><div>'+t+'</div><div class="message">'+e+'</div><div class="dialogbtncenter"><div id="No" class="rc-button no btn">'+a+"</div>"+'<div id="Yes" class="rc-button yes btn">'+u+"</div></div></div>",onOpen:function(){$("#w2ui-popup .w2ui-popup-message .rc-button").on("click",function(e){w2popup.message(),typeof n=="function"&&n(e.target.id)})},onKeydown:function(e){switch(e.originalEvent.keyCode){case 13:typeof n=="function"&&n("Yes"),w2popup.message();break;case 27:typeof n=="function"&&n("No"),w2popup.message()}}}):w2popup.open({width:490,height:285,modal:!1,showClose:!1,opacity:.9,body:'<div class="dialog"><div class="alerticon '+s+'"></div><div>'+t+'</div><div class="message">'+e+'</div><div class="dialogbtncenter"><div id="No" class="rc-button no btn">'+a+"</div>"+'<div id="Yes" class="rc-button yes btn">'+u+"</div></div></div>",onOpen:function(e){e.onComplete=function(){$("#w2ui-popup .w2ui-msg-body").css("background-color","#f4f4f4"),$("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),$("#w2ui-popup .rc-button").on("click",function(e){w2popup.close(),typeof n=="function"&&n(e.target.id)}),$("#w2ui-popup .close").on("click",function(e){w2popup.close()})}},onKeydown:function(e){switch(e.originalEvent.keyCode){case 13:typeof n=="function"&&n("Yes"),w2popup.close();break;case 27:typeof n=="function"&&n("No"),w2popup.close()}}})},info:function(e,t,n){if(typeof n=="undefined")var r="OK";else var r=n.OK;$("#w2ui-popup").length>0?(console.info("showing w2popup.message"),w2popup.message({width:486,height:250,modal:!0,showClose:!1,style:"overflow:hidden;",body:'<div class="w2ui-centered"><div style="font-size: 13px;">'+e+"</div></div>",buttons:'<div class="rc-box-center"><div style="margin-right:10px;" class="rc-button">'+r+"</div>",onOpen:function(e){e.onComplete=function(){$("#w2ui-popup .rc-button").on("click",function(e){w2popup.close(),t&&t()})}}})):w2popup.open({width:486,height:250,modal:!0,showClose:!1,style:"overflow:hidden;",body:'<div class="w2ui-centered" style="overflow:hidden;"><div style="font-size: 13px;">'+e+"</div></div>",buttons:'<div class="rc-box-center"><div style="margin-right:10px;" class="rc-button">'+r+"</div>",onOpen:function(e){e.onComplete=function(){$("#w2ui-popup .rc-button").on("click",function(e){w2popup.close()})}},onClose:function(){t&&t()}})}}}();define("rcdialog",["w2ui"],function(e){return function(){var t,n;return t||e.rcDialog}}(this)),define("views/callui/callhandler",["jquery","underscore","backbone"],function(e,t,n){var r=640,i="VOICE_CONNECTED",s="DISCONNECTED",o="sessionCreated",u="callAnswered",a="callRejected",f="FORCE_HANGUP_STATE",l=n.View.extend({tagName:"div",className:"call-handler-view",events:{},voiceConnection:null,callWindow:null,group_chat:!1,interval:null,initialize:function(e){t.bindAll(this,"_showCallViewNew","_listenForCallUiEvents","render"),t.bindAll(this,"close","_onCallStateChanged","_messageEventListener","_checkChildWindow"),this.options=e,console.assert(this.options.sharedObjects.comms),console.assert(this.options.sharedObjects),console.debug("initialize: window"),console.debug(window),this.voiceConnection=null,this.callWindow=null,this.options.sharedObjects.comms.isGroupChat(this.options.chat_id)?(console.debug("group chat"),this.group_chat=!0):(console.debug("1-to-1 chat"),this.group_chat=!1),this._listenForCallUiEvents();var n=this;this.options.sharedObjects.comms.on("answerCall",function(e){console.debug("Call answered: "+JSON.stringify(e)),n.callWindow&&n.callWindow.postMessage({action:u,session_id:e.session_id},"*")},this),this.options.sharedObjects.comms.on("hangupCall",function(e){console.debug("Call hangup: "+JSON.stringify(e))},this),this.options.sharedObjects.comms.on("rejectCall",function(e){console.debug("Call rejected: "+JSON.stringify(e)),n.callWindow&&n.callWindow.postMessage({action:a,session_id:e.session_id},"*")},this),this.options.sharedObjects.comms.on("callStateChanged",this._onCallStateChanged,this)},render:function(){},close:function(){console.debug("close"),this.options.sharedObjects.comms.off(null,null,this),window.removeEventListener("message",this._messageEventListener),this.interval&&clearInterval(this.interval),this.remove(),this.unbind()},_showCallViewNew:function(){console.debug("_showCallViewNew: chat_id: "+this.options.chat_id),console.debug("this.options"),console.debug(this.options),console.debug(window.location),console.debug(window.VOE);var e=this,t="";t=window.location.origin+window.location.pathname,this.options.sharedObjects.dev&&(t+="?dev=1"),t+="#callui/"+encodeURIComponent(this.options.chat_id),t+="/"+encodeURIComponent(this.options.sharedObjects.comms.user_id),t+="/"+encodeURIComponent(this.options.sharedObjects.comms.user.get("nickname")),console.debug("popup url: "+t),this.group_chat||this.options.sharedObjects.comms.call({user_id:e.options.chat_id,success:function(t){console.debug("1-to-1 call created: session_id: "+t),e.callWindow.postMessage({action:"sessionCreated",session_id:t},"*")}}),this.callWindow=this._popupCenter(t,"Comms Call",310,390),this._checkChildWindow()},_popupCenter:function(e,t,n,r){var i=window.screenLeft!=undefined?window.screenLeft:screen.left,s=window.screenTop!=undefined?window.screenTop:screen.top,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,u=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,a=o/2-n/2+i,f=u/2-r/2+s,l=window.open(e,t,"scrollbars=yes, width="+n+", height="+r+", top="+f+", left="+a);return window.focus&&l.focus(),l},_listenForCallUiEvents:function(){console.debug("_listenForCallUiEvents");var e=this;window.addEventListener("message",this._messageEventListener)},_messageEventListener:function(e){var t=this;console.debug("_messageEventListener: message from child window, data: "+JSON.stringify(e.data));if(!e.data.state||!e.data.session_id){console.warn("Invalid event data");return}if(e.data.state===i)!e.data.adhoc&&this.group_chat&&t.options.sharedObjects.comms.callIn({session_id:e.data.session_id,adhoc:e.data.adhoc,success:function(e){console.debug("callIn success: "+JSON.stringify(e))}});else if(e.data.state===s||e.data.state===f){console.debug("hangupCall: "+e.data.session_id);var n=undefined;e.data.duration&&(n=e.data.duration),t.options.sharedObjects.comms.hangupCall({session_id:e.data.session_id,duration:n}),t.callWindow=null}},_onCallStateChanged:function(e){console.debug("_onCallStateChanged: "+JSON.stringify(e));var t=this;e.ongoing_call||setTimeout(function(){t.close()},400)},_checkChildWindow:function(){var e=this;this.interval=setInterval(function(){e.callWindow?e.callWindow.closed&&(console.info("Child closed"),e.close()):(console.warn("child window null"),e.close())},1e3)}});return l}),define("text!templates/imagecropperview.html",[],function(){return'<div class="lock"/>\n<div class="body">\n    <span class="title"></span>\n    <div class="image-canvas"/>\n\n    <div class="button-container">\n        <div class="rc-button btn clear">CLEAR</div>\n        <div class="rc-button done">UPDATE</div>\n        <div class="rc-button-cancel cancel">CANCEL</div>\n    </div>\n</div>\n'}),!function(e,t){"function"==typeof define&&define.amd?define("croppie",["exports"],t):t("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:e.commonJsStrict={})}(this,function(e){function t(e){if(e in q)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=I.length;n--;)if(e=I[n]+t,e in q)return e}function n(e,t){e=e||{};for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},arguments.callee(e[n],t[n])):e[n]=t[n];return e}function r(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)},u=n&&!r;clearTimeout(r),r=setTimeout(o,t),u&&e.apply(i,s)}}function i(e){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange")}function s(e,t,n){if("string"==typeof t){var r=t;t={},t[r]=n}for(var i in t)e.style[i]=t[i]}function o(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function u(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(t,"")}function a(e,t){var n,r=t||new Image;return r.src===e?n=new Promise(function(e){e(r)}):(n=new Promise(function(t){"http"===e.substring(0,4).toLowerCase()&&r.setAttribute("crossOrigin","anonymous"),r.onload=function(){setTimeout(function(){t(r)},1)}}),r.src=e),r.style.opacity=0,n}function f(e,t){window.EXIF||t(0),EXIF.getData(e,function(){var e=EXIF.getTag(this,"Orientation");t(e)})}function l(e,t,n){var r=t.width,i=t.height,s=e.getContext("2d");switch(e.width=t.width,e.height=t.height,s.save(),n){case 2:s.translate(r,0),s.scale(-1,1);break;case 3:s.translate(r,i),s.rotate(180*Math.PI/180);break;case 4:s.translate(0,i),s.scale(1,-1);break;case 5:e.width=i,e.height=r,s.rotate(90*Math.PI/180),s.scale(1,-1);break;case 6:e.width=i,e.height=r,s.rotate(90*Math.PI/180),s.translate(0,-i);break;case 7:e.width=i,e.height=r,s.rotate(-90*Math.PI/180),s.translate(-r,i),s.scale(1,-1);break;case 8:e.width=i,e.height=r,s.translate(0,r),s.rotate(-90*Math.PI/180)}s.drawImage(t,0,0,r,i),s.restore()}function c(){var e,t,n,r,i=this,u="croppie-container",a=i.options.viewport.type?"cr-vp-"+i.options.viewport.type:null;i.options.useCanvas=i.options.enableOrientation||h.call(i),i.data={},i.elements={},e=i.elements.boundary=document.createElement("div"),n=i.elements.viewport=document.createElement("div"),t=i.elements.img=document.createElement("img"),r=i.elements.overlay=document.createElement("div"),i.options.useCanvas?(i.elements.canvas=document.createElement("canvas"),i.elements.preview=i.elements.canvas):i.elements.preview=i.elements.img,o(e,"cr-boundary"),s(e,{width:i.options.boundary.width+"px",height:i.options.boundary.height+"px"}),o(n,"cr-viewport"),a&&o(n,a),s(n,{width:i.options.viewport.width+"px",height:i.options.viewport.height+"px"}),o(i.elements.preview,"cr-image"),o(r,"cr-overlay"),i.element.appendChild(e),e.appendChild(i.elements.preview),e.appendChild(n),e.appendChild(r),o(i.element,u),i.options.customClass&&o(i.element,i.options.customClass),y.call(this),i.options.enableZoom&&d.call(i)}function h(){return(this.options.enableExif||this.options.exif)&&window.EXIF}function p(e){this.options.enableZoom&&(this.elements.zoomer.value=A(e,4))}function d(){function e(){v.call(n,{value:parseFloat(i.value),origin:new W(n.elements.preview),viewportRect:n.elements.viewport.getBoundingClientRect(),transform:z.parse(n.elements.preview)})}function t(t){var r,i;r=t.wheelDelta?t.wheelDelta/1200:t.deltaY?t.deltaY/1060:t.detail?t.detail/-60:0,i=n._currentZoom+r,t.preventDefault(),p.call(n,i),e()}var n=this,r=n.elements.zoomerWrap=document.createElement("div"),i=n.elements.zoomer=document.createElement("input");o(r,"cr-slider-wrap"),o(i,"cr-slider"),i.type="range",i.step="0.01",i.value=1,i.style.display=n.options.showZoomer?"":"none",n.element.appendChild(r),r.appendChild(i),n._currentZoom=1,n.elements.zoomer.addEventListener("input",e),n.elements.zoomer.addEventListener("change",e),n.options.mouseWheelZoom&&(n.elements.boundary.addEventListener("mousewheel",t),n.elements.boundary.addEventListener("DOMMouseScroll",t))}function v(e){var t=this,n=e?e.transform:z.parse(t.elements.preview),r=e?e.viewportRect:t.elements.viewport.getBoundingClientRect(),i=e?e.origin:new W(t.elements.preview);if(t._currentZoom=e?e.value:t._currentZoom,n.scale=t._currentZoom,t.options.enforceBoundary){var o=m.call(t,r),u=o.translate,a=o.origin;n.x>=u.maxX&&(i.x=a.minX,n.x=u.maxX),n.x<=u.minX&&(i.x=a.maxX,n.x=u.minX),n.y>=u.maxY&&(i.y=a.minY,n.y=u.maxY),n.y<=u.minY&&(i.y=a.maxY,n.y=u.minY)}var f={};f[j]=n.toString(),f[B]=i.toString(),s(t.elements.preview,f),X.call(t),w.call(t)}function m(e){var t=this,n=t._currentZoom,r=e.width,i=e.height,s=t.options.boundary.width/2,o=t.options.boundary.height/2,u=t.elements.preview.getBoundingClientRect(),a=u.width,f=u.height,l=r/2,c=i/2,h=-1*(l/n-s),p=h-(a*(1/n)-r*(1/n)),d=-1*(c/n-o),v=d-(f*(1/n)-i*(1/n)),m=1/n*l,g=a*(1/n)-m,y=1/n*c,b=f*(1/n)-y;return{translate:{maxX:h,minX:p,maxY:d,minY:v},origin:{maxX:g,minX:m,maxY:b,minY:y}}}function g(){var e=this,t=e._currentZoom,n=e.elements.preview.getBoundingClientRect(),r=e.elements.viewport.getBoundingClientRect(),i=z.parse(e.elements.preview.style[j]),o=new W(e.elements.preview),u=r.top-n.top+r.height/2,a=r.left-n.left+r.width/2,f={},l={};f.y=u/t,f.x=a/t,l.y=(f.y-o.y)*(1-t),l.x=(f.x-o.x)*(1-t),i.x-=l.x,i.y-=l.y;var c={};c[B]=f.x+"px "+f.y+"px",c[j]=i.toString(),s(e.elements.preview,c)}function y(){function e(e){if(e.preventDefault(),!l){if(l=!0,r=e.pageX,o=e.pageY,e.touches){var i=e.touches[0];r=i.pageX,o=i.pageY}transform=z.parse(f.elements.preview),window.addEventListener("mousemove",t),window.addEventListener("touchmove",t),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),document.body.style[F]="none",a=f.elements.viewport.getBoundingClientRect()}}function t(e){e.preventDefault();var t=e.pageX,n=e.pageY;if(e.touches){var l=e.touches[0];t=l.pageX,n=l.pageY}var c=t-r,h=n-o,d=f.elements.preview.getBoundingClientRect(),v=transform.y+h,m=transform.x+c,g={};if("touchmove"==e.type&&e.touches.length>1){var y=e.touches[0],w=e.touches[1],E=Math.sqrt((y.pageX-w.pageX)*(y.pageX-w.pageX)+(y.pageY-w.pageY)*(y.pageY-w.pageY));u||(u=E/f._currentZoom);var S=E/u;return p.call(f,S),void i(f.elements.zoomer)}f.options.enforceBoundary?(a.top>d.top+h&&a.bottom<d.bottom+h&&(transform.y=v),a.left>d.left+c&&a.right<d.right+c&&(transform.x=m)):(transform.y=v,transform.x=m),g[j]=transform.toString(),s(f.elements.preview,g),b.call(f),o=n,r=t}function n(){l=!1,window.removeEventListener("mousemove",t),window.removeEventListener("touchmove",t),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),document.body.style[F]="",g.call(f),w.call(f),u=0}var r,o,u,a,f=this,l=!1;f.elements.overlay.addEventListener("mousedown",e),f.elements.overlay.addEventListener("touchstart",e)}function b(){var e=this,t=e.elements.boundary.getBoundingClientRect(),n=e.elements.preview.getBoundingClientRect();s(e.elements.overlay,{width:n.width+"px",height:n.height+"px",top:n.top-t.top+"px",left:n.left-t.left+"px"})}function w(){var e=this;E.call(e)&&e.options.update.call(e,e.get())}function E(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function S(){var e,t,n,r,o,u=this,a=0,f=1.5,l=1,c={},h=u.elements.preview,d=u.elements.zoomer,v=new z(0,0,l),m=new W,y=E.call(u);y&&!u.data.bound&&(u.data.bound=!0,c[j]=v.toString(),c[B]=m.toString(),c.opacity=1,s(h,c),e=h.getBoundingClientRect(),t=u.elements.viewport.getBoundingClientRect(),n=u.elements.boundary.getBoundingClientRect(),u._originalImageWidth=e.width,u._originalImageHeight=e.height,u.options.enableZoom&&(u.options.enforceBoundary&&(r=t.width/e.width,o=t.height/e.height,a=Math.max(r,o)),a>=f&&(f=a+1),d.min=A(a,4),d.max=A(f,4),l=Math.max(n.width/e.width,n.height/e.height),p.call(u,l),i(d)),u._currentZoom=v.scale=l,c[j]=v.toString(),s(h,c),u.data.points.length?x.call(u,u.data.points):T.call(u),g.call(u),b.call(u))}function x(e){if(4!=e.length)throw"Croppie - Invalid number of points supplied: "+e;var t=this,n=e[2]-e[0],r=t.elements.viewport.getBoundingClientRect(),i=t.elements.boundary.getBoundingClientRect(),o={left:r.left-i.left,top:r.top-i.top},u=r.width/n,a=e[1],f=e[0],l=-1*e[1]+o.top,c=-1*e[0]+o.left,h={};h[B]=f+"px "+a+"px",h[j]=(new z(c,l,u)).toString(),s(t.elements.preview,h),p.call(t,u),t._currentZoom=u}function T(){var e=this,t=e.elements.preview.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),r=e.elements.boundary.getBoundingClientRect(),i=n.left-r.left,o=n.top-r.top,u=i-(t.width-n.width)/2,a=o-(t.height-n.height)/2,f=new z(u,a,e._currentZoom);s(e.elements.preview,j,f.toString())}function N(e){var t=this,n=t.elements.canvas,r=t.elements.img,i=n.getContext("2d"),s=h.call(t),e=t.options.enableOrientation&&e;i.clearRect(0,0,n.width,n.height),n.width=r.width,n.height=r.height,s?f(r,function(t){l(n,r,parseInt(t)),e&&l(n,r,e)}):e&&l(n,r,e)}function C(e){var t=e.points,n=document.createElement("div"),r=document.createElement("img"),i=t[2]-t[0],u=t[3]-t[1];return o(n,"croppie-result"),n.appendChild(r),s(r,{left:-1*t[0]+"px",top:-1*t[1]+"px"}),r.src=e.url,s(n,{width:i+"px",height:u+"px"}),n}function k(e,t){var n=t.points,r=n[0],i=n[1],s=n[2]-n[0],o=n[3]-n[1],u=t.circle,a=document.createElement("canvas"),f=a.getContext("2d"),l=s,c=o;return t.outputWidth&&t.outputHeight&&(l=t.outputWidth,c=t.outputHeight),a.width=l,a.height=c,f.drawImage(e,r,i,s,o,0,0,l,c),u&&(f.fillStyle="#fff",f.globalCompositeOperation="destination-in",f.beginPath(),f.arc(l/2,c/2,l/2,0,2*Math.PI,!0),f.closePath(),f.fill()),a.toDataURL(t.format,t.quality)}function L(e,t){var n,r=this,i=[];if("string"==typeof e)n=e,e={};else if(Array.isArray(e))i=e.slice();else{if("undefined"==typeof e&&r.data.url)return S.call(r),w.call(r),null;n=e.url,i=e.points||[]}r.data.bound=!1,r.data.url=n||r.data.url,r.data.points=(i||r.data.points).map(function(e){return parseFloat(e)});var s=a(n,r.elements.img);return s.then(function(){r.options.useCanvas&&(r.elements.img.exifdata=null,N.call(r,e.orientation||1)),S.call(r),w.call(r),t&&t()}),s}function A(e,t){return parseFloat(e).toFixed(t||0)}function O(){var e=this,t=e.elements.preview.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),r=n.left-t.left,i=n.top-t.top,s=r+n.width,o=i+n.height,u=e._currentZoom;(u===1/0||isNaN(u))&&(u=1);var a=e.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;return r=Math.max(a,r/u),i=Math.max(a,i/u),s=Math.max(a,s/u),o=Math.max(a,o/u),{points:[A(r),A(i),A(s),A(o)],zoom:u}}function M(e){var t,r=this,i=O.call(r),s=n(V,n({},e)),o="string"==typeof e?e:s.type||"viewport",u=s.size,a=s.format,f=s.quality,l=r.elements.viewport.getBoundingClientRect(),c=l.width/l.height;return"viewport"===u?(i.outputWidth=l.width,i.outputHeight=l.height):"object"==typeof u&&(u.width&&u.height?(i.outputWidth=u.width,i.outputHeight=u.height):u.width?(i.outputWidth=u.width,i.outputHeight=u.width/c):u.height&&(i.outputWidth=u.height*c,i.outputHeight=u.height)),$.indexOf(a)>-1&&(i.format="image/"+a,i.quality=f),i.circle="circle"===r.options.viewport.type,i.url=r.data.url,t=new Promise(function(e){e("canvas"===o?k.call(r,r.elements.preview,i):C.call(r,i))})}function _(){S.call(this)}function D(e){if(!this.options.useCanvas)throw"Croppie: Cannot rotate without enableOrientation";var t=this,n=t.elements.canvas,r=(t.elements.img,document.createElement("canvas")),i=1;r.width=n.width,r.height=n.height;var s=r.getContext("2d");s.drawImage(n,0,0),(90===e||-270===e)&&(i=6),(-90===e||270===e)&&(i=8),(180===e||-180===e)&&(i=3),l(n,r,i),v.call(t)}function P(){var e=this;e.element.removeChild(e.elements.boundary),u(e.element,"croppie-container"),e.options.enableZoom&&e.element.removeChild(e.elements.zoomerWrap),delete e.elements}function H(e,t){if(this.element=e,this.options=n(n({},H.defaults),t),c.call(this),this.options.url){var r={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,L.call(this,r)}}"function"!=typeof Promise&&!function(e){function t(e,t){return function(){e.apply(t,arguments)}}function n(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],a(e,t(i,this),t(s,this))}function r(e){var t=this;return null===this._state?void this._deferreds.push(e):void l(function(){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return void (t._state?e.resolve:e.reject)(t._value);var r;try{r=n(t._value)}catch(i){return void e.reject(i)}e.resolve(r)})}function i(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void a(t(n,e),t(i,this),t(s,this))}this._state=!0,this._value=e,o.call(this)}catch(r){s.call(this,r)}}function s(e){this._state=!1,this._value=e,o.call(this)}function o(){for(var e=0,t=this._deferreds.length;t>e;e++)r.call(this,this._deferreds[e]);this._deferreds=null}function u(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function a(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(i){if(r)return;r=!0,n(i)}}var f=setTimeout,l="function"==typeof setImmediate&&setImmediate||function(e){f(e,1)},c=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){var i=this;return new n(function(n,s){r.call(i,new u(e,t,n,s))})},n.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&c(arguments[0])?arguments[0]:arguments);return new n(function(t,n){function r(s,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var u=o.then;if("function"==typeof u)return void u.call(o,function(e){r(s,e)},n)}e[s]=o,0===--i&&t(e)}catch(a){n(a)}}if(0===e.length)return t([]);for(var i=e.length,s=0;s<e.length;s++)r(s,e[s])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(e){return new n(function(t,n){for(var r=0,i=e.length;i>r;r++)e[r].then(t,n)})},n._setImmediateFn=function(e){l=e},"undefined"!=typeof module&&module.exports?module.exports=n:e.Promise||(e.Promise=n)}(this);var B,j,F,I=["Webkit","Moz","ms"],q=document.createElement("div").style;j=t("transform"),B=t("transformOrigin"),F=t("userSelect");var R="translate3d",U=", 0px",z=function(e,t,n){this.x=parseFloat(e),this.y=parseFloat(t),this.scale=parseFloat(n)};z.parse=function(e){return e.style?z.parse(e.style[j]):e.indexOf("matrix")>-1||e.indexOf("none")>-1?z.fromMatrix(e):z.fromString(e)},z.fromMatrix=function(e){var t=e.substring(7).split(",");return t.length&&"none"!==e||(t=[1,0,0,1,0,0]),new z(parseInt(t[4],10),parseInt(t[5],10),parseFloat(t[0]))},z.fromString=function(e){var t=e.split(") "),n=t[0].substring(R.length+1).split(","),r=t.length>1?t[1].substring(6):1,i=n.length>1?n[0]:0,s=n.length>1?n[1]:0;return new z(i,s,r)},z.prototype.toString=function(){return R+"("+this.x+"px, "+this.y+"px"+U+") scale("+this.scale+")"};var W=function(e){if(!e||!e.style[B])return this.x=0,void (this.y=0);var t=e.style[B].split(" ");this.x=parseFloat(t[0]),this.y=parseFloat(t[1])};W.prototype.toString=function(){return this.x+"px "+this.y+"px"};var X=r(b,500),V={type:"canvas",format:"png",quality:1},$=["jpeg","webp","png"];if(window.jQuery){var J=window.jQuery;J.fn.croppie=function(e){var t=typeof e;if("string"===t){var n=Array.prototype.slice.call(arguments,1),r=J(this).data("croppie");return"get"===e?r.get():"result"===e?r.result.apply(r,n):this.each(function(){var t=J(this).data("croppie");if(t){var r=t[e];if(!J.isFunction(r))throw"Croppie "+e+" method not found";r.apply(t,n),"destroy"===e&&J(this).removeData("croppie")}})}return this.each(function(){var t=new H(this,e);J(this).data("croppie",t)})}}H.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},orientationControls:{enabled:!0,leftClass:"",rightClass:""},customClass:"",showZoomer:!0,enableZoom:!0,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,update:function(){}},n(H.prototype,{bind:function(e,t){return L.call(this,e,t)},get:function(){return O.call(this)},result:function(e){return M.call(this,e)},refresh:function(){return _.call(this)},setZoom:function(e){p.call(this,e),i(this.elements.zoomer)},rotate:function(e){D.call(this,e)},destroy:function(){return P.call(this)}}),e.Croppie=window.Croppie=H,"object"==typeof module&&module.exports&&(module.exports=H)}),define("views/imagecropper/imagecropperview",["jquery","underscore","backbone","text!templates/imagecropperview.html","croppie"],function(e,t,n,r,i){var s=n.View.extend({className:"image-cropper-view",events:{"click .rc-button.done":"_onDoneClick","click .rc-button-cancel":"_onCancelClick","click .rc-button.clear":"_onClearClick"},croppie:null,initialize:function(e){t.bindAll(this,"render","close","popup","_onDoneClick","_onClearClick"),this.options=e,this.template=t.template(r),console.assert(this.options.url&&this.options.url!==""),this.croppie=null},render:function(){this.$el.html(this.template()),this.$(".body").fadeIn();var e="square";return this.options.type&&(console.debug("type: "+this.options.type),e=this.options.type),console.log(this.options.isBanner),this.options.isBanner?(this.$(".body").addClass("banner"),this.croppie=this.$(".image-canvas").croppie({url:this.options.url,viewport:{width:640,height:70,type:e},boundary:{width:920,height:150}}),this.options.title&&(this.$(".title").show(),this.$(".title").text(this.options.title),this.$(".image-canvas").addClass("title-visible")),this.$(".rc-button.done").addClass("for-banner"),this.$(".rc-button-cancel.cancel").addClass("for-banner"),this.$(".rc-button-clear").addClass("for-banner")):this.croppie=this.$(".image-canvas").croppie({url:this.options.url,viewport:{width:200,height:200,type:e},boundary:{width:400,height:400}}),this.options.onClear&&this.$(".rc-button.clear").show(),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onDoneClick:function(){console.debug("_onDoneClick");var e=this;this.croppie.croppie("result",{type:"canvas",size:"viewport"}).then(function(t){e.options.onDone({src:t}),e.close()})},_onCancelClick:function(){this.close()},_onClearClick:function(){console.debug("_onClearClick"),this.options.onClear&&this.options.onClear(),this.close()},popup:function(){var t=this;e("body").append(this.render().el)}});return s}),define("views/profile/viewprofile",["jquery","underscore","backbone","text!templates/viewprofile.html","models/usermodel","rcdialog","velocity","views/callui/callhandler","views/imagecropper/imagecropperview"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({className:"viewprofile-view",events:{"click .call":"_onCallClicked","click .message":"_onMessageClicked","click .removefriend":"_onRemoveFriendClicked","click .addfriend":"_onAddFriendClicked","click .unblock":"_onUnblockClicked","click .rc-button.edit-profile":"_onEditProfileClicked","click .edit-avatar":"_onEditAvatarClicked","change .file-select-input":"_onFileSelectChanged","click .rc-button.save-profile":"_onSaveClicked","keyup .nickname-input":"_onNicknameKeyup","click .cancel":"_onCancelEditProfileClicked"},model:null,userDataLoaded:!1,editMode:!1,initialize:function(e){t.bindAll(this,"render","_onUserInfo","_onMessageClicked","_onCallClicked","_showLogin"),this.options=e,this.template=t.template(r),this.model=new i,this.editMode=!1,this.userDataLoaded=!1,this.comms=this.options.sharedObjects.comms,this.comms.getUser({user_id:this.options.user_id,server_cache:!1,success:this._onUserInfo}),this.callHandler=this.options.sharedObjects.callHandler},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.userDataLoaded&&(this.options.sharedObjects.comms.user_id===this.options.user_id?this.$(".button_containers.me").show():this.model.has("is_blocked")&&this.model.get("is_blocked")?this.$(".button_containers.blocked").show():this.model.has("friend")&&this.model.get("friend")?this.$(".button_containers.friend").show():this.$(".button_containers.non-friend").show()),this},popup:function(){var t=this;w2popup.open({width:720,height:460,body:'<div class="viewprofile"></div>',modal:!1,opacity:.9,showClose:!1,onOpen:function(n){n.onComplete=function(){e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e(".w2ui-popup .viewprofile").append(t.render().el),e("#w2ui-popup .close").on("click",function(e){w2popup.close()})}},onClose:function(e){console.debug("onClose")}})},_onUserInfo:function(e){console.debug("user info: "+JSON.stringify(e)),this.model.set(e),this.userDataLoaded=!0,this.render(),this.$(".infotext").show(),this.$(".infotext").velocity("fadeIn",{duration:500}),this.$(".loader").hide()},_onCallClicked:function(){if(this.callHandler.voiceConnection||this.callHandler.sessionId){console.info("_startCall: already have ongoing call");return}var e={chat_id:this.model.get("id"),adhoc:!0,create_session:!0,send_invite:!0};this.callHandler.makeCall(e),w2popup.close()},_onMessageClicked:function(){var e="activity/"+encodeURIComponent(this.model.get("id"));this.options.sharedObjects.router.navigate(e,{trigger:!0}),w2popup.close()},_onRemoveFriendClicked:function(){console.debug("_onDeleteContactClicked: "+JSON.stringify(this.model.toJSON()));var e=this,t='Are you sure you want to delete this user from your contacts : <br/> <span class="data">'+this.model.get("nickname")+"?</span>";s.yesNo(t,'<div class="dialogtitle">DELETE CONTACT</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(console.info("removing "+e.model.get("id")),e.options.sharedObjects.comms.Friends.remove({user_id:e.model.get("id")}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}),w2popup.close())},"DELETE","CANCEL","razericons-alerts")},_onAddFriendClicked:function(){this.options.sharedObjects.comms.Friends.add({user_id:this.model.get("id")}),this.$(".addfriend .add").removeClass("razericons-user_add").addClass("razericons-validate"),this.$(".addfriend").addClass("done")},_onUnblockClicked:function(){console.debug("_onUnblockClicked: "+this.model.get("id"));var e=this;this.comms.Friends.unblock({user_id:this.model.get("id"),success:function(t){console.debug("Unblock success");var n="activity/"+encodeURIComponent(e.model.get("id"));e.options.sharedObjects.router.navigate(n,{trigger:!0})}}),w2popup.close()},_onEditProfileClicked:function(){console.debug("_onEditProfileClicked");if(this.editMode){w2popup.close();return}this.$(".edit-profile").hide(),this.$(".cancel").show(),this.editMode=!0,this.$(".edit-avatar").show(),this.$(".nickname-input").val(this.model.get("nickname")),this.$(".nickname-input").show()},_onCancelEditProfileClicked:function(){console.debug("_onCancelEditProfileClicked"),this.$(".edit-profile").show(),this.$(".cancel").hide(),this.editMode=!1,this.$(".edit-avatar").hide(),this.$(".nickname-input").val(this.model.get("nickname")),this.$(".nickname-input").hide()},_onEditAvatarClicked:function(){console.debug("_onEditAvatarClicked"),this.$(".file-select-input").click()},_onFileSelectChanged:function(e){var t=this,n=this.$("input[type=file]")[0].files[0];this.$("input[type=file]").prop("value",null),console.debug("_onFileSelectChanged"),console.debug(n),this.options.origAvatar=this.$(".avatarcontainer img").attr("src");if(n){var r=new FileReader;r.addEventListener("load",function(e){var n=new a({url:e.target.result,type:"circle",onDone:function(e){console.debug("edit avatar done"),t.$(".avatarcontainer img").attr("src",e.src),t.$(".edit-avatar").hide(),t.$(".button_containers").hide(),t.$(".button_containers.save").show()}});n.popup()},!1),r.readAsDataURL(n)}},_onSaveClicked:function(){console.debug("_onSaveClicked");var t=this,n=this.$(".avatarcontainer img").attr("src"),r=this.options.origAvatar!==n,i=!1,s=localStorage.getItem("rt");if(!s||s===""){console.error("no refresh_token"),w2popup.close(),this._showLogin();return}console.debug("refresh_token: "+s);var o="";if(n.indexOf("data:image")==0){var u=n.split(",");u.length===2&&(o=u[1],console.debug("uploading new avatar: "+o.substring(0,100)+"..."),console.debug("nickname: "+this.model.get("nickname")))}var a=this.$(".nickname-input").val();a!==this.model.get("nickname")&&(i=!0);var f;console.debug("avatar_changed: "+r+" nickname_changed: "+i);if(!i&&!r){w2popup.close();return}e("body").addClass("rc-loading");var l={nickname:a,refresh_token:s,success:function(t){e("body").removeClass("rc-loading"),w2popup.close()},error:function(n){e("body").removeClass("rc-loading"),w2popup.close(),t._showLogin()}};r&&(l.avatar=o),this.comms.updateProfile(l)},_onNicknameKeyup:function(){this.$(".button_containers").hide(),this.$(".button_containers.save").show()},_showLogin:function(){this.options.sharedObjects.comms.close(),this.options.sharedObjects.commsCommunity.close(),window.localStorage.removeItem("comms_api_key"),window.localStorage.removeItem("comms_uuid"),this.options.sharedObjects.router.navigate("login",{trigger:!0})}});return f}),define("views/activity/friendrequest",["jquery","underscore","backbone","text!templates/friendrequest.html","models/friendrequestmodel","views/profile/viewprofile"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"li",className:"friend-request-view grid",events:{"click .avatar":"_showProfile","click .title":"_showProfile","click .text":"_showProfile","click .confirm":"_accept","click .delete":"_reject"},router:null,comms:null,initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),this.router=this.options.sharedObjects.router,this.comms=this.options.sharedObjects.comms,console.assert(typeof this.router!="undefined")},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_accept:function(){console.debug("_accept: "+this.model.get("user_id")),this.comms.Friends.accept({user_id:this.model.get("user_id")});var e="activity/"+encodeURIComponent(this.model.get("user_id"));this.router.navigate(e,{trigger:!0}),this.close()},_reject:function(){console.debug("_reject: "+this.model.get("user_id")),this.comms.Friends.reject({user_id:this.model.get("user_id")}),this.close()},_showProfile:function(){var e=t.extend({user_id:this.model.get("user_id")},this.options);viewProfileView=new s(e),viewProfileView.popup()},_showUserProfile:function(t,n){console.debug("showUserProfile: "+t),console.assert(t!=="");var r=this,i="http://comms-svcs.razersynapse.com/webui/view-profile2/profile?buddyid="+t;n&&n!==""&&(i+="&api_key="+encodeURIComponent(n));var s="PROFILE",o='            <div class="view-profile" style="width:500px; height:410px;">             </div>             ';w2popup.open({title:s,body:o,width:520,height:550,modal:!1,buttons:"",onOpen:function(r){r.onComplete=function(){var r='                        <div class="loading disable-select" style="position:absolute;top:0;width:100%;height:100%;">                             <div class="rc-loader-small" style="display:block;"></div>                         </div>                         ';e(".w2ui-popup .view-profile").append(r),e.ajax({type:"GET",url:"https://api.comms.razerzone.com/users/"+encodeURIComponent(t),headers:{Authorization:"Basic "+btoa(n+":"+"")},success:function(t){console.debug("GET /users/{userId} success:"),console.debug(t),typeof t.friend!="undefined"&&!t.friend?e(".w2ui-popup .w2ui-msg-buttons .add-friend-button").show():typeof t.friend=="undefined"?console.debug("API error, missing friend parameter"):console.debug("Already friends")},error:function(e){console.error("error: "),console.error(e)}});var s='<iframe frameborder="0" style="overflow:none;" id="user-profile" width="100%" height="0" src=""></iframe>';e(".w2ui-popup .view-profile").append(s),e(".w2ui-popup .view-profile iframe#user-profile").attr("src",i),e(".w2ui-popup .view-profile iframe#user-profile").load(function(){e(".w2ui-popup .view-profile .loading").hide(),e(".w2ui-popup .view-profile iframe#user-profile").attr("height","100%"),console.debug("iframe load finished"),e(".w2ui-msg-body").niceScroll({cursorborder:"",cursorcolor:"#404040"}),e(".w2ui-popup .w2ui-msg-buttons .add-friend-button").click(function(){w2popup.close()})})}}})}});return o}),define("models/communities/communitymodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r=t.Model.extend({defaults:{id:"",lobby_id:"",name:"",admins:[],icon:"",banner_type:"color",banner:"",banner_font_color:"",description:"",owner:"",created:"",searchable:!0,text_muted:!1,voice_muted:!1,channels:[],in_focus:!1,unread_mention:0,subscribed:!0,password:""},initialize:function(){this._setEmojiName(),this.on("change:name",this._setEmojiName),this.changeIcon(),this.on("change:icon",this.changeIcon)},_setEmojiName:function(){this.set("name_emoji",n.parse(this.escape("name")))},changeIcon:function(){if(this.get("icon")!==""){var e=this.get("icon"),t=e.replace("http://","https://");this.set("icon",t)}else this.set("icon","assets/images/DefCommntyIcon.svg")}});return r}),define("collections/communitycollection",["underscore","backbone","models/communities/communitymodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){if(e.get("last_announcement")&&e.get("last_announcement").unread_count>0)return-1;if(t.get("last_announcement")&&t.get("last_announcement").unread_count>0)return 1;var n=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();return n>r?1:n<r?-1:0}});return r}),define("views/activity/activityview",["jquery","underscore","backbone","text!templates/activityview.html","views/activity/activityitem","models/recentchatmodel","collections/recentchatcollection","views/activity/friendrequest","models/friendrequestmodel","collections/communitycollection"],function(e,t,n,r,i,s,o,u,a,f){var l=n.View.extend({tagName:"div",className:"activity-view",events:{},collection:null,comms:null,windowFocusModel:null,flashInterval:null,currentgridid:"",initialize:function(e){t.bindAll(this,"render","close","_onItemClick","_onRecentChats","_onRecentChatsSort","_onWindowFocusChange","_onCollectionChange","_flashTitle","_stopFlashing","_onFriendPresence","_onFriendList","_onRecentChatChange","_onFriendRequest","_onFriendRemoved","_reload","onCommunityCollectionSynced","checkforFlashingActivityTab","_onPubSubMessage","highlightCurrentGrid"),this.options=e,this.template=t.template(r),this.collection=new o,this.comms=this.options.sharedObjects.comms,this.options.sharedObjects.activityCollection=this.collection,this.comms.ChatHistory.on("recentChatSort",this._onRecentChatsSort),this.comms.ChatHistory.on("recentChatChange",this._onRecentChatChange),this.options.sharedObjects.windowFocusModel.on("change",this._onWindowFocusChange),this.collection.on("change",this._onCollectionChange),this.collection.on("add",this.checkforFlashingActivityTab),this.collection.on("remove",this.checkforFlashingActivityTab),this.windowFocusModel=this.options.sharedObjects.windowFocusModel,this.comms.on("friendPresence",this._onFriendPresence),this.comms.on("friendList",this._onFriendList),this.comms.on("friendRequest",this._onFriendRequest),this.comms.on("friendRemoved",this._onFriendRemoved),this.comms.on("groupRemoved",this._reload),this.comms.on("groupUpdate",this._reload),this.comms.ChatHistory.on("chatDeleted",this._reload),this.comms.Friends.on("friendBlocked",this._reload),this.comms.Friends.on("friendUnblocked",this._reload);if(this.options.sharedObjects.enable_cache){var n=this.comms.user_id+".activities",i=localStorage.getItem(n);if(i){var u=JSON.parse(i);if(u)for(var a=0;a<u.length;++a){var f=new s(u[a]);this.collection.add(f)}}}this.comms.ChatHistory.getChats({success:this._onRecentChats})},render:function(){this.$el.html(this.template());if(this.collection.length>0){this.$(".noactivity").hide();var e=this;this.collection.each(function(n){var r=t.extend({model:n,onItemClick:e._onItemClick},e.options),s=new i(r);e.$("ul").append(s.render().el)}),this.highlightCurrentGrid("")}else this.$(".noactivity").show();return this.$("ul").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this},close:function(){console.debug("close"),this.remove(),this.unbind(),this.comms.off(null,null,this),this.comms.ChatHistory.off(null,null,this),this.comms.Friends.off(null,null,this)},_onItemClick:function(){console.debug("_onItemClicked"),this.$("ul li.activity-item-view").removeClass("active"),this.$("ul li.announcement-item-view").removeClass("active")},_onRecentChats:function(e){console.debug("_onRecentChats"),console.debug(e);if(this.options.sharedObjects.enable_cache){var t=this.comms.user_id+".activities";localStorage.setItem(t,JSON.stringify(e.data))}this.collection.each(function(e){e.set("removed",!0)}),this.collection.reset();for(var n=0;n<e.data.length;++n){var r=new s(e.data[n]);if(this.options.sharedObjects.friendCollection){var i=this.options.sharedObjects.friendCollection.get(e.data[n].chat_id);i&&r.set("presence",i.get("presence"))}r.set("id",e.data[n].chat_id),this.collection.add(r)}this.render()},onCommunityCollectionSynced:function(e){var t=this;e.each(function(e){if(e.has("last_announcement")&&e.get("last_announcement").unread_count>0){var n={announcement:!0,name:e.get("name"),avatar:e.get("icon"),message:e.get("last_announcement").message,timestamp:e.get("last_announcement").timestamp/1e3,chat_id:e.get("id"),unread:e.get("last_announcement").unread_count},r=new s(n);t.collection.add(r)}}),this.render()},_onRecentChatsSort:function(){console.debug("_onRecentChatsSort"),this._onItemClick(),this.collection.sort(),this.render()},_onWindowFocusChange:function(e){e.get("in_focus")&&this.flashInterval&&(console.debug("window flashing"),this._stopFlashing())},_onCollectionChange:function(e){this.checkforFlashingActivityTab();if(e.get("unread")===0)return;var t=0;this.collection.each(function(e){e.get("unread")>0&&t++}),!this.windowFocusModel.get("in_focus")&&t>0&&this._flashTitle({count:t,name:e.get("name")})},checkforFlashingActivityTab:function(){var e=0;this.collection.each(function(t){t.get("unread")>0&&e++}),e>0?this.options.showCommsNotifications(e):(this.options.hideCommsNotifications(),this._stopFlashing())},_flashTitle:function(e){var t="("+e.count+") Comms",n=e.name;this.flashInterval&&clearInterval(this.flashInterval),document.title=n,this.flashInterval=setInterval(function(){document.title=document.title===t?n:t},1e3)},_stopFlashing:function(){clearInterval(this.flashInterval),this.flashInterval=null,document.title="Comms"},_onFriendPresence:function(e){var t=this.collection.get(e.user_id);t&&t.set("presence",e.presence)},_onFriendList:function(e){for(var t=0;t<e.length;++t){var n=this.collection.get(e[t].id);n&&n.set("presence",e[t].presence)}},_onRecentChatChange:function(e){console.debug("_onRecentChatChange");var t=this.collection.get(e.chat_id);t||this.comms.ChatHistory.getChats({success:this._onRecentChats})},_onFriendRequest:function(e){console.debug("_onFriendRequest: "+JSON.stringify(e));var n=t.extend({model:new a(e)},this.options),r=new u(n);this.$("ul").prepend(r.render().el)},_onFriendRemoved:function(e){console.debug("_onFriendRemoved: "+JSON.stringify(e));var t=this.collection.get(e.user_id);t&&(console.debug("model: "+JSON.stringify(t.toJSON())),t.set("removed",!0),this.collection.remove(e.user_id));var r=n.history.fragment,i=r.split("/");if(i.length===2){var s=decodeURIComponent(i[1]);s===e.user_id&&this.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0})}},_reload:function(e){console.debug("_reaload: "+JSON.stringify(e)),this.comms.ChatHistory.getChats({success:this._onRecentChats})},_onGroupUpdate:function(e){console.debug("_onGroupUpdate: "+JSON.stringify(e))},_onPubSubMessage:function(e){},highlightCurrentGrid:function(t){t!==""&&(this.currentgridid=t);var n=this;this.$("ul li.activity-item-view").removeClass("active"),this.currentgridid!==""&&this.$("ul li.activity-item-view").each(function(t,r){e(this).data("id")===n.currentgridid&&e(this).addClass("active")})}});return l}),define("text!templates/friendsview.html",[],function(){return'<div class="scroll">\n	<div class="maintitle">CONTACTS</div>\n	<ul class="contactlist"></ul>\n\n	<div class="maintitle block">BLOCKED</div>\n	<ul class="blocklist"></ul>\n\n		<div class="maintitle pending">INVITE PENDING</div>\n	<ul class="pendinginvites"></ul>\n</div>\n'}),define("text!templates/frienditem.html",[],function(){return'<img class="avatar round" src="<%- avatar %>">\n<div class="presence <%- presence %>" ></div>\n<div class="title"><%= nick_emoji %></div>\n<div class="razericons-favorites favorite"></div>\n<div class="unblock rc-button">UNBLOCK</div>\n<div class="cancel rc-button">CANCEL</div>\n'}),define("views/friends/frienditem",["jquery","underscore","backbone","text!templates/frienditem.html","views/profile/viewprofile"],function(e,t,n,r,i){var s=n.View.extend({tagName:"li",className:"friend-item-view grid",events:{click:"_onClick","click .unblock":"_onUnblockClicked","click .cancel":"_onCancelClicked"},router:null,initialize:function(e){t.bindAll(this,"close"),this.options=e,this.template=t.template(r),this.router=this.options.sharedObjects.router,console.assert(typeof this.model!="undefined"),this.comms=this.options.sharedObjects.comms,this.model.on("change",this.render,this),this.model.on("change:removed",this.close,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("is_favorite")?this.$(".favorite").show():this.$(".favorite").hide(),this.model.get("is_blocked")?(this.$(".unblock").show(),this.$(".favorite").hide(),this.$el.addClass("blocked")):(this.$(".unblock").hide(),this.$el.removeClass("blocked")),this.model.get("is_pending")?this.$el.addClass("pending"):this.$el.removeClass("pending"),this.$el.data("id",this.model.get("id")),this},close:function(){console.debug("close"),this.remove(),this.unbind(),this.model.off(null,null,this)},_onClick:function(){console.debug("_onClick: model: blocked---"+this.model.get("is_blocked"));if(this.model.has("cancelled")&&this.model.get("cancelled"))return;if(this.model.has("is_blocked")&&this.model.get("is_blocked")){console.info("user is blocked");var e=t.extend({user_id:this.model.get("id")},this.options);viewProfileView=new i(e),viewProfileView.popup();return}this.options.onItemClick(this),this.$el.addClass("active");var n="friends/"+encodeURIComponent(this.model.get("id"));this.router.navigate(n,{trigger:!0})},_onUnblockClicked:function(){console.debug("_onUnblockClicked: "+this.model.get("id")),this.model.set("is_blocked",!1);var e=this;this.comms.Friends.unblock({user_id:this.model.get("id"),success:function(e){console.debug("Unblock success")}}),w2popup.close()},_onCancelClicked:function(){console.debug("onCancelClicked"),this.comms.Friends.remove({user_id:this.model.get("id")}),this.model.set("cancelled",!0)}});return s}),define("models/friendmodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",i=t.Model.extend({defaults:{name:"",nick:"",avatar:"",presence:"",is_favorite:!1,is_blocked:!1,removed:!1},initialize:function(){this._setEmojiName(),this.on("change:nick",this._setEmojiName),this.changeAvatar(),this.on("change:avatar",this.changeAvatar)},_setEmojiName:function(){this.set("nick_emoji",n.parse(this.escape("nick")))},changeAvatar:function(){if(this.get("avatar")!==""&&this.get("avatar")!==r){var e=this.get("avatar").split("/"),t=e[e.length-1],n="https://dbq9ithrljsz0.cloudfront.net/"+t;this.set("avatar",n)}else this.set("avatar",r)}});return i}),define("collections/friendcollection",["underscore","backbone","models/friendmodel"],function(e,t,n){var r=t.Collection.extend({model:n,parse:function(e){return e.data},comparator:function(e,t){var n=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();if(e.get("is_favorite")!==t.get("is_favorite")){if(e.get("is_favorite"))return-1;if(t.get("is_favorite"))return 1}return e.get("presence")===t.get("presence")?n>r?1:n<r?-1:0:e.get("presence")==="online"?-1:t.get("presence")==="online"?1:e.get("presence")==="busy"?-1:t.get("presence")==="busy"?1:e.get("presence")==="dnd"?-1:t.get("presence")==="dnd"?1:e.get("presence")==="away"?-1:t.get("presence")==="away"?1:e.get("presence")==="offline"?-1:t.get("presence")==="offline"?1:n>r?1:n<r?-1:0}});return r}),!function(e){"function"==typeof require&&"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("velocity-ui",["velocity"],e):e()}(function(){return function(e,t,n,r){function i(e,t){var n=[];return e&&t?(o.each([e,t],function(e,t){var r=[];o.each(t,function(e,t){for(;t.toString().length<5;)t="0"+t;r.push(t)}),n.push(r.join(""))}),parseFloat(n[0])>parseFloat(n[1])):!1}if(!e.Velocity||!e.Velocity.Utilities)return void (t.console&&console.log("Velocity UI Pack: Velocity must be loaded first. Aborting."));var s=e.Velocity,o=s.Utilities,u=s.version,a={major:1,minor:1,patch:0};if(i(a,u)){var f="Velocity UI Pack: You need to update Velocity (jquery.velocity.js) to a newer version. Visit http://github.com/julianshapiro/velocity.";throw alert(f),new Error(f)}s.RegisterEffect=s.RegisterUI=function(e,t){function n(e,t,n,r){var i=0,u;o.each(e.nodeType?[e]:e,function(e,t){r&&(n+=e*r),u=t.parentNode,o.each(["height","paddingTop","paddingBottom","marginTop","marginBottom"],function(e,n){i+=parseFloat(s.CSS.getPropertyValue(t,n))})}),s.animate(u,{height:("In"===t?"+":"-")+"="+i},{queue:!1,easing:"ease-in-out",duration:n*("In"===t?.6:1)})}return s.Redirects[e]=function(i,u,a,f,l,c){function h(){u.display!==r&&"none"!==u.display||!/Out$/.test(e)||o.each(l.nodeType?[l]:l,function(e,t){s.CSS.setPropertyValue(t,"display","none")}),u.complete&&u.complete.call(l,l),c&&c.resolver(l||i)}var p=a===f-1;t.defaultDuration="function"==typeof t.defaultDuration?t.defaultDuration.call(l,l):parseFloat(t.defaultDuration);for(var d=0;d<t.calls.length;d++){var v=t.calls[d],m=v[0],g=u.duration||t.defaultDuration||1e3,y=v[1],b=v[2]||{},w={};if(w.duration=g*(y||1),w.queue=u.queue||"",w.easing=b.easing||"ease",w.delay=parseFloat(b.delay)||0,w._cacheValues=b._cacheValues||!0,0===d){if(w.delay+=parseFloat(u.delay)||0,0===a&&(w.begin=function(){u.begin&&u.begin.call(l,l);var t=e.match(/(In|Out)$/);t&&"In"===t[0]&&m.opacity!==r&&o.each(l.nodeType?[l]:l,function(e,t){s.CSS.setPropertyValue(t,"opacity",0)}),u.animateParentHeight&&t&&n(l,t[0],g+w.delay,u.stagger)}),null!==u.display)if(u.display!==r&&"none"!==u.display)w.display=u.display;else if(/In$/.test(e)){var E=s.CSS.Values.getDisplayType(i);w.display="inline"===E?"inline-block":E}u.visibility&&"hidden"!==u.visibility&&(w.visibility=u.visibility)}d===t.calls.length-1&&(w.complete=function(){if(t.reset){for(var e in t.reset){var n=t.reset[e];s.CSS.Hooks.registered[e]!==r||"string"!=typeof n&&"number"!=typeof n||(t.reset[e]=[t.reset[e],t.reset[e]])}var o={duration:0,queue:!1};p&&(o.complete=h),s.animate(i,t.reset,o)}else p&&h()},"hidden"===u.visibility&&(w.visibility=u.visibility)),s.animate(i,m,w)}},s},s.RegisterEffect.packagedEffects={"callout.bounce":{defaultDuration:550,calls:[[{translateY:-30},.25],[{translateY:0},.125],[{translateY:-15},.125],[{translateY:0},.25]]},"callout.shake":{defaultDuration:800,calls:[[{translateX:-11},.125],[{translateX:11},.125],[{translateX:-11},.125],[{translateX:11},.125],[{translateX:-11},.125],[{translateX:11},.125],[{translateX:-11},.125],[{translateX:0},.125]]},"callout.flash":{defaultDuration:1100,calls:[[{opacity:[0,"easeInOutQuad",1]},.25],[{opacity:[1,"easeInOutQuad"]},.25],[{opacity:[0,"easeInOutQuad"]},.25],[{opacity:[1,"easeInOutQuad"]},.25]]},"callout.pulse":{defaultDuration:825,calls:[[{scaleX:1.1,scaleY:1.1},.5,{easing:"easeInExpo"}],[{scaleX:1,scaleY:1},.5]]},"callout.swing":{defaultDuration:950,calls:[[{rotateZ:15},.2],[{rotateZ:-10},.2],[{rotateZ:5},.2],[{rotateZ:-5},.2],[{rotateZ:0},.2]]},"callout.tada":{defaultDuration:1e3,calls:[[{scaleX:.9,scaleY:.9,rotateZ:-3},.1],[{scaleX:1.1,scaleY:1.1,rotateZ:3},.1],[{scaleX:1.1,scaleY:1.1,rotateZ:-3},.1],["reverse",.125],["reverse",.125],["reverse",.125],["reverse",.125],["reverse",.125],[{scaleX:1,scaleY:1,rotateZ:0},.2]]},"transition.fadeIn":{defaultDuration:500,calls:[[{opacity:[1,0]}]]},"transition.fadeOut":{defaultDuration:500,calls:[[{opacity:[0,1]}]]},"transition.flipXIn":{defaultDuration:700,calls:[[{opacity:[1,0],transformPerspective:[800,800],rotateY:[0,-55]}]],reset:{transformPerspective:0}},"transition.flipXOut":{defaultDuration:700,calls:[[{opacity:[0,1],transformPerspective:[800,800],rotateY:55}]],reset:{transformPerspective:0,rotateY:0}},"transition.flipYIn":{defaultDuration:800,calls:[[{opacity:[1,0],transformPerspective:[800,800],rotateX:[0,-45]}]],reset:{transformPerspective:0}},"transition.flipYOut":{defaultDuration:800,calls:[[{opacity:[0,1],transformPerspective:[800,800],rotateX:25}]],reset:{transformPerspective:0,rotateX:0}},"transition.flipBounceXIn":{defaultDuration:900,calls:[[{opacity:[.725,0],transformPerspective:[400,400],rotateY:[-10,90]},.5],[{opacity:.8,rotateY:10},.25],[{opacity:1,rotateY:0},.25]],reset:{transformPerspective:0}},"transition.flipBounceXOut":{defaultDuration:800,calls:[[{opacity:[.9,1],transformPerspective:[400,400],rotateY:-10},.5],[{opacity:0,rotateY:90},.5]],reset:{transformPerspective:0,rotateY:0}},"transition.flipBounceYIn":{defaultDuration:850,calls:[[{opacity:[.725,0],transformPerspective:[400,400],rotateX:[-10,90]},.5],[{opacity:.8,rotateX:10},.25],[{opacity:1,rotateX:0},.25]],reset:{transformPerspective:0}},"transition.flipBounceYOut":{defaultDuration:800,calls:[[{opacity:[.9,1],transformPerspective:[400,400],rotateX:-15},.5],[{opacity:0,rotateX:90},.5]],reset:{transformPerspective:0,rotateX:0}},"transition.swoopIn":{defaultDuration:850,calls:[[{opacity:[1,0],transformOriginX:["100%","50%"],transformOriginY:["100%","100%"],scaleX:[1,0],scaleY:[1,0],translateX:[0,-700],translateZ:0}]],reset:{transformOriginX:"50%",transformOriginY:"50%"}},"transition.swoopOut":{defaultDuration:850,calls:[[{opacity:[0,1],transformOriginX:["50%","100%"],transformOriginY:["100%","100%"],scaleX:0,scaleY:0,translateX:-700,translateZ:0}]],reset:{transformOriginX:"50%",transformOriginY:"50%",scaleX:1,scaleY:1,translateX:0}},"transition.whirlIn":{defaultDuration:850,calls:[[{opacity:[1,0],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:[1,0],scaleY:[1,0],rotateY:[0,160]},1,{easing:"easeInOutSine"}]]},"transition.whirlOut":{defaultDuration:750,calls:[[{opacity:[0,"easeInOutQuint",1],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:0,scaleY:0,rotateY:160},1,{easing:"swing"}]],reset:{scaleX:1,scaleY:1,rotateY:0}},"transition.shrinkIn":{defaultDuration:750,calls:[[{opacity:[1,0],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:[1,1.5],scaleY:[1,1.5],translateZ:0}]]},"transition.shrinkOut":{defaultDuration:600,calls:[[{opacity:[0,1],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:1.3,scaleY:1.3,translateZ:0}]],reset:{scaleX:1,scaleY:1}},"transition.expandIn":{defaultDuration:700,calls:[[{opacity:[1,0],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:[1,.625],scaleY:[1,.625],translateZ:0}]]},"transition.expandOut":{defaultDuration:700,calls:[[{opacity:[0,1],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:.5,scaleY:.5,translateZ:0}]],reset:{scaleX:1,scaleY:1}},"transition.bounceIn":{defaultDuration:800,calls:[[{opacity:[1,0],scaleX:[1.05,.3],scaleY:[1.05,.3]},.4],[{scaleX:.9,scaleY:.9,translateZ:0},.2],[{scaleX:1,scaleY:1},.5]]},"transition.bounceOut":{defaultDuration:800,calls:[[{scaleX:.95,scaleY:.95},.35],[{scaleX:1.1,scaleY:1.1,translateZ:0},.35],[{opacity:[0,1],scaleX:.3,scaleY:.3},.3]],reset:{scaleX:1,scaleY:1}},"transition.bounceUpIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateY:[-30,1e3]},.6,{easing:"easeOutCirc"}],[{translateY:10},.2],[{translateY:0},.2]]},"transition.bounceUpOut":{defaultDuration:1e3,calls:[[{translateY:20},.2],[{opacity:[0,"easeInCirc",1],translateY:-1e3},.8]],reset:{translateY:0}},"transition.bounceDownIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateY:[30,-1e3]},.6,{easing:"easeOutCirc"}],[{translateY:-10},.2],[{translateY:0},.2]]},"transition.bounceDownOut":{defaultDuration:1e3,calls:[[{translateY:-20},.2],[{opacity:[0,"easeInCirc",1],translateY:1e3},.8]],reset:{translateY:0}},"transition.bounceLeftIn":{defaultDuration:750,calls:[[{opacity:[1,0],translateX:[30,-1250]},.6,{easing:"easeOutCirc"}],[{translateX:-10},.2],[{translateX:0},.2]]},"transition.bounceLeftOut":{defaultDuration:750,calls:[[{translateX:30},.2],[{opacity:[0,"easeInCirc",1],translateX:-1250},.8]],reset:{translateX:0}},"transition.bounceRightIn":{defaultDuration:750,calls:[[{opacity:[1,0],translateX:[-30,1250]},.6,{easing:"easeOutCirc"}],[{translateX:10},.2],[{translateX:0},.2]]},"transition.bounceRightOut":{defaultDuration:750,calls:[[{translateX:-30},.2],[{opacity:[0,"easeInCirc",1],translateX:1250},.8]],reset:{translateX:0}},"transition.slideUpIn":{defaultDuration:900,calls:[[{opacity:[1,0],translateY:[0,20],translateZ:0}]]},"transition.slideUpOut":{defaultDuration:900,calls:[[{opacity:[0,1],translateY:-20,translateZ:0}]],reset:{translateY:0}},"transition.slideDownIn":{defaultDuration:900,calls:[[{opacity:[1,0],translateY:[0,-20],translateZ:0}]]},"transition.slideDownOut":{defaultDuration:900,calls:[[{opacity:[0,1],translateY:20,translateZ:0}]],reset:{translateY:0}},"transition.slideLeftIn":{defaultDuration:1e3,calls:[[{opacity:[1,0],translateX:[0,-20],translateZ:0}]]},"transition.slideLeftOut":{defaultDuration:1050,calls:[[{opacity:[0,1],translateX:-20,translateZ:0}]],reset:{translateX:0}},"transition.slideRightIn":{defaultDuration:1e3,calls:[[{opacity:[1,0],translateX:[0,20],translateZ:0}]]},"transition.slideRightOut":{defaultDuration:1050,calls:[[{opacity:[0,1],translateX:20,translateZ:0}]],reset:{translateX:0}},"transition.slideUpBigIn":{defaultDuration:850,calls:[[{opacity:[1,0],translateY:[0,75],translateZ:0}]]},"transition.slideUpBigOut":{defaultDuration:800,calls:[[{opacity:[0,1],translateY:-75,translateZ:0}]],reset:{translateY:0}},"transition.slideDownBigIn":{defaultDuration:850,calls:[[{opacity:[1,0],translateY:[0,-75],translateZ:0}]]},"transition.slideDownBigOut":{defaultDuration:800,calls:[[{opacity:[0,1],translateY:75,translateZ:0}]],reset:{translateY:0}},"transition.slideLeftBigIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateX:[0,-75],translateZ:0}]]},"transition.slideLeftBigOut":{defaultDuration:750,calls:[[{opacity:[0,1],translateX:-75,translateZ:0}]],reset:{translateX:0}},"transition.slideRightBigIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateX:[0,75],translateZ:0}]]},"transition.slideRightBigOut":{defaultDuration:750,calls:[[{opacity:[0,1],translateX:75,translateZ:0}]],reset:{translateX:0}},"transition.perspectiveUpIn":{defaultDuration:800,calls:[[{opacity:[1,0],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:["100%","100%"],rotateX:[0,-180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveUpOut":{defaultDuration:850,calls:[[{opacity:[0,1],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:["100%","100%"],rotateX:-180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateX:0}},"transition.perspectiveDownIn":{defaultDuration:800,calls:[[{opacity:[1,0],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:[0,0],rotateX:[0,180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveDownOut":{defaultDuration:850,calls:[[{opacity:[0,1],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:[0,0],rotateX:180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateX:0}},"transition.perspectiveLeftIn":{defaultDuration:950,calls:[[{opacity:[1,0],transformPerspective:[2e3,2e3],transformOriginX:[0,0],transformOriginY:[0,0],rotateY:[0,-180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveLeftOut":{defaultDuration:950,calls:[[{opacity:[0,1],transformPerspective:[2e3,2e3],transformOriginX:[0,0],transformOriginY:[0,0],rotateY:-180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateY:0}},"transition.perspectiveRightIn":{defaultDuration:950,calls:[[{opacity:[1,0],transformPerspective:[2e3,2e3],transformOriginX:["100%","100%"],transformOriginY:[0,0],rotateY:[0,180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveRightOut":{defaultDuration:950,calls:[[{opacity:[0,1],transformPerspective:[2e3,2e3],transformOriginX:["100%","100%"],transformOriginY:[0,0],rotateY:180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateY:0}}};for(var l in s.RegisterEffect.packagedEffects)s.RegisterEffect(l,s.RegisterEffect.packagedEffects[l]);s.RunSequence=function(e){var t=o.extend(!0,[],e);t.length>1&&(o.each(t.reverse(),function(e,n){var r=t[e+1];if(r){var i=n.o||n.options,u=r.o||r.options,a=i&&i.sequenceQueue===!1?"begin":"complete",f=u&&u[a],l={};l[a]=function(){var e=r.e||r.elements,t=e.nodeType?[e]:e;f&&f.call(t,t),s(n)},r.o?r.o=o.extend({},u,l):r.options=o.extend({},u,l)}}),t.reverse()),s(t[0])}}(window.jQuery||window.Zepto||window,window,document)}),define("views/friends/friendsview",["jquery","underscore","backbone","text!templates/friendsview.html","views/friends/frienditem","collections/friendcollection","models/friendmodel","velocity-ui"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"div",className:"friends-view",events:{},collection:null,blockCollection:null,comms:null,sorted:!1,currentgridid:"",fetched:!1,initialize:function(e){t.bindAll(this,"render","close","_onItemClick","_onFriendList","onFriendPresence","_reload","_onBlockList"),this.options=e,this.template=t.template(r),this.collection=new s,this.blockCollection=new s,this.pendingCollection=new s,this.comms=this.options.sharedObjects.comms,this.comms.Friends.get({success:this._onFriendList}),this.options.sharedObjects.friendCollection=this.collection,this.comms.on("friendPresence",this.onFriendPresence),this.comms.on("friendRemoved",this._reload),this.comms.Friends.on("friendBlocked",this._reload),this.comms.Friends.on("friendUnblocked",this._reload),this.comms.on("reloadFriends",this._reload),this.fetched=!1;if(this.options.sharedObjects.enable_cache){var n=this.comms.user_id+".friends",i=localStorage.getItem(n);if(i){var u=JSON.parse(i);if(u)for(var a=0;a<u.length;++a){var f=new o(u[a]);f.get("is_pending")===!0?(f.set("presence","offline"),this.pendingCollection.add(f)):f.get("is_blocked")?(f.set("presence","offline"),this.blockCollection.add(f)):this.collection.add(f)}}}this.comms.Friends.getBlocklist({success:this._onBlockList})},render:function(){this.$el.html(this.template()),console.debug("render: collection.length: "+this.collection.length);var e=this;return this.collection.length>0&&(this.collection.sort(),this.collection.each(function(n){var r=t.extend({model:n,onItemClick:e._onItemClick},e.options),s=new i(r);e.$("ul.contactlist").append(s.render().el),s.$el.data("id",n.get("id"))})),this.renderBlockList(),this.renderPendingList(),this.$(".scroll").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this},close:function(){console.debug("close"),this.comms.off(null,null,this),this.comms.Friends.off(null,null,this),this.remove(),this.unbind()},_onItemClick:function(){console.debug("_onItemClick"),this.$("ul li.friend-item-view").removeClass("active")},_onFriendList:function(e){if(this.options.sharedObjects.enable_cache){var t=this.comms.user_id+".friends";localStorage.setItem(t,JSON.stringify(e.data)),console.debug("saving to localStorage: "+t)}this.collection.reset(),this.pendingCollection.reset(),this.blockCollection.reset();for(var n=0;n<e.data.length;++n){var r=new o(e.data[n]);r.get("is_pending")===!0?(r.set("presence","offline"),this.pendingCollection.add(r)):r.get("is_blocked")?(r.set("presence","offline"),this.blockCollection.add(r)):this.collection.add(r)}this.render(),this.fetched=!0,this.options.checkOnboard&&this.options.checkOnboard()},onFriendPresence:function(e){var t=e.user_id;if(e.presence==="invisible")var n="offline";else var n=e.presence;if(this.collection.length>0){var r=this.collection.get(t);r?(r.set("presence",n),this.sorted===!1&&this.sortFriends()):console.warn("onFriendPresence: friend not found: "+JSON.stringify(e))}},sortFriends:function(){this.sorted=!0;var t=this;setTimeout(function(){t.sorted=!1},3e3);var n=e(".friends-view ul.contactlist"),r=n.children("li");r.detach().sort(function(n,r){var i=e(n).find(".title").text().toLowerCase(),s=e(r).find(".title").text().toLowerCase(),o=t.collection.get(e(n).data("id")),u=t.collection.get(e(r).data("id"));if(o&&u&&o.get("is_favorite")!==u.get("is_favorite")){if(o.get("is_favorite"))return-1;if(u.get("is_favorite"))return 1}var a=e(n).find(".presence")[0].className.replace("presence","").toLowerCase().trim(),f=e(r).find(".presence")[0].className.replace("presence","").toLowerCase().trim();return a===f?i<s?-1:i>s?1:0:a==="online"?-1:f==="online"?1:a==="busy"?-1:f==="busy"?1:a==="dnd"?-1:f==="dnd"?1:a==="away"?-1:f==="away"?1:a==="offline"?-1:f==="offline"?1:i<s?-1:i>s?1:0}),n.empty(),n.append(r)},_reload:function(){console.info("_reload"),this.comms.Friends.get({success:this._onFriendList})},highlightCurrentGrid:function(t){t!==""&&(this.currentgridid=t);var n=this;this.$("ul.contactlist li.friend-item-view").removeClass("active"),this.currentgridid!==""&&this.$("ul.contactlist li.friend-item-view").each(function(t,r){e(this).data("id")===n.currentgridid&&e(this).addClass("active")})},_onBlockList:function(e){this.blockCollection.reset();for(var t=0;t<e.data.length;++t){var n=new o(e.data[t]);n.set("is_blocked",!0),n.set("presence","offline"),n.set("nick",n.get("nickname")),this.blockCollection.add(n)}this.renderBlockList()},renderBlockList:function(){var e=this;this.blockCollection.length>0?(this.$(".maintitle.block").show(),this.blockCollection.each(function(t){var n={model:t,onItemClick:e._onItemClick,sharedObjects:e.options.sharedObjects},r=new i(n);e.$("ul.blocklist").append(r.render().el),r.$el.data("id",t.get("id"))})):this.$(".maintitle.block").hide()},renderPendingList:function(){var e=this;this.pendingCollection.length>0?(this.$(".maintitle.pending").show(),this.pendingCollection.each(function(t){console.debug(t.toJSON());var n={model:t,onItemClick:e._onItemClick,sharedObjects:e.options.sharedObjects},r=new i(n);e.$("ul.pendinginvites").append(r.render().el),r.$el.data("id",t.get("id"))})):this.$(".maintitle.pending").hide()}});return a}),define("text!templates/groupsview.html",[],function(){return"<ul>\n</ul>\n\n"}),define("models/groupmodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r=t.Model.extend({defaults:{icon:"",name:"",members:"",owner_name:"",owner:"",timestamp:0},idAttribute:"lobby_id",initialize:function(){this._setEmojiName(),this.on("change:name",this._setEmojiName),this.changeIcon(),this.on("change:icon",this.changeIcon)},_setEmojiName:function(){this.set("name_emoji",n.parse(this.escape("name")))},changeIcon:function(){if(this.get("icon")!==""){var e=this.get("icon"),t=e.replace("http://","https://");this.set("icon",t)}else this.set("icon","assets/images/Grp_def.svg")}});return r}),define("collections/groupcollection",["underscore","backbone","models/groupmodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){var n=function(e,t){var n=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();return n>r?1:n<r?-1:0};if(e.has("timestamp")&&t.has("timestamp")){var r=e.get("timestamp"),i=t.get("timestamp");return r===i?n(e,t):r>i?-1:r<i?1:0}return n(e,t)}});return r}),define("text!templates/groupitem.html",[],function(){return'<div class="bullet round"></div>\n<div class="navtitle textwrap"><%= name_emoji %></div>\n<img src="<%- icon %>" class="icon">\n<img src="<%- icon %>" class="icon_small">\n'}),define("views/groups/groupitem",["jquery","underscore","backbone","text!templates/groupitem.html"],function(e,t,n,r){var i=n.View.extend({tagName:"li",className:"group-item-view gridnavigation",events:{click:"_onClick"},router:null,initialize:function(e){t.bindAll(this,"close"),this.options=e,this.template=t.template(r),this.router=this.options.sharedObjects.router,console.assert(typeof this.model!="undefined")},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.data("id",this.model.get("lobby_id")),this._addTooltip(this.$(".icon"),this.model.get("name_emoji")),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onClick:function(){this.options.onItemClick(this),console.debug("_onClick"),this.$el.addClass("active"),console.debug("_onClick: model: "),console.debug(this.model.toJSON());if(this.model.get("lobby_id")!==""){var e="groups/"+encodeURIComponent(this.model.get("lobby_id"));this.router.navigate(e,{trigger:!0})}else console.warn(this.model.get("name")+" Does not have lobby_id")},_addTooltip:function(t,n){var r=this;t.hover(function(){e(".tooltiprazer").remove(),n!=""&&e('<p class="tooltiprazer"></p>').html(n).appendTo("body").fadeIn("slow")},function(){e(".tooltiprazer").remove()}).mousemove(function(n){var r=n.pageX+20,i=n.pageY,s=t.offset().top+4;e(".tooltiprazer").css({top:s,left:"88px"})})}});return i}),define("views/groups/groupsview",["jquery","underscore","backbone","text!templates/groupsview.html","collections/groupcollection","models/groupmodel","views/groups/groupitem"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"groups-view",events:{},collection:null,comms:null,fetched:!1,initialize:function(e){t.bindAll(this,"close","_onGroupList","_onItemClick","_onGroupInvite","_reload"),this.options=e,this.template=t.template(r),this.collection=new i,this.comms=this.options.sharedObjects.comms,this.comms.Groups.get({success:this._onGroupList}),this.comms.on("groupInvite",this._onGroupInvite,this),this.comms.on("groupRemoved",this._reload,this),this.comms.on("groupUpdate",this._reload,this),this.fetched=!1;var n=this;this.comms.on("groupCreated",function(e){console.debug("groupCreated: "+JSON.stringify(e)),e.message.type!=="AdHoc"&&n._reload()},this),this.options.sharedObjects.groupCollection=this.collection;if(this.options.sharedObjects.enable_cache){var o=this.comms.user_id+".groups",u=localStorage.getItem(o);if(u){var a=JSON.parse(u);if(a)for(var f=0;f<a.length;++f){var l=new s(a[f]);this.collection.add(l)}}}},render:function(){this.$el.html(this.template());var e=this,n=0;return this.collection.each(function(r){if(n<5){var i=t.extend({model:r,onItemClick:e._onItemClick},e.options),s=new o(i);e.$("ul").append(s.render().el),n++}}),this},close:function(){console.debug("close"),this.comms.off(null,null,this),this.comms.Groups.off(null,null,this),this.remove(),this.unbind()},_onItemClick:function(){console.debug("_onItemClick"),this.$("ul li.group-item-view").removeClass("active")},_onGroupList:function(e){console.debug("_onGroupList: length: "+e.data.length);if(this.options.sharedObjects.enable_cache){var t=this.comms.user_id+".groups";localStorage.setItem(t,JSON.stringify(e.data)),console.debug("saving to localStorage: "+t)}this.collection.reset();for(var n=0;n<e.data.length;++n){var r=new s(e.data[n]);this.collection.add(r)}this.render(),this.fetched=!0,this.options.checkOnboard&&this.options.checkOnboard()},_onGroupInvite:function(e){console.debug("_onGroupInvite: "+JSON.stringify(e));var t=this;this.comms.Groups.join({id:e.group_id,success:function(){console.debug("joinGroupSuccess"),t.comms.Groups.get({success:t._onGroupList})}})},_reload:function(e){console.debug("_reload: "+JSON.stringify(e)),this.comms.Groups.get({success:this._onGroupList})}});return u}),define("text!templates/search.html",[],function(){return'<div class="razericons-search"></div>\n<input type="text" placeholder="FIND COMMS USERS">\n<div class="clear razericons-player_cancel"></div>\n'}),define("text!templates/searchresults.html",[],function(){return'<div class="section-label friends">FRIENDS</div>\n<ul class="friends"></ul>\n<div class="section-label groups">GROUPS</div>\n<ul class="groups"></ul>\n<div class="section-label more">MORE PEOPLE</div>\n<ul class="more"></ul>\n\n<div class="searching">\n    <img src="assets/images/loader_wg.svg">\n    <span>Searching ...</span>\n</div>\n'}),define("text!templates/resultitem.html",[],function(){return'<div class="presence <%- presence %>" ></div>\n<img class="avatar round" src="<%- avatar %>">\n<div class="title textwrap"><%= title_emoji %></div>\n<img class="favorite" src="assets/images/favorite-icon.png">\n\n'}),define("views/search/resultitem",["jquery","underscore","backbone","text!templates/resultitem.html","w2ui","views/profile/viewprofile"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"result-item-view grid",events:{click:"_onClick"},initialize:function(e){t.bindAll(this,"render","close","_showUserProfile","_addFriend"),this.options=e,this.template=t.template(r)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("is_group")&&this.$(".avatar").addClass("group"),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onClick:function(){console.debug("_onClick: model: "+JSON.stringify(this.model.toJSON())),this.options.onItemClick(this),this.$el.addClass("active");if(this.model.get("is_group")){var e="activity/"+encodeURIComponent(this.model.get("chat_id"));this.options.sharedObjects.router.navigate(e,{trigger:!0})}else if(this.model.get("is_blocked")){var n=t.extend({user_id:this.model.get("chat_id")},this.options);viewProfileView=new s(n),viewProfileView.popup()}else if(this.model.get("is_friend")){var e="activity/"+encodeURIComponent(this.model.get("chat_id"));this.options.sharedObjects.router.navigate(e,{trigger:!0})}else{var n=t.extend({user_id:this.model.get("chat_id"),friend:this.model.get("is_friend")},this.options);viewProfileView=new s(n),viewProfileView.popup()}},_showUserProfile:function(t,n){console.debug("showUserProfile: "+t),console.assert(t!=="");var r=this,i="http://comms-svcs.razersynapse.com/webui/view-profile2/profile?buddyid="+t;n&&n!==""&&(i+="&api_key="+encodeURIComponent(n));var s="PROFILE",o='            <div class="view-profile" style="width:500px; height:410px;">             </div>             ',u='<div class="rc-box-center"><div class="add-friend-button rc-button" style="display:none;">ADD TO FRIENDS</div></div>';w2popup.open({title:s,body:o,width:520,height:550,modal:!1,buttons:u,onOpen:function(s){s.onComplete=function(){var s='                        <div class="loading disable-select" style="position:absolute;top:0;width:100%;height:100%;">                             <div class="rc-loader-small" style="display:block;"></div>                         </div>                         ';e(".w2ui-popup .view-profile").append(s),e.ajax({type:"GET",url:"https://api.comms.razerzone.com/users/"+encodeURIComponent(t),headers:{Authorization:"Basic "+btoa(n+":"+"")},success:function(t){console.debug("GET /users/{userId} success:"),console.debug(t),typeof t.friend!="undefined"&&!t.friend?e(".w2ui-popup .w2ui-msg-buttons .add-friend-button").show():typeof t.friend=="undefined"?console.debug("API error, missing friend parameter"):console.debug("Already friends")},error:function(e){console.error("error: "),console.error(e)}});var o='<iframe frameborder="0" style="overflow:none;" id="user-profile" width="100%" height="0" src=""></iframe>';e(".w2ui-popup .view-profile").append(o),e(".w2ui-popup .view-profile iframe#user-profile").attr("src",i),e(".w2ui-popup .view-profile iframe#user-profile").load(function(){e(".w2ui-popup .view-profile .loading").hide(),e(".w2ui-popup .view-profile iframe#user-profile").attr("height","100%"),console.debug("iframe load finished"),e(".w2ui-msg-body").niceScroll({cursorborder:"",cursorcolor:"#404040"}),e(".w2ui-popup .w2ui-msg-buttons .add-friend-button").click(function(){r._addFriend(t),w2popup.close()})})}}})},_addFriend:function(e){console.debug("_addFriend: user_id: "+e),this.options.sharedObjects.comms.Friends.add({user_id:e})}});return o}),define("models/searchresultmodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",i=t.Model.extend({defaults:{chat_id:"",title:"",title_emoji:"",avatar:"",presence:"",is_favorite:!1,is_friend:!1,is_group:!1,is_adhoc:!1,is_blocked:!1},idAttribute:"chat_id",initialize:function(){this._setEmojiTitle(),this.on("change:title",this._setEmojiTitle),this.get("is_group")&&this.get("avatar")===""&&this.set("avatar","assets/images/Grp_def.svg"),this.changeAvatar()},_setEmojiTitle:function(){this.set("title_emoji",n.parse(this.escape("title")))},changeAvatar:function(){if(this.get("avatar")!==""){var e=this.get("avatar");if(this.get("is_group"))var t=e.replace("http://","https://");else if(e!==r)var n=e.split("/"),i=n[n.length-1],t="https://s3.amazonaws.com/rzravatar/"+i;else t=e;this.set("avatar",t)}else this.get("is_group")?this.set("avatar","assets/images/Grp_def.svg"):this.set("avatar",r)}});return i}),define("views/search/searchresults",["jquery","underscore","backbone","text!templates/searchresults.html","views/search/resultitem","models/searchresultmodel","nicescroll"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"search-results-view",events:{},friendCollection:null,groupCollection:null,moreCollection:null,closed:!1,query:"",initialize:function(e){t.bindAll(this,"render","close","_onItemClick"),t.bindAll(this,"showSearching","hideSearching"),this.options=e,this.template=t.template(r),console.debug(this.options),this.friendCollection=null,this.groupCollection=null,this.moreCollection=null,this.closed=!1,this.query=""},render:function(){this.$el.html(this.template());var e=this;return this.friendCollection&&(this.friendCollection.each(function(t){var n=new i({model:t,sharedObjects:e.options.sharedObjects,onItemClick:e._onItemClick});e.$("ul.friends").append(n.render().el)}),this.friendCollection.length>0&&this.$(".section-label.friends").show()),this.groupCollection&&(this.groupCollection.each(function(t){var n=new i({model:t,sharedObjects:e.options.sharedObjects,onItemClick:e._onItemClick});e.$("ul.groups").append(n.render().el)}),this.groupCollection.length>0&&this.$(".section-label.groups").show()),this.moreCollection&&(this.moreCollection.each(function(t){var n=new i({model:t,sharedObjects:e.options.sharedObjects,onItemClick:e._onItemClick});e.$("ul.more").append(n.render().el)}),this.moreCollection.length>0&&this.$(".section-label.more").show()),setTimeout(function(){e.closed||e.$el.niceScroll(t.extend({},e.options.sharedObjects.niceScrollOptions))},100),this},close:function(){console.debug("close"),this.remove(),this.unbind(),this.closed=!0},showSearching:function(){this.$(".searching").show()},hideSearching:function(){this.$(".searching").hide()},_onItemClick:function(){console.debug("_onItemClick"),this.$(".result-item-view").removeClass("active")}});return u}),define("views/search/searchview",["jquery","underscore","backbone","text!templates/search.html","views/search/searchresults","models/searchresultmodel"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"search-view",events:{"keyup input":"_onInputKeypress","click .clear":"_onClearClicked","focus input":"_onInputFocus","focusout input":"_onInputFocusOut"},searchResults:null,initialize:function(e){t.bindAll(this,"render","close","_clearResults","_search","clear"),this.options=e,this.template=t.template(r),console.assert(typeof this.options.parentView!="undefined"),this.options.sharedObjects.comms.Friends.on("friendUnblocked",this._clearResults),this.options.sharedObjects.comms.Friends.on("friendBlocked",this._clearResults)},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.remove(),this.unbind(),this.options.sharedObjects.comms.Friends.off(null,null,this)},clear:function(){this.$("input").val(""),this.$(".clear").hide(),this.searchResults&&(this.searchResults.close(),this.searchResults=null)},_onInputKeypress:function(t){var n=this.$("input").val();if(n===""){this._clearResults();return}this.$(".clear").show(),e(".recent").text("SEARCH RESULTS"),n.length>=2&&(this.searchResults||(this.searchResults=new i(this.options),this.options.parentView.$el.append(this.searchResults.render().el)),this._search(n))},_onInputFocus:function(){console.debug("_onInputFocus"),this.options.sharedObjects.router.navigate("friends",{trigger:!0})},_onInputFocusOut:function(e){if(e.relatedTarget&&e.relatedTarget.firstChild&&e.relatedTarget.firstChild.className&&e.relatedTarget.firstChild.className.indexOf("friend-item-view")!==-1)return},_onClearClicked:function(){this._clearResults()},_clearResults:function(){this.$("input").val(""),this.$(".clear").hide(),e(".recent").text("FRIENDS"),this.options.sharedObjects.router.navigate("friends",{trigger:!0}),this.searchResults&&(this.searchResults.close(),this.searchResults=null)},_focusInput:function(){this.$("input").focus()},_search:function(e){var r=this;r.searchResults.query=e;if(this.options.sharedObjects.friendCollection){var i=this.options.sharedObjects.friendCollection.models,o=t.filter(i,function(t){var n=t.get("nick");return n.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:!1}),u=new n.Collection;t.each(o,function(e){var t=new s({chat_id:e.get("id"),title:e.get("nick"),avatar:e.get("avatar"),presence:e.get("presence"),is_favorite:e.get("is_favorite"),is_friend:!0,is_blocked:e.get("is_blocked")});u.add(t)}),r.searchResults.friendCollection=u}if(this.options.sharedObjects.groupCollection){var i=this.options.sharedObjects.groupCollection.models,a=t.filter(i,function(t){var n=t.get("name");return n.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:!1}),f=new n.Collection;t.each(a,function(e){var t=new s({chat_id:e.get("lobby_id"),title:e.get("name"),avatar:e.get("icon"),is_group:!0});f.add(t)}),r.searchResults.groupCollection=f}r.searchResults.render(),r.searchResults.showSearching(),r.options.sharedObjects.comms.Friends.search({query:e,success:function(e){console.assert(e.query);if(e.query&&e.query!==r.searchResults.query){console.debug("query mismatch");return}if(r.searchResults){var i=new n.Collection;t.each(e.data,function(e){if(r.options.sharedObjects.comms.user_id===e.id)return;if(r.options.sharedObjects.friendCollection.get(e.id))return;var t=e.avatar;t===""&&(t="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png");var n=new s({chat_id:e.id,avatar:t,title:e.nickname});i.add(n)}),r.searchResults.moreCollection=i,r.searchResults.hideSearching(),r.searchResults.render()}}})}});return o}),define("text!templates/favoritesview.html",[],function(){return"<ul>\r\n</ul>"}),define("text!templates/favoriteitem.html",[],function(){return'<img class="avatar round" src="<%- avatar %>">\r\n<div class="presence <%- presence %>" ></div>\r\n<div class="title friend"><%= nick_emoji %></div>\r\n<div class="razericons-favorites favorite"></div>\r\n'}),define("text!templates/favoriteitemactivity.html",[],function(){return'<img class="avatar round" src="<%- avatar %>">\r\n<div class="presence round <%- presence %>"></div>\r\n<div class="title textwrap"><%= name_emoji %></div>\r\n<div class="date"><%- date %></div>\r\n<div class="text textwrap"><%= message_emoji %></div>\r\n<div class="razericons-favorites favorite"></div>\r\n<!-- <div class="unread">\r\n    <div class="icon round"><span class="count"><%- unread %></span></div>\r\n    <div class="more"></div>\r\n</div>-->\r\n'}),define("views/favorites/favoriteitem",["jquery","underscore","backbone","text!templates/favoriteitem.html","text!templates/favoriteitemactivity.html"],function(e,t,n,r,i){var s=n.View.extend({tagName:"li",className:"favorite-item-view grid",events:{click:"_onClick"},router:null,initialize:function(e){t.bindAll(this,"close","_onClick"),this.options=e,this.template=t.template(r),this.activitytemplate=t.template(i),this.router=this.options.sharedObjects.router,console.assert(typeof this.model!="undefined"),this.comms=this.options.sharedObjects.comms},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.data("id",this.model.get("id")),this},close:function(){console.debug("close"),this.remove(),this.unbind(),this.model.off(null,null,this)},_onClick:function(){this.options.onItemClick(this),this.$el.addClass("active");var e="favorites/"+encodeURIComponent(this.model.get("id"));this.router.navigate(e,{trigger:!0})}});return s}),define("views/favorites/favoritesview",["jquery","underscore","backbone","text!templates/favoritesview.html","views/favorites/favoriteitem","collections/friendcollection","models/friendmodel","velocity-ui"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"div",className:"favorites-view",events:{},collection:null,comms:null,sorted:!1,currentgridid:"",initialize:function(e){t.bindAll(this,"render","close","_onItemClick","_onFriendList","onFriendPresence","_reload"),this.options=e,this.template=t.template(r),this.collection=new s,this.comms=this.options.sharedObjects.comms,this.comms.Friends.get({success:this._onFriendList}),this.comms.on("friendPresence",this.onFriendPresence),this.comms.on("friendRemoved",this._reload),this.comms.Friends.on("friendBlocked",this._reload),this.comms.Friends.on("friendUnblocked",this._reload);if(this.options.sharedObjects.enable_cache){var n=this.comms.user_id+".favorites",i=localStorage.getItem(n);if(i){var u=JSON.parse(i);if(u)for(var a=0;a<u.length;++a){var f=new o(u[a]);this.collection.add(f)}}}},render:function(){this.$el.html(this.template()),console.debug("render: collection.length: "+this.collection.length);var e=this;return this.collection.length>0&&(this.collection.sort(),this.collection.each(function(n){if(n.get("is_favorite")===!0){var r=t.extend({model:n,onItemClick:e._onItemClick},e.options),s=new i(r);e.$("ul").append(s.render().el),s.$el.data("id",n.get("id"))}})),this.$("ul").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this},close:function(){console.debug("close"),this.comms.off(null,null,this),this.comms.Friends.off(null,null,this),this.remove(),this.unbind()},_onItemClick:function(){console.debug("_onItemClick"),this.$("ul li.favorite-item-view").removeClass("active")},_onFriendList:function(e){if(this.options.sharedObjects.enable_cache){var t=this.comms.user_id+".favorites";localStorage.setItem(t,JSON.stringify(e.data)),console.debug("saving to localStorage: "+t)}this.collection.reset();for(var n=0;n<e.data.length;++n){var r=new o(e.data[n]);r.get("is_favorite")===!0&&this.collection.add(r)}console.debug("collection length"),console.debug(this.collection.length),this.render()},onFriendPresence:function(e){var t=e.user_id;if(e.presence==="invisible")var n="offline";else var n=e.presence;if(this.collection.length>0){var r=this.collection.get(t);r&&(r.set("presence",n),this.sorted===!1&&this.sortFriends())}},sortFriends:function(){this.sorted=!0;var t=this;setTimeout(function(){t.sorted=!1},3e3);var n=e(".favorites-view ul"),r=n.children("li");r.detach().sort(function(n,r){var i=e(n).find(".title").text().toLowerCase(),s=e(r).find(".title").text().toLowerCase(),o=t.collection.get(e(n).data("id")),u=t.collection.get(e(r).data("id"));if(o&&u&&o.get("is_favorite")!==u.get("is_favorite")){if(o.get("is_favorite"))return-1;if(u.get("is_favorite"))return 1}var a=e(n).find(".presence")[0].className.replace("presence","").toLowerCase().trim(),f=e(r).find(".presence")[0].className.replace("presence","").toLowerCase().trim();return a===f?i<s?-1:i>s?1:0:a==="online"?-1:f==="online"?1:a==="busy"?-1:f==="busy"?1:a==="dnd"?-1:f==="dnd"?1:a==="away"?-1:f==="away"?1:a==="offline"?-1:f==="offline"?1:i<s?-1:i>s?1:0}),n.empty(),n.append(r)},_reload:function(){console.info("_reload"),this.comms.Friends.get({success:this._onFriendList})},highlightCurrentGrid:function(t){t!==""&&(this.currentgridid=t);var n=this;this.$("ul li.favorite-item-view").removeClass("active"),this.currentgridid!==""&&this.$("ul li.favorite-item-view").each(function(t,r){e(this).data("id")===n.currentgridid&&e(this).addClass("active")})}});return a}),define("text!templates/communities/channellistview.html",[],function(){return'<div class="channel-text nowrap">CHANNELS<span class="razericons-add createchannel"></span></div>\n<div class="channels">\n    <ul class="channellist"></ul>\n</div>\n<div class="invite_container"><div class="invite-friends hvalign">INVITE MEMBERS</div></div>'}),define("text!templates/communities/channelitemview.html",[],function(){return'<div class="container channel">\n	<span class="expander razericons-triangle_right"></span>\n    <span class="channel-name"><%= name_emoji %> </span>\n<!--<span class="count">(<span class="active-count"><%- online_members_count %></span>)</span> -->\n	<span class="private razericons-show_private"></span>\n	<span class="dotmenu razericons-menu_options"></span>\n</div>\n\n'}),define("text!templates/communities/subchannellistview.html",[],function(){return""}),define("text!templates/communities/subchannelitemview.html",[],function(){return'<div class="container subchannel">\r\n	<div class="border"></div>\r\n	<span class="expander razericons-triangle_right"></span>\r\n	<span class="channel-name"><%= name_emoji %></span>\r\n	<span class="private razericons-show_private"></span>\r\n	<span class="dotmenu razericons-menu_options"></span>\r\n</div>\r\n\r\n'}),define("text!templates/communities/subsubchannellistview.html",[],function(){return""}),define("text!templates/communities/subsubchannelitemview.html",[],function(){return'<div class="container subsubchannel">\r\n	<div class="border"></div>\r\n	<span class="channel-name"><%= name_emoji %></span>\r\n	<span class="private razericons-show_private"></span>\r\n	<span class="dotmenu razericons-menu_options"></span>\r\n</div>\r\n'}),define("text!templates/communities/channelsettingsview.html",[],function(){return'<div class="channelsettings menulist">\r\n	<ul>\r\n		<li class="edit_ch_prop">Edit Channel Properties</li>\r\n		<!-- <li class="edit_wm_msg">Edit Welcome Message</li>-->\r\n		<li class="addsubchannel">Add Sub Channel</li>\r\n		<li class="deletechannel">Delete Channel</li>\r\n	</ul>\r\n</div>'}),define("text!templates/communities/channelsettings/createchannel.html",[],function(){return'\r\n<div class="title channel">Create a Channel</div>\r\n<div class="title subchannel">Create a SubChannel</div>\r\n<div class="label">NAME</div>\r\n<input type="text" name="channelname" id="channelname" value="" placeholder="Give a name to this new Channel" >\r\n\r\n<div class="password_container">\r\n	<div class="label">PASSWORD</div>\r\n	<div class="privacy_text">Control who gets in with a password protected Channel</div>\r\n	<div class="password-div">\r\n		<input type="checkbox" id="password-checkbox"></input>\r\n		<label for="password-checkbox"><span></span></label><span class="pwdprotectedtext">Password protected</span>\r\n		<div class="password-input">\r\n			<input name="password" class="passwordtext"  type="password" placeholder="Password" value="" autocomplete="new-password"/>\r\n			<div>\r\n				<input type="checkbox" id="show-password-checkbox"></input>\r\n				<label for="show-password-checkbox"><span></span></label><span class="showpwdtext">Show password</span>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n<div class="label" style="margin-top:26px">DESTINATION</div>\r\n<div class="subchannel_dest"></div>\r\n<div class="select_dest">\r\n	 <select name="channels" id="channels" class="channels"> \r\n		 <option>SELECT A DESTINATION</option>\r\n	</select>\r\n</div>\r\n<div class="buttons">\r\n	<div class="button create btn">CREATE</div>\r\n	<div class="button cancel btn">CANCEL</div>\r\n</div>\r\n<div style="clear:both"></div>\r\n'}),define("models/channelmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{lobby:!1,name:"",active:0,"protected":!1,sub_channels:0,text_muted:!1,voice_muted:!1,created:"",password:"",prompt_password:!1,topic:"",motd:{message:""}}});return n}),define("collections/channelcollection",["underscore","backbone","models/channelmodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){if(e.get("lobby"))return-1;if(t.get("lobby"))return 1;var n=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();return n>r?1:n<r?-1:0}});return r}),define("models/communities/channelmodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r=t.Model.extend({defaults:{lobby:!1,name:"",active:0,"protected":!1,text_muted:!1,voice_muted:!1,created:"",password:"",topic:"",motd:{message:""}},initialize:function(){this._setEmojiName(),this.on("change:name",this._setEmojiName)},_setEmojiName:function(){this.set("name_emoji",n.parse(this.escape("name")))}});return r}),define("views/communities/channelsettings/createchannelview",["jquery","backbone","w2ui","text!templates/communities/channelsettings/createchannel.html","collections/channelcollection","models/communities/channelmodel"],function(e,t,n,r,i,s){var o=t.View.extend({tagName:"div",className:"create-channel-view",events:{"keyup #channelname":"onKeypressChannelname",'keyup input[name="password"]':"onPasswordKeypress","change #password-checkbox":"onProtectedClicked","change #show-password-checkbox":"onShowPasswordChanged"},selectedChannelId:"",createchannel:!1,options:{},initialize:function(e){_.bindAll(this,"popup","onCreateClicked","onSelectChannel"),this.template=_.template(r),this.options=e,this.commsCommunity=e.sharedObjects.commsCommunity,this.selectedChannelId="",this.createchannel=!1,this.collection=new i,this.subChannelCollection=new i,this.subsubChannelCollection=new i,console.debug("this.options"),console.debug(this.options)},render:function(){return this.$el.html(this.template()),this.selectedChannelId=this.model.get("id"),this.model.get("id")===this.options.community_id?(console.debug("channel"),this.$(".title.channel").show(),this.createchannel=!0,this.$(".select_dest").show(),this.$(".subchannel_dest").hide()):(console.debug("subchannel"),this.$(".title.subchannel").show(),this.$(".select_dest").hide(),this.$(".subchannel_dest").show(),this.$(".subchannel_dest").text(this.model.get("name")),this.createchannel=!1),this.loadChannels(),this},popup:function(){var t=this;n.open({body:'<div class="publish-announcement-container"></div>',width:534,height:536,modal:!1,opacity:.9,showClose:!1,speed:.4,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .publish-announcement-container").append(t.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){t.close()}),e("#w2ui-popup .create").on("click",function(e){t.onCreateClicked()}),e("#w2ui-popup .cancel").on("click",function(e){t.close()})}}})},close:function(){console.debug("close"),n.close(),this.createchannel&&this.$(".channels").iconselectmenu("destroy"),this.remove(),this.unbind()},onKeypressChannelname:function(){var t=e(".w2ui-popup #channelname").val();t!==""?this.$(".create").addClass("activate"):this.$(".create").removeClass("activate")},onCreateClicked:function(){console.debug("onCreateClicked");var t=this,n=e(".w2ui-popup #channelname").val();console.log("channel-name: "+n);if(n==="")return;var r=t.$('input[name="password"]').val(),i=!1;r!==""&&(i=!0),console.log("password: "+r),console.debug("this.selectedChannelId----"+this.selectedChannelId);if(this.selectedChannelId!==this.options.community_id){var s={name:n,password:r,parent:this.selectedChannelId,"protected":i,depth:this.model.get("depth")+1};this.commsCommunity.createSubChannel({community_id:this.options.community_id,parent_id:this.selectedChannelId,channel:s,success:function(e){console.debug("Sub channel created successfully"),t.close()}})}else{var s={password:r,name:n,"protected":i};this.commsCommunity.createChannel({community_id:this.options.community_id,channel:s,success:function(e){console.debug("channel created successfully"),t.close()}})}},onPasswordKeypress:function(t){var n=e('input[name="password"]').val();n===""?this.$("#password-checkbox").prop("checked",!1):this.$("#password-checkbox").prop("checked",!0)},onProtectedClicked:function(){this.$("#password-checkbox").is(":checked")?(this.$(".password-input").show(),this.$(".password-input").velocity("slideDown",{duration:200})):(this.$('input[name="password"]').val(""),this.$(".password-input").velocity("slideUp",{duration:200}))},onShowPasswordChanged:function(){this.$("#show-password-checkbox").is(":checked")?this.$('input[name="password"]').attr("type","text"):this.$('input[name="password"]').attr("type","password")},setNiceScroll:function(){e(".ui-selectmenu-menu ul").niceScroll({cursorborder:"",cursorcolor:"#404040",cursorwidth:"10px",horizrailenabled:!1})},loadChannels:function(){console.debug("loadChannels:");var e=this;if(this.createchannel){this.$(".channels").empty();var t=this.commsCommunity.getCachedChannels({community_id:this.options.community_id}),n={id:this.options.community_id,name:"Root of the Community"},n=new s(n);this.addToDropdown(n,"channel"),t.length>0&&this.renderChannelTree(t),this.$(".channels").iconselectmenu({width:495,icons:{button:"razericons-triangle_down"},placeholder:"SELECT A DESTINATION",change:e.onSelectChannel}).iconselectmenu("menuWidget").addClass("overflow").addClass("ui-menu-icons customicons"),this.setNiceScroll()}},onSelectChannel:function(t,n){console.debug("onSelectChannel"),this.selectedChannelId=n.item.value,console.debug("this.selectedChannelId--"+this.selectedChannelId),e("#channels-menu li").removeClass("active"),e(t.currentTarget).addClass("active")},addToDropdown:function(e,t){if(e.get("id")===this.selectedChannelId){console.debug("current channel---"+e.get("name"));var n='<option value="'+e.get("id")+'" data-class="'+t+' active" selected>'+e.get("name")+"</option>"}else var n='<option value="'+e.get("id")+'" data-class="'+t+'" >'+e.get("name")+"</option>";this.$(".channels").append(n)},renderChannelTree:function(e){var t=this;this.collection.reset();for(var n=0;n<e.length;n++){var r=new s(e[n]);this.collection.add(r)}this.collection.each(function(e){t.addToDropdown(e,"channel"),t.subChannelCollection.reset();var n=e.get("channels");if(n.length>0){for(var r=0;r<n.length;r++){var e=new s(n[r]);t.subChannelCollection.add(e)}t.subChannelCollection.each(function(e){t.addToDropdown(e,"subchannel"),t.subsubChannelCollection.reset();var n=e.get("channels");if(n.length>0){for(var r=0;r<n.length;r++){var e=new s(n[r]);t.subsubChannelCollection.add(e)}t.subsubChannelCollection.each(function(e){t.addToDropdown(e,"subsubchannel")})}})}})}});return e.widget("custom.iconselectmenu",e.ui.selectmenu,{_renderItem:function(t,n){var r=e("<li>",{text:n.label});return r.addClass(n.element.attr("data-class")),r.appendTo(t)},_drawButton:function(){this._super();var e=this.element.find("[selected]").length,t=this.options.placeholder;!e&&t&&this.buttonText.text(t)}}),o}),define("text!templates/communities/channelsettings/channelproperties.html",[],function(){return'<div class="scroll">\r\n	<div class="main_container">\r\n		<div class="title subchannel">CHANNEL PROPERTIES</div>\r\n		<div class="label">NAME</div>\r\n		<input type="text" name="channelname" id="channelname" value="<%- name %>" placeholder="Give a name to this new Channel" >\r\n\r\n		<div class="label">WELCOME MESSAGE</div>\r\n		<textarea name="welcomemessage" id="welcomemessage" placeholder="Set a welcome message to greet all members entering the Channel! Lay ground rules, highlight Community Administrators, and more!" value=""></textarea>\r\n\r\n		<div class="password_container">\r\n			<div class="label">PASSWORD</div>\r\n			<div class="privacy_text">Control who gets in with a password protected Channel</div>\r\n			<div class="password-div">\r\n				<input type="checkbox" id="pwd-protected"></input>\r\n				<label for="pwd-protected"><span></span></label><span class="pwdprotectedtext">Password protected</span>\r\n				<div class="password-input">\r\n					<input name="password" class="passwordtext"  type="password" placeholder="Password" value="<%- password %>" autocomplete="new-password"/>\r\n					<div>\r\n						<input type="checkbox" id="show-pwd-cb"></input>\r\n						<label for="show-pwd-cb"><span></span></label><span class="showpwdtext">Show password</span>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div class="voice_chat">\r\n			<div class="left_con">\r\n				<div class="label">VOICE CHAT</div>\r\n				<div>Members can talk in this channel</div>\r\n			</div>	\r\n			<div class="right_con">		\r\n				<div class="toggle_btn_on_off">\r\n					<span class="left off btn voice_mute">OFF</span>\r\n					<span class="right on btn voice_unmute">ON</span>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div class="text_chat" style="display:none">\r\n			<div class="left_con">\r\n				<div class="label">TEXT CHAT</div>\r\n				<div>Members can send text messages in this channel</div>\r\n			</div>\r\n			<div class="right_con">		\r\n				<div class="toggle_btn_on_off">\r\n					<span class="left on btn">OFF</span>\r\n					<span class="right off btn">ON</span>\r\n				</div>\r\n			</div>\r\n		</div>\r\n\r\n		<div class="buttons">\r\n			<div class="button cancel btn">CANCEL</div>\r\n			<div class="button save btn">SAVE</div>\r\n		</div>\r\n		<div style="clear:both"></div>\r\n	</div>\r\n<div>'}),define("views/communities/channelsettings/channelproperties",["jquery","underscore","backbone","text!templates/communities/channelsettings/channelproperties.html","models/communities/channelmodel"],function(e,t,n,r,i){var s=n.View.extend({tagName:"div",className:"channel-properties-view",channel_temp:null,events:{"click .cancel":"close","keyup #channelname":"onKeypressChannelname","keyup #welcomemessage":"onKeypressWelcomeMessage","change #show-pwd-cb":"onShowPasswordChanged","change #pwd-protected":"onProtectedClicked",'keyup input[name="password"]':"onPasswordKeypress","click .save":"saveChannelChanges","click .voice_chat .voice_mute":"onVoiceMute","click .voice_chat .voice_unmute":"onVoiceUnmute"},initialize:function(e){this.template=t.template(r),t.bindAll(this,"render","onAdminRightsChanged"),this.options=e,this.commsCommunity=e.sharedObjects.commsCommunity,this.channel_temp=new i(this.model.toJSON());var n="adminRightsChanged."+this.options.community_id;this.commsCommunity.on(n,this.onAdminRightsChanged)},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this;this.model.get("password")!==""?this.$("#pwd-protected").prop("checked",!0):this.$("#pwd-protected").prop("checked",!1),this.model.get("voice_muted")&&this.vcMuteOn(),this.checkVoiceEditRights();var n={cursorwidth:this.options.sharedObjects.niceScrollOptions.cursorwidth,cursorborderradius:this.options.sharedObjects.niceScrollOptions.cursorborderradius,zindex:6};return this.$("textarea").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this.$(".scroll").niceScroll(t.extend({},n)),this},checkVoiceEditRights:function(){var e=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"voice_text"});e?this.$(".toggle_btn_on_off .btn").removeClass("rc-disabled-button"):this.$(".toggle_btn_on_off .btn").addClass("rc-disabled-button")},close:function(){console.debug("close"),this.remove(),this.unbind()},onKeypressChannelname:function(){var e=this.$("#channelname").val();this.channel_temp.set("name",e),this.checkToActivateSave()},onKeypressWelcomeMessage:function(){var e=this.$("#welcomemessage").val();console.debug("onKeypressWelcomeMessage---"+e);var t={message:e};this.channel_temp.set("motd",t),this.checkToActivateSave()},onPasswordKeypress:function(t){var n=e('input[name="password"]').val();this.channel_temp.set("password",n),n===""?(this.channel_temp.set("protected",!1),this.$("#pwd-protected").prop("checked",!1)):(this.channel_temp.set("protected",!0),this.$("#pwd-protected").prop("checked",!0)),this.checkToActivateSave()},onProtectedClicked:function(){this.$("#pwd-protected").is(":checked")||(this.$('input[name="password"]').val(""),this.channel_temp.set("protected",!1),this.channel_temp.set("password","")),this.checkToActivateSave()},onShowPasswordChanged:function(){this.$("#show-pwd-cb").is(":checked")?this.$('input[name="password"]').attr("type","text"):this.$('input[name="password"]').attr("type","password"),this.checkToActivateSave()},checkToActivateSave:function(){var e=this.hasChanged();e?this.$(".save").addClass("activate"):this.$(".save").removeClass("activate")},saveChannelChanges:function(){var e=this.hasChanged();console.debug("saveChannelChanges ---"+e);if(e){var t=this.channel_temp.get("name");if(t===""){console.log("onSaveClicked: name is empty");return}console.debug("channel to be saved"),console.debug(this.channel_temp.toJSON());var n=this;this.commsCommunity.updateChannel({community_id:this.options.community_id,channel_id:this.model.get("id"),channel:this.channel_temp.toJSON(),success:function(e){console.debug("channel updated successfully"),n.close()}})}},hasChanged:function(){return this.model.get("name")!==this.channel_temp.get("name")&&this.channel_temp.get("name")!==""?(console.debug("name changed"),!0):this.model.get("description")!==this.channel_temp.get("description")?(console.debug("description changed"),!0):this.model.get("password")!==this.channel_temp.get("password")?(console.debug("password changed"),!0):this.model.get("protected")!==this.channel_temp.get("protected")?(console.debug("protected changed"),!0):this.model.get("motd").message!==this.channel_temp.get("motd").message?(console.debug("welcome message changed"),!0):this.model.get("voice_muted")!==this.channel_temp.get("voice_muted")?(console.debug("voice muted changed"),!0):!1},onVoiceMute:function(){this.$(".voice_mute").hasClass("off")&&(this.vcMuteOn(),this.channel_temp.set("voice_muted",!0),console.debug("mute true")),this.checkToActivateSave()},onVoiceUnmute:function(){this.$(".voice_unmute").hasClass("off")&&(this.vcMuteOff(),this.channel_temp.set("voice_muted",!1),console.debug("mute false")),this.checkToActivateSave()},vcMuteOn:function(){this.$(".voice_mute").removeClass("off").addClass("on"),this.$(".voice_unmute").removeClass("on").addClass("off")},vcMuteOff:function(){this.$(".voice_unmute").removeClass("off").addClass("on"),this.$(".voice_mute").removeClass("on").addClass("off")},onAdminRightsChanged:function(e,t){t.sender!==this.options.sharedObjects.comms.user_id&&this.checkVoiceEditRights()}});return s}),define("views/communities/channelsettingsview",["jquery","underscore","backbone","text!templates/communities/channelsettingsview.html","views/communities/channelsettings/createchannelview","views/communities/channelsettings/channelproperties","rcdialog"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"channel-settings-view",channelPropertiesView:null,events:{"click .edit_ch_prop":"_onEditChannelProperties","click .edit_wm_msg":"_onEditWelcomeMessage","click .addsubchannel":"_onAddSubChannel","click .deletechannel":"_onDeleteChannel"},initialize:function(e){this.template=t.template(r),t.bindAll(this,"render","autoClose"),this.options=e,this.commsCommunity=e.sharedObjects.commsCommunity,this.channelPropertiesView=null},render:function(){return this.$el.html(this.template()),this.model.get("lobby")&&this.$(".deletechannel").remove(),this.model.get("depth")===3&&this.$(".addsubchannel").remove(),this},show:function(){var e=this.commsCommunity.hasRights({community_id:this.options.community_id});if(e){var t=this;this.$(".channelsettings").velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){}})}},close:function(){console.debug("close");var e=this;this.$(".channelsettings").velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){e.remove(),e.unbind()}})},autoClose:function(){this.remove(),this.unbind()},_onEditChannelProperties:function(){console.debug("_onEditChannelProperties"),this.channelPropertiesView&&(this.channelPropertiesView.close(),this.channelPropertiesView=null),e(".channel-properties-view").remove();var t={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.channelPropertiesView=new s(t),e(".community-main-view").append(this.channelPropertiesView.render().el),this.remove()},_onEditWelcomeMessage:function(){},_onAddSubChannel:function(){this.createChannelView&&(this.createChannelView.close(),this.createChannelView=null);var e={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.createChannelView=new i(e),this.createChannelView.popup()},_onDeleteChannel:function(){var e=this,t='Are you sure you want to delete: <br/> <span class="data">'+this.model.get("name")+" ?</span>";o.yesNo(t,'<div class="dialogtitle">DELETE CHANNEL</div>',function(t){console.debug("answer: "+t),t==="Yes"&&e.commsCommunity.deleteChannel({community_id:e.options.community_id,channel_id:e.model.get("id"),success:function(e){}})},"DELETE","CANCEL","razericons-alerts")}});return u}),define("text!templates/communities/passwordprompt.html",[],function(){return'<div class="title">Enter Password</div>\r\n<input type="password" id="password" placeholder="Password">\r\n<div class="error">Invalid Password.Please enter correct password.</div>\r\n<div class="buttons">\r\n	<div class="rc-button popupbtn ok green_disabled">OK</div>\r\n	<div class="rc-button popupbtn cancel" style="margin-left:10px">CANCEL</div>\r\n</div>'}),define("views/communities/passwordprompt",["jquery","underscore","backbone","text!templates/communities/passwordprompt.html"],function(e,t,n,r){var i=n.View.extend({className:"password-prompt-view",events:{"click .ok":"onOKClicked",'keyup input[type="password"]':"onPasswordKeyUp"},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.options.community_pwd_prompt&&this.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}),this.options.onclose_navigatetoactivity&&this.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}),w2popup.close(),this.remove(),this.unbind()},popup:function(){var t=this;w2popup.open({body:'<div class="password-prompt popup-rz"></div>',width:400,height:220,modal:!0,opacity:.9,showClose:!1,speed:.4,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .password-prompt").append(t.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){t.close()}),e("#w2ui-popup .cancel").on("click",function(e){t.close()}),e("#w2ui-popup .ok").on("click",function(e){t.onOkClicked()})}}})},onOkClicked:function(){var e=this.$('input[type="password"]').val();e!==""?this.options.community_pwd_prompt?this.joinCommunity():this.joinChannel():this.$(".error").show()},onPasswordKeyUp:function(e){this.$(".error").hide();var t=this.$('input[type="password"]').val();t!==""?this.$(".ok").removeClass("green_disabled").addClass("activate"):this.$(".ok").removeClass("activate").addClass("green_disabled");if(e.keyCode===13){this.onOkClicked();return}},joinChannel:function(){console.debug("joinChannel");var e=this,t=this.$('input[type="password"]').val();this.commsCommunity.joinChannel({community_id:e.options.community_id,channel_id:e.options.channel_id,password:t,success:function(n){e._savePassword(e.options.channel_id,t),e.options.go&&e.options.go(),w2popup.close(),e.remove(),e.unbind()},error:function(){e.$(".error").show()}})},joinCommunity:function(){console.debug("joinCommunity");var e=this,t=this.$('input[type="password"]').val();this.commsCommunity.joinCommunity({community_id:this.options.community_id,password:t,success:function(){w2popup.close(),e.remove(),e.unbind(),window.location.reload()},error:function(){e.$(".error").show()}})},_savePassword:function(e,t){var n=this.options.sharedObjects.comms.user_id+".channel_passwords",r=localStorage.getItem(n),i={};r&&(i=JSON.parse(r)),i[e]=t,localStorage.setItem(n,JSON.stringify(i))}});return i}),define("views/communities/subsubchannelitemview",["jquery","underscore","backbone","text!templates/communities/subsubchannelitemview.html","views/communities/channelsettingsview","views/communities/passwordprompt"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"li",className:"subsubchannel",events:{"click .container.subsubchannel .channel-name":"_onDoubleClick","click .container.subsubchannel .dotmenu":"onChannelSettingsClicked"},scroller:null,channelSettingsView:null,initialize:function(e){t.bindAll(this,"render","autoHideSettingsMenu","calculateChannelSettingsMenuTop","routeToChannel"),this.template=t.template(r),this.options=e,this.scroller=null,this.channelSettingsView=null,this.commsCommunity=this.options.sharedObjects.commsCommunity;var n="delete_channel."+this.model.get("id");this.commsCommunity.on(n,this._onChannelDeleted,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.has("protected")&&this.model.get("protected")&&this.$(".container.subsubchannel .private").show(),this},close:function(){console.debug("close"),this.remove(),this.unbind(),this.commsCommunity.off(null,null,this),this.channelSettingsView&&(this.channelSettingsView.close(),this.channelSettingsView=null)},_onDoubleClick:function(){console.debug("_onDoubleClick: "+JSON.stringify(this.model.toJSON()));var e=this.commsCommunity.getMyRole({community_id:this.options.community_id});if(e==="member"&&this.model.has("protected")&&this.model.get("protected")){var t=this._getSavedPassword(this.model.get("id"));t?this.routeToChannel():this.showPasswordPrompt()}else this.routeToChannel()},routeToChannel:function(){var e=this.model.get("community_id"),t=this.model.get("id"),n="communities/"+encodeURIComponent(e);n+="/"+encodeURIComponent(t),this.options.sharedObjects.router.navigate(n,{trigger:!0})},onChannelSettingsClicked:function(){this.channelSettingsView?this.hideChannelSettings():this.showChannelSettings()},showChannelSettings:function(){var t={channel_id:this.options.channel_id,community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,model:this.model};this.channelSettingsView=new i(t),this.$el.append(this.channelSettingsView.render().$el),this.calculateChannelSettingsMenuTop(),this.channelSettingsView.show(),e(document).bind("click",this.autoHideSettingsMenu),this.scroller=e("ul.channellist"),this.scroller.bind("scroll",this.calculateChannelSettingsMenuTop)},hideChannelSettings:function(){this.channelSettingsView.close(),this.closeChannelSettings()},hideChannelSettingsAuto:function(){this.channelSettingsView.autoClose(),this.closeChannelSettings()},closeChannelSettings:function(){e(document).unbind("click",this.autoHideSettingsMenu),this.scroller.unbind("scroll",this.calculateChannelSettingsMenuTop),this.channelSettingsView=null},autoHideSettingsMenu:function(){var e=this;!e.$(event.target).closest(".channelsettings").length&&!e.$(event.target).closest(".dotmenu").length&&e.hideChannelSettingsAuto()},calculateChannelSettingsMenuTop:function(){var e=this.$(".container.subsubchannel .dotmenu").offset().top,t=Math.round(e)-150;t>0&&this.channelSettingsView.$el.find(".menulist").css("top",t)},_onChannelDeleted:function(e,t){if(t.channel_id===this.options.channel_id){console.debug("deleting current channel , moving to lobby");var n=this.commsCommunity.getCachedCommunity({community_id:t.community_id}),r=n.lobby_id,i="communities/"+encodeURIComponent(t.community_id);i+="/"+encodeURIComponent(r),this.options.sharedObjects.router.navigate(i,{trigger:!0})}this.close()},showPasswordPrompt:function(){var e={channel_id:this.model.get("id"),community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,go:this.routeToChannel,community_pwd_prompt:!1};this.passwordPromptView=new s(e),this.passwordPromptView.popup()},_getSavedPassword:function(e){var t=this.options.sharedObjects.comms.user_id+".channel_passwords",n=localStorage.getItem(t),r={};n&&(r=JSON.parse(n));var i=r[e];return i}});return o}),define("views/communities/subsubchannellistview",["jquery","underscore","backbone","text!templates/communities/subsubchannellistview.html","velocity-ui","views/communities/subsubchannelitemview","models/communities/channelmodel"],function(e,t,n,r,i,s,o){var u=34,a=n.View.extend({tagName:"ul",className:"subsubchannel-list-view",subsubchannelactive:!1,options:{community_id:null,channel_id:null,sharedObjects:null,subsubchannellist:[]},initialize:function(e){t.bindAll(this,"render","close"),this.template=t.template(r),this.options=e,this.commsCommunity=this.options.sharedObjects.commsCommunity,this.subsubchannelactive=!1},render:function(){this.$el.html(this.template());var e=this,t=this.options.subsubchannellist;if(t.length>0){for(var n=0;n<t.length;n++){var r=new o(t[n]);r.set("community_id",this.options.community_id);var i=this.options;i.model=r;var u=new s(i);this.$el.append(u.render().el),this.options.channel_id===r.get("id")&&(u.$el.find(".container.subsubchannel").addClass("active"),this.subsubchannelactive=!0,setTimeout(function(){e.drawBorder(),e.drawBorderParent()},200))}var e=this;e.options.animate?setTimeout(function(){e.$el.velocity("slideDown",{duration:200,complete:function(){e.options.resizeScroll&&e.options.resizeScroll()}})},10):e.$el.show()}return this},close:function(){console.debug("close");var e=this;e.$el.velocity("slideUp",{duration:200,complete:function(){e.remove(),e.unbind()}})},drawBorder:function(){console.debug("drawBorder");var t=this.$(".container.subsubchannel.active .border").parent().parent(),n=u-6;t.prevAll().each(function(){n+=e(this).height()+2});var r=n-u/2;this.$(".container.subsubchannel.active .border").css("height",n),this.$(".container.subsubchannel.active .border").css("top",-r),this.$(".container.subsubchannel.active .border").show(),this.$(".container.subsubchannel.active").parent().parent().parent().find(".container.subchannel").addClass("expanded"),this.$(".container.subsubchannel.active").parent().parent().parent().parent().parent().find(".container.channel").addClass("expanded")},drawBorderParent:function(){console.debug("draw Border Parent");var t=this.$(".container.subsubchannel.active .border").parent().parent().parent().parent(),n=u-6;t.prevAll().each(function(){n+=e(this).height()+2});var r=n-u/2;t.find(".container.subchannel .border").css("height",n),t.find(".container.subchannel .border").css("top",-r),t.find(".container.subchannel .border").show()}});return a}),define("views/communities/subchannelitemview",["jquery","underscore","backbone","text!templates/communities/subchannelitemview.html","views/communities/subsubchannellistview","views/communities/channelsettingsview","views/communities/passwordprompt"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"li",className:"subchannel",events:{"click .container.subchannel .channel-name":"_onDoubleClick","click .container.subchannel .expander":"onExpanderClicked","click .container.subchannel .dotmenu":"onChannelSettingsClicked"},subSubChannelListView:null,channelSettingsView:null,scroller:null,currentChannel:!1,initialize:function(e){t.bindAll(this,"render","close","autoHideSettingsMenu","calculateChannelSettingsMenuTop","routeToChannel"),this.template=t.template(r),this.options=e,this.subSubChannelListView=null,this.channelSettingsView=null,this.commsCommunity=this.options.sharedObjects.commsCommunity,this.scroller=null,this.currentChannel=!1;var n=this;this.model.on("change:removed",function(e){e.get("removed")&&n.close()});var i="delete_channel."+this.model.get("id");this.commsCommunity.on(i,this._onChannelDeleted,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));if(this.model.has("channels")&&this.model.get("channels").length>0){this.$(".expander").show();if(this.options.channel_id===this.model.get("id"))this._showList(!1),this.currentChannel=!0;else if(this.options.currentChannel.parent_id!==this.model.get("id")){var e=this.commsCommunity.getCachedChannel({channel_id:this.model.get("id")});e&&e.expanded&&this._showList(!1)}}return this.model.has("protected")&&this.model.get("protected")&&this.$(".container.subchannel .private").show(),this},close:function(){console.debug("close"),this.channelSettingsView&&(this.channelSettingsView.close(),this.channelSettingsView=null),this.subSubChannelListView&&(this.subSubChannelListView.close(),this.subSubChannelListView=null),this.commsCommunity.off(null,null,this),this.remove(),this.unbind()},_onDoubleClick:function(){console.debug("_onDoubleClick: "+JSON.stringify(this.model.toJSON()));var e=this.commsCommunity.getMyRole({community_id:this.options.community_id});if(e==="member"&&this.model.has("protected")&&this.model.get("protected")){var t=this._getSavedPassword(this.model.get("id"));t?this.routeToChannel():this.showPasswordPrompt()}else this.routeToChannel()},routeToChannel:function(){var e=this.model.get("community_id"),t=this.model.get("id"),n="communities/"+encodeURIComponent(e);n+="/"+encodeURIComponent(t),this.options.sharedObjects.router.navigate(n,{trigger:!0})},onExpanderClicked:function(){this.model.get("channels").length>0&&(console.debug("onExpanderClicked: '"+this.model.get("name")+"'"),this.subSubChannelListView?this._hideList():this._showList(!0))},_showList:function(e){console.debug("showList");var n=this.commsCommunity.setChannelExpanded({channel_id:this.model.get("id"),expand:!0});this.$(".expander").removeClass("razericons-triangle_right"),this.$(".expander").addClass("razericons-triangle_down_right");var r=t.extend({subsubchannellist:this.model.get("channels"),animate:e},this.options);this.subSubChannelListView=new i(r),this.$el.append(this.subSubChannelListView.render().el),console.debug(this.currentChannel),this.currentChannel||(console.debug("inside if"),this.options.redrawBorder&&this.options.redrawBorder())},_hideList:function(){console.debug("hideList");var e=this.commsCommunity.setChannelExpanded({channel_id:this.model.get("id"),expand:!1});this.subSubChannelListView.close(),this.subSubChannelListView=null,this.$(".expander").addClass("razericons-triangle_right"),this.$(".expander").removeClass("razericons-triangle_down_right"),this.currentChannel||this.options.redrawBorder&&this.options.redrawBorder()},onChannelSettingsClicked:function(){this.channelSettingsView?this.hideChannelSettings():this.showChannelSettings()},showChannelSettings:function(){var t={channel_id:this.options.channel_id,community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,model:this.model};this.channelSettingsView=new s(t),this.$el.append(this.channelSettingsView.render().$el),this.calculateChannelSettingsMenuTop(),this.channelSettingsView.show(),e(document).bind("click",this.autoHideSettingsMenu),this.scroller=e("ul.channellist"),this.scroller.bind("scroll",this.calculateChannelSettingsMenuTop)},hideChannelSettings:function(){this.channelSettingsView.close(),this.closeChannelSettings()},hideChannelSettingsAuto:function(){this.channelSettingsView.autoClose(),this.closeChannelSettings()},closeChannelSettings:function(){e(document).unbind("click",this.autoHideSettingsMenu),this.scroller.unbind("scroll",this.calculateChannelSettingsMenuTop),this.channelSettingsView=null},autoHideSettingsMenu:function(){var e=this;!e.$(event.target).closest(".channelsettings").length&&!e.$(event.target).closest(".dotmenu").length&&e.hideChannelSettingsAuto()},calculateChannelSettingsMenuTop:function(){var e=this.$(".container.subchannel .dotmenu").offset().top,t=Math.round(e)-150;t>0&&this.channelSettingsView.$el.find(".menulist").css("top",t)},_onChannelDeleted:function(e,t){if(t.channel_id===this.options.channel_id){console.debug("deleting current channel , moving to lobby");var n=this.commsCommunity.getCachedCommunity({community_id:t.community_id}),r=n.lobby_id,i="communities/"+encodeURIComponent(t.community_id);i+="/"+encodeURIComponent(r),this.options.sharedObjects.router.navigate(i,{trigger:!0})}this.close()},showPasswordPrompt:function(){var e={channel_id:this.model.get("id"),community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,go:this.routeToChannel,community_pwd_prompt:!1};this.passwordPromptView=new o(e),this.passwordPromptView.popup()},_getSavedPassword:function(e){var t=this.options.sharedObjects.comms.user_id+".channel_passwords",n=localStorage.getItem(t),r={};n&&(r=JSON.parse(n));var i=r[e];return i}});return u}),define("views/communities/subchannellistview",["jquery","underscore","backbone","text!templates/communities/subchannellistview.html","velocity-ui","views/communities/subchannelitemview","models/communities/channelmodel","collections/channelcollection"],function(e,t,n,r,i,s,o,u){var a=34,f=n.View.extend({tagName:"ul",className:"subchannel-list-view",options:{community_id:null,channel_id:null,sharedObjects:null,subchannellist:[],li:null},collection:null,subchannelactive:!1,initialize:function(e){t.bindAll(this,"render","close","drawBorder","redrawBorder"),this.template=t.template(r),this.options=e,this.subchannelactive=!1,console.debug("initialize"),this.commsCommunity=this.options.sharedObjects.commsCommunity,this.collection=new u},render:function(){this.$el.html(this.template());var e=this.options.subchannellist,t=this.options.currentChannel,n=this;if(e.length>0){for(var r=0;r<e.length;r++){var i=new o(e[r]);i.set("community_id",this.options.community_id),this.collection.add(i)}this.collection.length>0&&this.collection.each(function(e){var r=n.options;r.model=e,r.redrawBorder=n.redrawBorder;var i=new s(r);n.$el.append(i.render().el),t&&(t.depth===2?t.id===e.get("id")&&(i.$el.find(".container.subchannel").addClass("active"),n.subchannelactive=!0):t.depth===3&&t.parent_id===e.get("id")&&i._showList(!1))}),n.options.animate?setTimeout(function(){n.$el.velocity("slideDown",{duration:200,complete:function(){n.options.resizeScroll&&n.options.resizeScroll()}})},10):n.$el.show(),setTimeout(function(){n.subchannelactive&&n.drawBorder()},210)}return this},close:function(){console.debug("close");var e=this;this.$el.velocity("slideUp",{duration:200,complete:function(){e.remove(),e.unbind()}})},drawBorder:function(){console.debug("draw border ");var e=this.$(".container.subchannel.active .border").parent().parent();this.showborder(e),this.$(".container.subchannel.active").parent().parent().parent().find(".container.channel").addClass("expanded")},redrawBorder:function(){console.debug("redrawBorder");var e=this;if(this.subchannelactive){console.debug("subchannel active"),this.$(".container.subchannel.active .border").hide();var t=this.$(".container.subchannel.active .border").parent().parent()}else{console.debug("subsubchannel active");var t=this.$(".container.subsubchannel.active .border").parent().parent().parent().parent();t.find(".container.subchannel.active .border").hide()}setTimeout(function(){e.showborder(t)},200)},showborder:function(t){console.debug("parent li"),console.debug(t);var n=a-6;t.prevAll().each(function(){console.debug(this),n+=e(this).height()+2,console.debug(e(this).height())});var r=n-a/2;if(t.find(".container.subchannel .expander").is(":visible"))var i="9px";else var i="30px";var s=t.find(".subchannel.container .border");s.css("height",n),s.css("top",-r),s.css("width",i),s.velocity("slideDown",{duration:10})}});return f}),define("views/communities/channelitemview",["jquery","underscore","backbone","text!templates/communities/channelitemview.html","views/communities/subchannellistview","velocity-ui","views/communities/channelsettingsview","views/communities/passwordprompt"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"div",className:"channel-item-view",events:{"click .container.channel .channel-name":"_onDoubleClick","click .container.channel .expander":"onExpanderClicked","click .container.channel .dotmenu":"onChannelSettingsClicked"},options:{model:null,sharedObjects:null,li:null,niceScroll:null},subChannelListView:null,channelSettingsView:null,scroller:null,initialize:function(e){t.bindAll(this,"close","_onJoinChannelSuccess","onExpanderClicked","routeToChannel"),t.bindAll(this,"autoHideSettingsMenu","calculateChannelSettingsMenuTop","_onChannelDeleted"),this.template=t.template(r),this.options=e,this.commsCommunity=e.sharedObjects.commsCommunity,console.assert(this.commsCommunity),this.subChannelListView=null,this.channelSettingsView=null;var n=this;this.model.on("change:removed",function(e){e.get("removed")&&n.close()});var i="delete_channel."+this.model.get("id");this.commsCommunity.on(i,this._onChannelDeleted,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.has("channels")&&this.model.get("channels").length>0&&(this.$(".expander").show(),this._showList(!1)),this.model.has("protected")&&this.model.get("protected")&&this.$(".container.channel .private").show(),this},close:function(){this.subChannelListView&&(this.subChannelListView.close(),this.subChannelListView=null),this.channelSettingsView&&(this.channelSettingsView.close(),this.channelSettingsView=null),this.remove(),this.unbind(),this.commsCommunity.off(null,null,this)},_onDoubleClick:function(){console.debug("_onDoubleClick: "+JSON.stringify(this.model.toJSON()));var e=this.commsCommunity.getMyRole({community_id:this.options.community_id});if(e==="member"&&this.model.has("protected")&&this.model.get("protected")){var t=this._getSavedPassword(this.model.get("id"));t?this.routeToChannel():this.showPasswordPrompt()}else this.routeToChannel()},routeToChannel:function(){var e=this.model.get("community_id"),t=this.model.get("id"),n="communities/"+encodeURIComponent(e);n+="/"+encodeURIComponent(t),this.options.sharedObjects.router.navigate(n,{trigger:!0})},_onJoinChannelSuccess:function(){console.log("%c _onJoinChannelSuccess: "+this.model.get("name"),"color:green;");var e=this.model.get("community_id"),t=this.model.get("id"),n=this;this.commsCommunity.getActive({community_id:e,channel_id:t,success:function(e){n.$(".active-count").text(e.data.length)}})},onExpanderClicked:function(){this.model.get("channels").length>0&&(console.debug("onExpanderClicked: '"+this.model.get("name")+"'"),this.subChannelListView?this._hideList():this._showList(!0))},_hideList:function(){console.debug("hide subchannels"),this.subChannelListView&&(this.subChannelListView.close(),this.subChannelListView=null,this.$(".expander").addClass("razericons-triangle_right"),this.$(".expander").removeClass("razericons-triangle_down_right"))},_showList:function(e){this.$(".expander").removeClass("razericons-triangle_right"),this.$(".expander").addClass("razericons-triangle_down_right");var t=this.options;t.subchannellist=this.model.get("channels"),t.resizeScroll=this.options.resizeScroll,t.animate=e,this.subChannelListView=new i(t),this.$el.append(this.subChannelListView.render().el)},onChannelSettingsClicked:function(){this.channelSettingsView?this.hideChannelSettings():this.showChannelSettings()},showChannelSettings:function(){console.debug("showChannelSettings");var t={channel_id:this.options.channel_id,community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,model:this.model},n=this.$el.parent().parent();this.channelSettingsView=new o(t),this.$el.append(this.channelSettingsView.render().$el),this.calculateChannelSettingsMenuTop(),this.channelSettingsView.show(),e(document).bind("click",this.autoHideSettingsMenu),n.bind("scroll",this.calculateChannelSettingsMenuTop)},hideChannelSettings:function(){this.channelSettingsView&&this.channelSettingsView.close(),this.closeChannelSettings()},hideChannelSettingsAuto:function(){this.channelSettingsView&&this.channelSettingsView.autoClose(),this.closeChannelSettings()},closeChannelSettings:function(){var t=this.$el.parent().parent();e(document).unbind("click",this.autoHideSettingsMenu),t.unbind("scroll",this.calculateChannelSettingsMenuTop),this.channelSettingsView=null},autoHideSettingsMenu:function(){var e=this;!e.$(event.target).closest(".channelsettings").length&&!e.$(event.target).closest(".dotmenu").length&&e.hideChannelSettingsAuto()},calculateChannelSettingsMenuTop:function(){var e=this.$(".container.channel .dotmenu").offset().top,t=Math.round(e)-150;t>0&&this.channelSettingsView.$el.find(".menulist").css("top",t)},_onChannelDeleted:function(e,t){console.debug("_onChannelDeleted");if(t.channel_id===this.options.channel_id){console.debug("deleting current channel , moving to lobby");var n=this.commsCommunity.getCachedCommunity({community_id:t.community_id}),r=n.lobby_id,i="communities/"+encodeURIComponent(t.community_id);i+="/"+encodeURIComponent(r),this.options.sharedObjects.router.navigate(i,{trigger:!0})}this.$el.parent().remove(),this.close()},showPasswordPrompt:function(){var e={channel_id:this.model.get("id"),community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,go:this.routeToChannel,community_pwd_prompt:!1};this.passwordPromptView=new u(e),this.passwordPromptView.popup()},_getSavedPassword:function(e){var t=this.options.sharedObjects.comms.user_id+".channel_passwords",n=localStorage.getItem(t),r={};n&&(r=JSON.parse(n));var i=r[e];return i}});return a}),define("text!templates/communities/invitecommunityview.html",[],function(){return'<div class="title">INVITE LINK</div>\n<div class="link">Generating link...</div>\n<div class="bc"><div class="rc-button rc-disabled-button copy">COPY</div></div>\n<button class="copy-link-btn" data-clipboard-action="copy" data-clipboard-text="">COPY</button>\n<div class="info">Copied to clipboard</div>\n'}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("clipboard",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Clipboard=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){var r=e("matches-selector");t.exports=function(e,t,n){for(var i=n?e:e.parentNode;i&&i!==document;){if(r(i,t))return i;i=i.parentNode}}},{"matches-selector":5}],2:[function(e,t,n){function r(e,t,n,r,s){var o=i.apply(this,arguments);return e.addEventListener(n,o,s),{destroy:function(){e.removeEventListener(n,o,s)}}}function i(e,t,n,r){return function(n){n.delegateTarget=s(n.target,t,!0),n.delegateTarget&&r.call(e,n)}}var s=e("closest");t.exports=r},{closest:1}],3:[function(e,t,n){n.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||n.node(e[0]))},n.string=function(e){return"string"==typeof e||e instanceof String},n.fn=function(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t}},{}],4:[function(e,t,n){function r(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!u.string(t))throw new TypeError("Second argument must be a String");if(!u.fn(n))throw new TypeError("Third argument must be a Function");if(u.node(e))return i(e,t,n);if(u.nodeList(e))return s(e,t,n);if(u.string(e))return o(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function i(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function s(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function o(e,t,n){return a(document.body,e,t,n)}var u=e("./is"),a=e("delegate");t.exports=r},{"./is":3,delegate:2}],5:[function(e,t,n){function r(e,t){if(s)return s.call(e,t);for(var n=e.parentNode.querySelectorAll(t),r=0;r<n.length;++r)if(n[r]==e)return!0;return!1}var i=Element.prototype,s=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;t.exports=r},{}],6:[function(e,t,n){function r(e){var t;if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName)e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute("contenteditable")&&e.focus();var n=window.getSelection(),r=document.createRange();r.selectNodeContents(e),n.removeAllRanges(),n.addRange(r),t=n.toString()}return t}t.exports=r},{}],7:[function(e,t,n){function r(){}r.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function r(){i.off(e,r),t.apply(n,arguments)}var i=this;return r._=t,this.on(e,r,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;for(r;i>r;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var s=0,o=r.length;o>s;s++)r[s].fn!==t&&r[s].fn._!==t&&i.push(r[s]);return i.length?n[e]=i:delete n[e],this}},t.exports=r},{}],8:[function(t,n,r){!function(i,s){if("function"==typeof e&&e.amd)e(["module","select"],s);else if("undefined"!=typeof r)s(n,t("select"));else{var u={exports:{}};s(u,i.select),i.clipboardAction=u.exports}}(this,function(e,t){function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(t),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t){r(this,e),this.resolveOptions(t),this.initSelection()}return e.prototype.resolveOptions=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=t.action,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""},e.prototype.initSelection=function(){this.text?this.selectFake():this.target&&this.selectTarget()},e.prototype.selectFake=function(){var t=this,n="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return t.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="fixed",this.fakeElem.style[n?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()},e.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},e.prototype.selectTarget=function(){this.selectedText=(0,i.default)(this.target),this.copyText()},e.prototype.copyText=function(){var t=void 0;try{t=document.execCommand(this.action)}catch(n){t=!1}this.handleResult(t)},e.prototype.handleResult=function(t){t?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},e.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},e.prototype.destroy=function(){this.removeFake()},o(e,[{key:"action",set:function(){var t=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!==("undefined"==typeof t?"undefined":s(t))||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),e}();e.exports=u})},{select:6}],9:[function(t,n,r){!function(i,s){if("function"==typeof e&&e.amd)e(["module","./clipboard-action","tiny-emitter","good-listener"],s);else if("undefined"!=typeof r)s(n,t("./clipboard-action"),t("tiny-emitter"),t("good-listener"));else{var u={exports:{}};s(u,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=u.exports}}(this,function(e,t,n,r){function i(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}var f=i(t),l=i(n),c=i(r),h=function(e){function t(n,r){s(this,t);var i=o(this,e.call(this));return i.resolveOptions(r),i.listenClick(n),i}return u(t,e),t.prototype.resolveOptions=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText},t.prototype.listenClick=function(t){var n=this;this.listener=(0,c.default)(t,"click",function(e){return n.onClick(e)})},t.prototype.onClick=function(t){var n=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new f.default({action:this.action(n),target:this.target(n),text:this.text(n),trigger:n,emitter:this})},t.prototype.defaultAction=function(t){return a("action",t)},t.prototype.defaultTarget=function(t){var n=a("target",t);return n?document.querySelector(n):void 0},t.prototype.defaultText=function(t){return a("text",t)},t.prototype.destroy=function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},t}(l.default);e.exports=h})},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)}),define("views/communities/invitecommunityview",["jquery","underscore","backbone","text!templates/communities/invitecommunityview.html","w2ui"],function(e,t,n,r,i){var s=n.View.extend({tagName:"div",className:"invite-community-view",events:{"click .rc-button.copy":"_onCopyClick","click .rc-button.close-btn":"_onCloseClick"},initialize:function(e){t.bindAll(this,"render","popup","close","_getLink"),console.assert(this.model),console.assert(e.comms),this.options=e,this.template=t.template(r)},render:function(){this.$el.html(this.template());var e=this;return this._getLink(function(t){console.debug("link: "+t),e.$(".link").text(t),e.$("button.copy-link-btn").attr("data-clipboard-text",t),e.$(".rc-button").removeClass("rc-disabled-button")}),require(["clipboard"],function(e){console.debug("Clipboard loaded");var t=new e(".copy-link-btn");t.on("success",function(e){console.log("success"),console.log(e)}),t.on("error",function(e){console.log("error"),console.log(e)})}),this},_getLink:function(e){console.debug("_getLink: model:"),console.debug(this.model.toJSON()),console.assert(this.model.has("id")&&this.model.get("id")!==""),console.assert(this.model.has("lobby_id")&&this.model.get("lobby_id")!=="");var t="https://web.comms.razerzone.com/#communities/";t+=encodeURIComponent(this.model.get("id")),t+="/"+encodeURIComponent(this.model.get("lobby_id")),this.options.comms.shortenUrl({long_url:t,success:function(t){console.debug(t),e(t.short_url)}})},close:function(){console.debug("close"),this.remove(),this.unbind()},popup:function(){var t=this;w2popup.open({width:400,height:220,body:'<div class="invite-view-container"/>',showMax:!1,showClose:!1,modal:!1,opacity:.9,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .invite-view-container").append(t.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){w2popup.close()})}},onClose:function(e){t.close()}})},_onCopyClick:function(){console.debug("_onCopyClick"),this.$(".copy-link-btn").click(),this.$(".rc-button.copy").addClass("close-btn"),this.$(".rc-button.copy").text("CLOSE"),this.$("div.info").show()},_onCloseClick:function(){console.debug("_onCloseClick"),w2popup.close()}});return s}),define("views/communities/channellistview",["jquery","underscore","backbone","text!templates/communities/channellistview.html","views/communities/channelitemview","collections/channelcollection","models/communities/channelmodel","nicescroll","views/communities/invitecommunityview","views/communities/channelsettings/createchannelview","views/communities/passwordprompt"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.View.extend({tagName:"div",className:"channel-list-view",events:{"click .invite-friends":"_onInviteClick","click .createchannel":"_onCreateChannelClicked"},channels:null,collection:null,rendered:!1,initialize:function(e){t.bindAll(this,"_renderChannels","resizeScroll","scrollToActiveChannel","onCommunitySynced","joinChannel"),this.template=t.template(r),this.options=e,this.channels=null,this.rendered=!1,this.commsCommunity=e.sharedObjects.commsCommunity,console.debug("initialize"),console.assert(e&&e.community_id&&e.community_id!==""),console.assert(e&&e.channel_id&&e.channel_id!==""),console.assert(this.commsCommunity);var n=this;this.joinChannel(),this.collection=new s,this.model.bind("change",this.checkRole,this),this.commsCommunity.on("create_channel",this._handleCreateChannel,this),this.commsCommunity.on("delete_channel",this._handleDeleteChannel,this),this.commsCommunity.on("edit_channel",this._handleEditChannel,this)},joinChannel:function(){var e=this._getSavedPassword(this.options.channel_id),t=this;console.debug("joinChannel---"+e),this.commsCommunity.joinChannel({community_id:t.options.community_id,channel_id:t.options.channel_id,password:e,success:function(e){},error:function(e){t.onJoinChannelError(e)}})},render:function(){console.debug("render"),this.$el.html(this.template()),this.checkRole();var e=this.commsCommunity.getCachedChannels({community_id:this.options.community_id});return e&&e.length>0?(console.debug("have cached channels--"+e.length),this._renderChannels(e)):(this.commsCommunity.getCommunity({community_id:this.options.community_id,success:this.onCommunitySynced}),console.debug("no cached channels for "+this.options.community_id)),this.$("ul.channellist").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this},close:function(){console.debug("close: community_id: "+this.options.community_id),this.collection.each(function(e){e.set("removed",!0)}),this.collection.reset();var e=this;e.commsCommunity.off(null,null,e),this.remove(),this.unbind()},_renderChannels:function(t){console.debug("_renderChannels---"+t.length),this.options.onChannelList&&this.options.onChannelList(t.length),this.$("ul.channellist").empty(),this.collection.each(function(e){e.set("removed",!0)}),this.collection.reset();for(var n=0;n<t.length;n++){var r=new o(t[n]);r.get("parent_id")===""&&(r.set("community_id",this.options.community_id),this.collection.add(r))}var s=this.commsCommunity.getCachedChannel({channel_id:this.options.channel_id});if(this.collection.length>0){var u=this;this.collection.each(function(t){var n=e('<li class="channel"></li>'),r={community_id:u.options.community_id,channel_id:u.options.channel_id,sharedObjects:u.options.sharedObjects,model:t,li:n,resizeScroll:u.resizeScroll,currentChannel:s},o=new i(r);n.append(o.render().el),u.$("ul.channellist").append(n),u.options.channel_id===t.get("id")&&o.$el.find(".container.channel").addClass("active")})}},checkRole:function(){var e=this.commsCommunity.hasRights({community_id:this.options.community_id});if(e){var t=this;this.$(".createchannel").show(),this.$el.addClass("admin")}},resizeScroll:function(){this.$("ul.channellist").getNiceScroll().resize()},scrollToActiveChannel:function(){this.$("ul.channellist").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this.$("ul.channellist").getNiceScroll().hide();var e=this.$("ul.channellist .container.active").position().top,n=this.$("ul.channellist").height();e>n&&this.$("ul.channellist").getNiceScroll(0).doScrollTop(e,200),this.$("ul.channellist").getNiceScroll().show()},_onInviteClick:function(){console.debug("_onInviteClick"),console.debug(this.options);var e=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id});console.assert(e);var t=new a({model:new n.Model(e),comms:this.options.sharedObjects.comms});t.popup()},_onCreateChannelClicked:function(){var e={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.createChannelView=new f(e),this.createChannelView.popup()},_handleCreateChannel:function(e,t){console.debug("_handleCreateChannel");var n=this.commsCommunity.getCachedChannels({community_id:this.options.community_id});n&&this._renderChannels(n),this.commsCommunity.getCommunity({community_id:this.options.community_id,success:this.onCommunitySynced})},onCommunitySynced:function(e){console.debug("onCommunitySynced");var t=e.channels;t&&this._renderChannels(t)},_handleDeleteChannel:function(e,t){console.debug("_handleDeleteChannel"),this.commsCommunity.getCommunity({community_id:this.options.community_id,success:this.onCommunitySynced})},_handleEditChannel:function(e,t){console.debug("handleEditChannel"),this.commsCommunity.getCommunity({community_id:this.options.community_id,success:this.onCommunitySynced})},_getSavedPassword:function(e){var t=this.options.sharedObjects.comms.user_id+".channel_passwords",n=localStorage.getItem(t),r={};n&&(r=JSON.parse(n));var i=r[e];return i},onJoinChannelError:function(e){console.debug("onJoinChannelError");var t=this;e.statusText==="Forbidden"&&e.status===403&&this.showPasswordPrompt()},showPasswordPrompt:function(){var e={channel_id:this.options.channel_id,community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,community_pwd_prompt:!1,onclose_navigatetoactivity:!0};this.passwordPromptView=new l(e),this.passwordPromptView.popup()}});return c}),define("text!templates/onboarduser.html",[],function(){return'<div class="mainui">\r\n	<div class="title"><span class="congrats bold">Hey there!</span> <span class="color76">Welcome on Razer Comms, </span></div>\r\n	<div class="line2 grey">It looks like it\'s your first time around here, so let\'s invite some friends !</div>\r\n	<input type="email" name="email" id="email" placeholder="Enter emails separated by commas" multiple>\r\n	<div class="rc-button invite">INVITE</div>\r\n</div>\r\n\r\n'}),define("text!templates/onboardinvite.html",[],function(){return'<div class="sent">\r\n	<div class="invite_sent">Invite(s) sent</div>\r\n	<div class="info"></div>\r\n	<div class="rc-button ok">OK</div>\r\n</div>'}),define("views/onboard/onboarduser",["jquery","underscore","backbone","text!templates/onboarduser.html","text!templates/onboardinvite.html"],function(e,t,n,r,i){var s=n.View.extend({className:"onboard-user-view",events:{'keyup input[name="email"]':"onKeyupEmail","click .invite":"sendInvites",'input input[name="email"]':"onEmailPaste"},router:null,initialize:function(e){t.bindAll(this,"close"),this.options=e,this.template=t.template(r),this.templateInviteSent=t.template(i),this.router=this.options.sharedObjects.router,this.comms=this.options.sharedObjects.comms},render:function(){return this.$el.html(this.template()),this},close:function(){this.remove(),this.unbind()},onKeyupEmail:function(){var e=this.$("#email").val();this.validateInput(e)},validateInput:function(e){if(e===""){this.$(".invite").removeClass("activate");return}var t=this.validateEmails(e);this.checkButton(t)},onEmailPaste:function(){var e=this.$("#email").val();this.validateInput(e)},validateEmail:function(e){var t=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return t.test(e)?!0:!1},validateEmails:function(e){var t=e.replace(/\s/g,"").split(/,|;/);for(var n=0;n<t.length;n++)if(!this.validateEmail(t[n]))return!1;return!0},checkButton:function(e){e?this.$(".invite").addClass("activate"):this.$(".invite").removeClass("activate")},sendInvites:function(){var e=this.$("#email").val(),t=e.replace(/\s/g,"").split(/,|;/),n=[];for(var r=0;r<t.length;r++){var i=this.isCommsUser(t[r]);i&&n.push(t[r])}this.sendEmailInvite(t),this.popup(n)},isCommsUser:function(e){var n=this;return this.comms.Friends.search({query:e,success:function(r){console.debug(r),r.query===e&&t.each(r.data,function(e){return e.id!==""&&n.sendFriendRequest(e.id),!0})}}),!1},popup:function(t){var n=this;w2popup.open({width:400,height:220,body:'<div class="invite-sent-container"/>',showMax:!1,showClose:!1,modal:!1,opacity:.9,onOpen:function(t){t.onComplete=function(){e(".w2ui-popup .invite-sent-container").append(n.templateInviteSent()),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){n.closePopup()}),e("#w2ui-popup .ok").on("click",function(e){n.closePopup()})}},onClose:function(e){n.$("#email").val("")}})},closePopup:function(){var e=this;w2popup.close(),e.$("#email").val("")},sendFriendRequest:function(e){console.debug("sendFriendRequest--"+e),this.comms.Friends.add({user_id:e})},sendEmailInvite:function(e){console.debug("sendEmailInvite"),console.debug(e),this.comms.emailInvite({recipients:e})}});return s}),define("views/leftsectionview",["jquery","underscore","backbone","text!templates/leftsectionview.html","views/leftheaderview","views/activity/activityview","views/friends/friendsview","views/groups/groupsview","nicescroll","views/search/searchview","views/favorites/favoritesview","views/communities/channellistview","views/onboard/onboarduser"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){MIN_WIDTH=600;var p=n.View.extend({tagName:"div",className:"left-section-view",events:{},activityView:null,friendsView:null,groupsView:null,searchView:null,leftHeaderView:null,favoritesView:null,communityChannelListView:null,onboardUserView:null,initialize:function(e){t.bindAll(this,"render","close","activityTab","friendsTab","favoritesTab","checkForOnboardView"),this.options=e,this.template=t.template(r),this.onboardUserView=null},render:function(){this.$el.html(this.template()),this.leftHeaderView=new i(this.options),this.$(".header").append(this.leftHeaderView.render().el);var e=t.extend({parentView:this},this.options);return this.searchView=new f(e),this.$(".search").append(this.searchView.render().el),this.options.checkOnboard=this.checkForOnboardView,this.activityView=new s(this.options),this.$(".content").append(this.activityView.render().el),this.friendsView=new o(this.options),this.$(".content").append(this.friendsView.render().el),this.favoritesView=new l(this.options),this.$(".content").append(this.favoritesView.render().el),this.groupsView=new u(this.options),this},close:function(){console.debug("close"),this.leftHeaderView&&(this.leftHeaderView.close(),this.leftHeaderView=null),this.activityView&&(this.activityView.close(),this.activityView=null),this.friendsView&&(this.friendsView.close(),this.friendsView=null),this.favoritesView&&(this.favoritesView.close(),this.favoritesView=null),this.searchView&&(this.searchView.close(),this.searchView=null),this.remove(),this.unbind()},activityTab:function(){this.options.sharedObjects.activeTab="activity",this.friendsView.$el.hide(),this.activityView.$el.show(),this.favoritesView.$el.hide(),this.$(".recent").text("RECENT"),this.$(".content").css("top","95px"),this.searchView.clear()},friendsTab:function(){console.debug("friendsTab"),this.options.sharedObjects.activeTab="friends",this.activityView.$el.hide(),this.friendsView.$el.show(),this.favoritesView.$el.hide(),this.$(".content").css("top","60px")},favoritesTab:function(){console.debug("favoritesTab"),this.options.sharedObjects.activeTab="favorites",this.activityView.$el.hide(),this.friendsView.$el.hide(),this.favoritesView.$el.show(),this.$(".recent").text("FAVORITES"),this.$(".content").css("top","95px")},checkToShow:function(){console.debug("checktoshow"),e(".main-view").width()<MIN_WIDTH&&(console.debug("hide"),this.$el.hide())},highlightCurrentGrid:function(e){this.activityView.highlightCurrentGrid(e),this.friendsView.highlightCurrentGrid(e),this.favoritesView.highlightCurrentGrid(e)},checkForOnboardView:function(){this.friendsView&&this.groupsView&&this.friendsView.fetched&&this.groupsView.fetched&&(this.options.sharedObjects.friendCollection.length===0&&this.options.sharedObjects.groupCollection.length===0?(this.closeOnboardView(),this.checkCurrentPathCommunity()||(console.debug("showing onboard view"),this.onboardUserView=new h(this.options),this.$el.parent().append(this.onboardUserView.render().el))):this.closeOnboardView())},closeOnboardView:function(){this.onboardUserView&&(console.debug("closeOnboardView"),this.onboardUserView.close(),this.onboardUserView=null)},checkCurrentPathCommunity:function(){var e=n.history.fragment,t=e.split("/");return t[0]==="communities"?!0:!1}});return p}),define("text!templates/maincontentsectionview.html",[],function(){return'<div class="background-logo"></div>\n<div class="greenheader">\n<div class="back razericons-arrow_left vertical-align"></div>\n</div>\n'}),define("text!templates/mainheaderviewgroup.html",[],function(){return'<!--<div class="title">Nick YvonneK</div>-->\r\n<div class="container">		\r\n		<div class="avatar group">\r\n			<img class="" src="<%- avatar %>" width="100%" height="100%">\r\n			<div class="update"><div class="razericons-camera camera"></div></div>\r\n			<input class="file-select-input" type="file" name="upload" accept="image/*">\r\n		</div>\r\n		\r\n		<div class="nav"><div class="back"></div></div>\r\n		<div class="left">\r\n			<div class="groupname textwrap">\r\n				<div class="title name textwrap"><%= title_emoji %></div>\r\n				<div class="gicon editicon razericons-edit"></div> 	\r\n			</div>\r\n			<input type="text" name="renamegroup" class="renamegroup"  autofocus>\r\n			<div class="show_members textwrap">\r\n				<div class="sub-title textwrap"><%- sub_title %></div><div class="eye off razericons-eye"></div>\r\n			</div>\r\n		</div>\r\n		<div class="more ricon infosettings"><span class="razericons-menu_options hvalign"></span></div>\r\n		<div class="add-member-button group ricon"><div class="razericons-user_add hvalign"></div></div>\r\n		<div class="call-icon ricon"><div class="razericons-call hvalign"></div></div>\r\n		<div class="setting_options group menulist">\r\n			<ul>\r\n				<li class="leave-group">Leave Group</li>\r\n				<li class="clear-history group">Clear History</li>\r\n				<li class="divider group"></li>\r\n				<li class="delete-group group">Delete Group</li>\r\n			</ul>\r\n		</div>\r\n</div>\r\n'}),define("text!templates/mainheaderviewuser.html",[],function(){return'<!--<div class="title">Nick YvonneK</div>-->\r\n<div class="container">\r\n		<img class="avatar round" src="<%- avatar %>">				\r\n		<div class="presence <%- sub_title %>"></div>				\r\n		<div class="nav"><div class="back"></div></div>\r\n		<div class="left" style="padding-left:5px">\r\n			<div class="title textwrap"><%= title_emoji %></div>\r\n			<div class="sub-title" style="padding-top:4px"><%- sub_title %></div>\r\n		</div>\r\n		<div class="more ricon infosettings"><span class="razericons-menu_options hvalign"></span></div>\r\n\r\n<!-- 	<div class="slider_con"><div class="volume-control"></div></div>\r\n		<div class="add-icon ricon"><div class="razericons-user_add hvalign ficon"></div></div>\r\n		<div class="sound-icon ricon"><div class="razericons-sound_medium hvalign ficon"></div></div>\r\n		<div class="mic-icon ricon"><div class="razericons-mic hvalign ficon"></div></div>-->\r\n		<div class="add-member-button user ricon"><div class="razericons-user_group_add hvalign"></div></div>\r\n		<div class="call-icon ricon"><div class="razericons-call hvalign ficon"></div></div>\r\n\r\n\r\n		<div class="setting_options menulist">\r\n			<ul>\r\n				<li class="view-profile">View Profile</li>\r\n				<li class="divider"></li>\r\n				<li class="add-favorite">Add to Favorites</li>\r\n				<li class="delete-favorite">Delete from favorites</li>\r\n				<li class="clear-history user">Clear History</li>\r\n				<li class="block-user">Block User</li>\r\n				<li class="divider"></li>\r\n				<li class="delete-friend">Delete Contact</li>\r\n			</ul>\r\n		</div>		\r\n</div>\r\n'}),define("text!templates/friendselector.html",[],function(){return'<div class="title">ADD MEMBERS TO A GROUP</div>\n\n<div class="search">\n    <span class="razericons-search searchicon"></span>\n    <input type="text" placeholder="SEARCH FOR THE PEOPLE TO ADD " class="inputfriendsearch" >\n	<span class="razericons-player_cancel clear"></span>\n</div>\n\n<div class="disable-select">\n	<div class="rc-loader-small" style="height:300px;"></div>\n</div>\n\n<div class="button-container">\n	<div class="rc-button rc-disabled-button add">ADD</div>\n</div>\n\n<div class=\'friendscontainer\'></div>\n<div class=\'search-result\'></div>\n<div class="selectioncontainer"></div>\n\n'}),define("text!templates/friendselectoritem.html",[],function(){return'<div class="presence round"></div>\n<img class="avatar round" src="<%- avatar %>">\n\n<div class="name vertical-align textwrap"><%= nick_emoji %></div>\n\n<input id="<%- id %>" type="checkbox">\n<label class="check-box" for="<%- id %>"></label>\n'}),define("views/addmember/friendselectoritem",["backbone","text!templates/friendselectoritem.html","rcemoji/rcemoji"],function(e,t,n){var r=e.View.extend({tagName:"div",className:"friend-item",options:{showCheckbox:!1,onCheckboxChanged:undefined,showPresence:!1},events:{'change input[type="checkbox"]':"onCheckboxChanged"},initialize:function(e){this.template=_.template(t),this.options=_.extend(this.options,e)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.options.showCheckbox?this.$("label.check-box").css("display","block"):this.$("label.check-box").css("display","none"),this.options.showPresence&&(this.$(".presence").addClass(this.model.get("presence")),this.$(".presence").css("display","block")),this.model.get("pre_selected")&&this.$('input[type="checkbox"]').prop("checked",!0),this},onCheckboxChanged:function(){var e=this.$('input[type="checkbox"]').attr("id"),t=this.$('input[type="checkbox"]').is(":checked");console.debug("user_id: "+e+" is_checked: "+t),typeof this.options.onCheckboxChanged!="undefined"&&this.options.onCheckboxChanged(this.model,t)}});return r}),define("text!templates/selectedfrienditem.html",[],function(){return'<div tabindex="1" class="selecteditem"><%- nick %></div>'}),define("views/addmember/friendselecteditem",["backbone","text!templates/selectedfrienditem.html"],function(e,t){var n=e.View.extend({className:"selected-friend-item",options:{},events:{click:"onItemClicked",keyup:"onItemKeyDown"},initialize:function(e){this.template=_.template(t),this.options=_.extend(this.options,e)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},onItemClicked:function(){this.$el.hasClass("selected")?this.$el.removeClass("selected"):this.$el.addClass("selected"),this.options.onDeleteItem&&this.options.onDeleteItem(this.model.get("id")),this.$el.focus()},onItemKeyDown:function(e){(e.keyCode==46||e.keyCode==8)&&this.options.removeselectedFriends&&this.options.removeselectedFriends()}});return n}),define("views/addmember/friendselector",["backbone","text!templates/friendselector.html","views/addmember/friendselectoritem","collections/friendcollection","jqueryhighlight","models/friendmodel","views/addmember/friendselecteditem"],function(e,t,n,r,i,s,o){var u=e.View.extend({tagname:"div",className:"friend-selecor-view",options:{baseUrl:"",url:"",grpurl:"",showCheckbox:!0,showButton:!1,buttonText:"OK",showCloseStream:!1,onButtonClicked:undefined,onGroupButtonClicked:undefined,showPresence:!1,preSelected:[],showOffline:!1,friendCollection:null,niceScrollOptions:null},collection:{},selectedFriends:[],removeFriends:[],events:{"click .button-container .invitefriend":"_onButtonClicked","keyup  .inputfriendsearch":"onInputFriendKeypress","click .button-container .cancel":"onCancelClicked","keyup .selectioncontainer":"onKeyUpSelectionContainer","click .clear":"onClearResults"},initialize:function(e){_.bindAll(this,"render","_onFriendList","checkPreSelected","onFriendCheckboxChanged","onDeleteSelectedItem","addOne","removeselectedFriends"),this.template=_.template(t),this.options.preSelected=[],this.options=_.extend(this.options,e),this.selectedFriends=[],this.removeFriends=[],this.collection=this.options.friendCollection},render:function(){console.log("render friends.js"),this.$el.html(this.template()),this.options.showButton?(this.$(".button-container").show(),this.$(".button-container .add.rc-button").text(this.options.buttonText),this.$(".button-container .add.rc-button").addClass("invitefriend")):this.$(".button-container").hide();var e=this;return this.collection.length>0&&(this.checkPreSelected(this.collection),this.collection.sort(),this.collection.each(function(t){e.addOne(t)})),this.options.niceScrollOptions&&setTimeout(function(){e.$(".friendscontainer").niceScroll(_.extend({},e.options.niceScrollOptions)),e.$(".search-result").niceScroll(_.extend({},e.options.niceScrollOptions)),e.$(".selectioncontainer").niceScroll(_.extend({},e.options.niceScrollOptions))},100),this},addOne:function(e){if(this.options.showPresence&&!this.options.showOffline&&e.get("presence")==="offline")return;var t=new n({model:e,showCheckbox:this.options.showCheckbox,onCheckboxChanged:this.onFriendCheckboxChanged,showPresence:this.options.showPresence});this.$(".friendscontainer").append(t.render().el);var r=this.selectedFriends.indexOf(e.get("id"));r>-1&&t.$('input[type="checkbox"]').prop("checked",!0)},_onFriendList:function(e){console.debug("_onFriendList: length: "+e.data.length);for(var t=0;t<e.data.length;++t){var n=new s(e.data[t]);this.collection.add(n)}this.render()},checkPreSelected:function(e){var t=this;console.debug("Pre selected"),console.debug(this.options.preSelected),e.each(function(e){this.options.preSelected.indexOf(e.get("id"))>-1&&(e.set("pre_selected",!0),this.selectedFriends.push(e.get("id")))},this),this.options.preSelected.length>0&&this.$(".rc-button").removeClass("rc-disabled-button")},showProgress:function(){this.$(".rc-loader-small").css("display","block")},hideProgress:function(){this.$(".rc-loader-small").hide()},onFriendCheckboxChanged:function(e,t){console.debug("onFriendCheckboxChanged: is_checked"+t);if(t)this.selectedFriends.push(e.get("id"));else{var n=this.selectedFriends.indexOf(e.get("id"));n>-1&&this.selectedFriends.splice(n,1)}this.selectedFriends=_.uniq(this.selectedFriends,!1),console.debug("selectedFriends"),console.debug(this.selectedFriends),this.renderSelectionContainer(),this.selectedFriends.length>0?this.$(".rc-button").removeClass("rc-disabled-button"):this.$(".rc-button").hasClass("rc-disabled-button")||this.$(".rc-button").addClass("rc-disabled-button")},_onButtonClicked:function(){console.debug("_onButtonClicked"),console.debug(this.selectedFriends),this.options.onButtonClicked&&this.options.onButtonClicked(this.selectedFriends)},onInputFriendKeypress:function(e){var t=this.$(".inputfriendsearch").val();if(t===""){this.onClearResults();return}this.$(".clear").show();var n=_.filter(this.collection.models,function(e){var n=e.get("nick");return n.toLowerCase().indexOf(t.toLowerCase())!=-1?!0:!1});this.$(".friendscontainer").hide(),this.$(".friendscontainer").empty(),this.$(".search-result").empty(),_.each(n,this.addOneResult,this),this.$(".search-result").show(),this.$(".search-result").highlight(t)},onClearResults:function(){this.$(".search-result").empty(),this.$(".search-result").hide(),this.renderFriendsContainer(),this.$(".friendscontainer").show(),this.$(".clear").hide(),this.$(".inputfriendsearch").val("")},addOneResult:function(e){var t=new n({model:e,showCheckbox:this.options.showCheckbox,onCheckboxChanged:this.onFriendCheckboxChanged});this.$(".search-result").append(t.render().el);var r=this.selectedFriends.indexOf(e.get("id"));r>-1&&t.$('input[type="checkbox"]').prop("checked",!0)},onCancelClicked:function(){this.options.onCancelClicked&&this.options.onCancelClicked()},renderFriendsContainer:function(){this.$(".friendscontainer").empty(),this.collection.each(this.addOne,this)},renderSelectionContainer:function(){this.$(".selectioncontainer").empty();for(var e=0;e<this.selectedFriends.length;e++){var t=this.collection.get(this.selectedFriends[e]),n=new o({model:t,onDeleteItem:this.onDeleteSelectedItem,removeselectedFriends:this.removeselectedFriends});this.$(".selectioncontainer").append(n.render().el)}},onKeyUpSelectionContainer:function(e){(e.keyCode==46||e.keyCode==8)&&this.removeselectedFriends()},onDeleteSelectedItem:function(e){var t=this.removeFriends.indexOf(e);t>-1?this.removeFriends.splice(t,1):this.removeFriends.push(e)},removeselectedFriends:function(){this.$(".selectioncontainer .selected-friend-item.selected").remove();if(this.removeFriends.length>0){for(var e=0;e<this.removeFriends.length;e++){var t=this.selectedFriends.indexOf(this.removeFriends[e]);t>-1&&this.selectedFriends.splice(t,1)}this.renderFriendsContainer(),this.removeFriends=[]}}});return u}),define("text!templates/memberlistview.html",[],function(){return'<div class="participants">\n	<div class="adminlist">\n		<div class="label admin">Admin:</div>\n	</div>\n	<div class="memberlist">\n		<div class="label members">Members:</div>\n	</div>\n\n	<div class="loader"></div>\n</div>\n'}),define("models/membermodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",i=t.Model.extend({defaults:{id:"",avatar:"",comms_id:"",nickname:"",presence:"",voice_enabled:!1},initialize:function(){this.get("avatar")===""&&this.set("avatar","https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png"),this._setEmojiName(),this.on("change:nickname",this._setEmojiName),this.changeAvatar(),this.on("change:avatar",this.changeAvatar)},_setEmojiName:function(){this.set("nickname_emoji",n.parse(this.escape("nickname")))},changeAvatar:function(){if(this.get("avatar")!==""&&this.get("avatar")!==r){var e=this.get("avatar").split("/"),t=e[e.length-1],n="https://dbq9ithrljsz0.cloudfront.net/"+t;this.set("avatar",n)}else this.set("avatar",r)}});return i}),define("collections/membercollection",["underscore","backbone","models/membermodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){var n=e.get("nickname").toLowerCase(),r=t.get("nickname").toLowerCase();return e.get("voice_enabled")===t.get("voice_enabled")&&e.get("voice_enabled")===!0?n>r?1:n<r?-1:0:e.get("voice_enabled")===!0?-1:t.get("voice_enabled")===!0?1:e.get("presence")===t.get("presence")?n>r?1:n<r?-1:0:e.get("presence")==="offline"?1:t.get("presence")==="offline"?-1:n>r?1:n<r?-1:0}});return r}),define("text!templates/memberlistitemview.html",[],function(){return'\n\n<div class="title textwrap"><%= nickname_emoji %></div>\n<div class="mic round"> <span class="razericons-mic micicon"></span></div>'}),define("text!templates/menuview.html",[],function(){return'<div class="menu friend">\r\n	<ul>\r\n		<li class="message">Message</li>\r\n		<li class="divider"></li>\r\n		<li class="call">Call</li>\r\n	</ul>\r\n</div>\r\n\r\n<div class="menu non-friend">\r\n	<ul>\r\n		<li class="addfriend">Add Friend</li>							\r\n	</ul>\r\n</div>'}),define("views/memberlist/menuview",["jquery","underscore","backbone","text!templates/menuview.html","views/callui/callhandler"],function(e,t,n,r,i){var s=n.View.extend({className:"menu-view",events:{"click .message":"_onMessageClicked","click .call":"_onCallClicked","click .addfriend":"_onAddFriendClicked"},menushown:!1,initialize:function(e){t.bindAll(this,"close","showMenuOptions","hideMenuOptions","autoHideMenuOptions"),this.options=e,this.template=t.template(r)},render:function(){this.$el.html(this.template()),this.options.parentView.$el.append(this.$el)},autoHideMenuOptions:function(t){var n=this;!e(t.target).closest(".menu-view").length&&!e(t.target).closest(".more").length&&e(".menu-view").is(":visible")&&n.hideMenuOptions()},close:function(){var t=this;e(document).unbind("click",t.autoHideMenuOptions)},toggleMenu:function(){this.menushown?this.options.parentView.$el.find(".menu-view").is(":visible")?this.hideMenuOptions():this.showMenuOptions():this.showMenuOptions()},showMenuOptions:function(){var t=this,n=this.options.sharedObjects.friendCollection.get(this.model.get("id"));e(".menu-view").hide(),this.render(),this.$el.show(),n!==undefined?(this.$(".menu.friend").show(),this.$(".menu.friend").addClass("visible")):(this.$(".menu.non-friend").show(),this.$(".menu.non-friend").addClass("visible")),this.$(".menu.visible").velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){t.menushown=!0,e(document).bind("click",t.autoHideMenuOptions)}})},hideMenuOptions:function(){var e=this;this.$(".menu.visible").velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){e.menushown=!1,e.close()}})},_onCallClicked:function(){var e=this.options;e.chat_id=this.model.get("id");var t=new i(e);t._showCallViewNew()},_onMessageClicked:function(){var e="activity/"+encodeURIComponent(this.model.get("id"));this.options.sharedObjects.router.navigate(e,{trigger:!0})},_onAddFriendClicked:function(){this.options.sharedObjects.comms.Friends.add({user_id:this.model.get("id")}),this.hideMenuOptions()}});return s}),define("views/memberlist/memberlistitemview",["jquery","underscore","backbone","text!templates/memberlistitemview.html","views/profile/viewprofile","views/memberlist/menuview"],function(e,t,n,r,i,s){var o=n.View.extend({className:"member-list-item-view",events:{click:"_onViewProfileClicked"},router:null,menuView:null,initialize:function(e){t.bindAll(this,"close","_onViewProfileClicked"),this.options=e,this.template=t.template(r),this.comms=this.options.sharedObjects.comms,this.model.on("change",this.render,this),this.comms.on("memberPresence",this._onMemberPresence,this),this.model.on("change:removed",this.close)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.removeClass("online busy away dnd offline invisible"),this.$el.addClass(this.model.get("presence")),this.model.get("voice_enabled")===!0&&(this.$(".mic").show(),this.$(".title").css("padding-right","21px")),this},close:function(){this.remove(),this.unbind(),this.model.off(null,null,this),this.comms.off(null,null,this)},_onViewProfileClicked:function(){var e=t.extend({user_id:this.model.get("id")},this.options);viewProfileView=new i(e),viewProfileView.popup()},_onMenuClicked:function(){e(".member-list-item-view").css("z-index","1"),this.$el.css("z-index","50"),this.menuView.toggleMenu()},_onMemberPresence:function(e){e.user_id===this.model.get("id")&&(this.model.set("presence",e.presence),this.model.set("voice_enabled",e.voice_enabled))}});return o}),define("views/memberlist/memberlistview",["jquery","underscore","backbone","text!templates/memberlistview.html","models/membermodel","collections/membercollection","views/memberlist/memberlistitemview","nicescroll","velocity-ui"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({tagName:"div",className:"member-list-view",events:{},collection:null,interval:null,niceScrolls:[],initialize:function(e){t.bindAll(this,"render","close","_onMemberList","clearNiceScrolls"),this.options=e,this.template=t.template(r),this.collection=new s,this.options.sharedObjects.comms.Groups.getMembers({group_id:this.options.chat_id,success:this._onMemberList}),this.niceScrolls=[]},render:function(){this.$el.html(this.template());if(!this.options.autoOpen){this.options.members&&this._onMemberList(this.options.members);var e=this;setTimeout(function(){e._showList()},0)}return this},close:function(){clearInterval(this.interval),this.remove(),this.unbind();for(var e=0;e<this.niceScrolls.length;e++)this.niceScrolls[e].remove();this.niceScrolls=[],this.collection.each(function(e){e.set("removed",!0)})},_onItemClick:function(){},_onMemberList:function(e){this.clearNiceScrolls(),this.collection.each(function(e){e.set("removed",!0)}),this.collection.reset();for(var n=0;n<e.data.length;++n){var r=new i(e.data[n]);this.collection.add(r)}var s=this;if(this.collection.length>0){this.$(".loader").hide(),this.collection.each(function(e){var n=t.extend({model:e,is_last:!1},s.options),r=new o(n);e.get("id")===s.options.owner_id?(s.$(".adminlist").append(r.render().el),s.$(".adminlist").css("display","inline")):(s.$(".memberlist").append(r.render().el),s.$(".memberlist").css("display","inline"))});var u={cursorwidth:this.options.sharedObjects.niceScrollOptions.cursorwidth,cursorborderradius:this.options.sharedObjects.niceScrollOptions.cursorborderradius,zindex:3};this.$(".participants").niceScroll(t.extend({},u));var a=this.$(".participants").getNiceScroll();this.niceScrolls.push(a)}this.options.onMemberList&&this.options.onMemberList(e),this.options.autoOpen&&setTimeout(function(){s._showList()},0)},clearNiceScrolls:function(){for(var e=0;e<this.niceScrolls.length;e++)this.niceScrolls[e].remove();this.niceScrolls=[]},_showList:function(){console.debug("_showList");var e=this;this.$(".participants").velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){}})},_hideList:function(){console.debug("_hideList");var e=this;this.$(".participants").velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){e.close()}})}});return f}),define("text!templates/creategroup.html",[],function(){return'<div class="title"></div>\r\n\r\n<div class="search">\r\n    <span class="razericons-search searchicon"></span>\r\n    <input type="text" placeholder="SEARCH FOR THE PEOPLE TO ADD " class="inputfriendsearch" >\r\n	<span class="razericons-player_cancel clear"></span>\r\n</div>\r\n\r\n<div class="disable-select">\r\n	<div class="rc-loader-small" style="height:300px;"></div>\r\n</div>\r\n\r\n<div class="button-container creategroup">\r\n	<input type="text" placeholder="*NAME YOUR GROUP" name="groupname" class="groupname">\r\n	<div class="rc-button rc-disabled-button create">CREATE</div>\r\n</div>\r\n\r\n<div class=\'friendscontainer\'></div>\r\n<div class=\'search-result\'></div>\r\n<div class="selectioncontainer"></div>\r\n\r\n'}),define("views/creategroup/friendselectoritem",["backbone","text!templates/friendselectoritem.html","rcemoji/rcemoji"],function(e,t,n){var r=e.View.extend({tagName:"div",className:"friend-item",options:{showCheckbox:!1,onCheckboxChanged:undefined,showPresence:!1},events:{'change input[type="checkbox"]':"onCheckboxChanged"},initialize:function(e){this.template=_.template(t),this.options=_.extend(this.options,e)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.options.showCheckbox?this.$("label.check-box").css("display","block"):this.$("label.check-box").css("display","none"),this.options.showPresence&&(this.$(".presence").addClass(this.model.get("presence")),this.$(".presence").css("display","block")),this.model.get("pre_selected")&&this.$('input[type="checkbox"]').prop("checked",!0),this},onCheckboxChanged:function(){var e=this.$('input[type="checkbox"]').attr("id"),t=this.$('input[type="checkbox"]').is(":checked");console.debug("user_id: "+e+" is_checked: "+t),typeof this.options.onCheckboxChanged!="undefined"&&this.options.onCheckboxChanged(this.model,t)}});return r}),define("views/creategroup/friendselecteditem",["backbone","text!templates/selectedfrienditem.html"],function(e,t){var n=e.View.extend({className:"selected-friend-item",options:{},events:{click:"onItemClicked",keyup:"onItemKeyDown"},initialize:function(e){this.template=_.template(t),this.options=_.extend(this.options,e)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.options.friend_mandatory&&this.model.get("id")===this.options.friend_mandatory&&this.$el.css("pointer-events","none"),this},onItemClicked:function(){this.$el.hasClass("selected")?this.$el.removeClass("selected"):this.$el.addClass("selected"),this.options.onDeleteItem&&this.options.onDeleteItem(this.model.get("id")),this.$el.focus()},onItemKeyDown:function(e){(e.keyCode==46||e.keyCode==8)&&this.options.removeselectedFriends&&this.options.removeselectedFriends()}});return n}),define("views/creategroup/friendselector",["backbone","text!templates/creategroup.html","views/creategroup/friendselectoritem","collections/friendcollection","jqueryhighlight","models/friendmodel","views/creategroup/friendselecteditem"],function(e,t,n,r,i,s,o){var u=e.View.extend({tagname:"div",className:"friend-selecor-view",options:{baseUrl:"",url:"",grpurl:"",showCheckbox:!0,showButton:!1,buttonText:"OK",showCloseStream:!1,onButtonClicked:undefined,onGroupButtonClicked:undefined,showPresence:!1,preSelected:[],showOffline:!1,friendCollection:null,niceScrollOptions:null},collection:{},selectedFriends:[],removeFriends:[],events:{"click .button-container .invitefriend":"_onButtonClicked","keyup  .inputfriendsearch":"onInputFriendKeypress","click .button-container .cancel":"onCancelClicked","keyup .selectioncontainer":"onKeyUpSelectionContainer","click .clear":"onClearResults","click .button-container .create":"_onButtonClicked","input .groupname":"_onInputKeypressGroupname"},initialize:function(e){_.bindAll(this,"render","_onFriendList","checkPreSelected","onFriendCheckboxChanged","onDeleteSelectedItem","addOne","removeselectedFriends"),this.template=_.template(t),this.options.preSelected=[],this.options=_.extend(this.options,e),this.selectedFriends=[],this.removeFriends=[],this.collection=this.options.friendCollection},render:function(){this.$el.html(this.template()),this.options.showButton?this.$(".button-container").show():this.$(".button-container").hide(),this.$(".title").text(this.options.title),this.$("button-container.creategroup").show();var e=this;return this.collection.length>0&&(this.checkPreSelected(this.collection),this.collection.sort(),this.collection.each(function(t){e.addOne(t)})),this.options.niceScrollOptions&&setTimeout(function(){e.$(".friendscontainer").niceScroll(_.extend({},e.options.niceScrollOptions)),e.$(".search-result").niceScroll(_.extend({},e.options.niceScrollOptions)),e.$(".selectioncontainer").niceScroll(_.extend({},e.options.niceScrollOptions))},100),this},addOne:function(e){if(this.options.showPresence&&!this.options.showOffline&&e.get("presence")==="offline")return;var t=new n({model:e,showCheckbox:this.options.showCheckbox,onCheckboxChanged:this.onFriendCheckboxChanged,showPresence:this.options.showPresence});this.options.preSelected&&this.options.preSelected.length>0?this.options.preSelected.indexOf(e.get("id"))>-1?(this.$(".friendscontainer").prepend(t.render().el),t.$('input[type="checkbox"]').prop("disabled",!0)):this.$(".friendscontainer").append(t.render().el):this.$(".friendscontainer").append(t.render().el);var r=this.selectedFriends.indexOf(e.get("id"));r>-1&&t.$('input[type="checkbox"]').prop("checked",!0)},_onFriendList:function(e){console.debug("_onFriendList: length: "+e.data.length);for(var t=0;t<e.data.length;++t){var n=new s(e.data[t]);this.collection.add(n)}this.render()},checkPreSelected:function(e){var t=this;e.each(function(e){this.options.preSelected.indexOf(e.get("id"))>-1&&this.selectedFriends.push(e.get("id"))},this);var n=this.$(".groupname").val();this.options.preSelected.length>0&&n.length>0&&this.$(".rc-button").removeClass("rc-disabled-button"),this.options.preSelected&&this.options.preSelected.length>0&&this.renderSelectionContainer()},showProgress:function(){this.$(".rc-loader-small").css("display","block")},hideProgress:function(){this.$(".rc-loader-small").hide()},close:function(){this.remove(),this.unbind()},onFriendCheckboxChanged:function(e,t){console.debug("onFriendCheckboxChanged: is_checked"+t);if(t)this.selectedFriends.push(e.get("id"));else{var n=this.selectedFriends.indexOf(e.get("id"));n>-1&&this.selectedFriends.splice(n,1)}this.selectedFriends=_.uniq(this.selectedFriends,!1),console.debug("selectedFriends"),console.debug(this.selectedFriends),this.renderSelectionContainer();var r=this.$(".groupname").val();this.selectedFriends.length>0&&r.length>0?this.$(".rc-button").removeClass("rc-disabled-button"):this.$(".rc-button").hasClass("rc-disabled-button")||this.$(".rc-button").addClass("rc-disabled-button")},_onButtonClicked:function(){console.debug("_onButtonClicked"),console.debug(this.selectedFriends);var e=this.$(".groupname").val();this.options.onButtonClicked&&this.options.onButtonClicked(e,this.selectedFriends)},onInputFriendKeypress:function(e){var t=this.$(".inputfriendsearch").val();if(t===""){this.onClearResults();return}this.$(".clear").show();var n=_.filter(this.collection.models,function(e){var n=e.get("nick");return n.toLowerCase().indexOf(t.toLowerCase())!=-1?!0:!1});this.$(".friendscontainer").hide(),this.$(".friendscontainer").empty(),this.$(".search-result").empty(),_.each(n,this.addOneResult,this),this.$(".search-result").show(),this.$(".search-result").highlight(t)},onClearResults:function(){this.$(".search-result").empty(),this.$(".search-result").hide(),this.renderFriendsContainer(),this.$(".friendscontainer").show(),this.$(".clear").hide(),this.$(".inputfriendsearch").val("")},addOneResult:function(e){var t=new n({model:e,showCheckbox:this.options.showCheckbox,onCheckboxChanged:this.onFriendCheckboxChanged});this.$(".search-result").append(t.render().el);var r=this.selectedFriends.indexOf(e.get("id"));r>-1&&t.$('input[type="checkbox"]').prop("checked",!0),this.options.preSelected&&this.options.preSelected.length>0&&this.options.preSelected.indexOf(e.get("id"))>-1&&t.$('input[type="checkbox"]').prop("disabled",!0)},onCancelClicked:function(){this.options.onCancelClicked&&this.options.onCancelClicked()},renderFriendsContainer:function(){this.$(".friendscontainer").empty(),this.collection.each(this.addOne,this)},renderSelectionContainer:function(){this.$(".selectioncontainer").empty();for(var e=0;e<this.selectedFriends.length;e++){var t=this.collection.get(this.selectedFriends[e]),n=new o({model:t,onDeleteItem:this.onDeleteSelectedItem,removeselectedFriends:this.removeselectedFriends,friend_mandatory:this.options.friend_mandatory});this.$(".selectioncontainer").append(n.render().el)}},onKeyUpSelectionContainer:function(e){(e.keyCode==46||e.keyCode==8)&&this.removeselectedFriends()},onDeleteSelectedItem:function(e){var t=this.removeFriends.indexOf(e);t>-1?this.removeFriends.splice(t,1):this.removeFriends.push(e)},removeselectedFriends:function(){this.$(".selectioncontainer .selected-friend-item.selected").remove();if(this.removeFriends.length>0){for(var e=0;e<this.removeFriends.length;e++){var t=this.selectedFriends.indexOf(this.removeFriends[e]);t>-1&&this.selectedFriends.splice(t,1)}this.renderFriendsContainer(),this.removeFriends=[]}},_onInputKeypressGroupname:function(e){var t=this.$('input[name="groupname"]').val();t.length>0&&this.selectedFriends.length>0?this.$(".rc-button").removeClass("rc-disabled-button"):this.$(".rc-button").addClass("rc-disabled-button")}});return u}),define("views/mainheaderview",["jquery","underscore","backbone","text!templates/mainheaderviewgroup.html","text!templates/mainheaderviewuser.html","velocity","models/usermodel","models/groupmodel","views/callui/callhandler","views/addmember/friendselector","w2ui","rcdialog","views/profile/viewprofile","views/memberlist/memberlistview","views/imagecropper/imagecropperview","views/creategroup/friendselector"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=640,g=n.View.extend({tagName:"div",className:"main-header-view",events:{"click .call-icon":"_startCall","click .nav.activity.active":"_navigateToActivity","click .nav.friends.active":"_navigateToFriends","click .nav.groups.active":"_navigateToGroups","click .add-member-button.group":"_onAddMemberClicked","click .add-member-button.user":"_onCreateGroupClicked","click .delete-friend":"_onDeleteContactClicked","click .leave-group":"_onLeaveGroupClicked","click .delete-group":"_onDeleteGroupClicked","click .group.owner .groupname":"_showEditGroupNameField","click .infosettings":"_onSettingsOptionsClicked","click .block-user":"_onBlockUserClicked","click .clear-history.user":"_onClearHistory","click .view-profile":"_onViewProfileClicked","click .group.owner .clear-history.group":"_onClearHistoryGroup","click .avatar.user":"_onViewProfileClicked","click .add-favorite":"_addToFavorites","click .delete-favorite":"_deleteFromFavorites","click .show_members":"_showParticipantsList","change .file-select-input":"_onFileSelectChanged"},shown:!1,group_chat:!1,userModel:null,groupModel:null,infosettingshown:!1,infoFetched:!1,owner_id:"",memberlist_shown:!1,memberListView:null,callHandler:null,memberList:null,myAudio:null,ringingStopped:!0,commsCommunity:null,friendsSelectorView:null,initialize:function(e){t.bindAll(this,"render","close","_onUserInfo","_onGroupInfo","_changeTitle","autoHideSettingOptions","autoHideMemberList","_onMemberList","_onFriendsSelected","subscribeToPresence","_fetchGroup","_onCallHandlerStartCall","_onCallHandlerEndCall","_updateGroupName","_onCreateButtonClicked"),this.options=e,this.userTemplate=t.template(i),this.groupTemplate=t.template(r),console.assert(typeof this.model!="undefined"),console.assert(this.options.comms),console.assert(this.options.sharedObjects),this.options.comms=this.options.sharedObjects.comms;if(this.options.comms.isGroupChat(this.model.get("chat_id"))){console.debug("group chat"),this.model.set("group_chat",!0),this.group_chat=!0,this.groupModel=new u({lobby_id:this.options.chat_id}),this._fetchGroup(),this.options.sharedObjects.comms.Groups.getMembers({group_id:this.options.chat_id,success:this._onMemberList});var n=this;this.options.comms.on("memberAdded."+this.model.get("chat_id"),this._fetchGroup,this),this.options.comms.on("memberPresence."+this.model.get("chat_id"),this._onMemberPresence,this)}else{console.debug("1-to-1 chat"),this.group_chat=!1;var n=this;this.userModel=new o({id:this.options.chat_id}),this.options.comms.getUser({user_id:this.model.get("chat_id"),server_cache:!0,success:this._onUserInfo}),this.options.comms.on("friendPresence",this.onFriendPresence,this)}this.infoFetched=!1,this.memberlist_shown=!1,this.memberList=null,this.myAudio=null,this.ringingStopped=!0,this.callHandler=this.options.sharedObjects.callHandler,this.callHandler.on("startCall",this._onCallHandlerStartCall,this),this.callHandler.on("endCall",this._onCallHandlerEndCall,this),this.commsCommunity=this.options.sharedObjects.commsCommunity,this.commsCommunity.CallHandler.on("startCall",this._onCallHandlerStartCall,this),this.commsCommunity.CallHandler.on("endCall",this._onCallHandlerEndCall,this)},render:function(){var e=this.options.sharedObjects.activeTab;e!==""&&(this.$(".nav").addClass("active"),this.$(".nav").addClass(e)),this.model.avatarToHttps(),this.model.get("group_chat")?(this.$el.html(this.groupTemplate(this.model.toJSON())),this.$(".container").addClass("group"),this.model.get("owner")===this.options.comms.user_id?(console.debug("current user is the owner"),this.$("li.group").show(),this.$(".container").addClass("owner"),this.$(".add-member-button").show()):(console.debug("current user is a member"),this.$(".leave-group").show(),this.$(".infosettings").css("right","74px")),this.model.get("sub_title")===" "?(this.$(".show_members .eye").hide(),this.$(".more").hide()):(this.$(".show_members .sub-title").hide(),this.$(".show_members .sub-title").fadeIn(),this.$(".show_members .eye").hide(),this.$(".show_members .eye").fadeIn(),this.$(".more").hide(),this.$(".more").fadeIn())):(this.$el.html(this.userTemplate(this.model.toJSON())),this.model.get("is_favorite")?this.$(".delete-favorite").show():this.$(".add-favorite").show(),this.$(".add-member-button.user").show());if(this.options.sharedObjects.callHandler.voiceConnection||this.options.sharedObjects.commsCommunity.CallHandler.isCallActive())this.$(".call-icon").addClass("disabled"),this.$(".razericons-call").addClass("disabled");return this._addTooltip(this.$(".call-icon"),"Start Call"),this._addTooltip(this.$(".add-member-button"),"Add Contact"),this.options.sharedObjects.is_webrtc_supported||(console.debug("dont have webrtc support"),this.$(".call-icon").hide(),this.$(".add-member-button").css("right","21px"),this.$(".more").css("right","74px"),this.model.get("group_chat")&&this.model.get("owner")!==this.options.comms.user_id&&this.$(".infosettings").css("right","21px")),this},close:function(){console.debug("close"),this.groupModel&&this.options.comms.Groups.unsubscribeToPresence({lobby_id:this.groupModel.get("lobby_id"),success:function(){console.debug("close: unsubscribed to group presence")}}),this.options.comms.off(null,null,this),this.callHandler.off(null,null,this),this.commsCommunity.CallHandler.off(null,null,this),this.remove(),this.unbind()},_onUserInfo:function(e){this.infoFetched=!0,this.userModel.set(e),this.model.set(e),console.debug("user info: "+JSON.stringify(e)),this.model.set("title",e.nickname),this.model.set("sub_title",e.presence),this.model.set("group_chat",!1),e.avatar===""&&this.model.set("avatar","https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png"),this.render()},_onGroupInfo:function(e){this.infoFetched=!0,this.groupchat=!0;if(e.type==="Channel"&&e.group)this.model.set(e.group),this.model.set("title",e.group.name),this.groupModel.set(e.group),e.group.icon===""&&(this.model.set("icon","assets/images/Grp_def.svg"),this.model.set("avatar","assets/images/Grp_def.svg"));else{this.model.set(e),this.groupModel.set(e),e.icon===""&&(this.model.set("icon","assets/images/Grp_def.svg"),this.model.set("avatar","assets/images/Grp_def.svg"));var t=e.members.length;this.model.set("members",t)}this.model.set("avatar",this.model.get("icon")),typeof e.online_count!="undefined"?this.model.set("sub_title",e.members+" Members, "+e.online_count+" Online"):this.model.set("sub_title",e.members+" Members"),this.model.set("group_chat",!0),this.render(),this.owner_id=e.owner,this.subscribeToPresence()},_showCallViewNew:function(){console.debug("_showCallViewNew: chat_id: "+this.model.get("chat_id")),console.debug("this.options"),console.debug(this.options);var e=t.extend({chat_id:this.model.get("chat_id")},this.options),n=new a(e);n._showCallViewNew()},_navigateToActivity:function(){this.options.sharedObjects.router.navigate("activity",{trigger:!0}),this.showHide()},_navigateToFriends:function(){this.options.sharedObjects.router.navigate("friends",{trigger:!0}),this.showHide()},_navigateToGroups:function(){this.options.sharedObjects.router.navigate("groups",{trigger:!0}),this.showHide()},showHide:function(){e(".main-view").width()<=m&&(e(".left-section-view").show(),e(".main-content-section-view").hide())},_changeTitle:function(e){this.model.set("title",e),this.render()},_infoViewOpened:function(){this.$(".info-icon").addClass("active")},_infoViewClosed:function(){this.$(".info-icon").removeClass("active")},_onSettingsOptionsClicked:function(){var e=this;this.infosettingshown?this.hideSettingOptions():this.showSettingOptions()},showSettingOptions:function(){var t=this,n=this.$(".infosettings"),r=this.$(".setting_options"),i=n.parent().position(),s=n.position().left-i.left+n.width()-r.width();r.css("left",s),r.velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){t.infosettingshown=!0,e(document).bind("click",t.autoHideSettingOptions)}})},hideSettingOptions:function(){var t=this;this.$(".setting_options").velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){t.infosettingshown=!1,e(document).unbind("click",t.autoHideSettingOptions)}})},autoHideSettingOptions:function(){var e=this;this.infosettingshown&&e.hideSettingOptions()},_onAddMemberClicked:function(){console.debug("_onAddMemberClicked");var n=this.options.sharedObjects.friendCollection.clone();this.memberList&&t.each(this.memberList.data,function(e){n.remove(e.id)});var r=634,i=e(".main-view").height()-100;r>i&&(r=i);var s=this;l.open({width:535,height:r,body:'<div class="friends-container"></div>',showMax:!1,modal:!1,opacity:.9,showClose:!1,onOpen:function(t){t.onComplete=function(){var t={showCheckbox:!0,showButton:!0,buttonText:"ADD",onButtonClicked:s._onFriendsSelected,onCancelClicked:s.onCancelClicked,showPresence:!0,showOffline:!0,friendCollection:n,niceScrollOptions:s.options.sharedObjects.niceScrollOptions},r=new f(t);e(".w2ui-popup .friends-container").append(r.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){l.close()})}},onClose:function(e){}})},_onFriendsSelected:function(e){console.debug("_onFriendsSelected"),console.debug(e);var n=this;t.each(e,function(e){console.debug("inviting: "+e+" to: "+JSON.stringify(n.groupModel.toJSON())),(n.groupModel.get("type")==="Private"||n.groupModel.get("type")==="Public")&&n.options.comms.Groups.addMember({user_id:e,group_id:n.groupModel.get("id"),lobby_id:n.groupModel.get("lobby_id")})}),l.close()},onCancelClicked:function(){l.close()},_onViewProfileClicked:function(){var e=t.extend({user_id:this.userModel.get("id")},this.options);viewProfileView=new h(e),viewProfileView.popup()},_addToFavorites:function(){console.debug("add to favorites");var e=this;this.options.comms.Friends.setFavorite({user_id:e.userModel.get("id"),success:function(t){e.hideSettingOptions(),e.$(".delete-favorite").show(),e.$(".add-favorite").hide()}})},_deleteFromFavorites:function(){console.debug("delete from favorites");var e=this;this.options.comms.Friends.unsetFavorite({user_id:e.userModel.get("id"),success:function(t){e.hideSettingOptions(),e.$(".delete-favorite").hide(),e.$(".add-favorite").show()}})},_onClearHistory:function(){console.debug("_onClearHistory: ");var e=this,t='Are you sure you want to delete chat history with your contact: <br/> <span class="data">'+this.userModel.get("nickname")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">CLEAR HISTORY</div>',function(t){console.debug("answer: "+t),t==="Yes"&&e.options.sharedObjects.comms.ChatHistory.deleteMessages({chat_id:e.userModel.get("id"),success:function(t){e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0})}})},"CLEAR","CANCEL","razericons-alerts")},_onBlockUserClicked:function(){console.debug("_onBlockUserClicked: "+JSON.stringify(this.userModel.toJSON()));var e=this,t='Are you sure you want to block: <br/> <span class="data">'+this.userModel.get("nickname")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">BLOCK USER</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(e.options.comms.Friends.block({user_id:e.userModel.get("id"),success:function(){console.debug("block user success")}}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"BLOCK","CANCEL","razericons-alerts")},_onDeleteContactClicked:function(){console.debug("_onDeleteContactClicked: "+JSON.stringify(this.userModel.toJSON()));var e=this,t='Are you sure you want to delete this user from your contacts: <br/> <span class="data">'+this.userModel.get("nickname")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">DELETE CONTACT</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(console.info("removing "+e.userModel.get("id")),e.options.sharedObjects.comms.Friends.remove({user_id:e.userModel.get("id")}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"DELETE","CANCEL","razericons-alerts")},_onLeaveGroupClicked:function(){var e=this,t='Are you sure you want to leave this group: <br/> <span class="data">'+this.groupModel.get("name")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">LEAVE GROUP</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(console.info("leaving group "+e.groupModel.get("id")),e.options.sharedObjects.comms.Groups.leave({id:e.groupModel.get("id")}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"LEAVE","CANCEL","razericons-alerts")},_onDeleteGroupClicked:function(){var e=this,t='Are you sure you want to delete this group:<br/> <span class="data">'+this.groupModel.get("name")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">DELETE GROUP</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(console.info("_onDeleteGroupClicked: deleting group"),e.options.sharedObjects.comms.Groups.destroy({id:e.groupModel.get("id")}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"DELETE","CANCEL","razericons-alerts")},_onClearHistoryGroup:function(){console.debug("_onClearHistory group: ");var e=this,t='Are you sure you want to delete chat history of this group: <br/> <span class="data">'+this.groupModel.get("name")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">CLEAR HISTORY</div>',function(t){console.debug("answer: "+t),t==="Yes"&&e.options.sharedObjects.comms.ChatHistory.deleteMessages({chat_id:e.groupModel.get("lobby_id"),success:function(e){}})},"CLEAR","CANCEL","razericons-alerts")},_showEditGroupNameField:function(){var t=this.$(".groupname .name").text(),n=this.$(".groupname").width();this.$(".groupname").hide(),this.$('input[name="renamegroup"]').css("width",n),this.$('input[name="renamegroup"]').val(t),this.$('input[name="renamegroup"]').show(),this.$('input[name="renamegroup"]').focus(),e(document).bind("click",this._updateGroupName)},_updateGroupName:function(t){if(!e(t.target).closest(".groupname").length&&!e(t.target).closest(".renamegroup").length){var n=this.$(".groupname .name").text(),r=this.$('input[name="renamegroup"]').val();if(r!==undefined)if(r!==n){this.$('input[name="renamegroup"]').hide(),this.$(".groupname").show();if(r!==""&&r.length>=3&&r.length<=25){this.$(".groupname .name").text(r);var i=this;this.options.comms.Groups.update({id:i.groupModel.get("id"),name:r,success:function(t){console.debug(t),e(document).unbind("click",i._updateGroupName)}})}}else this.$('input[name="renamegroup"]').is(":visible")&&(this.$('input[name="renamegroup"]').hide(),this.$(".groupname").show())}},_showParticipantsList:function(){this.memberListView?this.hideMemberList():this.showMemberList(!1)},showMemberList:function(t){var n=this;this.memberListView=new p({chat_id:n.options.chat_id,sharedObjects:n.options.sharedObjects,owner_id:n.owner_id,members:n.memberList,onMemberList:function(e){n.memberList=e},autoOpen:t}),n.$el.append(this.memberListView.render().el),e(document).bind("click",n.autoHideMemberList),this.$(".eye").removeClass("off").addClass("on")},hideMemberList:function(){this.memberListView._hideList(),this.memberListView=null,e(document).unbind("click",self.autoHideMemberList),this.$(".eye").removeClass("on").addClass("off")},autoHideMemberList:function(t){var n=this;!e(t.target).closest(".show_members").length&&!e(t.target).closest(".member-list-view").length},_onMemberList:function(e){console.debug("onmemberlist"),console.debug(e),this.memberList=e},subscribeToPresence:function(){if(this.groupModel){var e=this;this.options.sharedObjects.comms.Groups.subscribeToPresence({lobby_id:e.groupModel.get("lobby_id"),success:function(){console.log("subscribe to group presence success")}})}},_fetchGroup:function(){console.debug("_fetchGroup"),this.options.comms.Groups.getInfo({id:this.model.get("chat_id"),success:this._onGroupInfo})},_startCall:function(){console.debug("startCall: model: "+JSON.stringify(this.model.toJSON()));if(this.callHandler.voiceConnection||this.callHandler.sessionId){console.info("_startCall: already have ongoing call");return}if(this.group_chat){var e={chat_id:this.model.get("chat_id"),adhoc:!1};this.callHandler.makeCall(e)}else{var e={chat_id:this.model.get("chat_id"),adhoc:!0,create_session:!0,send_invite:!0};this.callHandler.makeCall(e)}},_onCallHandlerStartCall:function(){console.debug("_onCallHandlerStartCall"),this.$(".call-icon").addClass("disabled"),this.$(".razericons-call").addClass("disabled")},_onCallHandlerEndCall:function(){console.debug("_onCallHandlerEndCall"),this.$(".call-icon").removeClass("disabled"),this.$(".razericons-call").removeClass("disabled")},_onMemberPresence:function(e){var t=0;for(var n=0;n<this.memberList.data.length;n++)this.memberList.data[n].id===e.user_id&&(this.memberList.data[n].presence=e.presence),this.memberList.data[n].presence!=="offline"&&t++;var r=this.groupModel.get("members")+" Members, ";r+=t+" Online",this.$(".show_members .sub-title").text(r)},_addTooltip:function(t,n){var r=this;t.hover(function(){n!=""&&e('<p class="tooltiprazercall"></p>').html(n).appendTo("body").fadeIn("slow")},function(){e(".tooltiprazercall").remove()}).mousemove(function(n){var r=e(".tooltiprazercall").width(),i=t.offset().left+10-r/2;i=Math.round(i);var s=t.offset().top+t.outerHeight();e(".tooltiprazercall").css({top:s,left:i})})},onFriendPresence:function(e){this.group_chat||this.model.get("id")===e.user_id&&(this.model.set("presence",e.presence),this.model.set("sub_title",e.presence),this.$(".sub-title").text(e.presence),this.$(".presence").removeClass("online away busy dnd invisible offline ").addClass(e.presence))},_onFileSelectChanged:function(e){var t=this,n=this.$("input[type=file]")[0].files[0];this.$("input[type=file]").prop("value",null),console.debug("_onFileSelectChanged group"),console.debug(n);if(n){var r=new FileReader;r.addEventListener("load",function(e){var n=new d({url:e.target.result,onDone:function(e){if(e.src.indexOf("data:image")===0){var n=e.src.split(",");n.length===2&&(t.$(".group.owner .avatar img").attr("src",e.src),t.options.comms.Groups.update({id:t.groupModel.get("id"),name:t.groupModel.get("name"),icon:n[1],success:function(e){console.debug("_uploadGroupAvatar success"),console.debug(e)}}))}}});n.popup()},!1),r.readAsDataURL(n)}},_onCreateGroupClicked:function(){console.debug("_onCreateGroupClicked");var t=634,n=e(".main-view").height()-100;t>n&&(t=n);var r=this;l.open({width:400,height:t,body:'<div class="friends-container"></div>',showMax:!1,modal:!1,opacity:.9,showClose:!1,onOpen:function(t){t.onComplete=function(){var t={title:"CREATE A GROUP",showCheckbox:!0,showButton:!0,buttonText:"CREATE",onButtonClicked:r._onCreateButtonClicked,onCancelClicked:r.onCancelClicked,showPresence:!0,showOffline:!0,friendCollection:r.options.sharedObjects.friendCollection.clone(),niceScrollOptions:r.options.sharedObjects.niceScrollOptions,preSelected:[r.model.get("chat_id")],friend_mandatory:r.model.get("chat_id")};r.friendsSelectorView=new v(t),e(".w2ui-popup .friends-container").append(r.friendsSelectorView.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){l.close()})}},onClose:function(e){r.friendsSelectorView&&(r.friendsSelectorView.close(),r.friendsSelectorView=null)}})},_onCreateButtonClicked:function(e,t){var n=this;this.options.sharedObjects.comms.Groups.create({name:e,noname:!1,success:function(e){console.debug("_onCreateButtonClicked: group created: "+JSON.stringify(e)),setTimeout(function(){for(var r=0;r<t.length;++r)n.options.sharedObjects.comms.Groups.addMember({user_id:t[r],group_id:e.id,lobby_id:e.lobby_id,success:function(e){console.debug("_onCreateButtonClicked: added: "+JSON.stringify(e))}})},1e3),setTimeout(function(){var t="groups/"+encodeURIComponent(e.lobby_id);n.options.sharedObjects.router.navigate(t,{trigger:!0})},0)}}),l.close()},onCancelClicked:function(){l.close()}});return g}),define("text!templates/chatmessagesview.html",[],function(){return'<div class="pagination-progress"><div class="progressicon"></div></div>\n<div class="date-indicator-container">\n    <div class="date-indicator">TODAY</div>\n</div>\n<div class="messages rc-enable-select">\n    <div class="content"/>\n</div>\n<div class="typingstatus"><span class="name"></span> is typing...</div>\n<div class="message-input-container">\n	<div class="emojiPickerBox"><div class="pickericon close razericons-emoticon"></div></div>\n    <div class="message-input" contenteditable="true"/>\n	<div class="send vertical-align btn">SEND<span class="razericons-send_message"></span></div>\n    <span class="attachment razericons-join_file"/>\n    <input class="file-select-input" type="file" name="upload" accept="image/*">\n</div>\n<div class="emoji-picker-container"/>\n<div class="upload-progress"/>\n'}),define("models/chatmessagemodel",["underscore","backbone","rcemoji/rcemoji","autolinker","moment"],function(e,t,n,r,i){var s="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",o=t.Model.extend({defaults:{sender_name:"",message:"",avatar:"",timestamp:"",time:"",date:"",direction:"",status:"sent",message_emoji:"",sender_name_emoji:""},idAttribute:"message_id",initialize:function(){e.bindAll(this,"_setEmojiMessage","_setEmojiName");var t=new Date(parseInt(this.get("timestamp"))*1e3),n="",r=t.getHours();t.getHours()>12?(n="PM",r-=12):n="AM";var s=r+":"+this._pad(t.getMinutes(),2)+" "+n;this.set("time",s);var o=new Date,u=o.toLocaleDateString();if(u==t.toLocaleDateString())this.set("date","Today");else{o.setDate(o.getDate()-1);if(o.toLocaleDateString()===t.toLocaleDateString())this.set("date","Yesterday");else{var a=i(t).format("dddd, MMMM Do");this.set("date",a)}}this._setEmojiMessage(),this._setEmojiName(),this.on("change:message",this._setEmojiMessage),this.on("change:sender_name",this._setEmojiName),this.changeAvatar(),this.on("change:avatar",this.changeAvatar)},_pad:function(e,t){var n=Math.pow(10,t);return e<n?(""+(n+e)).slice(1):""+e},_setEmojiMessage:function(){var e=n.parse(this.escape("message"));e=e.replace(new RegExp("\r?\n","g"),"<br>");var t=r.link(e,{stripPrefix:!1,twitter:!1});this.set("message_emoji",t)},_setEmojiName:function(){this.set("sender_name_emoji",n.parse(this.escape("sender_name")))},changeAvatar:function(){if(this.get("avatar")!==""&&this.get("avatar")!==s){var e=this.get("avatar").split("/"),t=e[e.length-1],n="https://dbq9ithrljsz0.cloudfront.net/"+t;this.set("avatar",n)}else this.set("avatar",s)}});return o}),define("collections/chatmessagescollection",["underscore","backbone","models/chatmessagemodel"],function(e,t,n){var r=t.Collection.extend({model:n});return r}),define("text!templates/chatitemview.html",[],function(){return'<div class="avatar"><img class="round" src="<%- avatar %>" width="100%" height="100%"></div>\n<div class="name textwrap"><%= sender_name_emoji %></div>\n<div class="timestamp"><%- time %></div>\n<div class="chat-container">\n	<div class=\'message\'><%= message_emoji %></div>\n	<div class="status">Sending...</div>\n</div>\n<div class="image-placeholder"/>\n'}),define("text!templates/linkpreviewview.html",[],function(){return'<div class="preview-content">\n    <a href="<%- url %>" target="_blank">\n        <div class="site-link"><%- url%></div>\n    </a>\n    <div class="twitch-channel-avatar"></div>\n    <div class="site-name"><%- name %></div>\n\n    <div class="site-title textwrap"><%- title %></div>\n    <div class="site-desc"><%- description %></div>\n    <a class="img-anchor" href="<%- url %>" target="_blank"></a>\n    <div class="embedded">\n        <span class="play-button hvalign razericons-player">\n            <span class="play-background hvalign"></span>\n        </span>\n    </div>\n</div>\n'}),define("text!templates/linkpreviewwebsiteview.html",[],function(){return'<div class="preview-website">\n    <a href="<%- url %>" target="_blank">\n        <div class="site-link"><%- url%></div>\n    </a>\n    <div class="site-name"><%- name %></div>\n\n    <div class="site-title textwrap"><%- title %></div>\n    <div class="site-desc"><%- description %></div>\n    <a class="img-anchor" href="<%- url %>" target="_blank"></a>\n    <div class="embedded">\n    </div>\n</div>\n'}),define("models/linkpreviewmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{url:"",name:"",site_name:"",title:"",description:"",image:"",embedded:!1,iframe:""},initialize:function(){this.has("site_name")&&this.set("name",this.get("site_name"));if(this.has("images")){var e=this.get("images");e.length>0&&this.set("image",e[0].url)}this.on("change",this.checkEmbeded,this)},checkEmbeded:function(){var e=this.get("site_name");e||(e=this.get("name"));if(!e)return;e=e.toLowerCase(),e===""&&(e=this.get("name").toLowerCase());if(e==="")return;this.set("site_name",e);if(e==="youtube"){this.get("embedded")||this.set("embedded",!0);var t=this._youTubeGetID(this.get("url"));if(t!==""){var n='<iframe width="462" height="260" src="https://www.youtube.com/embed/';n+=t+'?autoplay=1" frameborder="0" allowfullscreen></iframe>',this.set("iframe",n)}}else if(e==="twitch"){this.get("embedded")||this.set("embedded",!0);var r=this.get("url").split("/"),t=r[r.length-1];if(t&&t!==""){var n='<iframe src="https://player.twitch.tv/?channel=';n+=t,n+='" frameborder="0" scrolling="no" width="462" height="260"></iframe>',this.set("iframe",n)}}},_youTubeGetID:function(e){var t="";return e=e.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),e[2]!==undefined?(t=e[2].split(/[^0-9a-z_\-]/i),t=t[0]):t=e,t}});return n}),define("views/linkpreview/linkpreviewview",["jquery","underscore","backbone","twitch","text!templates/linkpreviewview.html","text!templates/linkpreviewwebsiteview.html","models/linkpreviewmodel"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"link-preview-view",events:{"click .embedded img":"_onImageClick","click .embedded .play-button":"_onImageClick"},options:{chat_id:"",community_id:"",channel_id:"",url:"",comms:null,commsCommunity:null,chat_message:null,margin_left:undefined,margin_top:undefined,anchor:undefined},img:null,initialize:function(e){t.bindAll(this,"render","_onMetaTags","_onImageLoaded","close","_onMetaTagsError"),this.template=t.template(i),this.templateWebsite=t.template(s),this.options=e,this.img=null,console.assert(e&&e.url&&e.url!==""),console.assert(e.chat_message),e.community_id?(console.assert(e.community_id!==""),console.assert(e.channel_id&&e.channel_id!==""),console.assert(e.commsCommunity)):console.assert(e.chat_id),console.assert(this.options.comms),this.model=new o,this.model.set("url",this.options.url);var n=this;if(this.options.chat_message.has("attachment")){var r=this.options.chat_message.get("attachment");r.name=r.site_name,r.images&&r.images.length>0?(r.image=r.images[0].url,this.img=new Image,this.img.onload=this._onImageLoaded,this.img.src=r.image,this.img.className="site-image"):setTimeout(function(){n.trigger("loaded",n.model.get("url"))},0),r.description&&r.description.length>199&&(r.description=r.description.split(0,196)+"..."),r.type==="article"&&(r.isArticle=!0),this.model.set(r)}else{if(this.options.url.startsWith("mailto:")){console.debug("Got email URL: '"+this.options.url+"'"),setTimeout(function(){n.close()},10);return}console.debug("attachment not present in ChatMessage model: "+this.options.url+" fetching metatags"),this.options.comms.getMetaTags({url:this.options.url,success:this._onMetaTags,error:this._onMetaTagsError})}this.model.on("change",this.render),this.on("loaded",function(){n.options.anchor?n.options.anchor.remove():console.debug("no anchor to remove")})},render:function(t){var n=this;this.model.get("isArticle")||this.model.get("embedded")?(this.$el.html(this.template(this.model.toJSON())),console.log("render original template")):(this.$el.html(this.templateWebsite(this.model.toJSON())),console.log("render new template")),this.model.get("image")===""&&(this.$(".site-image").hide(),this.$(".site-link").css("left","0px"),this.$(".site-name").css("left","0px"),this.$(".site-title").css("left","0px"),this.$(".site-desc").css("left","0px"));if(this.model.get("embedded")){console.debug("embedded URL: "+this.model.get("url")),this.$("a.img-anchor").hide(),this.$(".embedded").show();var i=this.model.get("site_name").toLowerCase();if(i=="twitch"){var s=this.options.url.lastIndexOf("/"),o=this.options.url.substr(s+1);r.api({method:"streams/"+o},function(t,r){if(n.$(".embedded").find(".twitch-stream").length===0)if(t)console.error("fetchStream: error: "+JSON.stringify(t)),n.trigger("error",t);else if(r.stream){n.img.className="twitch-avatar",n.$(".twitch-channel-avatar").append(e(n.img)),n.$(".twitch-channel-avatar").show();var i=new Image;i.className="twitch-stream",i.onload=function(){n.$(".play-button").addClass("twitch-play"),n.$(".embedded img.twitch-stream").fadeIn(200,function(){n.$(".play-button").fadeIn(200)})},i.src=r.stream.preview.medium,n.$(".embedded").append(e(i)),n.$(".embedded img.twitch-stream").hide()}else n.$(".play-button").remove(),n.img.className+=" twitch-letterbox",n.$(".embedded").append(e(n.img))})}else this.img&&this.$(".embedded").append(e(this.img)),i==="youtube"?(this.$(".play-button").show(),this.$(".play-button").addClass("youtube-play")):this.$(".play-button").remove()}else this.img&&this.$("a.img-anchor").append(e(this.img));return typeof this.options.margin_left!="undefined"&&this.$el.css("margin-left",this.options.margin_left),typeof this.options.margin_top!="undefined"&&this.$el.css("margin-top",this.options.margin_top),this.options.chat_message.has("attachment")&&this.options.anchor&&this.options.anchor.remove(),this},close:function(){this.unbind(),this.remove()},_onMetaTags:function(e){var t=this,n={};e.title&&(n.title=e.title),e.description&&(e.description.length>199?n.description=e.description.split(0,196)+"...":n.description=e.description),e.site_name&&e.site_name!==""&&(n.name=e.site_name),e.images&&e.images.length>0?(n.image=e.images[0].url,this.img=new Image,this.img.onload=this._onImageLoaded,this.img.src=n.image,this.img.className="site-image"):setTimeout(function(){t.trigger("loaded",t.model.get("url"))},0),e.type==="article"&&(n.isArticle=!0),this.model.set(n);if(this.options.community_id){console.debug("saving to community chathistory");var r=this.options.chat_message.get("sender");console.assert(r&&r!==""),r===this.options.comms.user_id&&this.options.commsCommunity.saveLinkPreview({community_id:this.options.community_id,channel_id:this.options.channel_id,message_id:this.options.chat_message.get("message_id"),data:e,success:function(){console.debug("saveLinkPreview successful")}})}else this.options.chat_message.get("direction")==="outgoing"&&this.options.comms.ChatHistory.saveLinkPreview({chat_id:this.options.chat_id,message_id:this.options.chat_message.get("message_id"),data:e,success:function(){console.debug("saveLinkPreview successful")}})},_onImageLoaded:function(){var t=this,n=this.model.get("site_name").toLowerCase();if(n==="youtube"){if(this.img.height>260){var r=this.img.width/this.img.height,i=r*260;e(this.img).css("max-height","260px");if(i<460){var s=(462-i)/2;e(this.img).css("margin-left",s+"px"),e(this.img).css("border-radius","0"),this.$(".embedded").css("background-color","black")}}console.debug(this.img.width)}setTimeout(function(){t.trigger("loaded",t.model.get("url"))},0)},_onImageClick:function(){console.debug("_onImageClick: "+this.model.get("url"));if(this.model.get("embedded")){console.debug("Showing embedded iframe");var t=this.model.get("iframe");t&&t!==""&&(console.debug("iframe: '"+t+"'"),this.$(".embedded img").hide(),this.$(".embedded .play-button").hide(),this.$(".embedded").append(e(t)))}},_onMetaTagsError:function(){console.debug("_onMetaTagsError"),this.close()}});return u}),define("text!templates/picviewerview.html",[],function(){return'<div class="lock"/>\n\n<div class="body">\n\n  <div class="picture-canvas"/>\n\n  <div class="buttons-container">\n      <div class="rc-button-download razericons-transfert_download"></div>\n      <div class="rc-button-close razericons-close"></div>\n  </div>\n  <a id="downloadLink" style="display: none" download></a>\n</div>\n'}),define("views/picviewer/picviewerview",["jquery","underscore","backbone","text!templates/picviewerview.html"],function(e,t,n,r){var i=n.View.extend({className:"picture-viewer-view",events:{"click .rc-button-download":"_onDownloadClick","click .body":"close"},initialize:function(e){t.bindAll(this,"render","close","popup"),this.options=e,this.template=t.template(r)},render:function(){return this.$el.html(this.template()),this.$(".body").fadeIn(),this.$(".picture-canvas").css("background-image","url("+this.options.imgUrl+")"),this},close:function(){var e=this;this.$(".body").fadeOut("fast",function(){e.remove(),e.unbind()})},popup:function(){var t=this;e("body").append(this.render().el)},_onDownloadClick:function(t){t.stopPropagation(),t.preventDefault();var n=e("#downloadLink");n.attr({href:this.options.imgUrl}),console.log("download 14"),console.log(n.attr("href")),n[0].click()}});return i}),define("views/chatmessages/chatitemview",["jquery","underscore","backbone","text!templates/chatitemview.html","utils","views/linkpreview/linkpreviewview","views/picviewer/picviewerview"],function(e,t,n,r,i,s,o){var u="https://cdn.comms.razerzone.com",a="https://s3.amazonaws.com/comms.razerzone.com",f=n.View.extend({tagName:"div",className:"chat-item-view",events:{click:"_onClick","click a":"_onLinkClick"},attachmentUrl:"",initialize:function(e){t.bindAll(this,"render","close","_onLinkPreviewLoaded"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined"),this.model.on("change",this._onChange,this)},render:function(){if(i.isImageUrl(this.model.get("message"))){var t=this,n=new Image,r=this.model.get("message").replace(a,u),o=r;n.onload=function(){t.$("#img-container").show(),t.$(".image-placeholder").hide(),t.trigger("attachmentLoaded",t)},n.src=r,n.className+="attachment";var f='<div class="attachment" id="img-container"><a href="'+o+'" target="_blank">'+n.outerHTML+"</a></div>";this.model.set("message_emoji",f),this.$el.html(this.template(this.model.toJSON())),this.$(".image-placeholder").show()}else{this.$el.html(this.template(this.model.toJSON()));var l=this.$(".message").find("a");if(l.length===1){var c=e(l[0]).attr("href"),h={chat_id:this.options.chat_id,url:c,chat_message:this.model,comms:this.options.sharedObjects.comms};c===this.$(".message").text()||c===this.$(".message").text()+"/"?h.anchor=e(l[0]):h.margin_top=20;var p=new s(h);this.$el.append(p.render().el),p.on("loaded",this._onLinkPreviewLoaded)}}this._doChecks();var d=e.trim(this.$(".message").text()).length,v=this.$(".message").find("img.emoji").length;return d===0&&v==1&&this.$(".message .emoji").addClass("large"),this.$el.data("model",this.model),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onClick:function(){console.debug(this.model.toJSON())},_hideAvatar:function(){this.$(".avatar").hide()},_createSection:function(){this.$el.addClass("section"),this.$(".name").css("display","inline-block"),this.$(".avatar").css("display","inline-block")},_doChecks:function(){this.model.get("status")==="sent"?(this.$(".timestamp").css("display","inline"),this.$(".status").hide()):this.model.get("status")==="sending"&&(this.$(".timestamp").hide(),this.$(".status").css("display","inline")),this.options.prev_model!==undefined?this.options.prev_model.get("type")==="chat"?this.model.get("sender")!==this.options.prev_model.get("sender")?this._createSection():this.model.get("difference_timestamp")>=5?this._createSection():this.$(".timestamp").hide():this._createSection():(this.$(".name").css("display","inline-block"),this.$(".avatar").css("display","inline-block"))},_onChange:function(){this._doChecks()},_onLinkClick:function(t){console.debug("_onLinkClick URL: "+e(t.currentTarget).attr("href"));var n=e(t.currentTarget).attr("href");if(!n||n==="")return;if(n.indexOf("http://razer.net")===0){console.debug("Razer Short URL"),t.preventDefault();var r=this;this.options.sharedObjects.comms.expandUrl({short_url:n,success:function(e){console.debug("expandUrl: response: "+JSON.stringify(e));if(e.long_url.indexOf("https://web.comms.razerzone.com")===0){var t=e.long_url.split("#");t.length>1?r.options.sharedObjects.router.navigate(t[1],{trigger:!0}):window.location.href=e.long_url}}})}else if(i.isImageUrl(n)){t.preventDefault();var s=new o({imgUrl:n});s.popup();return}},_onLinkPreviewLoaded:function(e){this.trigger("previewLoaded",this)}});return f}),define("views/chatmessages/datesectionview",["jquery","underscore","backbone"],function(e,t,n){var r=n.View.extend({className:"date-section-view",initialize:function(e){this.options=e,console.assert(e&&e.date&&e.date!=="")},render:function(){this.$el.html();var e='<h2 class="date"><span>'+this.options.date+"</span></h2>";return this.$el.html(e),this}});return r}),define("views/chatmessages/unreadsectionview",["jquery","underscore","backbone"],function(e,t,n){var r=n.View.extend({className:"unread-section-view",initialize:function(e){t.bindAll(this,"close"),this.options=e,console.assert(typeof this.options.unread_count!="undefined"),console.assert(this.options.unread_count>0)},render:function(){this.$el.html();if(this.options.unread_count>1){var e='<h2 class="unread"><span>'+this.options.unread_count+" Unread Messages</span></h2>";this.$el.html(e)}else{var e='<h2 class="unread"><span>'+this.options.unread_count+" Unread Message</span></h2>";this.$el.html(e)}return this},close:function(){console.debug("close"),this.remove(),this.unbind()}});return r}),define("text!templates/callitem.html",[],function(){return'<div class="razericons-<%- type %><%- direction %> callicon "></div><div class="message textwrap"><%- message %> <%- activity %></div><div class="timestamp"><%- time %></div>\r\n'}),define("views/chatmessages/callitem",["jquery","underscore","backbone","text!templates/callitem.html"],function(e,t,n,r){var i=n.View.extend({tagName:"div",className:"call-item-view",events:{click:"_onClick"},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r)},render:function(){if(this.model.get("type")==="canceled_call")var e="Cancelled call";else if(this.model.get("type")==="missed_call")var e="Missed call";else if(this.model.get("direction")==="outgoing")var e="Outgoing Call";else if(this.model.get("direction")==="incoming")var e="Incoming Call";return this.model.set("message",e),this.model.get("type")==="voice_call_start"?this.model.set("activity","started"):this.model.get("type")==="voice_call_end"?this.model.set("activity","ended"):this.model.set("activity",""),this.$el.html(this.template(this.model.toJSON())),this.$el.data("model",this.model),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onClick:function(){console.debug("_onClick: "+JSON.stringify(this.model.toJSON()))}});return i}),define("views/chatmessages/chatmessagesview",["jquery","underscore","backbone","text!templates/chatmessagesview.html","collections/chatmessagescollection","models/chatmessagemodel","views/chatmessages/chatitemview","views/chatmessages/datesectionview","nicescroll","views/chatmessages/unreadsectionview","rcemoji/rcemoji","velocity-ui","contenteditable","views/chatmessages/callitem"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=13,v=20,m=234,g=n.View.extend({tagName:"div",className:"chat-messages-view",events:{"input .message-input":"_onMessageInput","keypress .message-input":"_onInputKeypress","click .emojiPickerBox":"_toggleEmojiPicker","paste .message-input":"onMessageInputPaste","click .messages":"_onMessagesClicked","keyup .message-input":"_onInputKeyUp","click .send":"_sendMessage","change .file-select-input":"_onAttachmentChanged","click span.attachment":"_onAttachmentClicked"},cached:!1,collection:null,offset:null,comms:null,groupchat:!1,unread_count:0,unreadSection:null,windowFocusModel:null,lastMessageId:null,h:0,emojiPickerShown:!1,messageInputHeight:0,emojiPickerView:null,typingState:"paused",typingTimeout:null,lastview:undefined,attachmentUrl:"",cached_messages:null,didScroll:!1,initialize:function(e){t.bindAll(this,"render","close","_onChatMessages","scrollToBottom","_onScroll","_showDateIndicator","_appendChatCollection","_insertMessage","_incomingMessage","_incomingGroupMessage","_markIncomingMessage","_onMessageForwarded","_onEmojiIconSelected","_adjustScrollHeight","onMessageInputPaste","_adjustChatInputHeight","_createGroupChat"),t.bindAll(this,"_showEmojiPicker","_hideEmojiPicker","_showScrollbars","_hideScrollBars","_onTypingState","_onMessageDeleted","_isScrollbarAtBottom","_onWindowResized","_sameAsCached"),t.bindAll(this,"focusInput","_onAttachmentLoaded","_onLinkPreviewLoaded"),this.options=e,this.template=t.template(r),console.assert(typeof this.options.chat_id!="undefined"),this.cached=!1,this.collection=new i,this.offset=null,this.didScroll=!1,this.comms=this.options.sharedObjects.comms,this.options.chat_id&&this.options.chat_id!==""&&this.comms.ChatHistory.getMessages({chat_id:this.options.chat_id,limit:v,success:this._onChatMessages}),this.comms.on("message",this._incomingMessage,this),this.comms.on("groupMessage",this._incomingGroupMessage,this),this.comms.on("typingState",this._onTypingState,this),this.options.chat_id&&this.options.chat_id!==""&&this.comms.isGroupChat(this.options.chat_id)?(console.debug("initialize: this is group chat"),this.groupchat=!0):this.groupchat=!1,this.unread_count=0,this.unreadSection=null,this.windowFocusModel=this.options.sharedObjects.windowFocusModel,this.comms.on("messageForwarded",this._onMessageForwarded,this),this.comms.ChatHistory.on("chatDeleted",this._onMessageDeleted,this);var n=this;l.initialize(),this.emojiPickerShown=!1,this.emojiPickerView=null,(new Image).src="js/lib/rcemoji/spritecommunities.png",this.typingState="paused",this.typingTimeout=null;var s="saveCall."+this.options.chat_id;this.comms.on(s,this._onCallChange,this),this.comms.on("missedCall",this._onMissedCall,this),this.options.sharedObjects.windowResizeModel&&this.options.sharedObjects.windowResizeModel.on("resize",this._onWindowResized,this);if(this.options.chat_id&&this.options.chat_id!==""){var o=this.comms.ChatHistory.getCachedMessages({chat_id:this.options.chat_id});o&&this._onCachedChatMessages(o),this.cached_messages=o}},render:function(){this.$el.html(this.template());var e=this;this.$(".messages").on("scroll",this._onScroll),this.$(".messages").niceScroll(t.extend({horizrailenabled:!1},this.options.sharedObjects.niceScrollOptions)),this.$(".message-input").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this.$(".message-input").contentEditable(),!this.options.adhoc&&this.options.adhoc!==undefined&&this.focusInput();if(this.collection.length>0){this._appendChatCollection(this.$(".content"),this.collection),this.cached||this.checkForAutoFetch();if(this.unread_count===0)this.cached?setTimeout(function(){e.scrollToBottom()},0):e.scrollToBottom();else if(this.unread_count<v){console.debug("render: Scrolling to unread messages");if(this.$(".unread-section-view").length>0){var n=this.$(".unread-section-view").offset().top,r=this.$(".messages").offset().top;this.$(".messages").scrollTop(n-r)}}}return this},focusInput:function(){this.$(".message-input").focus()},_onEmojiIconSelected:function(e,t){var n="js/lib/twemoji/icons/"+t.replace("em emj","")+".png",r='<img class="emoji"  alt="'+e+'" src="'+n+'" >';this.$(".message-input").append(r),this._placeCaretAtEnd(this.$(".message-input")[0])},_placeCaretAtEnd:function(e){e.focus();if(typeof window.getSelection!="undefined"&&typeof document.createRange!="undefined"){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(typeof document.body.createTextRange!="undefined"){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}},close:function(){console.debug("close"),this.comms.off(null,null,this),this.comms.ChatHistory.off(null,null,this),this.options.sharedObjects.windowResizeModel&&this.options.sharedObjects.windowResizeModel.off(null,null,this),this.unbind(),this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingState!=="paused"&&(this.comms.setTypingState({chat_id:this.options.chat_id,state:"paused"}),this.typingState="paused")),this.stopListening(),this.remove()},_appendChatCollection:function(e,n){var r=this,i="",s=-1;if(this.unread_count>0){var a=0;for(var l=n.length-1;l>=0;--l){var c=n.at(l);if(c.get("direction")==="incoming"){++a;if(a===this.unread_count){s=l,console.debug("_appendChatCollection: unread_index: "+s);break}}}}for(var l=0;l<n.length;++l){var h=n.at(l);if(l===s){var d=new f({unread_count:this.unread_count});e.append(d.render().el),this.unreadSection=d}if(i!==h.get("date")){i=h.get("date");var v=new u({date:i});e.append(v.render().el)}this.lastview=this.$(".messages .content").children().last();var m=this.lastview.data("model");m&&(h=this._checkPreviousAvatarToShow(m,h));var g=t.extend({model:h,prev_model:m,is_groupchat:this.groupchat},r.options),y;h.get("type")==="chat"?(y=new o(g),y.on("attachmentLoaded",r._onAttachmentLoaded),y.on("previewLoaded",r._onLinkPreviewLoaded)):y=new p(g),e.append(y.render().el)}},_onChatMessages:function(e){if(this._sameAsCached(e)){this.checkForAutoFetch();return}this.cached=!1,this.collection.reset(),e.data.length>0&&(this.offset=e.data[0].version);var t;for(var n=0;n<e.data.length;++n)t=new s(e.data[n]),this.collection.add(t);this.unread_count=e.unread_count,this.render();if(this.unread_count>0){console.debug("_onChatMessages: unread_count: "+this.unread_count+" marking as read"),t=this.collection.at(e.data.length-1),t&&console.debug(JSON.stringify(t.toJSON()));var r=e.data[e.data.length-1];console.assert(r);var i=r.message_id;this.comms.ChatHistory.markAsRead({chat_id:this.options.chat_id,message_id:i,adhoc:this.options.adhoc,success:function(e){console.debug("_onChatMessages: markAsRead success: "+JSON.stringify(e))}}),this.unread_count=0}},_onCachedChatMessages:function(e){this.collection.reset(),e.data.length>0&&(this.offset=e.data[0].version);for(var t=0;t<e.data.length;++t){var n=new s(e.data[t]);this.collection.add(n)}this.unread_count=0,this.cached=!0},scrollToBottom:function(e){e=typeof e!="undefined"?e:!1;var t=this;if(e){if(this.scrolling)return;this.scrolling=!0,this.$(".messages").animate({scrollTop:this.$(".messages")[0].scrollHeight},1e3,function(){t.scrolling=!1,t.didScroll=!1})}else this.$(".messages").scrollTop(this.$(".messages")[0].scrollHeight),this.didScroll=!1},_onScroll:function(e){var t=this.$(".messages").scrollTop();this.didScroll=!0;if(t===0){console.debug("_onScroll: loading more messages..."),console.debug("_onScroll: offset: "+this.offset);var n=this;n.$(".date-indicator").hide(),n.$(".pagination-progress").show(),this.comms.ChatHistory.getMessages({chat_id:this.options.chat_id,limit:v,offset:this.offset,success:function(e){n.$(".pagination-progress").hide();if(e.data.length>0){n.offset=e.data[0].version;var t=new i(e.data),r=n.$(".messages")[0].scrollHeight;n.collection.add(t.models,{at:0}),n.$(".content").empty(),console.debug("appending chats with new messages"),n._appendChatCollection(n.$(".content"),n.collection);var s=!1;n.$(".content .chat-item-view .link-preview-view").length>0&&(s=!0),n.$(".content .chat-item-view .attachment").length>0&&(s=!0),n.$(".content .chat-item-view .link-preview-view").show(),n.$(".content .chat-item-view .attachment").show();var o=0;if(s)console.debug("with_attachment"),o=1;else{console.debug("no_attachment");var u=n.$(".messages")[0].scrollHeight;n.$(".messages").scrollTop(u-r)}s&&setTimeout(function(){var e=n.$(".messages")[0].scrollHeight;console.debug("_onScroll: new_height: "+e+" orig_height: "+r+" diff: "+(e-r)),n.$(".messages").scrollTop(e-r)},o)}}})}},_showDateIndicator:function(){if(!this.dateIndicatorShown){this.$(".date-indicator").fadeIn(),this.dateIndicatorShown=!0;var e=this;setTimeout(function(){e.$(".date-indicator").fadeOut(),e.dateIndicatorShown=!1},2e3)}},_onMessageInput:function(){this._adjustChatInputHeight()},_adjustChatInputHeight:function(){var e=this.$(".message-input").outerHeight(!0);this.$(".message-input-container").css("height",e),this.$(".emojiPickerBox").css("height",e);if(this.emojiPickerShown){var t=e+m;this.$(".messages").css("bottom",t),this.$(".emoji-picker-container").css("bottom",e)}else this.$(".messages").css("bottom",e);this.h===0?this.h=e:this.h!==e&&(console.debug("height changed---"+e),this.h=e,this.scrollToBottom())},assignInitialHeight:function(){var e=this.$(".message-input").outerHeight(!0);this.$(".message-input-container").css("height",e),this.$(".emojiPickerBox").css("height",e+"px"),this.$(".messages").css("bottom",e+"px")},_adjustScrollHeight:function(e){var t=this.$(".message-input").height()+e,n=parseInt(this.$(".message-input").css("padding-top")),r=parseInt(this.$(".message-input").css("padding-bottom"));t+=n+r+1,this.$(".messages").css("bottom",t),this.scrollToBottom()},_onInputKeypress:function(e){e.which!=32;if(e.keyCode===d){var t=this;e.shiftKey||(e.preventDefault(),this._sendMessage())}},_sendMessage:function(e){var t=this,n=this.$(".message-input").html();if(n==="")return;var r=/^\s*(?:<br\s*\/?\s*>)+|(?:<br\s*\/?\s*>)+\s*$/gi;n=n.replace(r,""),n=n.replace(/<br ?\/?>/g,"\n");var i=l.unParse(n);i=this.htmlDecode(i);var o;if(this.options.chat_id===""&&this.options.recipients&&this.options.recipients.length>0){this._createGroupChat(i),this.$(".message-input").html("");return}if(this.options.chat_id===""){console.debug("no chat_id");return}if(this.groupchat){var u=new s({sender:this.comms.user.get("id"),sender_name:this.comms.user.get("nickname"),message:i,avatar:this.comms.user.get("avatar"),timestamp:Math.floor(Date.now()/1e3),direction:"outgoing",status:"sending",type:"chat"});this.options.adhoc?o=this.comms.Groups.sendMessage({group_id:this.options.chat_id,adhoc:!0,message:i,success:function(n){console.debug("send adhoc group message success"),e&&e(n),setTimeout(function(){u.set({sender_name:t.comms.user.get("nickname"),avatar:t.comms.user.get("avatar"),status:"sent",timestamp:Math.floor(Date.now()/1e3)})},200)}}):o=this.comms.Groups.sendMessage({lobby_id:this.options.chat_id,message:i,success:function(n){e&&e(n),setTimeout(function(){u.set({sender_name:t.comms.user.get("nickname"),avatar:t.comms.user.get("avatar"),status:"sent",timestamp:Math.floor(Date.now()/1e3)})},200)}}),u.set("message_id",o),this._insertMessage(u)}else{var u=new s({sender:this.comms.user.get("id"),sender_name:this.comms.user.get("nickname"),message:i,avatar:this.comms.user.get("avatar"),timestamp:Math.floor(Date.now()/1e3),direction:"outgoing",status:"sending",type:"chat"});o=this.comms.sendMessage({user_id:this.options.chat_id,message:i,success:function(n){e&&e(n),t.trigger("messageSent",{id:n}),setTimeout(function(){u.set({sender_name:t.comms.user.get("nickname"),avatar:t.comms.user.get("avatar"),status:"sent",timestamp:Math.floor(Date.now()/1e3)})},200)}}),u.set("message_id",o),this._insertMessage(u)}this.unreadSection&&(this.unreadSection.close(),this.unreadSection=null),this.emojiPickerShown&&this._hideEmojiPicker(),this.$(".message-input").empty(),this._adjustChatInputHeight()},onMessageInputPaste:function(e){var t=this.$(".message-input").html();t=l.unParse(t),t=l.parse(t),this.$(".message-input").html(t),this._adjustChatInputHeight(),this._placeCaretAtEnd(this.$(".message-input")[0])},stripTags:function(t){var n="<div>"+t+"</div>",r=e(n);return r.find("*").not("img").each(function(){e(this).replaceWith(this.innerHTML)}),r.html()},htmlDecode:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes.length===0?"":t.childNodes[0].nodeValue},_insertMessage:function(e){this.collection.add(e),this.lastview=this.$(".messages .content").children().last();var n=this.lastview.data("model");n&&(e=this._checkPreviousAvatarToShow(n,e));var r=this._isScrollbarAtBottom(),i=t.extend({model:e,prev_model:n,is_groupchat:this.groupchat},this.options),s=new o(i);s.on("attachmentLoaded",this._onAttachmentLoaded),s.on("previewLoaded",this._onLinkPreviewLoaded),this.$(".content").append(s.render().el),r&&(this.emojiPickerShown?this.scrollToBottom(!1):this.scrollToBottom(!0)),this._adjustChatInputHeight(),this._placeCaretAtEnd(this.$(".message-input")[0])},_checkPreviousAvatarToShow:function(e,t){t.set("difference_timestamp",undefined);if(e.get("type")==="chat"&&t.get("type")==="chat"&&e.get("sender")===t.get("sender")){var n=new Date(parseInt(t.get("timestamp"))*1e3),r=new Date(parseInt(e.get("timestamp"))*1e3),i=n.getTime()-r.getTime(),s=Math.round(i/6e4);t.set("difference_timestamp",s),s<5}return t},_incomingMessage:function(e){console.debug("_incomingMessage: "+JSON.stringify(e));if(e.user_id===this.options.chat_id){var t=this.collection.get(e.message_id);if(t){console.info("_incomingMessage: message already in collection: "+JSON.stringify(t.toJSON()));return}var n=new s({sender:e.user_id,sender_name:e.nickname,message:e.message,message_id:e.message_id,avatar:e.avatar,timestamp:Math.floor(Date.now()/1e3),direction:"incoming",type:"chat"});this._insertMessage(n),this._markIncomingMessage(n),this.lastMessageId=e.message_id}else console.debug("_incomingMessage: not this chat_id: "+this.options.chat_id+" "+JSON.stringify(e))},_incomingGroupMessage:function(e){if(e.chat_id===this.options.chat_id){var t=this.collection.get(e.message_id);if(t)return;var n=new s({sender:e.user_id,sender_name:e.nickname,message:e.message,message_id:e.message_id,avatar:e.avatar,timestamp:Math.floor(Date.now()/1e3),direction:"incoming",type:"chat"});e.user_id===this.comms.user_id&&n.set("direction","outgoing"),this._insertMessage(n),this._markIncomingMessage(n),this.lastMessageId=e.message_id}else console.debug("_incomingGroupMessage: not this chat_id: "+this.options.chat_id)},_markIncomingMessage:function(e){if(this.windowFocusModel.get("in_focus"))console.debug("_markIncomingMessage: window is in_focus marking: "+JSON.stringify(e.toJSON())),this.unreadSection&&(this.unreadSection.close(),this.unreadSection=null),this.comms.ChatHistory.markAsRead({chat_id:this.options.chat_id,message_id:e.get("message_id"),adhoc:this.options.adhoc,success:function(e){console.debug("_markIncomingMessage: markAsRead success: "+JSON.stringify(e))}});else{var t=this;this.windowFocusModel.once("change",function(){t.windowFocusModel.get("in_focus")&&t.lastMessageId&&(console.debug("_markIncomingMessage: on change. marking message_id: "+t.lastMessageId),t.comms.ChatHistory.markAsRead({chat_id:t.options.chat_id,message_id:t.lastMessageId,adhoc:t.options.adhoc}),t.lastMessageId=null)})}},_onMessageForwarded:function(e){console.debug("_onMessageForwarded: "+JSON.stringify(e));if(e.chat_id===this.options.chat_id){var t=this.collection.get(e.message_id);if(t){console.info("_onMessageForwarded: message already in collection: "+JSON.stringify(t.toJSON()));return}var n=new s({sender_name:e.nickname,message:e.message,message_id:e.message_id,avatar:this.comms.user.get("avatar"),timestamp:Math.floor(Date.now()/1e3),direction:"outgoing",type:"chat"});this._insertMessage(n)}},_toggleEmojiPicker:function(){this.emojiPickerShown?this._hideEmojiPicker():this._showEmojiPicker()},_showEmojiPicker:function(){console.debug("_showEmojiPicker"),this.emojiPickerShown=!0;var e=l.createEmojiView({onEmojiSelected:this._onEmojiIconSelected});this.$(".emoji-picker-container").append(e.render().el),e.$el.show(),e.$(".emojiPicker").show(),this.emojiPickerView=e,this._hideScrollBars();var t=this.$(".message-input-container").outerHeight(),n=+t+ +m,r=this;this.$(".messages").velocity({bottom:m+t,top:"-"+n+"px"},{easing:"easeOutCubic",complete:function(){r.$(".messages").css("top",0),r.scrollToBottom(!1),r._showScrollbars()}}),this.$(".emoji-picker-container").css("bottom","-"+n+"px"),this.$(".emoji-picker-container").show(),this.$(".emoji-picker-container").velocity({bottom:t},{easing:"easeOutCubic",complete:function(){}}),this.$(".emojiPickerBox").addClass("open"),this.$(".pickericon").removeClass("close").addClass("open")},_hideEmojiPicker:function(){console.debug("_hideEmojiPicker"),this.emojiPickerShown=!1,this._hideScrollBars();var e=this.$(".message-input-container").height(),t=this;this.$(".messages").velocity({bottom:e},{easing:"easeOutCubic",complete:function(){t.scrollToBottom(!1),t._showScrollbars()}});var n=+e+ +m;this.$(".emoji-picker-container").velocity({bottom:"-"+n+"px"},{easing:"easeOutCubic",complete:function(){t.$(".emoji-picker-container").hide(),t.emojiPickerView.close(),t.emojiPickerView=null}}),this.$(".emojiPickerBox").removeClass("open"),this.$(".pickericon").removeClass("open").addClass("close")},_hideScrollBars:function(){var e=this.$(".messages").getNiceScroll();e.hide()},_showScrollbars:function(){var e=this.$(".messages").getNiceScroll();e.resize(),e.show()},_onMessagesClicked:function(){this.emojiPickerView&&this._hideEmojiPicker()},_createGroupChat:function(e){console.debug("_createGroupChat: recipients: "+JSON.stringify(this.options.recipients));var t=this,n=new s({sender:t.comms.user.get("id"),sender_name:t.comms.user.get("nickname"),message:e,avatar:t.comms.user.get("avatar"),timestamp:Math.floor(Date.now()/1e3),direction:"outgoing",status:"sending",type:"chat"});this._insertMessage(n);var r="New Group by: "+this.comms.user.get("nickname");this.comms.Groups.create({name:r,noname:!0,success:function(r){console.debug("_createGroupChat: "+JSON.stringify(r));for(var i=0;i<t.options.recipients.length;++i)t.comms.Groups.invite({user_id:t.options.recipients[i],group_id:r.id,lobby_id:r.lobby_id});setTimeout(function(){var i=t.comms.Groups.sendMessage({lobby_id:r.lobby_id,message:e,success:function(e){console.debug("send group message success"),setTimeout(function(){n.set({sender_name:t.comms.user.get("nickname"),avatar:t.comms.user.get("avatar"),status:"sent",timestamp:Math.floor(Date.now()/1e3)});var e="activity/"+encodeURIComponent(r.lobby_id);t.options.sharedObjects.router.navigate(e,{trigger:!0})},200)}})},3e3)}})},_onInputKeyUp:function(e){var t=this;this.typingTimeout&&clearTimeout(this.typingTimeout);if(e.keyCode===d)this.comms.setTypingState({chat_id:this.options.chat_id,state:"paused"}),this.typingState="paused";else{var n=this.$(".message-input").html();n===""&&this.typingState==="composing"?(this.comms.setTypingState({chat_id:this.options.chat_id,state:"paused"}),this.typingState="paused"):n!==""&&this.typingState!=="composing"&&(this.comms.setTypingState({chat_id:this.options.chat_id,state:"composing"}),this.typingState="composing"),n!==""&&(this.typingTimeout=setTimeout(function(){console.debug("_onInputKeyUp: timeout expired"),t.comms.setTypingState({chat_id:t.options.chat_id,state:"paused"}),t.typingState="paused"},5e3))}},_onTypingState:function(e){e.chat_id===this.options.chat_id&&(e.state==="composing"&&(this.$(".typingstatus .name").text(e.nickname),this.$(".typingstatus").show()),e.state==="paused"&&this.$(".typingstatus").hide())},_onMessageDeleted:function(e){this.options.chat_id===e.chat_id&&this.$(".messages .content").empty()},_onCallChange:function(e){console.debug("_onInsertCallHistory---"+JSON.stringify(e));if(e.message.chat_id===this.options.chat_id){var t=new s({message_id:e.message.message_id,avatar:"",timestamp:Math.floor(Date.now()/1e3),direction:e.message.direction,type:e.message.type,duration:e.message.duration});this._insertCallItem(t)}},_onMissedCall:function(e){console.info("_onMissedCall: "+JSON.stringify(e));if(e.user_id===this.options.chat_id){var t=new s({avatar:"",timestamp:Math.floor(Date.now()/1e3),direction:"",type:"missed_call",duration:0});this._insertCallItem(t)}},_insertCallItem:function(e){this.collection.add(e);var n=t.extend({model:e},this.options),r=new p(n);this.lastview=r;var i=this._isScrollbarAtBottom();this.$(".content").append(r.render().el),i&&(this.emojiPickerShown?this.scrollToBottom(!1):this.scrollToBottom(!0)),this._adjustChatInputHeight(),this._placeCaretAtEnd(this.$(".message-input")[0])},checkForAutoFetch:function(){var e=this.$(".messages").height(),t=this.$(".content").height();t<e&&(console.debug("contentheight: "+t+" messagesheight: "+e),this.autoFetch())},autoFetch:function(){console.debug("autofetch");var t=this;t.$(".pagination-progress").show(),this.comms.ChatHistory.getMessages({chat_id:this.options.chat_id,limit:v,offset:this.offset,success:function(n){t.$(".pagination-progress").hide();if(n.data.length>0){t.offset=n.data[0].version;var r=e("<div/>"),s=new i(n.data);t._appendChatCollection(r,s),e("body").append(r);var o=r.height();r.remove(),console.debug("tmp_div height: "+o);var u=t.$(".messages")[0].scrollHeight;t.collection.add(s.models,{at:0}),t.$(".content").empty(),t._appendChatCollection(t.$(".content"),t.collection),t.$(".content .chat-item-view .link-preview-view").show(),t.$(".content .chat-item-view .attachment").show();var a=t.$(".messages")[0].scrollHeight;t.$(".messages").scrollTop(a-u),t.checkForAutoFetch()}}})},_isScrollbarAtBottom:function(){var e=this.$(".messages")[0];return e.scrollHeight-e.scrollTop===e.clientHeight?!0:!1},_onWindowResized:function(){this.scrollToBottom()},_onAttachmentClicked:function(){console.debug("_onAttachmentClicked"),this.$(".file-select-input").click()},_onAttachmentChanged:function(e){console.debug("_onAttachmentChanged");var t=this,n=this.$("input[type=file]")[0].files[0];console.debug("_onAttachmentChanged: file: "),console.debug(n);if(n){console.debug("file"),console.debug(n);if(n.type.indexOf("image")!==0){this._showWarning("Please select an image file");return}if(n.size>10485760){console.warn("file too big"),this._showWarning("Please select a smaller file to send");return}console.debug("file size: "+n.size);var r=new FileReader;r.addEventListener("load",function(){console.debug("_onAttachmentChanged: load result");var e=r.result.split(",");if(e.length>1&&e[1]&&e[1]!==""){console.debug("attachment: "+e[1].substring(0,100)),console.debug(e);var n="",i=e[0].split(":");if(i.length===2){var s=i[1].split(";");console.debug("ContentType: "+s[0]),n=s[0]}var o=!0;n.indexOf("image")===-1&&(o=!1),t.$(".upload-progress").show(),t.comms.ChatHistory.uploadAttachment({chat_id:t.options.chat_id,data:e[1],type:n,success:function(e){console.debug("File uploaded: "+e.url),o&&(t.attachmentUrl=e.url),t.$(".message-input").text(e.url),t._sendMessage(function(e){o||t.$(".upload-progress").hide()})}})}},!1),r.readAsDataURL(n)}},_onAttachmentLoaded:function(e){var t=this,n=this._isScrollbarAtBottom();e.$("img.attachment").show();if(n)this.scrollToBottom(!1),console.debug("_onAttachmentLoaded: at bottom"),console.debug("_onAttachmentLoaded checking again: "+this._isScrollbarAtBottom());else{console.debug("_onAttachmentLoaded: not at bottom");if(!this.didScroll){console.debug("Did not scroll but not at bottom");var t=this;setTimeout(function(){t.scrollToBottom(!1)},10)}}this.attachmentUrl!==""&&this.attachmentUrl===e.model.get("message")&&(console.debug("last sent attachment loaded"),this.$(".upload-progress").hide())},_showWarning:function(t){var n="line-height:200px; text-align:center;font-size:20px;",r="<div style='"+n+"'>"+t+"</div>";w2popup.open({width:400,height:200,showMax:!1,modal:!1,showClose:!0,body:r,onOpen:function(t){t.onComplete=function(){e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){w2popup.close()})}}})},_onLinkPreviewLoaded:function(e){var t=this._isScrollbarAtBottom();e.$(".link-preview-view").show();if(t)this.scrollToBottom(!1);else if(!this.didScroll){var n=this;setTimeout(function(){n.scrollToBottom(!1)},10)}},_sameAsCached:function(e){if(this.cached_messages&&e.unread_count===0){var t=e.data[e.data.length-1].timestamp,n=this.cached_messages.data[this.cached_messages.data.length-1].timestamp;if(t===n)return console.debug("messages are the same as the cached"),!0;console.debug("timestamp from cache and from server is different")}return!1}});return g}),define("models/mainheadermodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r=t.Model.extend({defaults:{chat_id:"",title:"",sub_title:"",avatar:"",group_chat:!1},initialize:function(){this._setEmojiTitle(),this.on("change:title",this._setEmojiTitle)},_setEmojiTitle:function(){this.set("title_emoji",n.parse(this.escape("title")))},avatarToHttps:function(){if(this.has("avatar")&&this.get("avatar")!==""&&this.get("avatar").indexOf("http:")===0)if(this.has("group_chat")&&this.get("group_chat")){var e=this.get("avatar");this.set("avatar",e.replace("http://","https://"))}else{var e=this.get("avatar").split("/"),t=e[e.length-1],n="https://dbq9ithrljsz0.cloudfront.net/"+t;this.set("avatar",n)}}});return r}),define("text!templates/infoview_group.html",[],function(){return'<div class="group">\n<div class="content">\n<div class="avatar-container animate">\n    <div class="avatar group">\n		<img class="" src="<%- icon %>" width="100px" height="100px">\n		<span class="update">UPDATE PICTURE</span>\n		<input class="file-select-input" type="file" name="upload" accept="image/*">\n	</div>\n	<div class="razericons-menu_dots infosettings"></div>\n</div>\n<div class="info-container animate">\n	<!-- <div class="newgroupname center textwrap"><%= name_emoji %></div>-->\n\n	<div class="center" style="height:31px">\n		 <div class="groupname">\n			<div class="name textwrap"><%= name_emoji %></div>\n			<div class="gicon editicon razericons-edit"></div> 			\n		</div>\n\n		<input type="text" name="renamegroup" class="renamegroup"  autofocus>\n	</div>\n    \n\n</div>\n<div class="setting_options">\n	<ul>\n		<li class="leave-group">Leave Group</li>\n		<li class="clear-history group">Clear History</li>\n		<li class="divider group"></li>\n		<li class="delete-group group">Delete Group</li>\n	</ul>\n</div>\n</div>\n</div>\n\n'}),define("text!templates/infoview_user.html",[],function(){return'<div class="content">\n	<div class="avatar-container animate">\n		<div class="avatar user"><img class="avatar round" src="<%- avatar %>">\n		<div class="presence round <%- presence %>"></div>\n		</div>	\n		<div class="razericons-menu_dots infosettings"></div>\n	</div>\n\n	<div class="info-container animate">\n		<div class="label center">Nickname</div>\n		<div class="nickname textwrap center"><%= nickname_emoji %></div>\n		<div class="label center comms-id">Razer ID</div>\n		<div class="comms-id center textwrap"><%- comms_id %></div>\n		<% if(about !== \'\') { %>\n		<div class="label about">About me</div>\n		<div class="about"><%- about %></div>\n		<% } %>\n	</div>\n	<div class="setting_options">\n		<ul>\n			<li class="view-profile">View Profile</li>\n			<li class="divider"></li>\n			<li class="add-favorite">Add to Favorites</li>\n			<li class="delete-favorite">Delete from favorites</li>\n			<li class="clear-history user">Clear History</li>\n			<li class="block-user">Block User</li>\n			<li class="divider"></li>\n			<li class="delete-friend">Delete Contact</li>\n		</ul>\n	</div>\n</div>\n\n'}),define("views/infoview",["jquery","underscore","backbone","text!templates/infoview_group.html","text!templates/infoview_user.html","models/usermodel","models/groupmodel","velocity-ui","views/memberlist/memberlistview","views/addmember/friendselector","w2ui","rcdialog","views/profile/viewprofile"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=13,d=n.View.extend({tagName:"div",className:"info-view",events:{"click .add-member-button":"_onAddMemberClicked","click .delete-friend":"_onDeleteContactClicked","click .leave-group":"_onLeaveGroupClicked","click .delete-group":"_onDeleteGroupClicked","click .group.owner .groupname":"_showEditGroupNameField","click .group":"_updateGroupName","click .infosettings":"_onInfoSettingsClicked","click .block-user":"_onBlockUserClicked","click .clear-history.user":"_onClearHistory","click .view-profile":"_onViewProfileClicked","change .group.owner .avatar":"_uploadGroupAvatar","click .clear-history.group.owner":"_onClearHistoryGroup","click .avatar.user":"_onViewProfileClicked","click .add-favorite":"_addToFavorites","click .delete-favorite":"_deleteFromFavorites"},groupchat:!1,userModel:null,groupModel:null,infosettingshown:!1,memberList:[],userInfoRefreshed:!1,memberListView:null,initialize:function(e){t.bindAll(this,"render","close","_onUserInfo","_onGroupInfo","_onFriendsSelected","_updateGroupName","_onAddMemberClicked","_onDeleteContactClicked","autoHideSettingOptions"),this.options=e,this.userTemplate=t.template(i),this.groupTemplate=t.template(r),console.assert(e.chat_id&&e.chat_id!==""),console.assert(e.sharedObjects.comms),console.debug("infoView: chat_id: "+this.options.chat_id),this.options.comms=this.options.sharedObjects.comms;if(this.options.comms.isGroupChat(this.options.chat_id))console.debug("group chat"),this.groupchat=!0,this.groupModel=new o,this.options.comms.Groups.getInfo({id:this.options.chat_id,success:this._onGroupInfo});else{console.debug("1-to-1 chat"),this.groupchat=!1,this.userModel=new s({id:this.options.chat_id});var n=this;this.options.comms.getUser({user_id:e.chat_id,server_cache:!0,success:this._onUserInfo})}this.userInfoRefreshed=!1,this.memberListView=null},render:function(){return this.groupchat?(this.$el.html(this.groupTemplate(this.groupModel.toJSON())),this.$el.addClass("group"),this.groupModel.get("owner")===this.options.comms.user_id?(console.debug("current user is the owner"),this.$("li.group").show(),this.$(".group").addClass("owner")):(console.debug("current user is a member"),this.$(".leave-group").show())):(this.$el.html(this.userTemplate(this.userModel.toJSON())),this.userInfoRefreshed&&(this.$(".content").show(),this.userModel.get("is_favorite")?this.$(".delete-favorite").show():this.$(".add-favorite").show())),this},close:function(){console.debug("close"),this.memberListView&&this.memberListView.close(),this.remove(),this.unbind()},_onGroupInfo:function(e){console.debug("group info: "+JSON.stringify(e));if(e.type==="Channel"&&e.group)this.groupModel.set(e.group),e.group.icon===""&&this.groupModel.set("icon","assets/images/Grp_def.svg");else{this.groupModel.set(e),e.icon===""&&this.groupModel.set("icon","assets/images/Grp_def.svg");var t=e.members.length;this.groupModel.set("members",t)}this.render();var n=e.owner,r=this;setTimeout(function(){r.$(".content").show(),r.$("div.animate").velocity("transition.slideDownIn",{complete:function(){r.options.comms.user_id===r.groupModel.get("owner")?r.$(".add-member-button").show():r.$(".add-member-button").hide()}});var e=new a({chat_id:r.options.chat_id,sharedObjects:r.options.sharedObjects,owner_id:n,onAddMembersClicked:r._onAddMemberClicked,onMemberList:function(e){r.memberList=e;for(var t=0;t<e.data.length;++t);}});r.$el.append(e.render().el),r.$(".member-list-view").addClass("group"),r.memberListView=e},200)},_onUserInfo:function(e){console.debug("user info: "+JSON.stringify(e)),this.userModel.set(e),e.avatar===""&&this.userModel.set("avatar","https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png");var t=this;this.userInfoRefreshed=!0,this.render(),this.$("div.animate").velocity("transition.slideDownIn",{complete:function(){console.debug("_onUserInfo: animation complete"),t.$(".delete-friend").removeAttr("style")}})},_onAddMemberClicked:function(){console.debug("_onAddMemberClicked");var n=this.options.sharedObjects.friendCollection.clone();t.each(this.memberList.data,function(e){n.remove(e.id)});var r=this;l.open({width:535,height:635,body:'<div class="friends-container"></div>',showMax:!1,modal:!1,opacity:.9,showClose:!1,onOpen:function(t){t.onComplete=function(){var t={showCheckbox:!0,showButton:!0,buttonText:"ADD",onButtonClicked:r._onFriendsSelected,onCancelClicked:r.onCancelClicked,showPresence:!0,showOffline:!0,friendCollection:n,niceScrollOptions:r.options.sharedObjects.niceScrollOptions},i=new f(t);e(".w2ui-popup .friends-container").append(i.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){l.close()})}},onClose:function(e){}})},_onFriendsSelected:function(e){console.debug("_onFriendsSelected"),console.debug(e);var n=this;t.each(e,function(e){console.debug("inviting: "+e+" to: "+JSON.stringify(n.groupModel.toJSON())),n.groupModel.get("type")==="Private"&&n.options.comms.Groups.invite({user_id:e,group_id:n.groupModel.get("id"),lobby_id:n.groupModel.get("lobby_id")})}),l.close()},onCancelClicked:function(){l.close()},_onDeleteContactClicked:function(){console.debug("_onDeleteContactClicked: "+JSON.stringify(this.userModel.toJSON()));var e=this,t='Are you sure you want to delete this user from your contacts: <br/> <span class="data">'+this.userModel.get("nickname")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">DELETE CONTACT</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(console.info("removing "+e.userModel.get("id")),e.options.sharedObjects.comms.Friends.remove({user_id:e.userModel.get("id")}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"DELETE","CANCEL","razericons-alerts")},_onLeaveGroupClicked:function(){var e=this,t='Are you sure you want to leave this group: <br/> <span class="data">'+this.groupModel.get("name")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">LEAVE GROUP</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(console.info("leaving group "+e.groupModel.get("id")),e.options.sharedObjects.comms.Groups.leave({id:e.groupModel.get("id")}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"LEAVE","CANCEL","razericons-alerts")},_onDeleteGroupClicked:function(){var e=this,t='Are you sure you want to delete this group:<br/> <span class="data">'+this.groupModel.get("name")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">DELETE GROUP</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(console.info("_onDeleteGroupClicked: deleting group"),e.options.sharedObjects.comms.Groups.destroy({id:e.groupModel.get("id")}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"DELETE","CANCEL","razericons-alerts")},_onBlockUserClicked:function(){console.debug("_onBlockUserClicked: "+JSON.stringify(this.userModel.toJSON()));var e=this,t='Are you sure you want to block: <br/> <span class="data">'+this.userModel.get("nickname")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">BLOCK USER</div>',function(t){console.debug("answer: "+t),t==="Yes"&&(e.options.comms.Friends.block({user_id:e.options.chat_id,success:function(){console.debug("block user success")}}),e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}))},"BLOCK","CANCEL","razericons-alerts")},_onClearHistory:function(){console.debug("_onClearHistory: ");var e=this,t='Are you sure you want to delete chat history with your contact: <br/> <span class="data">'+this.userModel.get("nickname")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">CLEAR HISTORY</div>',function(t){console.debug("answer: "+t),t==="Yes"&&e.options.sharedObjects.comms.ChatHistory.deleteMessages({chat_id:e.options.chat_id,success:function(t){e.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0})}})},"CLEAR","CANCEL","razericons-alerts")},_onClearHistoryGroup:function(){console.debug("_onClearHistory group: ");var e=this,t='Are you sure you want to delete chat history of this group: <br/> <span class="data">'+this.groupModel.get("name")+" ?</span>";c.yesNo(t,'<div class="dialogtitle">CLEAR HISTORY</div>',function(t){console.debug("answer: "+t),t==="Yes"&&e.options.sharedObjects.comms.ChatHistory.deleteMessages({chat_id:e.options.chat_id,success:function(e){}})},"CLEAR","CANCEL","razericons-alerts")},_showEditGroupNameField:function(){var e=this.$(".groupname .name").text(),t=this.$(".groupname .name").width()+20;this.$(".groupname").hide(),this.$('input[name="renamegroup"]').css("width",t),this.$('input[name="renamegroup"]').val(e),this.$('input[name="renamegroup"]').show(),this.$('input[name="renamegroup"]').focus()},_updateGroupName:function(t){if(!e(t.target).closest(".groupname").length&&!e(t.target).closest(".renamegroup").length){var n=this.$(".groupname .name").text(),r=this.$('input[name="renamegroup"]').val();if(r!==undefined)if(r!==n){this.$('input[name="renamegroup"]').hide(),this.$(".groupname").show();if(r!==""&&r.length>=3&&r.length<=25){this.$(".groupname .name").text(r);var i=this;this.options.comms.Groups.update({id:i.groupModel.get("id"),name:r,success:function(e){console.debug(e),i.options.onGroupNameChanged(r)}})}}else this.$('input[name="renamegroup"]').is(":visible")&&(this.$('input[name="renamegroup"]').hide(),this.$(".groupname").show())}},_onInfoSettingsClicked:function(){var e=this;this.infosettingshown?this.hideSettingOptions():this.showSettingOptions()},showSettingOptions:function(){var t=this;this.$(".setting_options").velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){t.infosettingshown=!0,e(document).bind("click",t.autoHideSettingOptions)}})},hideSettingOptions:function(){var t=this;this.$(".setting_options").velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){t.infosettingshown=!1,e(document).unbind("click",t.autoHideSettingOptions)}})},autoHideSettingOptions:function(){var t=this;!e(event.target).closest(".setting_options").length&&!e(event.target).closest(".infosettings").length&&t.hideSettingOptions()},_onViewProfileClicked:function(){var e=t.extend({user_id:this.userModel.get("id")},this.options);viewProfileView=new h(e),viewProfileView.popup()},_uploadGroupAvatar:function(){console.debug("_uploadGroupAvatar");var e=this.$("input[type=file]")[0].files[0],t=new FileReader,n=this;if(e){var t=new FileReader;t.addEventListener("load",function(){n.$(".avatar.group.owner img").attr("src",t.result);var e=t.result.split(",");e.length>1&&e[1]&&e[1]!==""&&n.options.comms.Groups.update({id:n.groupModel.get("id"),name:n.groupModel.get("name"),icon:e[1],success:function(e){console.debug("_uploadGroupAvatar success"),console.debug(e)}})},!1),t.readAsDataURL(e)}},_addToFavorites:function(){console.debug("add to favorites");var e=this;this.options.comms.Friends.setFavorite({user_id:e.userModel.get("id"),success:function(t){e.hideSettingOptions(),e.$(".delete-favorite").show(),e.$(".add-favorite").hide()}})},_deleteFromFavorites:function(){console.debug("delete from favorites");var e=this;this.options.comms.Friends.unsetFavorite({user_id:e.userModel.get("id"),success:function(t){e.hideSettingOptions(),e.$(".delete-favorite").hide(),e.$(".add-favorite").show()}})}});return d}),define("text!templates/communities/communitymainview.html",[],function(){return'<div class="greenheader"></div>\n<div class="message-input-container">\n	<div class="emojiPickerBox"><div class="pickericon close razericons-emoticon"></div></div>\n    <div class="message-input" contenteditable="true"></div>\n    <span class="attachment razericons-join_file"/>\n	<div class="send vertical-align btn">SEND<span class="razericons-send_message"></span></div>\n    <input class="file-select-input" type="file" name="upload" accept="image/*">\n    <div class="upload-progress"/>\n</div>\n\n<div class="emoji-picker-container"></div>\n<div class="usermentioncontainer"></div>\n'}),define("text!templates/communities/communityheaderview.html",[],function(){return'\r\n<div class="banner">\r\n	<% if (icon && icon !== \'\') { %>\r\n		<div class="logo">\r\n            <img id="logo-img" src="<%- icon %>" width="100%" height="100%">\r\n			<div class="update"><div class="razericons-camera camera"></div></div>\r\n			<input class="file-select-input" type="file" name="upload" accept="image/*">\r\n        </div>\r\n	<% } else { %>\r\n		<div class="logo">\r\n            <img id="logo-img" src="../images/CommunitiesDefIcon.png" width="100%" height="100%">\r\n			<div class="update"><div class="razericons-camera camera"></div></div>\r\n			<input class="file-select-input" type="file" name="upload" accept="image/*">\r\n        </div>\r\n	<% } %>\r\n	<div class="title" style="color:<%- banner_font_color %>"><%- name %></div>\r\n	<div class="settingsmenu"><span class="razericons-menu_options"></span></div>\r\n	<div class="call"><span class="razericons-headphone icon"></span></div>\r\n    <div class="banner-image">\r\n        <div class="banner-update"><div class="razericons-camera camera"></div>\r\n        <input class="banner-file-select-input" type="file" name="upload" accept="image/*">\r\n    </div>\r\n</div>\r\n<div class="banner_overlay">\r\n</div>\r\n'}),define("text!templates/communities/communitysettingsmenuview.html",[],function(){return'<div class="communitysettings menulist">\r\n	<ul class="owner">\r\n		<li class="edit">Edit Community Settings</li>\r\n		<li class="addchannel">Add Channel</li>\r\n		<li class="postannouncement">Post Announcement</li>\r\n	</ul>\r\n    <ul class="admin">\r\n        <li class="edit">Edit Community Settings</li>\r\n        <li class="addchannel">Add Channel</li>\r\n        <li class="postannouncement">Post Announcement</li>\r\n        <li class="leavecommunity">Leave Community</li>\r\n    </ul>\r\n	<ul class="member">\r\n		<li class="leavecommunity">Leave Community</li>\r\n	</ul>\r\n</div>'}),define("text!templates/communities/settings/communitysettings.html",[],function(){return'<div class="exit"><span class="razericons-close"></span><span>EXIT SETTINGS</span></div>\r\n<div class="main">\r\n	<div id="tabs"></div>\r\n	<div id="tabcontent"></div>\r\n</div>\r\n'}),define("text!templates/communities/settings/properties.html",[],function(){return'<div class="main_container">\r\n\r\n	<div class="left">\r\n		<div class="whitelabel">COMMUNITY NAME</div>\r\n		<input id="community-name" name="community-name" type="text" value="<%- name %>"></input>\r\n\r\n		<div class="privacy_container">\r\n			<div class="whitelabel">PRIVACY</div>\r\n			<div class="text">Anyone can find a public community when searching for it in Comms.</div>\r\n			<div class="privacy_buttons">\r\n				<% if(searchable){ %>\r\n					<div class="public on">PUBLIC</div>\r\n					<div class="private off">PRIVATE</div>\r\n				<% } else {%>\r\n					<div class="public off">PUBLIC</div>\r\n					<div class="private on">PRIVATE</div>\r\n				<% } %>\r\n			</div>\r\n			<div style="clear:both"></div>\r\n		</div>\r\n\r\n		<div class="password_container">\r\n			<div class="whitelabel">PASSWORD</div>\r\n			<div class="privacy_text">Control who gets in with a password protected Community</div>\r\n			<div class="password-div">\r\n				<input type="checkbox" id="password-checkbox"></input>\r\n				<label for="password-checkbox"><span></span></label><span class="pwdprotectedtext">Password protected</span>\r\n				<div class="password-input">\r\n					<input name="password" class="passwordtext"  type="password" placeholder="Password" value="<%- password %>"/>\r\n					<div>\r\n						<input type="checkbox" id="show-password-checkbox"></input>\r\n						<label for="show-password-checkbox"><span></span></label><span class="showpwdtext">Show password</span>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="right">\r\n		<div class="whitelabel">RELATED GAMES</div>\r\n		<div class="game_selector"></div>\r\n		<div class="whitelabel">DESCRIPTION</div>\r\n		<textarea name="description" placeholder="DESCRIBE YOUR COMMUNITY" value=""><%- description %></textarea>\r\n	</div>\r\n</div>\r\n<div class="disable-overlay"></div>'}),define("text!templates/communities/settings/adminrights.html",[],function(){return'\r\n<div class="container">\r\n	<div class="hint">Sorry, You don\'t have permission to modify rights.</div>\r\n	<table>\r\n		<tr class="header">\r\n			<th class="channeltext">CHANNEL</th>\r\n			<th class="ownertext">OWNER</th>\r\n			<th class="admintext">ADMIN</th>\r\n		</tr>\r\n		<tr class="spacer"></tr>\r\n		<tr>\r\n			<td><div class="voicechattext">Voice and text chat moderation for channel</div></td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" type="checkbox" id="voice_text_owner"  checked disabled></input>\r\n				<label class="check-box" for="voice_text_owner"><span></span></label>\r\n			</td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" type="checkbox" id="voice_text_admin"  ></input>\r\n				<label class="check-box" for="voice_text_admin"><span></span></label>\r\n			</td>\r\n		</tr>\r\n		<tr>\r\n			<td><div class="editsubtext">Create/edit properties/delete channels or sub-channels</div></td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" type="checkbox" id="edit_channel_owner" checked disabled></input>\r\n				<label class="check-box" for="edit_channel_owner"><span></span></label>\r\n			</td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" type="checkbox" id="edit_channel_admin" checked></input>\r\n				<label class="check-box" for="edit_channel_admin"><span></span></label>\r\n			</td>\r\n		</tr>\r\n		<tr class="spacer"></tr>\r\n		<tr class="header">\r\n			<th class="communitytext">COMMUNITY</th>\r\n			<th></th>\r\n			<th></th>\r\n		</tr>\r\n		<tr class="spacer"></tr>\r\n		<tr>\r\n			<td><div class="banuserstext">Ban users from the community</div></td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" id="ban_users_owner" type="checkbox" checked disabled></input>\r\n				<label class="check-box" for="ban_users_owner"><span></span></label>\r\n			</td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" id="ban_users_admin" type="checkbox" checked></input>\r\n				<label class="check-box" for="ban_users_admin"><span></span></label>\r\n			</td>\r\n		</tr>\r\n		<tr>\r\n			<td><div class="defadminrightstext">Define admin rights</div></td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" type="checkbox" id="edit_rights_owner" checked disabled></input>\r\n				<label class="check-box" for="edit_rights_owner"><span></span></label>\r\n			</td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" type="checkbox" id="edit_rights_admin" checked></input>\r\n				<label class="check-box" for="edit_rights_admin"><span></span></label>\r\n			</td>\r\n		</tr>\r\n		<tr>\r\n			<td><div class="editproptext">Edit properties</div></td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" id="edit_community_owner" type="checkbox" checked disabled></input>\r\n				<label class="check-box" for="edit_community_owner"><span></span></label>\r\n			</td>\r\n			<td class="td-checkbox">\r\n				<input class="input-checkbox" id="edit_community_admin" type="checkbox" checked></input>\r\n				<label class="check-box" for="edit_community_admin"><span></span></label>\r\n			</td>\r\n		</tr>\r\n\r\n	</table>\r\n<div class="disable-overlay"></div>\r\n</div>\r\n\r\n\r\n'}),define("text!templates/communities/settings/memberlist.html",[],function(){return'<div class="container">\r\n	<div class="search">\r\n		<span class="razericons-search searchicon"></span>\r\n		<input type="text" placeholder="SEARCH CHATS AND CONTACTS">\r\n		<span class="clear razericons-player_cancel"></span>\r\n	</div>\r\n	<div class="rc-button ban rc-disabled-button">BAN</div>\r\n	<div class="hint">Sorry , you don\'t have rights.</div>\r\n	<div class="table-container">\r\n		<table >\r\n			<thead>\r\n				<tr class="header">\r\n					<th><span class="checkbox"></span></th>\r\n					<th><span class="comms_id">COMMS ID</span></th>\r\n					<th><span class="nickname">NICKNAME</span></th>\r\n					<th><span class="joinedon">JOINED ON</span></th>\r\n					<th><span class="role" >ROLE</span></th>\r\n					<th><span class="status" >STATUS</span></th>\r\n				</tr>\r\n				<tr class="spacer"></tr>\r\n			</thead>\r\n			<tbody>\r\n			</tbody>\r\n		</table>\r\n	</div>\r\n	<div class="disable-overlay"></div>\r\n	<div class="loader"></div>\r\n</div>    \r\n\r\n'}),define("text!templates/communities/settings/banlist.html",[],function(){return'<div class="container">\r\n	<div class="search">\r\n		<span class="razericons-search searchicon"></span>\r\n		<input type="text" placeholder="SEARCH CHATS AND CONTACTS">\r\n		<span class="clear razericons-player_cancel"></span>\r\n	</div>\r\n	<div class="rc-button reinstate rc-disabled-button">REINSTATE</div>\r\n	<div class="hint">Sorry , you don\'t have rights.</div>\r\n	<div class="table-container">\r\n		<table>\r\n			<thead>\r\n				<tr class="header">\r\n					<th><span class="checkbox"></span></th>\r\n					<th><span class="comms_id">COMMS ID</span></th>\r\n					<th><span class="nickname">NICKNAME</span></th>\r\n					<th><span class="joinedon">JOINED ON</span></th>\r\n					<th><span class="role" >BANNED ON</span></th>\r\n					<th><span class="status" >BANNED BY</span></th>\r\n				</tr>\r\n				<tr class="spacer"></tr>\r\n			</thead>\r\n			<div class="scroller">\r\n				<tbody></tbody>\r\n			</div>\r\n		</table>\r\n	</div>\r\n	<div class="loader"></div>\r\n	<div class="disable-overlay"></div>\r\n</div>    \r\n\r\n'}),define("text!templates/communities/settings/deletecommunity.html",[],function(){return'<div class="main_container">\r\n	<div class="whitelabel">DELETING A COMMUNITY</div>\r\n	<div style="margin-bottom: 40px">Deleting a community is a definitive procedure therefore there is no coming back!</div>\r\n	<div style="margin-bottom: 10px">To Delete your Community, enter "DELETE" and hit the delete button.</div>\r\n	<input type="password" name="password" id="password">\r\n	<div class="delete btn">DELETE</div>\r\n</div>'}),define("text!templates/communities/settings/privacy.html",[],function(){return"PRIVACY"}),define("text!templates/communities/settings/personalize.html",[],function(){return'<div class="title">PROFILE PICTURE</div>\n<div>This is the avatar of your community, you shouldn\'t leave it empty</div>\n<div class="community_icon">\n    <div class="community-icon"><span class="razericons-camera"></span></div>\n    <input class="file-select-icon" type="file" name="upload" accept="image/*" name="community-icon">           \n</div>\n<div  class="title" style="margin-top:25px">BANNER IMAGE</div>\n<div>This give an identitiy to your Community and helps making it immersive.</div>\n<div class="community_banner">\n    <div class="community-banner"><span class="razericons-camera"></span></div>\n    <input class="file-select-banner" type="file" name="upload" accept="image/*" name="community-banner">\n</div>\n<div class="disable-overlay"></div>'}),define("models/communities/gamemodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{id:"",title:"",checked:!1}});return n}),define("collections/gamecollection",["underscore","backbone","models/communities/gamemodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){var n=e.get("title");n&&(n=n.toLowerCase());var r=t.get("title");return r&&(r=r.toLowerCase()),e.get("id")==="all"?-1:t.get("id")==="all"?1:n>r?1:n<r?-1:0}});return r}),define("text!templates/communities/create/gameitem.html",[],function(){return'<input class="input-checkbox" type="checkbox" id="<%- id %>"></input>\r\n<label for="<%- id %>"><span></span></label>    \r\n<div class="name textwrap"><%- title %></div>'}),define("views/communities/create/gameitem",["jquery","underscore","backbone","text!templates/communities/create/gameitem.html"],function(e,t,n,r){var i=n.View.extend({className:"game-item-view",events:{'change input[type="checkbox"]':"_onCheckboxChanged"},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("id")==="all"&&this.$el.addClass("all"),this.model.has("checked")&&this.model.get("checked")&&this.$('input[type="checkbox"]').attr("checked","checked"),this},close:function(){this.remove(),this.unbind()},_onCheckboxChanged:function(){var e=this.$('input[type="checkbox"]').is(":checked");e?this.model.set("checked",!0):this.model.set("checked",!1),this.options.onCheckboxChanged&&this.options.onCheckboxChanged(this.model,e)}});return i}),define("views/communities/settings/propertiesview",["jquery","underscore","backbone","text!templates/communities/settings/properties.html","models/communities/communitymodel","collections/gamecollection","models/communities/gamemodel","views/communities/create/gameitem"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({className:"properties-view",events:{'keyup input[name="community-name"]':"onNameKeyPress",'keyup textarea[name="description"]':"onDescriptionKeyPress","click .privacy_buttons .public":"onPrivacyPublic","click .privacy_buttons .private":"onPrivacyPrivate",'keyup input[name="password"]':"onPasswordKeypress","change #password-checkbox":"onProtectedClicked","change #show-password-checkbox":"onShowPasswordChanged"},model:null,community_temp:null,initialize:function(e){t.bindAll(this,"render","close","_onGameList","onCheckboxChanged","onAdminRightsChanged"),console.debug("initialize"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity,console.debug("this.options"),console.debug(this.options),this.model=this.options.model,this.community_temp=new i(this.model.toJSON()),this.commsCommunity.getMasterGameList({success:this._onGameList}),this.gameCollection=new s;var n="adminRightsChanged."+this.options.community_id;this.commsCommunity.on(n,this.onAdminRightsChanged)},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.options.sharedObjects.niceScrollOptions;this.$(".game_selector").niceScroll(t.extend({},e)),this.$(".main_container").niceScroll(t.extend({},e)),this.model.get("password")!==""?this.$("#password-checkbox").prop("checked",!0):this.$("#password-checkbox").prop("checked",!1);var n=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"edit_community"});return n||this.$(".disable-overlay").show(),console.debug("have_edit_community_rights---"+n),this},close:function(){console.debug("close"),this.commsCommunity.off(null,null,this),this.remove(),this.unbind()},_onGameList:function(e){var t=e.data,n={id:"all",title:"All Games/ Not Game Specific"},r=new o(n);this.gameCollection.add(r);for(var i=0;i<t.length;i++){var s=new o(t[i]);this.gameCollection.add(s)}this.renderGameList()},renderGameList:function(){var e=this;this.gameCollection.each(function(t){var n={model:t,sharedObjects:e.options.sharedObjects,onCheckboxChanged:e.onCheckboxChanged},r=new u(n);e.$(".game_selector").append(r.render().el)})},onCheckboxChanged:function(e,t){var n=this.gameCollection.get(e.get("id")),r=this.getCheckedGames();this.community_temp.set("games",r)},getCheckedGames:function(){var e=[];return this.gameCollection.each(function(t){t.has("checked")&&t.get("checked")&&e.push(t)}),e},onNameKeyPress:function(e){var t=this.$('input[name="community-name"]').val();this.community_temp.set("name",t)},onDescriptionKeyPress:function(){var e=this.$('textarea[name="description"]').val();this.community_temp.set("description",e)},onPrivacyPublic:function(){this.$(".privacy_buttons .public").hasClass("off")&&(this.selectPublic(),this.community_temp.set("searchable",!0))},onPrivacyPrivate:function(){this.$(".privacy_buttons .private").hasClass("off")&&(this.selectPrivate(),this.community_temp.set("searchable",!1))},selectPublic:function(){this.$(".privacy_buttons .public").removeClass("off").addClass("on"),this.$(".privacy_buttons .private").removeClass("on").addClass("off")},selectPrivate:function(){this.$(".privacy_buttons .private").removeClass("off").addClass("on"),this.$(".privacy_buttons .public").removeClass("on").addClass("off")},onPasswordKeypress:function(t){var n=e('input[name="password"]').val();this.community_temp.set("password",n),n===""?(this.community_temp.set("protected",!1),this.$("#password-checkbox").prop("checked",!1)):(this.community_temp.set("protected",!0),this.$("#password-checkbox").prop("checked",!0))},onProtectedClicked:function(){this.$("#password-checkbox").is(":checked")||(this.community_temp.set("protected",!1),this.community_temp.set("password",""),this.$('input[name="password"]').val(""))},onShowPasswordChanged:function(){this.$("#show-password-checkbox").is(":checked")?this.$('input[name="password"]').attr("type","text"):this.$('input[name="password"]').attr("type","password")},saveCommunityChanges:function(){var e=this.hasChanged();console.debug("saveCommunityChanges ---"+e);if(e){var t=this.community_temp.get("name");if(t===""){console.log("onSaveClicked: name is empty");return}var n=this;this.commsCommunity.updateCommunity({community_id:this.model.get("id"),community:this.community_temp.toJSON(),success:function(e){console.debug("community updated successfully")}})}},hasChanged:function(){return this.model.get("name")!==this.community_temp.get("name")?(console.debug("name changed"),!0):this.model.get("description")!==this.community_temp.get("description")?(console.debug("description changed"),!0):this.model.get("searchable")!==this.community_temp.get("searchable")?(console.debug("searchable changed"),!0):this.model.get("password")!==this.community_temp.get("password")?(console.debug("password changed"),!0):this.model.get("protected")!==this.community_temp.get("protected")?(console.debug("protected changed"),!0):!1},onAdminRightsChanged:function(e,t){console.debug("onAdminRightsChanged event triggered"),t.sender!==this.options.sharedObjects.comms.user_id&&(console.debug("onAdminRightsChanged prperties"),this.render())}});return a}),define("models/communities/adminrightsmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{edit_community:null,create_channel:null,edit_channel:null,delete_channel:null,mute_member:null,mute_channel:null,mute_community:null,kick_user:null,ban_user:null,promote_user:null,edit_rights:null}});return n}),define("views/communities/settings/adminrightsview",["jquery","underscore","backbone","text!templates/communities/settings/adminrights.html","models/communities/adminrightsmodel"],function(e,t,n,r,i){var s=n.View.extend({className:"admin-rights-view",events:{'change input[type="checkbox"]':"_onCheckboxChanged"},model:null,initialize:function(e){t.bindAll(this,"render","close","onAdminRightsChanged"),console.debug("initialize"),this.options=e,console.debug("this.options"),console.debug(this.options),this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity,console.assert(typeof this.model!="undefined");var n=this.commsCommunity.getCachedAdminRights({community_id:this.options.community_id});this.model=new i(n);var s="adminRightsChanged."+this.options.community_id;this.commsCommunity.on(s,this.onAdminRightsChanged)},render:function(){this.$el.html(this.template());var e=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"edit_rights"});return this.$("#voice_text_admin").prop("checked",this.model.get("mute_channel")),this.model.get("edit_channel")&&this.model.get("create_channel")&&this.model.get("delete_channel")?this.$("#edit_channel_admin").prop("checked",!0):this.$("#edit_channel_admin").prop("checked",!1),this.$("#ban_users_admin").prop("checked",this.model.get("ban_user")),this.$("#edit_rights_admin").prop("checked",this.model.get("edit_rights")),this.$("#edit_community_admin").prop("checked",this.model.get("edit_community")),console.debug("have rights---"+e),e||(this.$(".disable-overlay").show(),this.$(".hint").show(),this.$('input[type="checkbox"]').attr("disabled",!0)),this},_onCheckboxChanged:function(){var e=this.$("#voice_text_admin").prop("checked"),t=this.$("#edit_channel_admin").prop("checked"),n=this.$("#ban_users_admin").prop("checked"),r=this.$("#edit_rights_admin").prop("checked"),i=this.$("#edit_community_admin").prop("checked"),s={mute_channel:!0,create_channel:!0,edit_channel:!0,delete_channel:!0,kick_user:!0,ban_user:!0,edit_rights:!0,edit_community:!0,mute_channel:!0,mute_community:!0,mute_member:!0,promote_user:!0};e||(s.mute_channel=!1),t||(s.create_channel=!1,s.edit_channel=!1,s.delete_channel=!1),n||(s.ban_user=!1,s.kick_user=!1),r||(s.edit_rights=!1),i||(s.edit_community=!1),this.commsCommunity.updateAdminRights({community_id:this.options.community_id,admin_rights:s,success:function(e){}})},onAdminRightsChanged:function(e,t){console.debug("onAdminRightsChanged event triggered"),t.sender!==this.options.sharedObjects.comms.user_id&&(console.debug("onAdminRightsChanged adminrights tab"),this.model=new i(t.admin_rights),this.render())},close:function(){this.commsCommunity.off(null,null,this),this.remove(),this.unbind()}});return s}),define("models/communities/communitymembermodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="member",i="admin",s="owner",o=t.Model.extend({defaults:{name:"",comms_id:"",join_date:"",avatar:"https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",role:r,banned_on:"",banned_by:"",banned_by_name:""},initialize:function(){this.setJoinDate(),this.setBannedDate(),this._setEmojiName(),this.on("change:name",this._setEmojiName),this._setEmojiBannedName(),this.on("change:banned_by_name",this._setEmojiBannedName)},isAdmin:function(){var e=this.get("role");return e===undefined?(console.error("role is undefined"),!1):e===s?!0:e==i?!0:!1},isOwner:function(){var e=this.get("role");return e===undefined?(console.error("role is undefined"),!1):e===s?!0:!1},parse:function(t){if(!e.isUndefined(t.join_date)&&!e.isNull(t.join_date)){var n=new Date(t.join_date),r=n.getDate();n.getDate()<10&&(r="0"+n.getDate());var i=n.getMonth()+1;i<10&&(i="0"+(n.getMonth()+1)),t.join_date=r+"-"+i+"-"+n.getFullYear()}return typeof t.avatar!="undefined"&&t.avatar===""&&(t.avatar=this.defaults.avatar),(typeof t.name=="undefined"||t.name==="")&&typeof t.nick!="undefined"&&(t.name=t.nick),t.checkbox_id=t.id.split("@")[0],t},setJoinDate:function(){if(this.has("join_date")){var e=new Date(this.get("join_date")),t=this.changeDateFormat(e);this.set("join_date",t)}},setBannedDate:function(){if(this.has("banned_on")){var e=new Date(this.get("banned_on")),t=this.changeDateFormat(e);this.set("banned_on",t)}},changeDateFormat:function(e){var t=e.getDate();e.getDate()<10&&(t="0"+e.getDate());var n=e.getMonth()+1;n<10&&(n="0"+(e.getMonth()+1));var r=t+"-"+n+"-"+e.getFullYear();return r},_setEmojiName:function(){this.set("name_emoji",n.parse(this.escape("name")))},_setEmojiBannedName:function(){this.set("banned_by_name_emoji",n.parse(this.escape("banned_by_name")))}});return o}),define("collections/communitymembercollection",["underscore","backbone","models/communities/communitymembermodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){var n=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();return n>r?1:n<r?-1:0}});return r}),define("text!templates/communities/settings/memberitemview.html",[],function(){return'<td>\r\n    <input class="input-checkbox" type="checkbox" id="<%- id %>"></input>\r\n	<label for="<%- id %>"><span></span></label>    \r\n</td>\r\n<td><span class="row-text"><%- comms_id %></span></td>\r\n<td><span class="row-text"><%= name_emoji %></span></td>\r\n<td><span class="row-text"><%- join_date %></span></td>\r\n<td>\r\n    <span class="role-text"><%- role %></span>\r\n    <div class="role-select">\r\n		<select id="role-select">\r\n			<% if (role === "member") { %>\r\n				<option value="member">Member</option>\r\n				<option value="admin">Admin</option>\r\n			<% } else { %>\r\n				<option value="admin">Admin</option>\r\n				<option value="member">Member</option>		\r\n			<% } %>\r\n		</select>\r\n	</div>\r\n</td>\r\n<td><span class="row-text status"><%- status %></span></td>\r\n\r\n'}),define("views/communities/settings/memberitemview",["jquery","underscore","backbone","text!templates/communities/settings/memberitemview.html"],function(e,t,n,r){var i=n.View.extend({tagName:"tr",className:"member-item-view",events:{'change input[type="checkbox"]':"_onCheckboxChanged","change select#role-select":"_onRoleChanged"},initialize:function(e){t.bindAll(this,"render","close","_promoteUser","_demoteUser"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined"),this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){var e=this.commsCommunity.getMyRole({community_id:this.options.community_id});this.$el.html(this.template(this.model.toJSON())),this.model.get("role")==="owner"&&this.$('input[type="checkbox"]').attr("disabled",!0),this.options.have_ban_rights?e==="admin"&&this.model.get("role")==="admin"&&this.$('input[type="checkbox"]').attr("disabled",!0):this.$('input[type="checkbox"]').attr("disabled",!0);var t=this.commsCommunity.isActive({community_id:this.options.community_id,user_id:this.model.get("id")});return t?this.$(".status").text("active"):this.$(".status").text("inactive"),this},close:function(){this.remove(),this.unbind()},_onCheckboxChanged:function(){var e=this.$('input[type="checkbox"]').is(":checked");this.$el.toggleClass("selected"),e?this.model.set("checked",!0):this.model.set("checked",!1),this.options.have_promote_demote_rights&&(e?(this.$(".role-select").show(),this.$(".role-text").hide()):(this.$(".role-select").hide(),this.$(".role-text").show())),this.options.onCheckboxChanged&&this.options.onCheckboxChanged(this.model,e)},_onRoleChanged:function(){var e=this.$("#role-select :selected").text();e==="member"||e==="Member"?this._demoteUser():this._promoteUser()},_promoteUser:function(){var e=this;this.commsCommunity.promoteUser({community_id:e.options.community_id,user_id:e.model.get("id"),success:function(t){console.debug("promoted successfully"),e.$(".role-text").text("Admin")}})},_demoteUser:function(){var e=this;this.commsCommunity.demoteUser({community_id:e.options.community_id,user_id:e.model.get("id"),success:function(t){console.debug("demoted successfully"),e.$(".role-text").text("Member")}})}});return i}),define("views/communities/settings/memberlistview",["jquery","underscore","backbone","text!templates/communities/settings/memberlist.html","models/communities/communitymembermodel","collections/communitymembercollection","views/communities/settings/memberitemview"],function(e,t,n,r,i,s,o){var u=n.View.extend({className:"member-list-view",events:{"click .ban":"onBanClicked",'keyup  input[type="text"]':"onSearchKeypress","click .clear":"onClearResults"},initialize:function(e){t.bindAll(this,"render","close","_onMemberList","onCheckboxChanged","onAdminRightsChanged"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined"),this.commsCommunity=e.sharedObjects.commsCommunity,this.fetch(),this.collection=new s,this.searchCollection=new s;var n="adminRightsChanged."+this.options.community_id;this.commsCommunity.on(n,this.onAdminRightsChanged)},render:function(){this.$el.html(this.template());var e=this.options.sharedObjects.niceScrollOptions;return e.horizrailenabled=!0,e.zindex=4,e.cursorcolor="#404040",this.$(".table-container").niceScroll(t.extend({},e)),this},fetch:function(){this.commsCommunity.getMemberList({community_id:this.options.community_id,success:this._onMemberList})},close:function(){console.debug("close"),this.commsCommunity.off(null,null,this),this.$(".table-container").getNiceScroll().remove(),this.remove(),this.unbind()},_onMemberList:function(e){var t=this;this.collection.reset();for(var n=0;n<e.data.length;++n){var r=new i(e.data[n]);this.collection.add(r)}this.renderCollection(this.collection)},renderCollection:function(e){var t=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"ban_user"});console.debug("have_ban_rights---"+t);var n=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"promote_demote_user"});console.debug("have_promote_demote_rights---"+n),this.$("table tbody").empty(),this.$(".loader").hide();var r=this;if(e.length>0){var r=this;e.each(function(e){var i={community_id:r.options.community_id,channel_id:r.options.channnel_id,model:e,onCheckboxChanged:r.onCheckboxChanged,have_ban_rights:t,have_promote_demote_rights:n,sharedObjects:r.options.sharedObjects},s=new o(i);r.$("table tbody").append(s.render().el)}),this.$(".table-container").getNiceScroll().resize()}t?(this.$(".hint").hide(),this.$(".disable-overlay").hide()):(this.$(".hint").show(),this.$(".disable-overlay").show())},onCheckboxChanged:function(e){var t=e.get("id"),e=this.collection.get(t),n=this.getChecked();n.length>0?this.$(".ban").removeClass("rc-disabled-button"):this.$(".ban").addClass("rc-disabled-button")},getChecked:function(){var e=[];return this.collection.each(function(t){t.get("checked")&&e.push(t)}),e},onBanClicked:function(){var e=this,t=this.getChecked(),n=t.length;for(var r=0;r<t.length;++r){var i=t[r];this.commsCommunity.banUser({community_id:this.options.community_id,user_id:i.get("id"),success:function(t){--n,n<=0&&(e.fetch(),e.onClearResults())}})}},onSearchKeypress:function(){var e=this.$('input[type="text"]').val();if(e===""){this.onClearResults();return}this.$(".clear").show();var n=t.filter(this.collection.models,function(t){var n=t.get("name"),r=t.get("comms_id");return n.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:r.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:!1});this.searchCollection.reset();for(var r=0;r<n.length;++r)this.searchCollection.add(n[r]);this.renderCollection(this.searchCollection),this.$("table tbody").highlight(e)},onClearResults:function(){this.$(".clear").hide(),this.$('input[type="text"]').val(""),this.$(".ban").addClass("rc-disabled-button"),this.renderCollection(this.collection)},onAdminRightsChanged:function(e,t){console.debug("onAdminRightsChanged event triggered"),t.sender!==this.options.sharedObjects.comms.user_id&&(console.debug("onAdminRightsChanged memberlist"),this.onClearResults())}});return u}),define("text!templates/communities/settings/banitemview.html",[],function(){return'<td>\r\n    <input class="input-checkbox" type="checkbox" id="<%- id %>"></input>\r\n	<label for="<%- id %>"><span></span></label>    \r\n</td>\r\n<td><span class="row-text"><%- comms_id %></span></td>\r\n<td><span class="row-text"><%= name_emoji %></span></td>\r\n<td><span class="row-text"><%- join_date %></span></td>\r\n<td><span class="banned-on"><%- banned_on %></span></td>\r\n<td><span class="banned-by"><%= banned_by_name_emoji %></span></td>\r\n\r\n'}),define("views/communities/settings/banitemview",["jquery","underscore","backbone","text!templates/communities/settings/banitemview.html"],function(e,t,n,r){var i=n.View.extend({tagName:"tr",className:"ban-item-view",events:{'change input[type="checkbox"]':"_onCheckboxChanged"},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.options.have_rights||this.$('input[type="checkbox"]').attr("disabled",!0),this},close:function(){this.remove(),this.unbind()},_onCheckboxChanged:function(){var e=this.$('input[type="checkbox"]').is(":checked");this.$el.toggleClass("selected"),e?this.model.set("checked",!0):this.model.set("checked",!1),this.options.onCheckboxChanged&&this.options.onCheckboxChanged(this.model,e)}});return i}),define("views/communities/settings/banlistview",["jquery","underscore","backbone","text!templates/communities/settings/banlist.html","models/communities/communitymembermodel","collections/communitymembercollection","views/communities/settings/banitemview","jqueryhighlight"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({className:"ban-list-view",events:{"click .reinstate":"onReinstateClicked",'keyup  input[type="text"]':"onSearchKeypress","click .clear":"onClearResults"},initialize:function(e){t.bindAll(this,"render","close","_onBanList","onCheckboxChanged","onAdminRightsChanged"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined"),this.commsCommunity=e.sharedObjects.commsCommunity,this.fetch(),this.collection=new s,this.searchCollection=new s;var n="adminRightsChanged."+this.options.community_id;this.commsCommunity.on(n,this.onAdminRightsChanged)},render:function(){return this.$el.html(this.template()),this},close:function(){this.commsCommunity.off(null,null,this),this.remove(),this.unbind()},fetch:function(){this.commsCommunity.getBanList({community_id:this.options.community_id,success:this._onBanList})},_onBanList:function(e){this.collection.reset();for(var t=0;t<e.data.length;++t){var n=new i(e.data[t]);this.collection.add(n)}this.renderCollection(this.collection)},renderCollection:function(e){var t=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"ban_user"});console.debug("have_rights---"+t),this.$("table tbody").empty(),this.$(".loader").hide();var n=this;if(e.length>0){var n=this;e.each(function(e){var r={model:e,onCheckboxChanged:n.onCheckboxChanged,have_rights:t,sharedObjects:n.options.sharedObjects},i=new o(r);n.$("table tbody").append(i.render().el)})}t?(this.$(".hint").hide(),this.$(".disable-overlay").hide()):(this.$(".hint").show(),this.$(".disable-overlay").show())},onCheckboxChanged:function(e){var t=e.get("id"),e=this.collection.get(t),n=this.getChecked();n.length>0?(console.debug("Has checked users"),this.$(".reinstate").removeClass("rc-disabled-button")):(console.debug("No checked users"),this.$(".reinstate").addClass("rc-disabled-button"))},getChecked:function(){var e=[];return this.collection.each(function(t){t.get("checked")&&e.push(t)}),e},onReinstateClicked:function(){var e=this,t=this.getChecked(),n=t.length;for(var r=0;r<t.length;++r){var i=t[r];this.commsCommunity.unBanUser({community_id:this.options.community_id,user_id:i.get("id"),success:function(t){--n,n<=0&&(e.fetch(),e.onClearResults())}})}},onSearchKeypress:function(){var e=this.$('input[type="text"]').val();if(e===""){this.onClearResults();return}this.$(".clear").show();var n=t.filter(this.collection.models,function(t){var n=t.get("name"),r=t.get("comms_id");return n.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:r.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:!1});this.searchCollection.reset();for(var r=0;r<n.length;++r)this.searchCollection.add(n[r]);this.renderCollection(this.searchCollection),this.$("table tbody").highlight(e)},onClearResults:function(){this.$(".clear").hide(),this.$('input[type="text"]').val(""),this.$(".reinstate").addClass("rc-disabled-button"),this.renderCollection(this.collection)},onAdminRightsChanged:function(e,t){console.debug("onAdminRightsChanged event triggered"),t.sender!==this.options.sharedObjects.comms.user_id&&(console.debug("onAdminRightsChanged banlist"),this.renderCollection(this.collection))}});return a}),define("views/communities/settings/deletecommunityview",["jquery","underscore","backbone","text!templates/communities/settings/deletecommunity.html","rcdialog"],function(e,t,n,r,i){var s=n.View.extend({className:"delete-community-view",events:{'keyup input[name="password"]':"onPasswordKeypress","click .delete.activate":"onDeleteClicked"},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined"),this.commsCommunity=e.sharedObjects.commsCommunity;var n=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"delete_community"});console.debug("have rights to delete community---"+n),n},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.commsCommunity.off(null,null,this),this.remove(),this.unbind()},popup:function(){var e=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id}),t=this,n='Are you sure you want to delete: <br/> <span class="data">'+e.name+" ?</span>";i.yesNo(n,'<div class="dialogtitle">DELETE COMMUNITY</div>',function(e){console.debug("answer: "+e),e==="Yes"&&t.commsCommunity.deleteCommunity({community_id:t.options.community_id,success:function(e){t.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0})}})},"DELETE","CANCEL","razericons-alerts")},onDeleteClicked:function(){var t=this;e("body").addClass("rc-loading"),t.commsCommunity.deleteCommunity({community_id:t.options.community_id,success:function(n){e("body").removeClass("rc-loading"),t.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0})}})},onPasswordKeypress:function(t){var n=e('input[name="password"]').val();n==="delete"||n==="DELETE"||n==="Delete"?this.$(".delete").addClass("activate"):this.$(".delete").removeClass("activate")}});return s}),define("views/communities/settings/privacyview",["jquery","underscore","backbone","text!templates/communities/settings/privacy.html"],function(e,t,n,r){var i=n.View.extend({className:"privacy-view",events:{},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined")},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.remove(),this.unbind()}});return i}),define("views/communities/settings/personalizeview",["jquery","underscore","backbone","text!templates/communities/settings/personalize.html","views/imagecropper/imagecropperview"],function(e,t,n,r,i){var s=n.View.extend({className:"personalize-view",events:{"change .file-select-icon":"_uploadCommunityIcon","change .file-select-banner":"_uploadCommunityBanner"},initialize:function(e){t.bindAll(this,"render","close","onAdminRightsChanged"),this.options=e,this.template=t.template(r),console.debug("initialize"),this.commsCommunity=e.sharedObjects.commsCommunity,this.model=this.options.model;var n="adminRightsChanged."+this.options.community_id;this.commsCommunity.on(n,this.onAdminRightsChanged)},render:function(){this.$el.html(this.template());var e=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"edit_community"});return e||this.$(".disable-overlay").show(),this},close:function(){this.remove(),this.unbind()},_uploadCommunityIcon:function(){var t=this.$(".file-select-icon")[0].files[0];this.$(".file-select-icon").prop("value",null);var n=this;t&&this.readImageFileForCropper({file:t,onSuccess:function(t){console.log(t.url),n.$(".community-icon").html("<img src="+t.url+">"),e("body").removeClass("rc-loading"),n.model.set("icon",t.url)},onClear:function(){n.$(".community-icon").html('<span class="razericons-camera"></span>'),n.model.set("icon","")}})},_uploadCommunityBanner:function(){var t=this.$(".file-select-banner")[0].files[0];this.$(".file-select-banner").prop("value",null);var n=this;t&&this.readImageFileForCropper({title:"Update Community Banner",file:t,isBanner:!0,onSuccess:function(t){console.log(t.url),n.$(".community-banner").html("<img src="+t.url+">"),e("body").removeClass("rc-loading"),n.model.set("banner",t.url),n.model.set("banner_type","url"),n.updateCommunity()},onClear:function(){n.$(".community-banner").html('<span class="razericons-camera"></span>'),n.model.set("banner",""),n.model.set("banner_type","url"),n.updateCommunity()}})},readImageFileForCropper:function(t){var n=this,r=new FileReader;r.addEventListener("load",function(r){var s=new i({url:r.target.result,title:t.title,isBanner:t.isBanner,onDone:function(r){if(r.src.indexOf("data:image")===0){var i=r.src.split(",");if(i.length===2){var s=CryptoJS.SHA1(i[1]);e("body").addClass("rc-loading"),n.commsCommunity.uploadFile({community_id:n.model.get("id"),filename:s,base64Data:i[1],success:t.onSuccess})}}},onClear:t.onClear});s.popup()},!1),r.readAsDataURL(t.file)},updateCommunity:function(){this.commsCommunity.updateCommunity({community_id:this.options.community_id,community:this.model.toJSON(),success:function(e){console.log("update community success"),console.debug(e)}})},onAdminRightsChanged:function(e,t){t.sender!==this.options.sharedObjects.comms.user_id&&this.render()}});return s}),define("views/communities/communitysettingsview",["jquery","underscore","backbone","rcsidetab","text!templates/communities/settings/communitysettings.html","text!templates/communities/settings/properties.html","text!templates/communities/settings/adminrights.html","text!templates/communities/settings/memberlist.html","text!templates/communities/settings/banlist.html","text!templates/communities/settings/deletecommunity.html","text!templates/communities/settings/privacy.html","text!templates/communities/settings/personalize.html","views/communities/settings/propertiesview","views/communities/settings/adminrightsview","views/communities/settings/memberlistview","views/communities/settings/banlistview","views/communities/settings/deletecommunityview","views/communities/settings/privacyview","velocity","views/communities/settings/personalizeview"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){var w=n.View.extend({className:"community-settings-view",events:{"click .exit":"_onExitClicked"},propertiesView:null,adminRightsView:null,memberlistView:null,banlistView:null,deleteCommunityView:null,personalizeView:null,initialize:function(e){t.bindAll(this,"render"),this.template=t.template(i),this.options=e;var n=this;this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){this.$el.html(this.template());var e=this;return setTimeout(function(){e.initializeTabs(),e.$el.velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){}})},0),this},initializeTabs:function(){var t=this,n=this.commsCommunity.getMyRole({community_id:this.options.community_id});if(n==="owner")var r=[{name:"PROPERTIES",id:"community-properties",content:"templates/communities/settings/properties.html",html:s},{name:"PERSONALIZE",id:"community-personalize",content:"templates/communities/settings/personalize.html",html:c},{name:"ADMIN RIGHTS",id:"admin-rights",content:"templates/communities/settings/adminrights.html",html:o},{name:"MEMBERS LIST",id:"member-list",content:"templates/communities/settings/memberlist.html",html:u},{name:"BAN LIST",id:"ban-list",content:"templates/communities/settings/banlist.html",html:a},{name:"DELETE COMMUNITY",id:"delete-community",content:"templates/communities/settings/deletecommunity.html",html:f}];else var r=[{name:"PROPERTIES",id:"community-properties",content:"templates/communities/settings/properties.html",html:s},{name:"PERSONALIZE",id:"community-personalize",content:"templates/communities/settings/personalize.html",html:c},{name:"ADMIN RIGHTS",id:"admin-rights",content:"templates/communities/settings/adminrights.html",html:o},{name:"MEMBERS LIST",id:"member-list",content:"templates/communities/settings/memberlist.html",html:u},{name:"BAN LIST",id:"ban-list",content:"templates/communities/settings/banlist.html",html:a}];this.$("#tabs").rcSidetab2({name:"community-settings-view",active:"community-properties",tabs:r,content:"tabcontent",nocache:!0,onLoadFinished:function(){var n=e(this).attr("id");console.log(n+" Load finished"),n==="community-properties"?(t.propertiesView&&(t.propertiesView.close(),t.propertiesView=null),t.propertiesView=new h(t.options),t.$("#tabcontent").html(t.propertiesView.render().$el)):n==="community-personalize"?(t.propertiesView.saveCommunityChanges(),t.personalizeView&&(t.personalizeView.close(),t.personalizeView=null),t.personalizeView=new b(t.options),t.$("#tabcontent").html(t.personalizeView.render().$el)):n==="admin-rights"?(t.propertiesView.saveCommunityChanges(),t.adminRightsView&&(t.adminRightsView.close(),t.adminRightsView=null),t.adminRightsView=new p(t.options),t.$("#tabcontent").html(t.adminRightsView.render().$el)):n==="member-list"?(t.propertiesView.saveCommunityChanges(),t.memberlistView&&(t.memberlistView.close(),t.memberlistView=null),t.memberlistView=new d(t.options),t.$("#tabcontent").html(t.memberlistView.render().$el)):n==="ban-list"?(t.propertiesView.saveCommunityChanges(),t.banlistView&&(t.banlistView.close(),t.banlistView=null),t.banlistView=new v(t.options),t.$("#tabcontent").html(t.banlistView.render().$el)):n==="delete-community"?(t.propertiesView.saveCommunityChanges(),t.deleteCommunityView&&(t.deleteCommunityView.close(),t.deleteCommunityView=null),t.deleteCommunityView=new m(t.options),t.$("#tabcontent").html(t.deleteCommunityView.render().$el)):n==="community-privacy"&&(this.propertiesView.saveCommunityChanges(),t.privacyView&&(t.privacyView.close(),t.privacyView=null),t.privacyView=new g(t.options),t.$("#tabcontent").html(t.privacyView.render().$el))}})},close:function(){self.adminRightsView&&(self.adminRightsView.close(),self.adminRightsView=null),self.memberlistView&&(self.memberlistView.close(),self.memberlistView=null),self.banlistView&&(self.banlistView.close(),self.banlistView=null),self.deleteCommunityView&&(self.deleteCommunityView.close(),self.deleteCommunityView=null),self.privacyView&&(self.privacyView.close(),self.privacyView=null),self.propertiesView&&(self.propertiesView.close(),self.propertiesView=null),this.remove(),this.unbind()},_onExitClicked:function(){console.debug("_onExitClicked"),this.propertiesView.saveCommunityChanges();var e=this;this.$el.velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){e.close()}})}});return w}),define("text!templates/communities/announcement/publishannouncement.html",[],function(){return'\r\n<div class="title">Post an announcement </div>\r\n<textarea class="multiline" placeholder= "ENTER YOUR MESSAGE HERE" ></textarea>\r\n\r\n<div class="info">Do note that when an Announcement is posted, a notification will be sent out to all the members of this Community so please use this wisely do NOT spam!</div>\r\n\r\n<div class="buttons">\r\n    <div class="clear button btn">CLEAR</div>\r\n    <div class="publish button btn">POST</div>\r\n    <div class="cancel button btn">CANCEL</div>\r\n</div>\r\n'});var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes,this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s,i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t),n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=t.Hasher,i=[],t=e.algo.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=0;80>f;f++){if(16>f)i[f]=e[t+f]|0;else{var c=i[f-3]^i[f-8]^i[f-14]^i[f-16];i[f]=c<<1|c>>>31}c=(r<<5|r>>>27)+a+i[f],c=20>f?c+((s&o|~s&u)+1518500249):40>f?c+((s^o^u)+1859775393):60>f?c+((s&o|s&u|o&u)-1894007588):c+((s^o^u)-899497514),a=u,u=o,o=s<<30|s>>>2,s=r,r=c}n[0]=n[0]+r|0,n[1]=n[1]+s|0,n[2]=n[2]+o|0,n[3]=n[3]+u|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(r+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=r._createHelper(t),e.HmacSHA1=r._createHmacHelper(t)})(),define("cryptojs_sha1",function(e){return function(){var t,n;return t||e.CryptoJS}}(this)),define("views/communities/announcement/publishannouncementview",["jquery","backbone","w2ui","text!templates/communities/announcement/publishannouncement.html","cryptojs_sha1"],function(e,t,n,r,i){var s=t.View.extend({tagName:"div",className:"publish-announcement-view",events:{},clearPressed:"",options:{},initialize:function(e){_.bindAll(this,"popup"),this.template=_.template(r),this.options=e,this.commsCommunity=e.sharedObjects.commsCommunity,console.debug("this.options"),console.debug(this.options)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.has("last_announcement")&&this.$("textarea").val(this.model.get("last_announcement").message),this},popup:function(){var t=this;n.open({body:'<div class="publish-announcement-container"></div>',width:534,height:409,modal:!0,opacity:.9,showClose:!1,speed:.4,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .publish-announcement-container").append(t.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){t.close()}),e("#w2ui-popup .clear").on("click",function(e){t.onClearClicked()}),e("#w2ui-popup .publish").on("click",function(e){t.onPublishClicked()}),e("#w2ui-popup .cancel").on("click",function(e){t.close()})}}})},close:function(){console.debug("close"),n.close(),this.remove(),this.unbind()},onPublishClicked:function(){var e=this.$("textarea").val();console.debug("onPublishClicked: mesg: '"+e+"'");var t=this;if(e!=""){var n={message:e,message_id:this._generateMessageId(e)},t=this;this.commsCommunity.sendAnnouncement({community_id:t.options.community_id,message:e,success:function(){console.debug("Announcement posted successfully")}})}else this.clearPressed==1&&(console.debug("Deleting announcements"),this.commsCommunity.deleteAnnouncements({community_id:t.options.community_id,success:function(){console.debug("Announcement deleted successfully")}}));this.close()},_generateMessageId:function(e){var t=new Date,n={community:this.model.get("id"),message:e,timestamp:t.getTime()};return i.SHA1(JSON.stringify(n)).toString()},onClearClicked:function(){this.clearPressed=!0,this.$("textarea").val("")}});return s}),define("views/communities/communitysettingsmenuview",["jquery","underscore","backbone","text!templates/communities/communitysettingsmenuview.html","views/communities/communitysettingsview","rcdialog","views/communities/announcement/publishannouncementview","views/communities/channelsettings/createchannelview"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"div",className:"community-settings-menu-view",communitySettingsView:null,publishAnnouncementView:null,events:{"click .edit":"_onEditCommunitySettings","click .addchannel":"_onAddChannel","click .postannouncement":"_onPostAnnouncement","click .leavecommunity":"_onLeaveCommunity"},initialize:function(e){this.template=t.template(r),t.bindAll(this,"render","autoHideSettingsMenu"),this.options=e,console.debug("this.options"),console.debug(this.options),this.communitySettingsView=null,this.publishAnnouncementView=null,this.commsCommunity=this.options.sharedObjects.commsCommunity},render:function(){this.$el.html(this.template());var t=e(".community-header-view .banner .settingsmenu"),n=this.$(".communitysettings"),r=t.position().left+t.width()-190;n.css("left",r);var i=this.commsCommunity.hasRights({community_id:this.options.community_id}),s=this.commsCommunity.getMyRole({community_id:this.options.community_id});return s==="owner"?this.$("ul.owner").show():s==="admin"?this.$("ul.admin").show():s==="member"&&this.$("ul.member").show(),this},show:function(){var t=this;this.$(".communitysettings").velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){e(document).bind("click",t.autoHideSettingsMenu)}})},close:function(){var t=this;this.$(".communitysettings").velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){t.options.menuAutoClosed&&t.options.menuAutoClosed(),e(document).unbind("click",t.autoHideSettingsMenu),t.remove(),t.unbind()}})},autoHideSettingsMenu:function(){var t=this;!e(event.target).closest(".communitysettings").length&&!e(event.target).closest(".settingsmenu").length&&t.close()},closeWithoutAnimate:function(){this.options.menuAutoClosed&&this.options.menuAutoClosed(),e(document).unbind("click",this.autoHideSettingsMenu),this.remove(),this.unbind()},_onEditCommunitySettings:function(){this.communitySettingsView&&(this.communitySettingsView.close(),this.communitySettingsView=null),e(".community-settings-view").remove();var t={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.communitySettingsView=new i(t),this.$el.parent().parent().append(this.communitySettingsView.render().$el),this.closeWithoutAnimate()},_onAddChannel:function(){var e={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.createChannelView=new u(e),this.createChannelView.popup()},_onPostAnnouncement:function(){console.debug("_onPostAnnouncement"),this.publishAnnouncementView&&(this.publishAnnouncementView.close(),this.publishAnnouncementView=null);var e={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.publishAnnouncementView=new o(e),this.publishAnnouncementView.popup()},_onLeaveCommunity:function(){var e=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id}),t=this,n='Are you sure you want to leave: <br/> <span class="data">'+e.name+" ?</span>";s.yesNo(n,'<div class="dialogtitle">LEAVE COMMUNITY</div>',function(e){console.debug("answer: "+e),e==="Yes"&&t.commsCommunity.leaveCommunity({community_id:t.options.community_id,success:function(e){console.debug("Community left successfully"),t.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0})}})},"LEAVE","CANCEL","razericons-alerts")}});return a}),define("text!templates/communities/callui/communitycallui.html",[],function(){return'<div class="community-call-controls">\n <div class="channel-name"><span></span></div>\n <div class="community-icon"><img src="assets/images/DefCommntyIcon.svg"></div>\n <div class="speaker-icon ricon"><span class="razericons-sound_medium hvalign ficon"></span></div>\n <div class="mic-icon ricon"><span class="razericons-mic hvalign ficon"></span></div>\n <div class="hangup-icon ricon"><span class="razericons-headphone hvalign ficon"></span></div>\n <div class="sliderbox self">\n   <div class="volume-control"></div>\n   <div class="mute razericons-sound_medium off"></div>\n   <div class="mute razericons-sound_mute on"></div>\n </div>\n</div>\n'}),define("views/communities/callui/communitycallui",["jquery","underscore","backbone","velocity-ui","text!templates/communities/callui/communitycallui.html"],function(e,t,n,r,i){var s=null,o=n.View.extend({tagName:"div",className:"community-call-ui-view",events:{"click .hangup-icon":"_onHangupClick","click .mic-icon":"_toggleMicIcon","click .speaker-icon":"_toggleVolumeSlider","click .sliderbox.self .mute.off":"_onSpeakerMuteClicked","click .sliderbox.self .mute.on":"_onSpeakerUnMuteClicked"},bounceInterval:null,is_muted:!1,slider_shown:!1,callHandler:null,initialize:function(e){t.bindAll(this,"show","close","_startBounce","_stopBounce","_showSlider","_hideSlider","_autoHideVolumeSlider","_onVolumeSliderChanged","_onSpeakerMuteClicked","_onSpeakerUnMuteClicked"),this.options=e,this.template=t.template(i),this.bounceInterval=null,this.is_muted=!1,this.slider_shown=!1,console.assert(e.name&&e.name!==""),console.assert(e.parentView),console.assert(e.commsCommunity),console.assert(e.session_id&&e.session_id!==""),this.callHandler=this.options.commsCommunity.CallHandler},show:function(){var e=this;s&&(console.info("closing current CommunityCallUiView"),s.close(!0)),s=this,console.assert(this.options.parentView),this.options.parentView.append(this.render().el);var t=this.options.commsCommunity.CallHandler;this._startBounce(),t.callIn({session_id:this.options.session_id,success:function(){console.info("Call to '"+e.options.name+"' success"),e._stopBounce()}})},render:function(){this.$el.html(this.template()),this.options.icon&&this.options.icon!==""&&this.$(".community-icon img").attr("src",this.options.icon),this.$(".channel-name span").text(this.options.name);var e=this;return this.$el.velocity("transition.bounceRightIn",{complete:function(){e.$el.removeAttr("style")}}),this.$(".volume-control").slider({orientation:"vertical",range:"min",animate:!0,value:60,change:this._onVolumeSliderChanged}),this},close:function(e){console.debug("close"),this.$(".sliderbox.self").hide();if(e)this.remove(),this.unbind(),s=null;else{var t=this;this.$el.velocity("transition.bounceRightOut",{complete:function(){t.remove(),t.unbind(),s=null}})}this._stopBounce()},_onHangupClick:function(){var e=this.options.commsCommunity.CallHandler;e.hangupCall(),this.close(!1)},_startBounce:function(){var t=this;e.Velocity.RegisterEffect("bounce",{defaultDuration:200,calls:[[{translateY:0},0],[{translateY:-7},.25],[{translateY:0},.5],[{translateY:-7},.75],[{translateY:0},1]]}),this.bounceInterval&&clearInterval(this.bounceInterval),this.bounceInterval=setInterval(function(){console.debug("boucing"),t.$(".community-icon").velocity("bounce")},1e3)},_stopBounce:function(){this.bounceInterval&&(clearInterval(this.bounceInterval),this.bounceInterval=null)},_toggleMicIcon:function(){var e=this.options.commsCommunity.CallHandler;e.isCallActive()&&(this.is_muted?(this.is_muted=!1,this.$(".mic-icon span").addClass("razericons-mic"),this.$(".mic-icon span").removeClass("razericons-mic_mute"),this.$(".mic-icon span").removeClass("muted"),e.selfUnmute()):(this.is_muted=!0,this.$(".mic-icon span").removeClass("razericons-mic"),this.$(".mic-icon span").addClass("razericons-mic_mute"),this.$(".mic-icon span").addClass("muted"),e.selfMute()))},_toggleVolumeSlider:function(){this.slider_shown?this._hideSlider():this._showSlider()},_showSlider:function(){this.$(".sliderbox.self").velocity("fadeIn"),this.slider_shown=!0,e(document).bind("click",this._autoHideVolumeSlider)},_hideSlider:function(){this.$(".sliderbox.self").velocity("fadeOut"),this.slider_shown=!1,e(document).unbind("click",this._autoHideVolumeSlider)},_onVolumeSliderChanged:function(e,t){var n=this.options.commsCommunity.CallHandler;n.changeSpeakerVolume(t.value)},_autoHideVolumeSlider:function(){var t=this;!e(event.target).closest(".sliderbox.self").length&&!e(event.target).closest(".community-call-ui-view").length&&t._hideSlider()},_onSpeakerMuteClicked:function(){this.$(".sliderbox.self .mute.off").hide(),this.$(".sliderbox.self .mute.on").show(),this.$(".speaker-icon span").addClass("razericons-sound_mute"),this.$(".speaker-icon span").removeClass("razericons-sound_medium"),this.$(".speaker-icon span").addClass("muted"),this.callHandler.muteAll()},_onSpeakerUnMuteClicked:function(){this.$(".sliderbox.self .mute.on").hide(),this.$(".sliderbox.self .mute.off").show(),this.$(".speaker-icon span").addClass("razericons-sound_medium"),this.$(".speaker-icon span").removeClass("razericons-sound_mute"),this.$(".speaker-icon span").removeClass("muted"),this.callHandler.unMuteAll()}});return o}),define("views/communities/communityheaderview",["jquery","underscore","backbone","text!templates/communities/communityheaderview.html","views/communities/communitysettingsmenuview","views/communities/callui/communitycallui","views/imagecropper/imagecropperview","models/communities/channelmodel"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"div",className:"community-header-view",events:{"click .settingsmenu":"_onCommunitySettingsClicked","click .call":"_onCallClicked","change .file-select-input":"_onFileSelectChanged","change .banner-file-select-input":"_onBannerFileSelectChanged"},communitySettingsMenuView:null,callui:null,currentChannel:null,initialize:function(e){this.template=t.template(r),t.bindAll(this,"render","menuAutoClosed","_onStartCall","_onEndCall","checkIfVoiceMuted"),this.options=e,this.communitySettingsMenuView=null,this.callui=null,this.commsCommunity=this.options.sharedObjects.commsCommunity,console.assert(this.commsCommunity),this.commsCommunity.CallHandler.on("startCall",this._onStartCall,this),this.commsCommunity.CallHandler.on("endCall",this._onEndCall,this),this.options.sharedObjects.callHandler.on("startCall",this._onStartCall,this),this.options.sharedObjects.callHandler.on("endCall",this._onEndCall,this),this.model.bind("change",this.render),this.commsCommunity.on("edit_channel",this._handleEditChannel,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));if(this.model.get("banner_type")=="color"){var e=this.model.get("banner");this.$(".banner").css("background-color",e)}else if(this.model.get("banner_type")=="url"){var e=" url("+this.model.get("banner")+") ";this.$(".banner").css("background-image",e)}this.model.get("name")!==""&&this.$(".settingsmenu").css("display","inline-block");var t=this.commsCommunity.getMyRole({community_id:this.options.community_id});if(t==="member")this.$(".update").remove(),this.$(".file-select-input").remove(),this.$(".banner-image").remove();else{var n=this.commsCommunity.hasRights({community_id:this.options.community_id,operation:"edit_community"});n||(this.$(".update").remove(),this.$(".file-select-input").remove(),this.$(".banner-image").remove())}(this.commsCommunity.CallHandler.isCallActive()||this.options.sharedObjects.callHandler.voiceConnection)&&this._onStartCall(),this.options.sharedObjects.is_webrtc_supported||(console.debug("dont have webrtc support"),this.$(".call").hide(),this.$(".settingsmenu").css("right","20px"));var r=this.commsCommunity.getCachedChannel({channel_id:this.options.channel_id});return this.currentChannel=new u(r),this.checkIfVoiceMuted(),this},checkIfVoiceMuted:function(){if(this.currentChannel.get("voice_muted")){var e=this.commsCommunity.getMyRole({community_id:this.options.community_id});e==="member"?(this.$(".call").addClass("disabled"),this.commsCommunity.CallHandler.isCallActive()&&this.callui&&(this.callui._onHangupClick(),this.callui=null)):this.$(".call").removeClass("disabled")}else this.$(".call").removeClass("disabled")},_handleEditChannel:function(e,t){var n=t.channel;n.id===this.options.channel_id&&(this.currentChannel.set(t.channel),this.checkIfVoiceMuted())},close:function(){this.remove(),this.unbind(),this.commsCommunity.CallHandler.off(null,null,this),this.options.sharedObjects.callHandler.off(null,null,this)},_onCommunitySettingsClicked:function(){if(this.communitySettingsMenuView)this.communitySettingsMenuView.close(),this.communitySettingsMenuView=null;else{var e={community_id:this.options.community_id,channel_id:this.options.channel_id,menuAutoClosed:this.menuAutoClosed,sharedObjects:this.options.sharedObjects,model:this.model};this.communitySettingsMenuView=new i(e),this.$el.append(this.communitySettingsMenuView.render().$el),this.communitySettingsMenuView.show()}},menuAutoClosed:function(){this.communitySettingsMenuView=null},_onCallClicked:function(){var t=this.commsCommunity.getCurrentChannel(this.model.get("id"));this.callui=new s({name:t.name,session_id:t.id,icon:this.model.get("icon"),parentView:e(".main-view"),commsCommunity:this.options.sharedObjects.commsCommunity}),this.callui.show()},_onStartCall:function(){console.debug("_onStartCall"),this.$(".call").addClass("disabled")},_onEndCall:function(){console.debug("_onEndCall"),this.$(".call").removeClass("disabled"),this.callui=null,this.checkIfVoiceMuted()},_onFileSelectChanged:function(){var e=this,t=this.$(".file-select-input")[0].files[0];this.$(".file-select-input").prop("value",null),t&&this.readImageFileForCropper({file:t,onSuccess:function(t){console.log(t.url),e.model.set("icon",t.url),e.updateCommunity()},onClear:function(){e.model.set("icon",""),e.updateCommunity()}})},_onBannerFileSelectChanged:function(){var e=this,t=this.$(".banner-file-select-input")[0].files[0];this.$(".banner-file-select-input").prop("value",null),t&&this.readImageFileForCropper({title:"Update Community Banner",file:t,isBanner:!0,onSuccess:function(t){console.log(t.url),e.model.set("banner",t.url),e.model.set("banner_type","url"),e.updateCommunity()},onClear:function(){e.model.set("banner",""),e.model.set("banner_type","url"),e.updateCommunity()}})},readImageFileForCropper:function(e){var t=this,n=new FileReader;n.addEventListener("load",function(n){var r=new o({url:n.target.result,title:e.title,isBanner:e.isBanner,onDone:function(n){if(n.src.indexOf("data:image")===0){var r=n.src.split(",");if(r.length===2){var i=CryptoJS.SHA1(r[1]);t.commsCommunity.uploadFile({community_id:t.options.community_id,filename:i,base64Data:r[1],success:e.onSuccess})}}},onClear:e.onClear});r.popup()},!1),n.readAsDataURL(e.file)},updateCommunity:function(){this.commsCommunity.updateCommunity({community_id:this.options.community_id,community:this.model.toJSON(),success:function(e){console.log("update community success"),console.debug(e)}})}});return a}),define("text!templates/communities/channelmessagesview.html",[],function(){return'<div class="channel_info">\r\n<% if(name !== \'\') { %>\r\n	<span class="channelname"><%- name %> : </span>\r\n<% } else {%>\r\n	<span class="channelname">Game lobby : </span>\r\n<% } %>\r\n	<span class="channeltopic"><%- topic %></span>\r\n</div>\r\n<div class="messages rc-enable-select"></div>\r\n<div class="temp-messages"></div>\r\n'}),define("models/channelmessagemodel",["jquery","backbone","rcemoji/rcemoji","autolinker","moment"],function(e,t,n,r,i){var s="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",o=t.Model.extend({defaults:{message_id:"",sender:"",sender_name:"",message:"",timestamp:"",admin:"",avatar:"",time:""},initialize:function(){var e=new Date(parseInt(this.get("timestamp"))),t="",n=e.getHours();e.getHours()>12?(t="PM",n-=12):t="AM";var r=n+":"+this._pad(e.getMinutes(),2)+" "+t;this.set("time",r);var s=new Date,o=s.toLocaleDateString();if(o==e.toLocaleDateString())this.set("date","Today");else{s.setDate(s.getDate()-1);if(s.toLocaleDateString()===e.toLocaleDateString())this.set("date","Yesterday");else{var u=i(e).format("dddd, MMMM Do");this.set("date",u)}}this._setEmojiMessage(),this._setEmojiName(),this.on("change:message",this._setEmojiMessage),this.on("change:sender_name",this._setEmojiName),this.changeAvatar(),this.on("change:avatar",this.changeAvatar)},_pad:function(e,t){var n=Math.pow(10,t);return e<n?(""+(n+e)).slice(1):""+e},_setEmojiMessage:function(){var t=this.get("message").replace(new RegExp("\r?\n","g"),"<br>"),i=r.link(t,{stripPrefix:!1,twitter:!1}),s=this,o=e("<div>"+i+"</div>"),u=o.html();u=n.parse(u),this.set("message_emoji",u)},_setEmojiName:function(){this.set("sender_name_emoji",n.parse(this.escape("sender_name")))},changeAvatar:function(){this.set("avatar",s)}});return o}),define("collections/channelmessagescollection",["underscore","backbone","models/channelmessagemodel"],function(e,t,n){var r=t.Collection.extend({model:n});return r}),define("text!templates/communities/channelmessageitemview.html",[],function(){return'<div class="avatar"><img class="round" src="<%- avatar %>" width="100%" height="100%"></div>\r\n<div class="name"><%= sender_name_emoji %></div>\r\n<div class="timestamp"><%- time %></div>\r\n<div class="chat-container">\r\n	<div class=\'message\'><%= message_emoji %></div>\r\n	<div class="status">Sending...</div>\r\n</div>\r\n<div class="image-placeholder"/>\r\n'}),define("views/communities/channelmessageitemview",["jquery","underscore","backbone","text!templates/communities/channelmessageitemview.html","views/linkpreview/linkpreviewview","utils"],function(e,t,n,r,i,s){var o="https://cdn.comms.razerzone.com",u="https://s3.amazonaws.com/comms.razerzone.com",a=n.View.extend({tagName:"div",className:"channel-message-item-view",events:{"click .chat-container":"_onClick","click .name":"_onClick"},initialize:function(e){t.bindAll(this,"render","close","_onLinkPreviewLoaded"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined"),console.assert(this.options.community_id&&this.options.community_id!==""),console.assert(this.options.channel_id&&this.options.channel_id!=="")},render:function(){var t=this.options.sharedObjects.comms.user_id,n=!1,r=this.model.get("message"),a=this.model.get("message"),f="";if(r.startsWith("<span>")){var l=e(r),r=l.text();s.isImageUrl(r)&&(n=!0,f=r)}if(n){console.debug("is_image: "+n);var c=this,h=new Image,p=f.replace(u,o);h.onload=function(){c.$(".image-placeholder").hide(),c.trigger("attachmentLoaded",c)},h.src=p,h.className+="attachment";var d='<a href="'+p+'" target="_blank">'+h.outerHTML+"</a>";this.model.set("message",d),this.model.set("orig_message",a),this.$el.html(this.template(this.model.toJSON())),this.$(".image-placeholder").show()}else this.$el.html(this.template(this.model.toJSON()));var v=e.trim(this.$(".message").text()).length,m=this.$(".message").find("img.emoji").length;v===0&&m===1&&this.$(".emoji").addClass("large"),this.model.get("sender")===t?this.$(".name").addClass("me"):this.model.get("admin")===!0&&this.$(".name").addClass("admin-message"),this.$el.data("model",this.model);var g=e("<div>"+this.model.get("message_emoji")+"</div>"),y=g.find("span.tagged"),c=this;y.each(function(n){var r=e(this).attr("data-userid");r===t&&c.options.highlightSection&&c.options.highlightSection()});var b=this.$(".message").find("a");if(b.length===1&&!n){var p=e(b[0]).attr("href");console.debug("Loading link preview for: "+p),console.debug("community_id: "+this.options.community_id+" channel_id: "+this.options.channel_id);var w={community_id:this.options.community_id,channel_id:this.options.channel_id,url:p,margin_left:0,chat_message:this.model,comms:this.options.sharedObjects.comms,commsCommunity:this.options.sharedObjects.commsCommunity};p===this.$(".message").text()||p===this.$(".message").text()+"/"?(w.margin_top=30,w.anchor=e(b[0])):w.margin_top=50;var E=new i(w);this.$el.append(E.render().el),E.on("loaded",this._onLinkPreviewLoaded)}return this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onClick:function(){console.debug("_onClick"),console.debug(this.model.toJSON())},_onLinkPreviewLoaded:function(){console.debug("_onLinkPreviewLoaded"),this.trigger("previewLoaded",this)}});return a}),define("text!templates/communities/announcement/motd.html",[],function(){return'<div class="entry-message">    \n	<div class="title">\n        <span class="green">Welcome Message</span>   \n	</div>\n    <div class="message"><%- channel_message.message %></div>\n</div>\n<div class="announcement">\n    <div class="title">\n        <span class="green">Announcement</span><span class="grey">, posted by </span><span class="sender" style="display:inline"><%= announcement.by.name_emoji %></span>\n		<span class="timestamp"><%- announcement.date %></span>\n	</div>\n    <div class="message"><%= announcement.message_emoji %></div>\n</div>\n\n'}),define("views/communities/announcement/motdview",["jquery","backbone","text!templates/communities/announcement/motd.html"],function(e,t,n){var r=t.View.extend({tagName:"div",className:"motd-view",events:{},options:{},initialize:function(e){_.bindAll(this,"render"),this.template=_.template(n),this.options=e,this.commsCommunity=e.sharedObjects.commsCommunity;var t=this;this.model.on("change",function(e){console.debug("model changed, rendering"),t.render()})},render:function(){return console.debug("motd model"),console.debug(this.model.toJSON()),this.$el.html(this.template(this.model.toJSON())),this.model.hasAnnouncement()?console.debug("render: hasAnnouncement"):(console.debug("render: no announcement"),this.$(".announcement").hide()),this.model.hasEntryMessage()?console.debug("render: hasEntryMessage"):this.$(".entry-message").hide(),this},close:function(){console.debug("close"),this.commsCommunity.off(null,null,this),this.unbind(),this.remove()}});return r}),define("models/communities/motd",["underscore","backbone","rcemoji/rcemoji","autolinker","moment"],function(e,t,n,r,i){var s=t.Model.extend({defaults:{channel_message:{message:"",by:{id:"",name:"",comms_id:""}},announcement:{message:"",message_id:"",timestamp:"",by:{id:"",name:""}},announcement_id:""},initialize:function(){this._setEmojiMessage(),this._setEmojiName(),this._setTimestamp(),this.on("change:announcement",this._setEmojiMessage),this.on("change:announcement",this._setEmojiName),this.on("change:announcement",this._setTimestamp2)},hasEntryMessage:function(){return this.get("channel_message").message!==""?!0:!1},hasAnnouncement:function(){return this.has("announcement")&&this.get("announcement").message!==""?!0:!1},_setEmojiMessage:function(){var e=this.get("announcement").message.replace(new RegExp("\r?\n","g"),"<br>"),t=r.link(e,{stripPrefix:!1,twitter:!1}),i=this,s=$("<div>"+t+"</div>"),o=s.html();o=n.parse(o),console.debug("text"),console.debug(o);var u=this.get("announcement");u.message_emoji=o,console.debug("announcement"),console.debug(u),this.set("announcement",u),console.debug("this"),console.debug(this)},_setEmojiName:function(){var e=this.get("announcement").by.name,t=this.get("announcement");t.by.name_emoji=n.parse(e),this.set("announcement",t)},_pad:function(e,t){var n=Math.pow(10,t);return e<n?(""+(n+e)).slice(1):""+e},_setTimestamp:function(){var e=new Date(parseInt(this.get("announcement").timestamp)),t="",n=e.getHours();e.getHours()>12?(t="PM",n-=12):t="AM";var r=n+":"+this._pad(e.getMinutes(),2)+" "+t,s=new Date,o=s.toLocaleDateString();if(o==e.toLocaleDateString())var u="Today";else{s.setDate(s.getDate()-1);if(s.toLocaleDateString()===e.toLocaleDateString())var u="Yesterday";else var u=i(e).format("dddd, MMMM Do")}var a=this.get("announcement");a.date=u,a.time=r,this.set("announcement",a)},_setTimestamp2:function(){var e=new Date(parseInt(this.get("announcement").timestamp)),t=i(e).fromNow(),n=this.get("announcement");n.date=t,this.set("announcement",n)}});return s}),define("views/communities/channelmessagesview",["jquery","underscore","backbone","text!templates/communities/channelmessagesview.html","models/channelmessagemodel","collections/channelmessagescollection","views/communities/channelmessageitemview","nicescroll","contenteditable","models/channelmodel","views/chatmessages/datesectionview","views/communities/announcement/motdview","models/communities/motd","utils","views/picviewer/picviewerview"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=n.View.extend({tagName:"div",className:"channel-messages-view",collection:{},rendering:!1,cached_messages:null,didScroll:!1,offset:null,events:{"click a":"_onLinkClick"},initialize:function(e){this.template=t.template(r),t.bindAll(this,"render","_onMessages","_displayChannelInfo","close","_onMessage","scrollToBottom","_onAnnouncementPosted","_onAnnouncementCleared","_appendChatCollection","_onLinkPreviewLoaded","_onScroll"),t.bindAll(this,"_showAnnouncement","_checkNewSection","_sameAsCached","_onAttachmentLoaded"),t.bindAll(this,"_onMessagePagination"),this.options=e,this.commsCommunity=e.sharedObjects.commsCommunity,this.rendering=!1,this.collection=new s,this.cached_messages=null,this.didScroll=!1,this.offset=null;var n=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id}),i=this.commsCommunity.getCachedMessages({community_id:this.options.community_id,channel_id:this.options.channel_id});console.debug("initialize"),i?n?n.unread_mention===0&&this.fetchMessages():this.fetchMessages():this.fetchMessages(),this.channelmodel=new f;var o="message."+e.channel_id;this.commsCommunity.on(o,this._onMessage,this),this.model.bind("change",this._displayChannelInfo,this),this.model.bind("change",this._setInFocus,this),this._setInFocus();var u="post_announcement."+this.options.community_id;this.commsCommunity.on(u,this._onAnnouncementPosted,this);var a="clear_announcement."+this.options.community_id;this.commsCommunity.on(a,this._onAnnouncementCleared,this)},fetchMessages:function(){console.debug("fetch messages"),this.commsCommunity.getMessages2({community_id:this.options.community_id,channel_id:this.options.channel_id,success:this._onMessages})},render:function(){var e=this.commsCommunity.getCachedChannel({community_id:this.options.community_id,channel_id:this.options.channel_id});e?this.channelmodel=new f(e):console.debug("dont have cached channel---"+this.options.channel_id),this.$el.html(this.template(this.channelmodel.toJSON()));var n=this.commsCommunity.getCachedMessages({community_id:this.options.community_id,channel_id:this.options.channel_id});return this.$(".messages").on("scroll",this._onScroll),this.$(".messages").niceScroll(t.extend({horizrailenabled:!1},this.options.sharedObjects.niceScrollOptions)),this.$(".message-input").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this.$(".message-input").contentEditable(),this.$(".message-input").focus(),n?(console.debug("have cached messages"),this._onMessages(n),this.cached_messages=n):console.debug("dont have cached messages"),this},close:function(){console.debug("close: "+this.channelmodel.get("name")),this.commsCommunity.off(null,null,this),this.$(".messages").getNiceScroll().remove(),this.$(".message-input").getNiceScroll().remove(),this.remove(),this.unbind()},_onMessages:function(e){console.debug("_onChatMessages: length: "+e.data.length),this.offset=e.offset;if(this._sameAsCached(e))return;this.collection.reset();for(var t=0;t<e.data.length;++t){var n=new i(e.data[t]);this.collection.add(n)}this.$(".messages").empty(),this._appendChatCollection(this.$(".messages"),this.collection),this.options.onMessages&&this.options.onMessages(e.data.length)},_appendChatCollection:function(t,n,r){var i=this,s="";typeof r=="undefined"&&(r=!0);var u=this.commsCommunity.getAnnouncementMarker(this.options.channel_id),a=!1,f=e("<div/>");for(var c=0;c<n.length;++c){this.rendering=!0;var h=n.at(c);if(s!==h.get("date")){s=h.get("date");var p=new l({date:s});f.append(p.render().el)}this.lastview=f.find(".channel-message-item-view:last");var d=this.lastview.data("model");d&&(h=this._setDifference(d,h)),this._checkNewSection(f,d,h);var v={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:h,prev_model:d,highlightSection:function(){f.find(".message_section.current").addClass("highlight")}},m=new o(v);m.on("previewLoaded",this._onLinkPreviewLoaded,this),m.on("attachmentLoaded",this._onAttachmentLoaded,this),f.find(".message_section.current").append(m.render().el),u&&h.get("message_id")===u&&(a=!0,this._showAnnouncement(f))}a||this._showAnnouncement(f),t.append(f.children()),r&&setTimeout(function(){i.scrollToBottom()},0)},_checkNewSection:function(e,t,n){var r=e.find("> div:last-child");if(r.length>0&&r.hasClass("motd-view")){console.debug("Last entry is MOTDView"),this._createSection(e);return}if(t){var i=this._checkTagged(n);i?(this.options.userToReply&&this.options.userToReply(n),this._createSection(e)):(i=this._checkTagged(t),i?this._createSection(e):n.get("sender")!==t.get("sender")?this._createSection(e):n.get("difference_timestamp")>=5&&this._createSection(e))}else this._createSection(e)},_checkTagged:function(t){var n=this.options.sharedObjects.comms.user_id,r=e("<div>"+t.get("message")+"</div>"),i=r.find("span.tagged"),s=this,o=!1;return i.each(function(t){var r=e(this).attr("data-userid");r===n&&(o=!0)}),o},_createSection:function(e){e.find(".message_section").removeClass("current"),e.append('<div class="message_section current"></div>')},_setDifference:function(e,t){t.set("difference_timestamp",undefined);if(e.get("sender")===t.get("sender")){var n=new Date(parseInt(t.get("timestamp"))),r=new Date(parseInt(e.get("timestamp"))),i=n.getTime()-r.getTime(),s=Math.round(i/6e4);t.set("difference_timestamp",s)}return t},scrollToBottom:function(e){e=typeof e!="undefined"?e:!1;var t=this;if(e){if(this.scrolling)return;this.scrolling=!0,this.$(".messages").animate({scrollTop:this.$(".messages")[0].scrollHeight},1e3,function(){t.scrolling=!1})}else this.$(".messages").scrollTop(this.$(".messages")[0].scrollHeight)},_displayChannelInfo:function(){console.debug("displayChannelInfo");var e=this.commsCommunity.getCachedChannel({community_id:this.options.community_id,channel_id:this.options.channel_id});e?this.channelmodel=new f(e):console.debug("dont have cached channel---"+this.options.channel_id),this.channelmodel.get("name")!==""&&this.$(".channelname").text(this.channelmodel.get("name")+" : "),this.$(".channeltopic").text(this.channelmodel.get("topic"))},_onMessage:function(e,t){console.debug("_onMessage: "+JSON.stringify(t)),this.options.closeOnboardView&&this.options.closeOnboardView();var n=this,r=e.split("."),s=r[2];if(s===this.options.channel_id){t.timestamp=Date.now();var u=new i(t),a=this.collection.at(this.collection.length-1);a&&(u=this._setDifference(a,u));var f=this._isScrollbarAtBottom(this.$(".messages"));this._checkNewSection(this.$(".messages"),a,u);var l={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:u,prev_model:a,highlightSection:function(){n.$(".messages .message_section.current").addClass("highlight")}},c=new o(l);c.on("previewLoaded",this._onLinkPreviewLoaded,this),c.on("attachmentLoaded",this._onAttachmentLoaded,this),this.$(".messages .message_section.current").append(c.render().el),this.collection.add(u),f?(console.debug("at bottom scrolling to bottom"),this.scrollToBottom(!1)):console.debug("not at bottom not scrolling to end")}},_setInFocus:function(){this.commsCommunity.setCommunityFocus({community_id:this.options.community_id,in_focus:!0})},_onLinkClick:function(t){console.debug("_onLinkClick URL: "+e(t.currentTarget).attr("href"));var n=e(t.currentTarget).attr("href");if(!n||n==="")return;if(n.indexOf("http://razer.net")===0){console.debug("Razer Short URL"),t.preventDefault();var r=this;this.options.sharedObjects.comms.expandUrl({short_url:n,success:function(e){console.debug("expandUrl: response: "+JSON.stringify(e));if(e.long_url.indexOf("https://web.comms.razerzone.com")===0){var t=e.long_url.split("#");t.length>1?r.options.sharedObjects.router.navigate(t[1],{trigger:!0}):window.location.href=e.long_url}}})}else if(p.isImageUrl(n)){t.preventDefault();var i=new d({imgUrl:n});i.popup();return}},_onAnnouncementPosted:function(e,t){console.debug("_onAnnouncementPosted"),console.debug(t);var n=t.announcement,r=new h,i={message:n.message,timestamp:n.timestamp,by:{id:n.sender,name:n.sender_name}};r.set("announcement",i);var s=new c({model:r,sharedObjects:this.options.sharedObjects});this.$(".messages").append(s.render().el),this.scrollToBottom(!0),this._markAnnouncementAsRead(n.message_id)},_markAnnouncementAsRead:function(e){var t=this;this.commsCommunity.markAnnouncementRead({community_id:this.options.community_id,message_id:e,success:function(){}})},_onAnnouncementCleared:function(e,t){console.debug("_onAnnouncementCleared"),this.$(".motd-view").remove()},_showAnnouncement:function(e){var t=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id});if(t){if(t.last_announcement){var n=t.last_announcement,r=new h,i={message:n.message,timestamp:n.timestamp,by:{id:n.sender,name:n.sender_name}};r.set("announcement",i);var s=new c({model:r,sharedObjects:this.options.sharedObjects});e.append(s.render().el),t.last_announcement.unread_count>0&&this._markAnnouncementAsRead(t.last_announcement.message_id)}}else{var o=this;console.debug("No cached community, waiting"),this.commsCommunity.once("communityList",function(e){console.debug("_showAnnouncement: got communityList event"),o._showAnnouncement(o.$(".messages")),o.scrollToBottom(!1)})}},_isScrollbarAtBottom:function(e){var t=e.height(),n=e[0].scrollHeight,r=e.scrollTop();return r+=2,r>=n-t?!0:!1},_onLinkPreviewLoaded:function(e){var t=this._isScrollbarAtBottom(this.$(".messages"));e.$(".link-preview-view").show();if(t)this.scrollToBottom(!1);else if(!this.didScroll){console.debug("Did not scroll but not at bottom");var n=this;setTimeout(function(){n.scrollToBottom(!1)},10)}else this.trigger("attachmentLoaded")},_onAttachmentLoaded:function(e){var t=this._isScrollbarAtBottom(this.$(".messages"));e.$("img.attachment").show(),t?(this.scrollToBottom(!1),console.debug("_onAttachmentLoaded: at bottom")):(console.debug("_onAttachmentLoaded: not at bottom"),this.trigger("attachmentLoaded"))},_sameAsCached:function(e){if(this.cached_messages){console.debug("cached_messages"),console.debug(this.cached_messages),console.debug("from server:"),console.debug(e);if(e.data.length>0&&this.cached_messages.data.length>0){var t=e.data[e.data.length-1].timestamp,n=this.cached_messages.data[this.cached_messages.data.length-1].timestamp;if(t===n)return console.debug("messages are the same as the cached"),!0}}return!1},_onScroll:function(){var e=this;this.didScroll=!0;if(!this.offset)return;var t=this.$(".messages").scrollTop();t===0&&this.commsCommunity.getMessages2({community_id:this.options.community_id,channel_id:this.options.channel_id,offset:this.offset,success:this._onMessagePagination})},_onMessagePagination:function(e){if(e.data.length===0)return;var t=this;this.offset=e.offset;var n=new s(e.data);this.collection.add(n.models,{at:0});var r=this.$(".messages")[0].scrollHeight,i=this._getAttachmentCount(this.collection);console.debug("total_attachments: "+i),this.collection.totalAttachments=i,this.collection.counter=0,i>0&&this.on("attachmentLoaded",function(){t.collection.counter++;var e=t.collection.counter,n=t.collection.totalAttachments;console.debug("_onMessagePagination: counter: "+e+" total: "+n);if(e===n){t.$(".messages").empty(),t.$(".messages").append(t.$(".temp-messages").children()),t.$(".temp-messages").empty(),t.$(".temp-messages").hide();var i=t.$(".messages")[0].scrollHeight;console.debug("_onScroll: new_height: "+i+" orig_height: "+r+" diff: "+(i-r)),i>r&&t.$(".messages").scrollTop(i-r),t.off("attachmentLoaded")}},this),this._appendChatCollection(this.$(".temp-messages"),this.collection,!1),this.$(".temp-messages").show();if(i==0){t.$(".messages").empty(),t.$(".messages").append(t.$(".temp-messages").children()),t.$(".temp-messages").empty(),t.$(".temp-messages").hide();var o=t.$(".messages")[0].scrollHeight;console.debug("_onScroll: new_height: "+o+" orig_height: "+r+" diff: "+(o-r)),o>r&&t.$(".messages").scrollTop(o-r)}},_getAttachmentCount:function(t){var n=0;return t.each(function(t){t.has("orig_message")&&t.set("message",t.get("orig_message"));var r=t.get("message");if(r.startsWith("<span>")){var i=e(r),r=i.text();if(p.isImageUrl(r)){t.unset("attachment"),n++;return}}if(t.has("attachment")){n++;return}}),n}});return v}),define("text!templates/communities/channelmemberlistview.html",[],function(){return'<div class="loading"></div>\r\n<div class="content">\r\n	<div class="list">\r\n		<div class="main">\r\n			<div class="friends_container">\r\n				<div class="heading friends">ONLINE FRIENDS (<span class="count">0</span>)</div>\r\n				<div class="friendlist"></div>\r\n			</div>\r\n			<div class="members_container">\r\n				<div class="heading members">ONLINE MEMBERS (<span class="count">0</span>)</div>\r\n				<div class="memberlist"></div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!templates/communities/channelmemberitemview.html",[],function(){return'<img src="<%- avatar %>" class="avatar">\r\n<div class="presence <%- presence %>"></div>\r\n<span class="username"><%= nickname_emoji %></span>\r\n<span class="mic razericons-mic"></span>\r\n'}),define("views/communities/channelmemberitemview",["jquery","underscore","backbone","text!templates/communities/channelmemberitemview.html"],function(e,t,n,r){var i=n.View.extend({className:"channel-member-item-view",events:{click:"_onClick","click .mic":"_onMicClick"},initialize:function(e){t.bindAll(this,"render","_onStartCall","_onEndCall","_onPromoted","_onDemoted"),this.template=t.template(r),this.options=e;var n=this;this.model.on("change:removed",function(e){e.get("removed")&&n.close()}),console.assert(e.commsCommunity),this.model.on("change",this.render,this),this.options.commsCommunity.CallHandler.on("startCall",this._onStartCall,this),this.options.commsCommunity.CallHandler.on("endCall",this._onEndCall,this);var i="promote."+this.model.get("id")+this.options.community_id,s="demote."+this.model.get("id")+this.options.community_id;this.options.commsCommunity.on(i,this._onPromoted,this),this.options.commsCommunity.on(s,this._onDemoted,this)},render:function(){this.model.get("presence")===""&&this.model.set("presence","online"),this.$el.html(this.template(this.model.toJSON()));if(this.model.get("info").role==="owner"||this.model.get("info").role==="admin")this.$(".username").removeClass("member"),this.$(".username").addClass("admin");return this.options.commsCommunity.isCurrentUser(this.model.get("id"))&&this.$el.addClass("me"),this.options.commsCommunity.CallHandler.isCallActive()?this.$(".mic").removeClass("disabled"):this.$(".mic").addClass("disabled"),this.model.get("voice_enabled")?this.$(".mic").show():this.$(".mic").hide(),this.model.get("local_mute")?this.$(".mic").removeClass("speaking"):this.model.get("is_talking")?this.$(".mic").addClass("speaking"):this.$(".mic").removeClass("speaking"),this.model.get("local_mute")?(this.$(".mic").removeClass("razericons-mic"),this.$(".mic").addClass("razericons-mic_mute"),this.$(".mic").addClass("local-mute")):(this.$(".mic").addClass("razericons-mic"),this.$(".mic").removeClass("razericons-mic_mute"),this.$(".mic").removeClass("local-mute")),this},close:function(){this.remove(),this.unbind(),this.options.commsCommunity.CallHandler.off(null,null,this)},_onPromoted:function(e,t){console.debug("_onPromoted");var n=this.model.get("info");n.role="admin",this.model.set("info",n),this.$(".username").removeClass("member"),this.$(".username").addClass("admin")},_onDemoted:function(){console.debug("_onDemoted");var e=this.model.get("info");e.role="member",this.model.set("info",e),this.$(".username").removeClass("admin"),this.$(".username").addClass("member")},_onClick:function(){this.options.onItemClick&&this.options.onItemClick(),this.$el.addClass("active")},_onMicClick:function(){if(this.$el.hasClass("me"))return;this.options.commsCommunity.CallHandler.isCallActive()&&this.model.get("voice_enabled")&&this.options.commsCommunity.CallHandler.setLocalMute(this.model.get("id"),!this.model.get("local_mute"))},_onStartCall:function(){this.$(".mic").removeClass("disabled")},_onEndCall:function(){this.$(".mic").addClass("disabled")}});return i}),define("models/communities/channelusermodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r="https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png",i=t.Model.extend({defaults:{name:"",avatar:"",presence:"",role:"",voice_enabled:!1,is_talking:!1,local_mute:!1,info:{comms_id:"",role:""}},initialize:function(){this._setEmojiName(),this.changeAvatar(),this.on("change:avatar",this.changeAvatar)},_setEmojiName:function(){this.set("nickname_emoji",n.parse(this.escape("nickname")))},changeAvatar:function(){if(this.get("avatar")!==""&&this.get("avatar")!==r){var e=this.get("avatar").split("/"),t=e[e.length-1],n="https://dbq9ithrljsz0.cloudfront.net/"+t;this.set("avatar",n)}else this.set("avatar",r)}});return i}),define("collections/channelmemberscollection",["underscore","backbone","models/communities/channelusermodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){var n=e.get("nickname");n&&(n=n.toLowerCase());var r=t.get("nickname");r&&(r=r.toLowerCase());var i=e.get("role"),s=t.get("role");return i==="owner"&&(i="admin"),s==="owner"&&(s="admin"),i===s?n>r?1:n<r?-1:0:i==="admin"?-1:s==="admin"?1:n>r?1:n<r?-1:0}});return r}),define("delayedexecution",["underscore","backbone"],function(e,t){var n=function(e){e||(e={}),this.initialize.apply(this,arguments)};return e.extend(n.prototype,t.Events,{tooFast:!1,executing:!1,options:{},lastExec:null,initialize:function(t){e.bindAll(this,"execute"),this.tooFast=!1,this.executing=!1,this.options.func=t.func,this.options.delay=t.delay,this.lastExec=null},isTooFast:function(){return Date.now()-this.lastExec<this.options.delay*1e3?this.tooFast=!0:this.tooFast=!1,this.tooFast},isExecuting:function(){return this.executing},execute:function(){var e=this;this.isTooFast()?this.isExecuting()||(this.executing=!0,setTimeout(function(){e.options.func(),e.lastExec=Date.now(),e.executing=!1},this.options.delay*1e3)):(this.options.func(),this.lastExec=Date.now(),this.executing=!1)}}),n}),define("views/communities/channelmemberlistview",["jquery","underscore","backbone","text!templates/communities/channelmemberlistview.html","velocity-ui","views/communities/channelmemberitemview","models/communities/channelusermodel","collections/channelmemberscollection","delayedexecution"],function(e,t,n,r,i,s,o,u,a){var f=100,l=n.View.extend({className:"channel-member-list-view",options:{community_id:null,channel_id:null,sharedObjects:null},users:[],friends:[],channel:null,memberCollection:null,friendCollection:null,offset:null,renderMembers:null,initialize:function(e){t.bindAll(this,"_onMemberList","render","close","onItemClick","_onFriendPresence","_onCommunityInfo","renderMemberList","_onScroll","_onJoinSession","_onLeaveSession","_onTalkState"),this.template=t.template(r),this.options=e,this.channel=null,this.comms=this.options.sharedObjects.comms,this.commsCommunity=this.options.sharedObjects.commsCommunity,this.users=[],this.friends=[];var n="joinChannel."+this.options.channel_id;this.commsCommunity.on(n,this._onJoinChannel,this);var n="leaveChannel."+this.options.channel_id;this.commsCommunity.on(n,this._onLeaveChannel,this),this.commsCommunity.CallHandler.listenForTalkState({community_id:this.options.community_id,channel_id:this.options.channel_id,onJoinSession:this._onJoinSession,onLeaveSession:this._onLeaveSession,onTalkState:this._onTalkState,context:this}),this.commsCommunity.CallHandler.on("localMute",this._onLocalMute,this),this.memberCollection=new u,this.friendCollection=new u,this.comms.on("friendPresence",this._onFriendPresence,this),this.renderMembers=new a({func:this.renderMemberList,delay:3})},render:function(){return this.$el.html(this.template()),this.channel=this.commsCommunity.getCachedChannel({community_id:this.options.community_id,channel_id:this.options.channel_id}),this.channel&&(this.users=this.channel.online_members,this.friends=this.channel.online_friends,this.renderFriendList(),this.renderMemberList(this.channel.online_members)),this.$(".list").on("scroll",this._onScroll),this.$(".list").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this},getCachedMembers:function(){return this.channel=this.commsCommunity.getCachedChannel({community_id:this.options.community_id,channel_id:this.options.channel_id}),this.channel?this.channel.online_members:null},getCachedFriends:function(){return this.channel=this.commsCommunity.getCachedChannel({community_id:this.options.community_id,channel_id:this.options.channel_id}),this.channel?this.channel.online_friends:null},_onScroll:function(){var e=this.$(".list").scrollTop(),t=this.$(".main").height()-this.$(".list").height(),n=this;e===t&&(n.$(".pagination-progress").css("visibility","visible"),this.commsCommunity.getActive({community_id:this.options.community_id,channel_id:this.options.channel_id,limit:f,offset:this.offset,success:function(e){e.data.length>0?(n._setOffset(e.data),Array.prototype.push.apply(n.users,e.data),n.renderMemberList(n.users)):n.$(".memberlist .pagination-progress").remove()}}))},close:function(){this.remove(),this.unbind(),this.commsCommunity.off(null,null,this),this.commsCommunity.CallHandler.off(null,null,this),this.commsCommunity.CallHandler.unlistenForTalkState({channel_id:this.options.channel_id,context:this}),this.comms.off(null,null,this)},_onCommunityInfo:function(e){var t=e.channels;if(t.length>0)for(var n=0;n<t.length;n++){var r=t[n];if(r.id===this.options.channel_id){this.channel=r;break}var i=r.channels;if(i.length>0)for(var s=0;s<i.length;s++){var o=i[s];if(o.id===this.options.channel_id){this.channel=o;break}var u=o.channels;if(u.length>0)for(var a=0;a<u.length;a++){var f=u[a];if(f.id===this.options.channel_id){this.channel=f;break}}}}this.channel?(this.users=this.channel.online_members,this._setOffset(this.users),this.friends=this.channel.online_friends,this.renderFriendList(),this.renderMemberList()):console.assert("channel not found---"+this.options.channel_id)},_setOffset:function(e){var t=e[e.length-1];t&&(this.offset=t.offset)},_onMemberList:function(e){},renderMemberList:function(e){this.$(".members_container").hide(),this.$(".list .memberlist").empty(),this.memberCollection.each(function(e){e.set("removed",!0)}),this.memberCollection.reset();for(var t=0;t<this.users.length;t++){var n=new o(this.users[t]);n.get("nickname")!==""&&this.memberCollection.add(n)}if(this.memberCollection.length>0){var r=this;this.memberCollection.each(function(e){var t={model:e,onItemClick:r.onItemClick,commsCommunity:r.commsCommunity,community_id:r.options.community_id},n=new s(t);r.$(".list .memberlist").append(n.render().el)}),this.setOnlineMembersCount(),this.$(".memberlist").append('<div class="pagination-progress"></div>'),this.$(".members_container").show(),this.$(".list").getNiceScroll().resize()}},renderFriendList:function(){this.$(".friends_container").hide(),this.$(".list .friendlist").empty(),this.friendCollection.each(function(e){e.set("removed",!0)}),this.friendCollection.reset();for(var e=0;e<this.friends.length;e++){var t=new o(this.friends[e]);this.friendCollection.add(t)}if(this.friendCollection.length>0){var n=this;this.friendCollection.each(function(e){var t=n.options.sharedObjects.friendCollection.get(e.get("id"));t&&e.set("presence",t.get("presence"));var r={model:e,onItemClick:n.onItemClick,commsCommunity:n.commsCommunity,community_id:n.options.community_id},i=new s(r);n.$(".list .friendlist").append(i.render().el)}),this.$(".heading.friends .count").text(this.friendCollection.length),this.$(".friends_container").show()}},setOnlineMembersCount:function(){if(this.channel){var e=this.channel.online_members_count;if(e<100)var e=this.memberCollection.length}else var e=this.memberCollection.length;this.$(".heading.members .count").text(e)},_onJoinChannel:function(t,n){var r=this.options.sharedObjects.friendCollection.get(n.user.id);r&&e.inArray(n.user,this.friends)===-1&&(this.friends.push(n.user),this.renderFriendList(),this.commsCommunity.updateCachedFriends({channel_id:this.options.channel_id,online_friends:this.friends})),n.user.id==this.options.sharedObjects.comms.user_id?this.commsCommunity.getCommunity({community_id:this.options.community_id,success:this._onCommunityInfo}):(e.inArray(n.user,this.users)===-1&&this.users.push(n.user),this.renderMembers.execute())},_onLeaveChannel:function(e,t){for(var n=0;n<this.users.length;n++){var r=this.users[n];t.user.offset===r.offset&&t.user.id===r.id&&this.users.splice(n,1)}this.renderMembers.execute();for(var n=0;n<this.friends.length;n++){var i=this.friends[n];t.user.id===i.id&&this.friends.splice(n,1)}this.commsCommunity.updateCachedFriends({channel_id:this.options.channel_id,online_friends:this.friends}),this.renderFriendList(this.users)},onItemClick:function(){this.$(".channel-member-item-view").removeClass("active")},_onFriendPresence:function(e){var t=this.friendCollection.get(e.user_id);t&&t.set("presence",e.presence)},_onJoinSession:function(e){console.debug("_onJoinSession: "+JSON.stringify(e));var t=this.memberCollection.get(e.user.id);if(t){t.set("voice_enabled",!0);for(var n=0;n<this.users.length;n++)this.users[n].id===e.user.id&&(this.users[n].voice_enabled=!0)}var t=this.friendCollection.get(e.user.id);if(t){t.set("voice_enabled",!0);for(var n=0;n<this.friends.length;n++)this.friends[n].id===e.user.id&&(this.friends[n].voice_enabled=!0)}},_onLeaveSession:function(e){console.debug("_onLeaveSession: "+JSON.stringify(e));var t=this.memberCollection.get(e.user.id);if(t){t.set("voice_enabled",!1);for(var n=0;n<this.users.length;n++)this.users[n].id===e.user.id&&(this.users[n].voice_enabled=!1)}var t=this.friendCollection.get(e.user.id);if(t){t.set("voice_enabled",!1);for(var n=0;n<this.friends.length;n++)this.friends[n].id===e.user.id&&(this.friends[n].voice_enabled=!1)}},_onTalkState:function(e){var t=this.memberCollection.get(e.user.id);t?t.set("is_talking",e.data.speaking):console.debug("talkState user not found");var t=this.friendCollection.get(e.user.id);t&&t.set("is_talking",e.data.speaking)},_onLocalMute:function(e){console.debug("_onLocalMute: data: "+JSON.stringify(e));var t=this.memberCollection.get(e.user.id);if(t){t.set("local_mute",e.value);for(var n=0;n<this.users.length;n++)this.users[n].id===e.user.id&&(this.users[n].local_mute=e.value)}var t=this.friendCollection.get(e.user.id);if(t){t.set("local_mute",e.value);for(var n=0;n<this.friends.length;n++)this.friends[n].id===e.user.id&&(this.friends[n].local_mute=e.value)}}});return l}),define("text!templates/communities/mentionuserview.html",[],function(){return'<div class="loader"></div>'}),define("text!templates/communities/mentionuseritemview.html",[],function(){return'<img src="<%- avatar %>" class="avatar">\r\n<div class="username"><%= nickname_emoji %></div>\r\n<div class="comms_id"></div>'}),define("views/communities/mentionuseritemview",["jquery","underscore","backbone","text!templates/communities/mentionuseritemview.html"],function(e,t,n,r){var i=n.View.extend({className:"mention-user-item-view",events:{click:"_onClick"},initialize:function(e){t.bindAll(this,"close"),this.options=e,this.template=t.template(r),this.model.on("change:removed",function(e){e.get("removed")&&self.close()})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.data("model",this.model),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onClick:function(e){console.debug("_onClick"),this.options.onSelected&&this.options.onSelected(this.model)}});return i}),define("views/communities/mentionuserview",["jquery","underscore","backbone","text!templates/communities/mentionuserview.html","collections/channelmemberscollection","models/communities/channelusermodel","views/communities/mentionuseritemview"],function(e,t,n,r,i,s,o){var u=n.View.extend({className:"mention-user-view",events:{click:"_onClick",keydown:"_onKeyDown",keypress:"_onSelected",mouseover:"focus"},options:{query:null,users:null},searchCollection:null,searched:!1,initialize:function(n){t.bindAll(this,"render","close","_onServerSearchResults","_onKeyDown"),this.options=n,this.template=t.template(r),this.searched=!1,this.comms=n.sharedObjects.comms,this.commsCommunity=n.sharedObjects.commsCommunity,this.searchCollection=new i,this.memberCollection=new i,this.options.users?this._onLocalSearchResults():this.commsCommunity.search({channel_id:this.options.channel_id,query:this.options.query,success:this._onServerSearchResults}),e(document).on("keydown",function(e){e.keyCode==9&&e.preventDefault()})},render:function(){this.$el.html(this.template());if(this.searched)if(this.searchCollection.length>0){e(".usermentioncontainer").show();var n=this;this.$(".loader").hide(),this.searchCollection.each(function(e){var r=t.extend({model:e,onSelected:n.options.onSelected},this.options),i=new o(r);n.$el.append(i.render().el)})}else this.$el.html("No Matching Results found"),e(".usermentioncontainer").hide();return this.focus(),this},focus:function(){this.$el.attr("tabindex","1"),this.$el.focus(),this.$el.find(".selected").length<1&&this.$el.children(".mention-user-item-view").eq(0).addClass("selected")},_onServerSearchResults:function(e){console.debug("_onServerSearchResults");var t=e.data,n=this.options.sharedObjects.comms.user_id;this.searchCollection.each(function(e){e.set("removed",!0)}),this.searchCollection.reset();for(var r=0;r<t.length;r++){var i=new s(t[r]);i.get("id")!==n&&this.searchCollection.add(i)}this.searched=!0,this.render()},_onLocalSearchResults:function(){var e=this.options.users;this.memberCollection.reset();var n=this.options.sharedObjects.comms.user_id;for(var r=0;r<e.length;r++){var i=new s(e[r]);i.get("id")!==n&&this.memberCollection.add(i)}var o=this.options.query,u=t.filter(this.memberCollection.models,function(e){var t=e.get("nickname");return t.toLowerCase().indexOf(o.toLowerCase())!=-1?!0:!1});this.searchCollection.each(function(e){e.set("removed",!0)}),this.searchCollection.reset();for(var r=0;r<u.length;r++)this.searchCollection.add(u[r]);console.debug("_onLocalSearchResults"),console.debug(u),this.searched=!0,this.render()},close:function(){this.searchCollection.reset(),this.memberCollection.reset(),this.remove(),this.unbind()},_onSelected:function(e){console.debug("_onSelected---"+e.which);if(e.which===13){e.preventDefault();var t=this.$el.find(".selected"),n=t.data("model");console.debug("on enter model"),console.debug(n),this.options.onSelected&&this.options.onSelected(n)}},_onKeyDown:function(e){var t=this;if(e.which=="38"||e.which=="40"){if(e.which=="38"){console.debug("up");var n=this.$el.find(".selected").prev(".mention-user-item-view");this.$el.find(".selected").removeClass("selected"),n.length>0?n.addClass("selected"):this.$el.children(".mention-user-item-view").eq(0).addClass("selected")}if(e.which=="40"){console.debug("down");var r=this.$el.find(".selected").next(".mention-user-item-view");this.$el.find(".selected").removeClass("selected"),r.length>0?r.addClass("selected"):this.$el.children().last().addClass("selected")}setTimeout(function(){t.$el.focus()},0),this._scrollToSelected()}},_scrollToSelected:function(){console.debug("_scrollToSelected");var e=this.$el.find(".selected").offset().top,t=this.$el.parent().outerHeight(),n=this.$el.find(".selected").height(),r=this.$el.parent().scrollTop(),i=this.$el.height()-this.$el.parent().height(),s=this;r===i,console.debug("selected_top: "+e+" height: "+t+" scrollTop: "+this.$el.parent().scrollTop());var o=this.$el.parent().outerHeight()+this.$el.parent().offset().top;console.debug("limit---"+o);if(e>o){var u=this.$el.parent().scrollTop()+n;console.debug("newscrolltop"),console.debug(u),this.$el.parent().scrollTop(u)}}});return u}),define("text!templates/communities/userbanned.html",[],function(){return'<div class="info">You have been banned from this community.</div>\r\n<div><div class="ok">OK</div></div>'}),define("views/communities/userbanned",["jquery","underscore","backbone","text!templates/communities/userbanned.html","rcdialog"],function(e,t,n,r,i){var s=n.View.extend({className:"user-banned-view",events:{},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),console.assert(typeof this.model!="undefined"),this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}),w2popup.close(),this.remove(),this.unbind()},popup:function(){var t=this;w2popup.open({body:'<div class="user-banned"></div>',width:400,height:220,modal:!0,opacity:.9,showClose:!1,speed:.4,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .user-banned").append(t.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){t.close()}),e("#w2ui-popup .ok").on("click",function(e){t.close()})}}})}});return s}),define("text!templates/communities/create/onboardcommunity.html",[],function(){return'<div class="title"><span class="congrats bold">Congratulation ! </span> <span class="color76">You\'ve successfully created a new Community.</span></div>\r\n<div class="line2">You can start <span class="grey bold">inviting friends, create channels</span> and <span class="grey bold">personalise</span> your Community by adding a profile picture and a banner.</div>\r\n<div class="buttons">\r\n	<div class="button invite-friends"><span class="razericons-user_add icon"></span><span class="text green">INVITE FRIENDS</span></div>\r\n	<div class="button add-channel"><span class="razericons-add icon"></span><span class="text green">ADD A CHANNEL</span></div>\r\n	<div class="button personalize"><span class="razericons-camera icon"></span><span class="text green">PERSONALIZE</span></div>\r\n</div>\r\n<div class="invite_container">\r\n    <div class="content">\r\n        <div class="ititle">INVITE</div>\r\n        <div class="stext">Share this link with your friends to invite them to this community</div>\r\n        <div class="ibox">\r\n            <div class="link">Generating link...</div>\r\n            <div class="rc-button rc-disabled-button copy">COPY</div>\r\n        </div>\r\n        \r\n        <button class="copy-link-btn" data-clipboard-action="copy" data-clipboard-text="">COPY</button>\r\n    </div>\r\n</div>'}),define("text!templates/communities/create/createcommunity.html",[],function(){return'<div class="page1">\r\n	<div class="title">Create a Community</div>\r\n	<input name="community-name" class="community-name-input" type="text" placeholder="NAME YOUR COMMUNITY"></input>\r\n	<textarea name="description" placeholder="DESCRIBE YOUR COMMUNITY"></textarea>\r\n	<div class="privacy_buttons">\r\n		<div class="public on btn">PUBLIC</div>\r\n		<div class="private off btn">PRIVATE</div>\r\n	</div>\r\n	<div class="privacy_text">Anyone can find a public community when searching for it in Comms.</div>\r\n	<div class="step_text">Step 1/2</div>\r\n	<div class="button">\r\n		<div class="cancel btn">CANCEL</div>\r\n		<div class="create btn">CREATE</div>\r\n	</div>\r\n</div>\r\n<div class="page2">\r\n	<div class="title">Personalize your Community</div>\r\n	<div class="text_profile">ADD A PROFILE PICTURE AND A BANNER</div>\r\n	<div class="icons">\r\n		<div class="community-icon">\r\n			<img src="<%- icon %>">\r\n			<div class="update"><span class="razericons-camera"></span></div>\r\n		</div>\r\n		<input class="file-select-icon" type="file" name="upload" accept="image/*" name="community-icon">\r\n		<div class="community-banner">\r\n			<img src="<%- banner %>">\r\n			<div class="update"><span class="razericons-camera"></span></div>\r\n		</div>\r\n		<input class="file-select-banner" type="file" name="upload" accept="image/*" name="community-banner">\r\n	</div>\r\n	<div style="clear:both;"></div>\r\n	<div class="text_game">IS YOUR COMMUNITY GAME SPECIFIC?</div>\r\n	<div class="game_selector"></div>\r\n	<!-- <div class="step_text">Step 2/2</div>-->\r\n	<div class="button">\r\n		<div class="save btn rc-disabled-button">SAVE</div>\r\n		<!-- <div class="later btn">LATER</div>-->\r\n	</div>\r\n</div>'}),define("views/communities/create/createcommunity",["jquery","underscore","backbone","text!templates/communities/create/createcommunity.html","rcdialog","w2ui","views/communities/create/gameitem","models/communities/communitymodel","collections/gamecollection","models/communities/gamemodel","cryptojs_sha1","views/communities/create/onboardcommunity","views/imagecropper/imagecropperview"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=n.View.extend({className:"create-community-view",events:{},initialize:function(e){t.bindAll(this,"render","close","_onGameList","onNameKeyPress","onDescriptionKeyPress","onPrivacyPublic","onPrivacyPrivate","onCheckboxChanged","_uploadCommunityIcon","_uploadCommunityBanner"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity,this.commsCommunity.getMasterGameList({success:this._onGameList}),this.collection=new a,this.options.model?this.model=new u(this.options.model.toJSON()):this.model=new u},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$(".community-name-input").val(this.model.get("name")),this.$('textarea[name="description"]').val(this.model.get("description")),this.model.get("searchable")?this.selectPublic():this.selectPrivate(),this.$(".game_selector").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this},close:function(){s.close(),this.remove(),this.unbind()},popup:function(){var t=this;e("#w2ui-popup .create-community-container").remove(),e("#w2ui-popup .close").remove(),s.open({body:'<div class="create-community-container"></div>',width:534,height:518,modal:!1,opacity:.9,showClose:!1,speed:.4,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .create-community-container").append(t.render().el),e(".w2ui-popup .create-community-container .page1").show(),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){t.close()}),e("#w2ui-popup .create").on("click",function(e){t.onCreateClicked()}),e("#w2ui-popup .cancel").on("click",function(e){t.close()}),e(".w2ui-popup .community-name-input").keyup(t.onNameKeyPress),e('.w2ui-popup textarea[name="description"]').keyup(t.onDescriptionKeyPress),e(".w2ui-popup .privacy_buttons .public").click(t.onPrivacyPublic),e(".w2ui-popup .privacy_buttons .private").click(t.onPrivacyPrivate)}}})},nextPopup:function(){var t=this;e("#w2ui-popup .create-community-container").remove(),e("#w2ui-popup .close").remove(),s.open({width:614,height:525,body:'<div class="create-community-container"></div>',modal:!1,opacity:.9,showClose:!1,speed:.1,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .create-community-container").append(t.render().el),e(".w2ui-popup .create-community-container .page2").show(),e(".w2ui-popup .create-community-container .save").show(),t.renderGameList(),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){t.close()}),e("#w2ui-popup .back").on("click",function(e){t.popup()}),e("#w2ui-popup .later").on("click",function(e){t.routeToNewCommunity(),t.close()}),e("#w2ui-popup .save").on("click",function(e){t.updateCommunity()}),e(".w2ui-popup .file-select-icon").change(t._uploadCommunityIcon),e(".w2ui-popup .file-select-banner").change(t._uploadCommunityBanner)}}})},_onGameList:function(e){var t=e.data,r={id:"all",title:"All Games/ Not Game Specific"},i=new n.Model(r);this.collection.add(i);for(var s=0;s<t.length;s++){var o=new f(t[s]);this.collection.add(o)}this.renderGameList()},renderGameList:function(){var e=this;this.collection.each(function(t){var n={sharedObjects:e.options.sharedObjects,model:t,onCheckboxChanged:e.onCheckboxChanged},r=new o(n);e.$(".game_selector").append(r.render().el)})},onNameKeyPress:function(e){var t=this.$(".community-name-input").val();this.model.set("name",t)},onDescriptionKeyPress:function(){var e=this.$('textarea[name="description"]').val();this.model.set("description",e)},onPrivacyPublic:function(){this.$(".privacy_buttons .public").hasClass("off")&&(this.selectPublic(),this.model.set("searchable",!0))},onPrivacyPrivate:function(){this.$(".privacy_buttons .private").hasClass("off")&&(this.selectPrivate(),this.model.set("searchable",!1))},selectPublic:function(){this.$(".privacy_buttons .public").removeClass("off").addClass("on"),this.$(".privacy_buttons .private").removeClass("on").addClass("off")},selectPrivate:function(){this.$(".privacy_buttons .private").removeClass("off").addClass("on"),this.$(".privacy_buttons .public").removeClass("on").addClass("off")},onCreateClicked:function(){var t=this.model.get("name");if(t=="")return;var n=this,r=this.getCheckedGames();this.model.set("games",r),console.log("=== CREATING COMMUNITY ==="),console.log(JSON.stringify(this.model.toJSON())),e("body").addClass("rc-loading"),this.commsCommunity.createCommunity({community:this.model.toJSON(),success:function(t){e("body").removeClass("rc-loading"),console.debug("community created successfully"),console.debug(t),n.model.set("id",t.id),n.model.set("created",t.created),n.model.set("url",t.url),n.model.set("xmpp_server",t.xmpp_server),n.model.set("lobby_id",t.lobby_id),n.nextPopup()}})},routeToNewCommunity:function(){this.commsCommunity.addToCachedCommunities({community_id:this.model.get("id"),community:this.model});var e="communities/"+encodeURIComponent(this.model.get("id"));e+="/"+encodeURIComponent(this.model.get("lobby_id")),this.options.sharedObjects.router.navigate(e,{trigger:!0})},onCheckboxChanged:function(e,t){var n=this.collection.get(e.get("id")),r=this.getCheckedGames();this.showSave()},getCheckedGames:function(){var e=[];return this.collection.each(function(t){t.has("checked")&&t.get("checked")&&e.push(t)}),e},_uploadCommunityIcon:function(){this.showSave();var t=this.$(".file-select-icon")[0].files[0];this.$(".file-select-icon").prop("value",null);var n=this;t&&this.readImageFileForCropper({file:t,onSuccess:function(t){console.log(t.url),n.$(".community-icon").html("<img src="+t.url+">"),e("body").removeClass("rc-loading"),n.model.set("icon",t.url)},onClear:function(){n.model.set("icon","")}})},_uploadCommunityBanner:function(){this.showSave();var t=this.$(".file-select-banner")[0].files[0];this.$(".file-select-banner").prop("value",null);var n=this;t&&this.readImageFileForCropper({title:"Update Community Banner",file:t,isBanner:!0,onSuccess:function(t){console.log(t.url),n.$(".community-banner").html("<img src="+t.url+">"),e("body").removeClass("rc-loading"),n.model.set("banner",t.url),n.model.set("banner_type","url")},onClear:function(){n.model.set("banner",""),n.model.set("banner_type","url")}})},readImageFileForCropper:function(t){var n=this,r=new FileReader;r.addEventListener("load",function(r){var i=new h({url:r.target.result,title:t.title,isBanner:t.isBanner,onDone:function(r){if(r.src.indexOf("data:image")===0){var i=r.src.split(",");if(i.length===2){var s=l.SHA1(i[1]);e("body").addClass("rc-loading"),n.commsCommunity.uploadFile({community_id:n.model.get("id"),filename:s,base64Data:i[1],success:t.onSuccess})}}},onClear:t.onClear});i.popup()},!1),r.readAsDataURL(t.file)},showSave:function(){e(".w2ui-popup .save").removeClass("rc-disabled-button")},updateCommunity:function(){var e=this.getCheckedGames();this.model.set("games",e);var t=this;this.commsCommunity.updateCommunity({community_id:this.model.get("id"),community:this.model.toJSON(),success:function(e){console.debug(e),t.routeToNewCommunity(),t.close()}})}});return p}),define("views/communities/create/onboardcommunity",["jquery","underscore","backbone","text!templates/communities/create/onboardcommunity.html","models/communities/communitymodel","views/communities/channelsettings/createchannelview","views/communities/invitecommunityview","views/communities/create/createcommunity"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({className:"onboard-community-view",events:{"click .invite-friends":"onInviteFriends","click .add-channel":"onAddChannel","click .personalize":"onPersonalizeClicked","click .rc-button.copy":"_onCopyClick"},createChannelView:null,initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity,this.comms=e.sharedObjects.comms},render:function(){this.$el.html(this.template());var e=this;return setTimeout(function(){e.$el.niceScroll(t.extend({},e.options.sharedObjects.niceScrollOptions))},0),this._getLink(function(t){console.debug("link: "+t),e.$(".link").text(t),e.$("button.copy-link-btn").attr("data-clipboard-text",t),e.$(".rc-button").removeClass("rc-disabled-button")}),require(["clipboard"],function(e){console.debug("Clipboard loaded");var t=new e(".copy-link-btn");t.on("success",function(e){console.log("success"),console.log(e)}),t.on("error",function(e){console.log("error"),console.log(e)})}),this},_getLink:function(e){console.debug("_getLink: model:");var t=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id});if(t){var r=new n.Model(t);console.assert(r.has("id")&&r.get("id")!==""),console.assert(r.has("lobby_id")&&r.get("lobby_id")!=="");var i="https://web.comms.razerzone.com/#communities/";i+=encodeURIComponent(r.get("id")),i+="/"+encodeURIComponent(r.get("lobby_id")),this.comms.shortenUrl({long_url:i,success:function(t){console.debug(t),e(t.short_url)}})}},close:function(){console.debug("close"),this.remove(),this.unbind(),this.comms.off(null,null,this)},onInviteFriends:function(){console.debug("_onInviteClick"),console.debug(this.options);var e=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id});console.assert(e);var t=new o({model:new n.Model(e),comms:this.options.sharedObjects.comms});t.popup()},onAddChannel:function(){var e={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.createChannelView=new s(e),this.createChannelView.popup()},onPersonalizeClicked:function(){var e={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.createCommunityView=new u(e),this.createCommunityView.nextPopup()},_onCopyClick:function(){console.debug("_onCopyClick"),this.$(".copy-link-btn").click()}});return a}),define("text!templates/communities/communitydeleted.html",[],function(){return'<div class="info">Sorry, This community has been deleted.</div>\r\n<div><div class="ok">OK</div></div>'}),define("views/communities/communitydeleted",["jquery","underscore","backbone","text!templates/communities/communitydeleted.html"],function(e,t,n,r){var i=n.View.extend({className:"community-deleted-view",events:{},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.options.sharedObjects.router.navigate("activityEmpty",{trigger:!0}),w2popup.close(),this.remove(),this.unbind()},popup:function(){var t=this;w2popup.open({body:'<div class="community-deleted"></div>',width:400,height:220,modal:!0,opacity:.9,showClose:!1,speed:.4,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .community-deleted").append(t.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){t.close()}),e("#w2ui-popup .ok").on("click",function(e){t.close()})}}})}});return i}),define("views/communities/communitymainview",["jquery","underscore","backbone","text!templates/communities/communitymainview.html","models/communities/communitymodel","views/communities/communityheaderview","views/communities/channelmessagesview","models/channelmessagemodel","rcemoji/rcemoji","views/communities/channelmemberlistview","views/communities/channellistview","views/communities/mentionuserview","views/communities/userbanned","views/communities/create/onboardcommunity","views/communities/communitydeleted","views/communities/passwordprompt"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=13,g=234,y=600,b=n.View.extend({tagName:"div",className:"community-main-view",events:{"input .message-input":"_checkTaggedUsers","keypress .message-input":"_onInputKeypress","click .send":"_sendMessage","click .emojiPickerBox":"_toggleEmojiPicker","click span.attachment":"_onAttachmentClicked","change .file-select-input":"_onAttachmentChanged"},collection:{},user:null,communityHeaderView:null,channelMessagesView:null,channelMemberListView:null,communityChannelListView:null,emojiPickerShown:!1,emojiPickerView:null,mentionUserView:null,keyword:null,usertoreply:null,onboardCommunityView:null,channel_count:null,message_count:null,initialize:function(e){this.template=t.template(r),t.bindAll(this,"render","onCommunitySynced","fetchChannelMessages","close","_onEmojiIconSelected","_onCommunityEdited","joinCommunity","showPasswordPrompt"),t.bindAll(this,"_checkTaggedUsers","onSelected","autoHideMentionMenu","setUserToBeReplied","_onCommunityChanged","closeOnboardView","onCommunityError"),this.options=e,this.comms=e.sharedObjects.comms,this.commsCommunity=e.sharedObjects.commsCommunity,this.channel_count=null,this.message_count=null,this.model=new i,this.fetch();var n=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id});n&&(this.model=new i(n)),this.user=null,this.channelMessagesView=null,this.channelMemberListView=null,this.communityChannelListView=null,this.communityHeaderView=null,this.mentionUserView=null,this.keyword=null,this.onboardCommunityView=null;var s="communityChange."+this.options.community_id;this.commsCommunity.on(s,this._onCommunityChanged,this),this.commsCommunity.on("me_banned",this._onMeBanned,this)},fetch:function(){this.commsCommunity.getCommunity({community_id:this.options.community_id,success:this.onCommunitySynced,error:this.onCommunityError})},render:function(){this.$el.html(this.template());var n=e(".navigation-view").width();this.$el.css("left",n);var r=this.commsCommunity.getCachedCommunity({community_id:this.options.community_id});return r?(this.model=new i(r),console.debug("have cached community")):console.debug("dont have cached community---"+this.options.community_id),this.fetchBanner(),this.fetchChannelMessages(),this.fetchMemberList(),this.fetchChannelList(),this.commsCommunity.newlyCreatedCommunityId===this.options.community_id&&this.showOnboard(),this.$(".message-input").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this.$(".usermentioncontainer").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this.$(".message-input").contentEditable(),this.checkWhatToShow(),this},close:function(){this.commsCommunity.setCommunityFocus({community_id:this.options.community_id,in_focus:!1}),this.communityChannelListView&&(this.communityChannelListView.close(),this.communityChannelListView=null),this.channelMessagesView&&(this.channelMessagesView.close(),this.channelMessagesView=null),this.channelMemberListView&&(this.channelMemberListView.close(),this.channelMemberListView=null),this.communityHeaderView&&(this.communityHeaderView.close(),this.communityHeaderView=null),this.remove(),this.unbind(),this.commsCommunity.off(null,null,this)},checkWhatToShow:function(){e(".main-view").width()<y},onCommunitySynced:function(e){console.debug("onCommunitySynced"),this.user=e.user,this.model.set(e),typeof e.is_member!="undefined"&&!e.is_member&&(console.info("Auto joining the community"),this.model.has("protected")&&this.model.get("protected")?this.showPasswordPrompt():this.joinCommunity()),this.checkToShowOnboardView()},joinCommunity:function(){this.commsCommunity.joinCommunity({community_id:this.options.community_id,success:function(){window.location.reload()}})},fetchChannelList:function(){console.debug("fetchChannelList");var e=this,t={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model,onChannelList:function(t){e.channel_count=t,e.checkToShowOnboardView()}};this.communityChannelListView=new l(t),this.$el.append(this.communityChannelListView.render().el)},fetchChannelMessages:function(){this.channelMessagesView&&(this.channelMessagesView.close(),this.channelMessagesView=null);var e=this,t={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,userToReply:this.setUserToBeReplied,model:this.model,closeOnboardView:this.closeOnboardView,onMessages:function(t){e.message_count=t,e.checkToShowOnboardView()}};this.channelMessagesView=new o(t),this.$el.append(this.channelMessagesView.render().el)},setUserToBeReplied:function(e){this.usertoreply=e},fetchMemberList:function(){console.debug("fetchMemberList"),this.channelMemberListView&&(this.channelMemberListView.close(),this.channelMemberListView=null),this.channelMemberListView=new f(this.options),this.$el.append(this.channelMemberListView.render().el)},fetchBanner:function(){this.communityHeaderView&&(this.communityHeaderView.close(),this.communityHeaderView=null);var e={model:this.model,community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects};this.communityHeaderView=new s(e),this.$el.append(this.communityHeaderView.render().el)},_onInputKeypress:function(e){e.which===37&&e.which===38&&e.which===39&&e.which===40&&e.preventDefault();if(e.keyCode===m){if(!this.user)return;var t=this;e.shiftKey||(e.preventDefault(),this._sendMessage())}},_checkTaggedUsers:function(e){this._adjustChatInputHeight();var t=this.$(".message-input").text();if(t==="")return;var n=/@[^\s]{1}[\w\s]+/g,r=t.match(n);if(r!=null&&r.length>0)if(/\s+$/.test(t))this.closeMentionUserView();else{var i=r.pop();this.keyword=i,i=i.replace("@",""),i.length>=2?this._searchTaggedUsers(i):this.closeMentionUserView()}else this.closeMentionUserView();var s=/\/r\s/ig,o=t.match(s);if(o!=null&&o.length>0){var i="/r&nbsp;";if(this.usertoreply){var u=this.$(".message-input").html(),a=u.replace(i," ");this.$(".message-input").html(a);var f='<span class="tagged" contenteditable="false" data-userid='+this.usertoreply.get("sender")+">"+this.usertoreply.get("sender_name")+"&nbsp;</span>";this.$(".message-input").append(f);var l=/(safari|chrome)/.test(navigator.userAgent.toLowerCase());l||this.$(".message-input br:first-child").replaceWith("&nbsp;"),this.hackCursor(),this._placeCaretAtEnd(this.$(".message-input")[0])}}},_searchTaggedUsers:function(n){console.debug("_searchTaggedUsers---"+n);var r=this.commsCommunity.getCachedChannel({channel_id:this.options.channel_id});if(r){var i=r.online_members_count,s=r.online_members;if(i<100)var o=t.extend({users:s,query:n,onSelected:this.onSelected},this.options);else var o=t.extend({users:null,query:n,onSelected:this.onSelected},this.options);this.mentionUserView&&(this.mentionUserView.close(),this.mentionUserView=null),this.$(".usermentioncontainer").hide(),this.mentionUserView=new c(o),this.$(".usermentioncontainer").html(this.mentionUserView.render().el),this.mentionUserView&&this.mentionUserView.focus(),e(document).bind("click",this.autoHideMentionMenu)}},closeMentionUserView:function(){this.mentionUserView&&(console.debug("closeMentionUserView"),this.mentionUserView.close(),this.mentionUserView=null),this.$(".usermentioncontainer").hide(),e(document).unbind("click",this.autoHideMentionMenu)},autoHideMentionMenu:function(e){console.debug("autoHideMentionMenu");var t=this;!t.$(e.target).closest(".usermentioncontainer").length&&!t.$(e.target).closest(".message-input").length&&t.closeMentionUserView()},onSelected:function(e){console.log("onSelected keyword is--"+this.keyword),this.closeMentionUserView();var t=this.$(".message-input").html(),n=t.replace(this.keyword," ");this.$(".message-input").html(n);var r='<span class="tagged" contenteditable="false" data-userid='+e.get("id")+">"+e.get("nickname")+"&nbsp;</span>";this.$(".message-input").append(r);var i=/(safari|chrome)/.test(navigator.userAgent.toLowerCase());i||this.$(".message-input br:first-child").replaceWith("&nbsp;"),this.hackCursor(),this._placeCaretAtEnd(this.$(".message-input")[0]),this.keyword=null},getMentionedUsers:function(){var t=[],n=e("<div>"+this.$(".message-input").html()+"</div>"),r=n.find("span.tagged");return r.each(function(n){var r=e(this).attr("data-userid");t.push(r)}),t},getMentionedHtml:function(){var t=this.options.sharedObjects.comms.user_id,n=e("<div>"+this.$(".message-input").html()+"</div>"),r=n.find("span.tagged");return r.each(function(n){var r=e(this).attr("data-userid"),i=e(this).text(),s="@"+i+" ";e(this).text(s),r===t&&e(this).addClass("me")}),n.html()},hackCursor:function(){return e(".message-input :last-child").get(0).tagName==="SPAN"?e(".message-input span:last-child").after('<i style="font-style: normal"></i>'):!1},htmlDecode:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},_sendMessage:function(){if(!this.user)return;var e=this.$(".message-input").html();if(e==="")return;var t=/^\s*(?:<br\s*\/?\s*>)+|(?:<br\s*\/?\s*>)+\s*$/gi;e=e.replace(t,""),e=e.replace(/<br ?\/?>/g,"\n");var n=this.getMentionedUsers(),r=!1;n.length>0&&(r=!0,e=this.getMentionedHtml());var i=a.unParse(e);i=this.htmlDecode(i);var s=new u({sender:this.comms.user.get("id"),sender_name:this.comms.user.get("nickname"),message:i,timestamp:Math.floor(Date.now()/1e3),status:"sending",mention:r,target:n}),o=!1;if(this.user.role==="owner"||this.user.role==="admin")o=!0;var f=this.commsCommunity.sendMessage({community_id:this.options.community_id,channel_id:this.options.channel_id,message:{message:"<span>"+i+"</span>",sender_name:this.user.nickname,comms_id:this.user.comms_id,sender:this.user.id,admin:o,timestamp:Math.floor(Date.now()),mention:r,target:n},success:function(e){console.debug("sendMessage success: message_id: "+e),setTimeout(function(){s.set({status:"sent",timestamp:Math.floor(Date.now()/1e3)})},200)}});s.set("message_id",f),this.emojiPickerShown&&this._hideEmojiPicker(),this.$(".message-input").html(""),this._adjustChatInputHeight(),this._placeCaretAtEnd(this.$(".message-input")[0])},_toggleEmojiPicker:function(){this.emojiPickerShown?this._hideEmojiPicker():this._showEmojiPicker()},_showEmojiPicker:function(){console.debug("_showEmojiPicker"),this.emojiPickerShown=!0;var e=a.createEmojiView({onEmojiSelected:this._onEmojiIconSelected});this.$(".emoji-picker-container").append(e.render().el),e.$el.show(),e.$(".emojiPicker").show(),this.emojiPickerView=e,this._hideScrollBars();var t=this.$(".message-input-container").outerHeight(!0),n=+t+ +g,r=this;this.$(".messages").velocity({bottom:g+t,top:"-"+n+"px"},{easing:"easeOutCubic",complete:function(){r.$(".messages").css("top","0px"),r.scrollToBottom(!1),r._showScrollbars()}}),this.$(".emoji-picker-container").css("bottom","-"+n+"px"),this.$(".emoji-picker-container").show(),this.$(".emoji-picker-container").velocity({bottom:t},{easing:"easeOutCubic",complete:function(){}}),this.$(".emojiPickerBox").addClass("open"),this.$(".pickericon").removeClass("close").addClass("open")},_hideEmojiPicker:function(){console.debug("_hideEmojiPicker"),this.emojiPickerShown=!1,this._hideScrollBars();var e=this.$(".message-input-container").height(),t=this;this.$(".messages").velocity({bottom:e},{easing:"easeOutCubic",complete:function(){t.scrollToBottom(!1),t._showScrollbars()}});var n=+e+ +g;this.$(".emoji-picker-container").velocity({bottom:"-"+n+"px"},{easing:"easeOutCubic",complete:function(){t.$(".emoji-picker-container").hide(),t.emojiPickerView.close(),t.emojiPickerView=null}}),this.$(".emojiPickerBox").removeClass("open"),this.$(".pickericon").removeClass("open").addClass("close")},_hideScrollBars:function(){var e=this.$(".messages").getNiceScroll();e.hide()},_showScrollbars:function(){var e=this.$(".messages").getNiceScroll();e.resize(),e.show()},scrollToBottom:function(e){e=typeof e!="undefined"?e:!1;var t=this;if(e){if(this.scrolling)return;this.scrolling=!0,this.$(".messages").animate({scrollTop:this.$(".messages")[0].scrollHeight},1e3,function(){t.scrolling=!1})}else this.$(".messages").scrollTop(this.$(".messages")[0].scrollHeight)},_onEmojiIconSelected:function(e,t){var n="js/lib/twemoji/icons/"+t.replace("em emj","")+".png",r='<img class="emoji"  alt="'+e+'" src="'+n+'" >';this.$(".message-input").append(r),this._placeCaretAtEnd(this.$(".message-input")[0])},_placeCaretAtEnd:function(e){e.focus();if(typeof window.getSelection!="undefined"&&typeof document.createRange!="undefined"){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(typeof document.body.createTextRange!="undefined"){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}},_onMessageInput:function(){this._adjustChatInputHeight()},_adjustChatInputHeight:function(){var e=this.$(".message-input").outerHeight(!0);this.$(".message-input-container").css("height",e),this.$(".emojiPickerBox").css("height",e);if(this.emojiPickerShown){var t=e+g;this.$(".messages").css("bottom",t),this.$(".emoji-picker-container").css("bottom",e)}else this.$(".messages").css("bottom",e);this.$(".usermentioncontainer").css("bottom",e),this.h===0?this.h=e:this.h!==e&&(console.debug("height changed---"+e),this.h=e,this.scrollToBottom())},_setInFocus:function(){this.commsCommunity.setCommunityFocus({community_id:this.options.community_id,in_focus:!0})},_onCommunityEdited:function(){console.debug("_onCommunityEdited"),this.fetch()},_onCommunityChanged:function(e){console.debug("_onCommunityChanged"),this.fetch()},_onMeBanned:function(e){var t=new h(this.options);t.popup()},checkToShowOnboardView:function(){this.channel_count===1&&this.message_count===0?this.user!==null&&this.user.role==="owner"&&this.showOnboard():this.closeOnboardView()},showOnboard:function(){console.debug("showOnboard"),this.onboardCommunityView&&(this.onboardCommunityView.close(),this.onboardCommunityView=null);var e=this,t={community_id:this.options.community_id,channel_id:this.options.channel_id,sharedObjects:this.options.sharedObjects,model:this.model};this.onboardCommunityView=new p(t),this.$el.append(this.onboardCommunityView.render().el)},closeOnboardView:function(){this.commsCommunity.newlyCreatedCommunityId="",this.onboardCommunityView&&(this.onboardCommunityView.close(),this.onboardCommunityView=null)},onCommunityError:function(e){console.debug("onCommunityError"),console.debug(e);if(e.status===404){var t=new d(this.options);t.popup()}},showPasswordPrompt:function(){var e={channel_id:this.options.channel_id,community_id:this.options.community_id,sharedObjects:this.options.sharedObjects,community_pwd_prompt:!0};this.passwordPromptView=new v(e),this.passwordPromptView.popup()},_onAttachmentClicked:function(e){console.debug("_onAttachmentClicked"),this.$(".file-select-input").click()},_onAttachmentChanged:function(e){console.debug("_onAttachmentChanged");var t=this.$("input[type=file]")[0].files[0];console.debug("_onAttachmentChanged: file: "),console.debug(t);var n=new FileReader,r=this;if(t){console.debug("file"),console.debug(t);if(t.type.indexOf("image")!==0){this._showWarning("Please select an image file");return}if(t.size>10485760){console.warn("file too big"),this._showWarning("Please select a smaller file to send");return}console.debug("file size: "+t.size);var n=new FileReader;n.addEventListener("load",function(){console.debug("_onAttachmentChanged: load result");var e=n.result.split(",");if(e.length>1&&e[1]&&e[1]!==""){console.debug("attachment: "+e[1].substring(0,100)),console.debug(e);var t="",i=e[0].split(":");if(i.length===2){var s=i[1].split(";");console.debug("ContentType: "+s[0]),t=s[0]}var o=!0;t.indexOf("image")===-1&&(o=!1),r.$(".upload-progress").show(),r.comms.ChatHistory.uploadAttachment({chat_id:r.options.channel_id,data:e[1],type:t,success:function(e){console.debug("File uploaded: "+e.url),o&&(r.attachmentUrl=e.url),r.$(".message-input").text(e.url),r._sendMessage(),r.$(".upload-progress").hide()}})}},!1),n.readAsDataURL(t)}},_showWarning:function(t){var n="line-height:200px; text-align:center;font-size:20px;",r="<div style='"+n+"'>"+t+"</div>";w2popup.open({width:400,height:200,showMax:!1,modal:!1,showClose:!0,body:r,onOpen:function(t){t.onComplete=function(){e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){w2popup.close()})}}})}});return b}),define("text!templates/call/calluiview2.html",[],function(){return'<div class="callcontrols ">\n\n    <div class="more round" style="display:none;"><span class="razericons-menu_options dot"></span></div>\n    <div class="avatar_list"></div>\n	<div class="status_avatar"></div>\n    <div class="chat-icon ricon disabled"><span class="razericons-message  hvalign ficon"></span></div>\n    <div class="sound-icon ricon"><span class="razericons-sound_medium hvalign  ficon"></span></div>\n	<div class="sliderbox self">\n			<div class="volume-control"></div>\n			<div class="mute razericons-sound_medium off"></div>\n			<div class="mute razericons-sound_mute on"></div>\n	</div>\n	\n    <div class="mic-icon ricon"><span class="razericons-mic  hvalign ficon"></span></div>\n    <div class="time ricon"><span class="counter">00:00</span></div>\n    <div class="hangup-icon ricon"><span class="razericons-call_hangup hvalign ficon"></span></div>\n	\n</div>\n	<div class="expanded_avatar_list"></div>'}),define("text!templates/call/avataritemvertical.html",[],function(){return'<img src="<%- avatar %>" class="avatar" data-id="<%- id %>">\r\n<div class="sliderbox">\r\n	<div class="volume-control"></div>\r\n	<div class="mute razericons-sound_medium off"></div>\r\n	<div class="mute razericons-sound_mute on"></div>\r\n</div>\r\n'}),define("text!templates/call/avataritemhorizontal.html",[],function(){return'<img src="<%- avatar %>" class="avatar" data-id="<%- id %>">\r\n<div class="name textwrap"><%- nickname %></div>\r\n<div class="sliderbox">\r\n	<div class="volume-control"></div>\r\n	<div class="mute razericons-sound_medium off"></div>\r\n	<div class="mute razericons-sound_mute on"></div>\r\n</div>\r\n'}),define("views/callui/avataritem",["jquery","underscore","backbone","text!templates/call/avataritemvertical.html","text!templates/call/avataritemhorizontal.html","velocity-ui","jqueryui"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"avatar-item-view",events:{"click .avatar":"_toggleVolumeSlider","click  .mute.off":"_onMuteClicked","click  .mute.on":"_onUnMuteClicked"},callHandler:null,slidershown:!1,options:{sharedObjects:null},initialize:function(e){t.bindAll(this,"close","_onVolumeSliderChanged"),t.bindAll(this,"_hideVolumeSlider","_showVolumneSlider","autoHideVolumeSlider"),t.bindAll(this,"_onTalkState"),this.options=e,this.callHandler=this.options.sharedObjects.callHandler,this.callHandler.on("talkState",this._onTalkState,this),this.verticalTemplate=t.template(r),this.horizontalTemplate=t.template(i),this.model.on("change:removed",this.close)},render:function(){return this.options.orientation==="vertical"?(this.$el.html(this.verticalTemplate(this.model.toJSON())),this._addTooltip(this.$(".avatar"),this.model.get("nickname"))):this.$el.html(this.horizontalTemplate(this.model.toJSON())),this.options.animate?this.$el.velocity("transition.bounceDownIn",{}):this.$el.velocity("transition.slideLeftIn",{}),this.$(".volume-control").slider({orientation:this.options.orientation,range:"min",animate:!0,value:60,change:this._onVolumeSliderChanged}),this},close:function(){console.debug("close avataritem---"+this.model.get("nickname")),this.remove(),this.unbind(),this.model.off(null,null,this),this.callHandler.off(null,null,this)},_addTooltip:function(t,n){var r=this;t.hover(function(){n!=""&&e('<p class="tooltiprazercall"></p>').html(n).appendTo("body").fadeIn("slow")},function(){e(".tooltiprazercall").remove()}).mousemove(function(n){var r=e(".tooltiprazercall").width(),i=t.offset().left+10-r/2;i=Math.round(i);var s=t.offset().top+t.outerHeight();e(".tooltiprazercall").css({top:s,left:i})})},_toggleVolumeSlider:function(){e(".tooltiprazercall").remove(),this.slidershown?this._hideVolumeSlider():this._showVolumneSlider()},_showVolumneSlider:function(){this.options.orientation==="vertical"?this.$(".sliderbox").velocity("fadeIn"):this.$(".sliderbox").velocity("slideDown"),e(document).bind("click",this.autoHideVolumeSlider),this.slidershown=!0},_hideVolumeSlider:function(){this.options.orientation==="vertical"?this.$(".sliderbox").velocity("fadeOut"):this.$(".sliderbox").velocity("slideUp"),e(document).unbind("click",this.autoHideVolumeSlider),this.slidershown=!1},_onVolumeSliderChanged:function(e,t){this.callHandler.setLocalVolume(this.model.get("id"),t.value)},_onMuteClicked:function(){this.$(".mute.off").hide(),this.$(".mute.on").show(),this.callHandler.setLocalMute(this.model.get("id"),!0)},_onUnMuteClicked:function(){this.$(".mute.on").hide(),this.$(".mute.off").show(),this.callHandler.setLocalMute(this.model.get("id"),!1)},autoHideVolumeSlider:function(){var t=this;!e(event.target).closest(".sliderbox").length&&!e(event.target).closest(".callui-view2").length&&t._hideVolumeSlider()},_onTalkState:function(e){if(this.options.orientation==="vertical"){var t=e.user.id;t==this.model.get("id")&&(e.data.speaking?this.$("img").addClass("speaking"):this.$("img").removeClass("speaking"))}}});return u}),define("views/callui/calluiview2",["jquery","underscore","backbone","text!templates/call/calluiview2.html","velocity-ui","models/usermodel","models/groupmodel","models/membermodel","collections/membercollection","jqueryui","views/callui/avataritem"],function(e,t,n,r,s,o,u,a,f,l,c){var h=5,p=n.View.extend({tagName:"div",className:"callui-view2",events:{"click .hangup-icon":"_onHangupClicked","click .chat-icon":"_onChatClicked","click .mic-icon":"_toggleMicIcon","click .sound-icon":"_toggleVolumeSlider","click .sliderbox.self .mute.off":"_onSpeakerMuteClicked","click .sliderbox.self .mute.on":"_onSpeakerUnMuteClicked","click .more":"_toggleExpandedList"},callHandler:null,userModel:null,groupModel:null,options:{sharedObjects:null,chat_id:null,group_chat:!1},is_muted:!1,active_voice_members:[],bounceInterval:null,is_groupchat:!1,first_display:!0,connection_done:!1,slidershown:!1,defaultview:!0,expanded_list_shown:!1,main_list_arr:[],expanded_list_arr:[],initialize:function(e){t.bindAll(this,"close","_timerTick","_onUserInfo","_onMemberList","_onGroupInfo","_onVolumeSliderChanged","autoHideVolumeSlider"),this.template=t.template(r),this.options=e,console.assert(this.options.sharedObjects),console.assert(this.options.sharedObjects.callHandler),console.assert(this.options.chat_id&&this.options.chat_id!==""),this.callHandler=this.options.sharedObjects.callHandler,this.callHandler.on("timerTick",this._timerTick,this),this.is_muted=!1,this.bounceInterval=null,this.is_groupchat=!1,this.first_display=!0,this.connection_done=!1,this.slidershown=!1,this.defaultview=!0,this.expanded_list_shown=!1,this.active_voice_members=[],this.main_list_arr=[],this.expanded_list_arr=[],e.group_chat?(console.debug("group call"),this.is_groupchat=!0,this.groupModel=new u,this.options.sharedObjects.comms.Groups.getInfo({id:this.options.chat_id,success:this._onGroupInfo}),this.collection=new f,this.options.sharedObjects.comms.Groups.getMembers({chat_id:this.options.chat_id,success:this._onMemberList})):(console.debug("One-to-one call"),this.is_groupchat=!1,this.userModel=new o,this.options.sharedObjects.comms.getUser({user_id:this.options.chat_id,server_cache:!0,success:this._onUserInfo})),this.options.sharedObjects.callHandler.on("talkingMembers",this._onTalkingMembers,this),this.options.sharedObjects.callHandler.on("webRtcState",this._onCallState,this)},render:function(){return this.$el.html(this.template()),this.$el.velocity("transition.bounceRightIn",{}),this.$(".volume-control").slider({orientation:"vertical",range:"min",animate:!0,value:60,change:this._onVolumeSliderChanged}),this._addTooltip(this.$(".hangup-icon"),"End Call"),this},close:function(){console.debug("close");var t=this;e(".tooltiprazercall").remove(),this.$el.velocity("transition.bounceRightOut",{complete:function(){console.info("close: transition finished "),t.callHandler.off(null,null,t),t.remove(),t.unbind(),t.stopBounce(),console.debug("active_voice_members"),console.debug(t.active_voice_members);for(var e=0;e<t.active_voice_members.length;e++){var n=t.collection.get(t.active_voice_members[e]);n&&n.set("removed",!0)}}})},_onHangupClicked:function(){this.callHandler.hangupCall()},_timerTick:function(e){if(e<60)this.$(".time .counter").text("00:"+this._pad(e,2));else if(e<3600){var t=Math.floor(e/60),n=e-t*60;this.$(".time .counter").text(this._pad(t,2)+":"+this._pad(n,2))}else{var r=Math.floor(e/3600),t=Math.floor((e-r*3600)/60),n=e-r*3600-t*60;this.$(".time .counter").text(this._pad(r,2)+":"+this._pad(t,2)+":"+this._pad(n,2))}this.connection_done||this.stopBounce()},_pad:function(e,t){var n=e+"";while(n.length<t)n="0"+n;return n},_onChatClicked:function(){console.debug("_onChatClicked: chat_id: "+this.options.chat_id);if(this.options.chat_id&&this.options.chat_id!==""){var e="activity/"+encodeURIComponent(this.options.chat_id);this.options.sharedObjects.router.navigate(e,{trigger:!0})}},_toggleMicIcon:function(){this.callHandler.voiceConnection&&(this.is_muted?(this.is_muted=!1,this.$(".mic-icon span").addClass("razericons-mic"),this.$(".mic-icon span").removeClass("razericons-mic_mute"),this.$(".mic-icon span").removeClass("muted"),this.callHandler.selfUnMute()):(this.is_muted=!0,this.$(".mic-icon span").removeClass("razericons-mic"),this.$(".mic-icon span").addClass("razericons-mic_mute"),this.$(".mic-icon span").addClass("muted"),this.callHandler.selfMute()))},_onUserInfo:function(e){this.userModel.set(e),this.$(".status_avatar").html("<img src="+this.userModel.get("avatar")+' class="round ">'),this.startBounce()},_onGroupInfo:function(e){e.type==="Channel"&&e.group?(this.groupModel.set(e.group),this.is_groupchat=!0):e.type==="AdHoc"&&(e.members.length===1?this.is_groupchat=!1:(this.is_groupchat=!0,this.groupModel.set(e))),this.$(".status_avatar").html("<img src="+this.groupModel.get("icon")+' class="group ">'),this.startBounce()},_onMemberList:function(e){for(var t=0;t<e.data.length;++t){var n=new a(e.data[t]);this.collection.add(n)}this.active_voice_members=[]},_onTalkingMembers:function(e){if(this.is_groupchat){console.debug("_onTalkingMembers"),console.debug(e);var t=!1,n=[];for(i=0;i<e.length;i++){var r=e[i].userId,s=this.collection.get(r);n.push(r),r===this.options.sharedObjects.comms.user_id&&(t=!0),this.active_voice_members.indexOf(r)===-1&&!t&&(this.first_display?this.addMember(s,!1):this.addMember(s,!0))}for(k=0;k<this.active_voice_members.length;k++){var r=this.active_voice_members[k],s=this.collection.get(r);n.indexOf(r)===-1&&this.removeMember(s)}}},addMember:function(e,t){this.active_voice_members.push(e.get("id"));if(this.main_list_arr.length<h)var n="vertical";else{var n="horizontal";t=!1}var r={model:e,sharedObjects:this.options.sharedObjects,animate:t,orientation:n};avatarItemView=new c(r),this.main_list_arr.length<h?(this.$(".avatar_list").prepend(avatarItemView.render().el),this.main_list_arr.push(e.get("id"))):(this.$(".expanded_avatar_list").prepend(avatarItemView.render().el),this.expanded_list_arr.push(e.get("id"))),this.checkToShowMore()},checkToShowMore:function(){this.active_voice_members.length>h?(this.defaultview=!1,this.first_display||this.$(".more").show()):(this.$(".more").hide(),this.hideExpandedList(!1),this.defaultview=!0)},checkOnRemove:function(){if(this.active_voice_members.length>=h&&this.main_list_arr.length<h&&this.expanded_list_arr.length>0){var e=this.expanded_list_arr[0],t=this.collection.get(e);t.set("removed",!0),this.removeFromExpandedList(e),this.addMember(t,!1)}},removeMember:function(e){console.debug("removed---"+e.get("nickname")),e.set("removed",!0),this._inArray(this.main_list_arr,e.get("id"))?this.removeFromMainList(e.get("id")):this._inArray(this.expanded_list_arr,e.get("id"))&&this.removeFromExpandedList(e.get("id")),this.checkToShowMore()},removeFromMainList:function(e){this.active_voice_members=this._removeFromArray(this.active_voice_members,e),this.main_list_arr=this._removeFromArray(this.main_list_arr,e);var t=this.$(".avatar_list").find('[data-id="'+e+'"]'),n=t.parent().prevAll();t.velocity("transition.bounceUpOut",{complete:function(){t.parent().remove()}}),setTimeout(function(){t.parent().css("width","0"),n.velocity("transition.slideLeftIn",{queue:!1})},300),this.checkOnRemove()},removeFromExpandedList:function(e){this.active_voice_members=this._removeFromArray(this.active_voice_members,e),this.expanded_list_arr=this._removeFromArray(this.expanded_list_arr,e);var t=this.$(".expanded_avatar_list").find('[data-id="'+e+'"]');t.parent().remove()},_removeFromArray:function(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),e},_inArray:function(e,t){var n=e.indexOf(t);return n>-1?!0:!1},startBounce:function(){var t=this;e.Velocity.RegisterEffect("bounce",{defaultDuration:200,calls:[[{translateY:0},0],[{translateY:-7},.25],[{translateY:0},.5],[{translateY:-7},.75],[{translateY:0},1]]}),this.bounceInterval&&clearInterval(this.bounceInterval),this.bounceInterval=setInterval(function(){console.debug("boucing"),t.$(".status_avatar img").velocity("bounce")},1e3)},stopBounce:function(){clearInterval(this.bounceInterval),this.bounceInterval=null,this.connection_done=!0,this.$(".status_avatar img").velocity("slideDownIn",{duration:200});var e=this;setTimeout(function(){console.debug("stop bouncing"),e.is_groupchat&&(e.$(".avatar_list").velocity("transition.slideLeftIn",{stagger:100}),e.first_display=!1,e.checkToShowMore())},600)},checkChatIcon:function(){var e=n.history.getFragment(),t=e.split("/"),r=t.pop();r=decodeURIComponent(r),r===this.options.chat_id?this.$(".chat-icon").addClass("disabled"):(this.$(".chat-icon").removeClass("disabled"),this._addTooltip(this.$(".chat-icon"),"Go to Chat")),this.hideSlider(),this.hideExpandedList()},_toggleVolumeSlider:function(){this.slidershown?this.hideSlider():this.showSlider()},showSlider:function(){this.$(".sliderbox.self").velocity("fadeIn"),this.slidershown=!0,e(document).bind("click",this.autoHideVolumeSlider)},hideSlider:function(){this.$(".sliderbox.self").velocity("fadeOut"),this.slidershown=!1,e(document).unbind("click",this.autoHideVolumeSlider)},_onVolumeSliderChanged:function(e,t){this.callHandler.changeSpeakerVolume(t.value)},_onSpeakerMuteClicked:function(){this.$(".sliderbox.self .mute.off").hide(),this.$(".sliderbox.self .mute.on").show(),this.$(".sound-icon span").addClass("razericons-sound_mute"),this.$(".sound-icon span").removeClass("razericons-sound_medium"),this.$(".sound-icon span").addClass("muted"),this.callHandler.muteAll()},_onSpeakerUnMuteClicked:function(){this.$(".sliderbox.self .mute.on").hide(),this.$(".sliderbox.self .mute.off").show(),this.$(".sound-icon span").addClass("razericons-sound_medium"),this.$(".sound-icon span").removeClass("razericons-sound_mute"),this.$(".sound-icon span").removeClass("muted"),this.callHandler.unMuteAll()},_toggleExpandedList:function(){this.expanded_list_shown?this.hideExpandedList(!0):this.showExpandedList()},showExpandedList:function(){var e=this.$(".more").position().left-this.$(".expanded_avatar_list").width();this.$(".expanded_avatar_list").css("left",e+"px"),this.$(".expanded_avatar_list").velocity("fadeIn"),this.expanded_list_shown=!0},hideExpandedList:function(e){e?this.$(".expanded_avatar_list").velocity("fadeOut"):this.$(".expanded_avatar_list").hide(),this.expanded_list_shown=!1},_addTooltip:function(t,n){var r=this;t.hover(function(){n!=""&&e('<p class="tooltiprazercall"></p>').html(n).appendTo("body").fadeIn("slow")},function(){e(".tooltiprazercall").remove()}).mousemove(function(n){var r=e(".tooltiprazercall").width(),i=t.offset().left+10-r/2;i=Math.round(i);var s=t.offset().top+t.outerHeight();e(".tooltiprazercall").css({top:s,left:i})})},autoHideVolumeSlider:function(){var t=this;!e(event.target).closest(".sliderbox.self").length&&!e(event.target).closest(".callui-view2").length&&t.hideSlider()}});return p}),define("views/maincontentsectionview",["jquery","underscore","backbone","text!templates/maincontentsectionview.html","views/mainheaderview","views/chatmessages/chatmessagesview","models/mainheadermodel","views/infoview","velocity","views/communities/communitymainview","views/callui/calluiview2","views/onboard/onboarduser"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=600,p=920,d=1210,v=1410,m=n.View.extend({tagName:"div",className:"main-content-section-view",events:{"window resize":"onWindowResize","click .greenheader .back":"navigateToActivity"},chatMessagesView:null,headerView:null,infoView:null,communityMainView:null,callUiView:null,myAudio:null,ringingStopped:!0,initialize:function(n){t.bindAll(this,"render","close","showChatMessages","_onHeaderTitleClick","showEmpty","_onGroupNameChanged","checkInfoViewStatus","focusMessageInput"),t.bindAll(this,"_onCallState","_onStartCall","_onEndCall","_timerTick"),this.options=n,this.template=t.template(r),this.chatMessagesView=null,this.headerView=null,this.infoView=null,this.communityMainView=null;var i=this;e(window).resize(function(){i.onWindowResize()}),this.myAudio=null,this.ringingStopped=!0,this.options.sharedObjects.callHandler.on("webRtcState",this._onCallState,this),this.options.sharedObjects.callHandler.on("startCall",this._onStartCall,this),this.options.sharedObjects.callHandler.on("endCall",this._onEndCall,this),this.options.sharedObjects.callHandler.on("timerTick",this._timerTick,this)},render:function(){return this.$el.html(this.template()),this},close:function(){console.debug("close"),this.chatMessagesView&&(this.chatMessagesView.close(),this.chatMessagesView=null),this.callUiView&&(this.callUiView.close(),this.callUiView=null),this.options.sharedObjects.callHandler.off(null,null,this),this.remove(),this.unbind()},showChatMessages:function(e,n){n=typeof n!="undefined"?n:!1,console.debug("showChatMessages: "+e+" adhoc: "+n),this.$(".background-logo").hide();var r;this.options.sharedObjects.activityCollection&&(r=this.options.sharedObjects.activityCollection.get(e),r||console.debug("showChatMessages: recent_chat_model not found for "+e));var u=new o({chat_id:e});if(this.options.sharedObjects.friendCollection){var a=this.options.sharedObjects.friendCollection.get(e);if(a)u.set("title",a.get("nick")),u.set("sub_title",a.get("presence")),u.set("avatar",a.get("avatar")),u.set("group_chat",!1);else if(this.options.sharedObjects.activityCollection){r=this.options.sharedObjects.activityCollection.get(e);if(r)u.set("title",r.get("name")),u.set("avatar",r.get("avatar")),r.get("group_chat")?(u.set("sub_title"," "),u.set("group_chat",!0)):(u.set("sub_title","offline"),u.set("group_chat",!1));else{var f=this.options.sharedObjects.groupCollection.get(e);f&&(u.set("title",f.get("name")),u.set("avatar",f.get("icon")),u.set("sub_title"," "),u.set("group_chat",!0))}}}var l=t.extend({chat_id:e,model:u,comms:this.options.sharedObjects.comms,sharedObjects:this.options.sharedObjects,onTitleClick:this._onHeaderTitleClick,checkInfoViewStatus:this.checkInfoViewStatus},this.optoins);this.headerView&&(this.headerView.close(),this.headerView=null),this.headerView=new i(l),this.$el.append(this.headerView.render().el);var c=0,l=t.extend({chat_id:e,adhoc:n},this.options);this.chatMessagesView&&(this.chatMessagesView.close(),this.chatMessagesView=null),this.chatMessagesView=new s(l),this.$el.append(this.chatMessagesView.render().el),this.infoView&&(this.infoView.close(),this.infoView=null),this.checkCurrentChat()},_onHeaderTitleClick:function(n){console.debug("_onHeaderTitleClick: "+n);if(e(".main-view").width()<=p)var r="100%";else if(e(".main-view").width()>p&&e(".main-view").width()<=d)var r="280px";else if(e(".main-view").width()>d&&e(".main-view").width()<=v)var r="350px";else if(e(".main-view").width()>v)var r="380px";var i=this.chatMessagesView.$(".messages").getNiceScroll(),s=this;if(this.infoView)this.infoView.close(),this.infoView=null,i.hide(),this.chatMessagesView.$el.velocity({right:"0"},{easing:"easeOutCubic",complete:function(){i.resize(),i.show()}}),this.options.sharedObjects.infoStateModel.set("state",!1),this.headerView._infoViewClosed();else{var o=t.extend({chat_id:n,onGroupNameChanged:this._onGroupNameChanged},this.options);this.infoView=new u(o),i.hide(),this.chatMessagesView.$el.velocity({right:r},{easing:"easeOutCubic",complete:function(){s.$el.append(s.infoView.render().el),s.infoView.$el.css("width",r),s.infoView.$el.show(),i=s.chatMessagesView.$(".messages").getNiceScroll(),i.resize(),i.show()}}),this.options.sharedObjects.infoStateModel.set("state",!0),this.headerView._infoViewOpened()}},checkToShow:function(){e(".main-view").width()<=h&&(this.$el.show(),this.$el.css("left","0px"),this.$(".greenheader .back").show())},navigateToActivity:function(){var e=n.history.fragment,t=e.split("/");if(t.length===2)var r=t[0];else r="activity";console.debug("navigateToActivity---"+r),this.options.sharedObjects.router.lastActivity="",this.options.sharedObjects.router.navigate(r,{trigger:!0})},showEmpty:function(){console.debug("showEmpty"),this.chatMessagesView&&(this.chatMessagesView.close(),this.chatMessagesView=null),this.headerView&&(this.headerView.close(),this.headerView=null),this.infoView&&(this.infoView.close(),this.infoView=null),this.$(".background-logo").show()},_onGroupNameChanged:function(e){this.headerView._changeTitle(e)},onWindowResize:function(){if(this.$(".info-view .content").is(":visible")){if(e(".main-view").width()<=p)var t="100%";else if(e(".main-view").width()>p&&e(".main-view").width()<=d)var t="280px";else if(e(".main-view").width()>d&&e(".main-view").width()<=v)var t="350px";else if(e(".main-view").width()>v)var t="380px";this.chatMessagesView.$el.css("right",t),this.infoView.$el.css("width",t),this.infoView.$el.css("display","block"),this.headerView._infoViewOpened()}else this.chatMessagesView&&(this.chatMessagesView.$el.css("right",0),this.headerView._infoViewClosed())},checkInfoViewStatus:function(){this.infoView?this.headerView._infoViewOpened():this.headerView._infoViewClosed()},focusMessageInput:function(){this.chatMessagesView.focusInput()},_onCallState:function(e){console.debug("_onCallState: "+e);switch(e){case"ENTER_GUILD":break;case"DISCONNECTED":this._stopRinging(),this.callUiView&&(this.callUiView.close(),this.callUiView=null);break;default:}},_onStartCall:function(t){console.assert(t&&t!=="");var n={chat_id:t,sharedObjects:this.options.sharedObjects};this.options.sharedObjects.comms.isGroupChat(t)?n.group_chat=!0:n.group_chat=!1,this.callUiView=new l(n),e(".main-view").append(this.callUiView.render().el),this.ringingStopped=!1,this._startRinging()},_onEndCall:function(){this._stopRinging(),this.callUiView&&(this.callUiView.close(),this.callUiView=null)},checkCurrentChat:function(){this.callUiView&&this.callUiView.checkChatIcon()},_startRinging:function(){console.debug("start ringing"),this.myAudio=new Audio("assets/wav/wav_voicecall_out.wav"),typeof this.myAudio.loop=="boolean"?this.myAudio.loop=!0:this.myAudio.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),this.myAudio.play()},_stopRinging:function(){this.ringingStopped||this.myAudio&&(console.debug("stop ringing"),this.myAudio.pause(),this.ringingStopped=!0)},_timerTick:function(){this.ringingStopped||(console.debug("_timerTick"),this._stopRinging())}});return m}),define("text!templates/composeview.html",[],function(){return'<div class="header">\n    <span class="to">To:</span>\n    <div class="input-container">\n        <span class="input-span">\n            <label>\n                <input placeholder="Type the name of a person or group">\n            </label>\n        </span>\n    </div>\n</div>\n'}),define("text!templates/composesearchview.html",[],function(){return'<ul class="friend-results">\n</ul>\n<div class="groups-label">GROUPS</div>\n<ul class="group-results">\n</ul>\n'}),define("text!templates/composesearchresult.html",[],function(){return'<div class="presence <%- presence %>" ></div>\n<img class="avatar" src="<%- avatar %>">\n<div class="title"><%= title_emoji %></div>\n\n'}),define("views/compose/composesearchresult",["jquery","underscore","backbone","text!templates/composesearchresult.html"],function(e,t,n,r){var i=n.View.extend({tagName:"li",className:"compose-search-result-view grid",events:{click:"_onClick"},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},close:function(){console.debug("close"),this.remove(),this.unbind()},_onClick:function(){this.options.onResultSelected&&this.options.onResultSelected(this.model)}});return i}),define("views/compose/composesearchview",["jquery","underscore","backbone","text!templates/composesearchview.html","models/searchresultmodel","views/compose/composesearchresult","nicescroll"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"compose-search-view",events:{},friendResultCollection:null,groupResultCollection:null,closed:!1,initialize:function(e){t.bindAll(this,"render","close","search","_onResultSelected","navigateUp","navigateDown","_scrollToSelected","getSelected"),this.options=e,this.template=t.template(r),this.friendResultCollection=null,this.groupResultCollection=null,this.closed=!1},render:function(){this.$el.html(this.template());var e=this,n=!1;if(this.friendResultCollection){var r;this.friendResultCollection.each(function(n){var i=t.extend({model:n,onResultSelected:e._onResultSelected},e.options);r=new s(i),e.$("ul.friend-results").append(r.render().el),r.$el.addClass("friend"),r.$el.data("model",n)}),this.friendResultCollection.length>0&&(n=!0,r.$el.addClass("last"))}return this.groupResultCollection&&(this.groupResultCollection.each(function(n){var r=t.extend({model:n,onResultSelected:e._onResultSelected},e.options),i=new s(r);e.$("ul.group-results").append(i.render().el),i.$el.addClass("group"),i.$el.data("model",n)}),this.groupResultCollection.length>0&&(this.$(".groups-label").show(),n=!0)),this.$(".compose-search-result-view").first().addClass("selected"),setTimeout(function(){e.closed||e.$el.niceScroll(t.extend({},e.options.sharedObjects.niceScrollOptions))},100),n?this.$el.show():this.$el.hide(),this},close:function(){console.debug("close"),this.remove(),this.unbind(),this.closed=!0},search:function(e,r){var s=this;if(this.options.sharedObjects.friendCollection){var o=this.options.sharedObjects.friendCollection.models,u=t.filter(o,function(t){var n=t.get("nick");return n.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:!1}),a=new n.Collection;t.each(u,function(e){var t=new i({chat_id:e.get("id"),title:e.get("nick"),avatar:e.get("avatar"),presence:e.get("presence"),is_favorite:e.get("is_favorite"),is_friend:!0});a.add(t)});for(var f=0;f<r.length;++f)a.remove(r[f].get("chat_id"));this.friendResultCollection=a}if(r.length===0){if(this.options.sharedObjects.groupCollection){var o=this.options.sharedObjects.groupCollection.models,l=t.filter(o,function(t){var n=t.get("name");return n.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:!1}),c=new n.Collection;t.each(l,function(e){var t=new i({chat_id:e.get("lobby_id"),title:e.get("name"),avatar:e.get("icon"),is_group:!0});c.add(t)}),this.groupResultCollection=c}if(this.options.sharedObjects.activityCollection){var o=this.options.sharedObjects.activityCollection.models,l=t.filter(o,function(t){if(!t.get("adhoc"))return!1;var n=t.get("name");return n.toLowerCase().indexOf(e.toLowerCase())!=-1?!0:!1});this.groupResultCollection||(this.groupResultCollection=new n.Collection),t.each(l,function(e){var t=new i({chat_id:e.get("chat_id"),title:e.get("name"),avatar:e.get("avatar"),is_group:!0,is_adhoc:!0});s.groupResultCollection.add(t)})}}this.render()},navigateUp:function(){console.debug("navigateUp");var e=this.$(".compose-search-result-view.selected");this.$(".compose-search-result-view").removeClass("selected");if(e.length===0){console.debug("no selected"),this.$(".compose-search-result-view").first().addClass("selected");return}e.prev().length===0?e.hasClass("group")&&this.$(".compose-search-result-view.last").length>0?this.$(".compose-search-result-view.last").addClass("selected"):this.$(".compose-search-result-view").first().addClass("selected"):e.prev().addClass("selected"),this._scrollToSelected()},navigateDown:function(){console.debug("navigateDown");var e=this.$(".compose-search-result-view.selected");this.$(".compose-search-result-view").removeClass("selected");if(e.length===0){this.$(".compose-search-result-view").first().addClass("selected");return}e.next().length===0?e.hasClass("friend")?this.$(".compose-search-result-view.group").first().addClass("selected"):this.$(".compose-search-result-view").last().addClass("selected"):e.next().addClass("selected"),this._scrollToSelected()},getSelected:function(){var e=this.$(".compose-search-result-view.selected");if(e.length!==0){var t=e.data("model");if(t)return t}},_scrollToSelected:function(){var e=this.$(".compose-search-result-view.selected").offset().top,t=this.$el.height(),n=this.$(".compose-search-result-view.selected").height();if(e>t||e<0)e<0?this.$el.scrollTop(this.$el.scrollTop()-n):this.$el.scrollTop(this.$el.scrollTop()+n)},_onResultSelected:function(e){console.debug("_onResultSelected: "+JSON.stringify(e.toJSON())),this.options.onResultSelected&&this.options.onResultSelected(e),this.close()}});return u}),define("text!templates/composerecipient.html",[],function(){return"<span><%- title %></span>\n"}),define("views/compose/composerecipient",["jquery","underscore","backbone","text!templates/composerecipient.html"],function(e,t,n,r){var i=n.View.extend({tagName:"div",className:"compose-recipient-view",events:{click:"_onClick"},initialize:function(e){t.bindAll(this,"render","close"),this.options=e,this.template=t.template(r)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},close:function(){console.debug("close"),this.remove(),this.unbind()}});return i}),define("views/compose/composeview",["jquery","underscore","backbone","text!templates/composeview.html","views/compose/composesearchview","views/compose/composerecipient","views/chatmessages/chatmessagesview"],function(e,t,n,r,i,s,o){var u=8,a=38,f=40,l=13,c=n.View.extend({tagName:"div",className:"compose-view",events:{"keydown .header input":"_onKeyDown","keyup .header input":"_onInputKeyUp"},searchView:null,chatMessagesView:null,recipients:[],initialize:function(e){t.bindAll(this,"render","close","focus","_clearResults","_onResultSelected","_showChatMessages"),this.options=e,this.template=t.template(r),this.searchView=null,this.chatMessagesView=null,this.recipients=[]},render:function(){return this.$el.html(this.template()),this._showChatMessages(""),this},close:function(){console.debug("close"),this.remove(),this.unbind()},focus:function(){this.$(".header input").focus()},_clearResults:function(){this.$(".header input").val(""),this.searchView&&(this.searchView.close(),this.searchView=null)},_onKeyDown:function(e){if(e.which===u){var t=this.$(".header input").val();if(t===""&&this.recipients.length>0){console.debug("_onKeyDown: removing 1 recipient");var n=this.recipients.length-1,r=this.recipients[n];r.view.close(),this.recipients.splice(n,1),this.recipients.length===0&&this._showChatMessages("")}}if(e.which===a){e.preventDefault(),this.searchView&&this.searchView.navigateUp();return}if(e.which===f){e.preventDefault(),this.searchView&&this.searchView.navigateDown();return}},_onInputKeyUp:function(e){var n=this.$(".header input").val();if(n===""){this._clearResults();return}if(e.which===a||e.which===f)return;if(e.which===l){e.preventDefault();if(this.searchView){var r=this.searchView.getSelected();r&&(console.debug("Enter pressed: selected: "),console.debug(r.toJSON()),this._onResultSelected(r))}return}if(n.length>=1){if(!this.searchView){var s=t.extend({onResultSelected:this._onResultSelected},this.options);this.searchView=new i(s),this.$el.append(this.searchView.render().el);var o=this.$(".header").outerHeight();o+=4,this.searchView.$el.css("top",o)}this.searchView.search(n,this.recipients)}},_onResultSelected:function(e){console.debug("_onResultSelected: "+JSON.stringify(e.toJSON())),this._clearResults();var t=this,n=new s({model:e});this.$(".header .input-span").before(n.render().el),this.$(".header input").attr("placeholder",""),this.$(".header .input-span").addClass("small"),this.focus(),e.view=n,this.recipients.push(e);if(this.recipients.length===1)if(e.get("is_group")){var r="activity/"+encodeURIComponent(e.get("chat_id"));e.get("is_adhoc")&&(r+="?adhoc=1"),this.options.sharedObjects.router.navigate(r,{trigger:!0})}else this._showChatMessages(e.get("chat_id")),this.chatMessagesView.on("messageSent",function(){var n="activity/"+encodeURIComponent(e.get("chat_id"));t.options.sharedObjects.router.navigate(n,{trigger:!0})});else this._showChatMessages("")},_showChatMessages:function(e){console.debug("_showChatMessages: chat_id: '"+e+"'");var n=t.extend({chat_id:e},this.options);this.chatMessagesView&&this.chatMessagesView.close();if(e===""&&this.recipients.length>0){n.recipients=[];for(var r=0;r<this.recipients.length;++r)n.recipients.push(this.recipients[r].get("chat_id"))}this.chatMessagesView=new o(n),this.$el.append(this.chatMessagesView.render().el),this.chatMessagesView.$el.css("right","0")}});return c}),define("text!templates/incomingcall.html",[],function(){return'<div class="text">Incoming call from...</div>\r\n<div class="avatar"><img class="round" src="<%- avatar %>"><div class="presence round <%- presence %>"></div></div>\r\n\r\n<div class="caller textwrap"><%= nickname_emoji %></div>\r\n<div class="controls">\r\n	<div class="icon hangup"><div class="razericons-call_hangup"></div></div>\r\n	<div class="icon answercall"><div class="razericons-call"></div></div>\r\n</div>'}),define("views/callui/incomingcall",["jquery","underscore","backbone","text!templates/incomingcall.html","w2ui","views/callui/callhandler"],function(e,t,n,r,i,s){var o=n.View.extend({className:"incoming-call-view",events:{"click .answercall":"_onAnswerCall2","click .hangup":"_onDeclineCall"},myAudio:null,missedCall:!1,initialize:function(e){t.bindAll(this,"close","_onAnswerCall","_onDeclineCall","_onUserInfo","_onMissedCall","_onAnswerCall2","_startAudio","_stopAudio"),this.options=e,this.template=t.template(r),this.router=this.options.sharedObjects.router,this.myAudio=null,console.debug("initialize incomingcall.js"),console.assert(typeof this.model!="undefined"),this.comms=this.options.sharedObjects.comms,this.comms.on("missedCall",this._onMissedCall,this);var n=this.model.get("user_id");this.comms.getUser({user_id:n,server_cache:!0,success:this._onUserInfo}),this.myAudio=new Audio("assets/wav/wav_voicecall_in.wav"),this.missedCall=!1},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},_onUserInfo:function(e){console.debug("_onUserInfo"),console.debug(e),this.model.set(e),e.avatar===""&&this.model.set("avatar","https://s3.amazonaws.com/comms.razerzone.com/avatar_default.png"),this.render()},close:function(){console.debug("close"),this.comms.off(null,null,this),this.options.sharedObjects.callHandler.off(null,null,this),this.unbind(),this.remove()},popup:function(){console.debug("popup");var t=this;i.open({width:310,height:340,body:'<div class="incomingcallview"></div>',modal:!0,opacity:.9,showClose:!1,onOpen:function(n){n.onComplete=function(){e(".w2ui-popup .w2ui-box1").css("top","0"),e(".w2ui-popup .incomingcallview").append(t.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){i.close(),t._onDeclineCall()}),t._startAudio()}},onClose:function(e){t.close()}})},_onAnswerCall:function(){var e=this.model.get("session_id"),t=this.model.get("user_id"),n=this,r="";r=window.location.origin+window.location.pathname,this.options.sharedObjects.dev&&(r+="?dev=1"),r+="#callui/"+encodeURIComponent(e),r+="/"+encodeURIComponent(this.comms.user_id),r+="/"+encodeURIComponent(this.comms.user.get("nickname")),r+="?adhoc=1",console.debug("popup url: "+r),this.comms.answerCall({session_id:e,user_id:t}),this._popupCenter(r,"Comms Call",310,390),i.close();var o=new s({chat_id:e,sharedObjects:this.options.sharedObjects})},_onAnswerCall2:function(){console.debug("_onAnswerCall2"),this.options.sharedObjects.callHandler.answerCall({session_id:this.model.get("session_id"),chat_id:this.model.get("user_id")}),i.close(),this._stopAudio()},_onDeclineCall:function(){var e=this.model.get("session_id"),t=this.model.get("user_id");this.comms.rejectCall({session_id:e,user_id:t}),i.close(),this._stopAudio()},_popupCenter:function(e,t,n,r){var i=window.screenLeft!=undefined?window.screenLeft:screen.left,s=window.screenTop!=undefined?window.screenTop:screen.top,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,u=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,a=o/2-n/2+i,f=u/2-r/2+s,l=window.open(e,t,"scrollbars=yes, width="+n+", height="+r+", top="+f+", left="+a);return window.focus&&l.focus(),l},_onMissedCall:function(e){console.info("_onMissedCall: "+JSON.stringify(e)),this.missedCall=!0,i.close(),this._stopAudio()},_startAudio:function(){this.missedCall||(console.debug("_startAudio"),typeof this.myAudio.loop=="boolean"?this.myAudio.loop=!0:this.myAudio.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),this.myAudio.play())},_stopAudio:function(){this.myAudio.pause()}});return o}),define("text!templates/navigationview.html",[],function(){return'<div class="userstatus">\r\n	<div class="userinfo">\r\n		<div class="avatar round"><img src="<%- avatar %>" width="100%" height="100%" class="round"></div>\r\n		<div class="presence round <%- presence %>"></div>\r\n		<div class="name textwrap"><%- nickname %></div>\r\n		<div class="razericons-triangle_down"></div>\r\n	</div>\r\n</div>\r\n<div class="navigation short">\r\n	<div class="divider" ></div>\r\n	<div class="slideleft slide"><div class="razericons-chevron_left"></div></div>\r\n	<div class="slideright slide"><div class=" razericons-chevron_right"></div></div>\r\n	<div class="maintitle large">CHATS</div>\r\n\r\n\r\n	<div class="tab activity active large">Activity <div class="unread activity round large"><span class="count"></span></div></div>\r\n	<div class="razericons-message tab activity short"></div><div class="unread activity round short"><span class="count"></span></div>\r\n\r\n	<div class="tab friends large">Contacts</div>\r\n	<div class="razericons-user_single tab friends short" style="padding-bottom:0"></div>\r\n\r\n	<!--<div class="divider"></div>-->\r\n	<div class="create_group large">CREATE GROUP <div class="razericons-add addgroup"></div></div>\r\n	<div class="razericons-message_creategroup tab create_group short"></div>\r\n\r\n	<div class="divider" ></div>\r\n	<div class="scroller">\r\n		<div class="grouplist"></div>\r\n		<div class="divider" style="display:none"></div>\r\n		<div class="maintitle communities large">COMMUNITIES</div>\r\n		<div class="razericons-community tab community short" style="padding-left:2px;display:none"></div>\r\n		<div class="communitylist" ></div>\r\n	</div>\r\n	<div class="fb_quick"><div class="razericons-message_alert hvalign"></div></div>\r\n</div>\r\n\r\n'}),define("text!templates/usermenu.html",[],function(){return'<div class="dropdowncontent">\r\n<div class="nickname"><%- comms_id %></div>\r\n<div class="view-profile rc-button" >VIEW PROFILE</div>\r\n<ul class="usermenu">\r\n	<li class="divider"></li>\r\n	<li class="presence" data-val="online"><div class="text">Online</div><div class="bar online"></div></li>\r\n	<li class="presence" data-val="busy"><div class="text">Busy</div><div class="bar dnd"></div></li>\r\n	<li class="presence" data-val="away"><div class="text">Away</div><div class="bar away"></div></li>\r\n	<li class="presence" data-val="invisible"><div class="text">Invisible</div><div class="bar invisible"></div></li>\r\n	<li class="divider" style="margin-top:9px"></li>\r\n    <li class="settings"><div class="text">Settings</div></li>\r\n	<li class="feedback"><div class="text">Feedback</div></li>\r\n	<li class="logout"><div class="text">Sign Out</div></li>\r\n	<li class="divider" style="margin-top:9px;margin-bottom:12px"></li>	\r\n</ul>\r\n	<div class="theme-title">THEME</div>\r\n		<div class="switch">\r\n			<input id="cmn-toggle-4" class="cmn-toggle cmn-toggle-round-flat" type="checkbox" name="theme">\r\n			<label for="cmn-toggle-4"><span class="razericons-moon moon"></span></label>\r\n		</div>\r\n\r\n<!-- \r\n<div id="feedbackModal">\r\n	<div class="close-feedbackModal"> \r\n		<div class="razericons-close modalclose"></div>\r\n	</div>		\r\n	<div class="modal-content">\r\n			\r\n		<select name="software">            \r\n			<option value="value1" selected>Comms</option> \r\n		</select>\r\n		<select class="typeofissue" name="typeofissue">\r\n			<option value="value2" selected>TYPE OF ISSUE</option>\r\n			<option value="value1">I have a problem</option> \r\n			<option value="value3">I have a suggestion</option>\r\n		</select>\r\n		<input class="subject" type="text" name="subject" placeholder="SUBJECT">\r\n		<textarea class="description" name="textarea" rows="13" cols="50" placeholder="DETAILS OF YOUR FEEDBACK"></textarea>\r\n		<div class="sendlog" style="display:none;">\r\n				<input id="log" type="checkbox" checked="checked">\r\n				<label class="check-box" for="log"></label><div class="labelcheckbox">Send log file</div>\r\n		</div>\r\n		<div class="rc-button sendfeedback">SEND FEEDBACK</div>\r\n	</div>\r\n</div>-->\r\n</div>\r\n'}),define("text!templates/settingsview.html",[],function(){return'<a id="settings" href="#settingsModal"></a>\n<div id="settingsModal">\n    <div class="close-settingsModal"> \n        <div class="razericons-close modalclose"></div>\n    </div>      \n    <div class="modal-content">\n        <div class="">\n            <div id="modalsidecontent"></div>\n            <div id="modalmaincontent"></div>\n        </div>\n    </div>\n</div>\n\n\n'}),define("text!templates/settingschat.html",[],function(){return'<div class="titlegreen ">CHATS HISTORY</div>\r\n<div class="greytext">This will clear all your chats history. This action is not reversible.</div>\r\n<div class="rc-button clearhistory">CLEAR HISTORY</div>\r\n<div class="titlegreen section">CHATS INFORMATIVE MESSAGES</div>\r\n<div class="greytext">These options allow you to be alerted in chat when:</div>\r\n<ul>\r\n<li>\r\n	<div class="text">User is typing</div>\r\n	<div class="onoffswitch">\r\n		<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="chat" checked>\r\n		<label class="onoffswitch-label" for="chat">\r\n			<span class="onoffswitch-inner"></span>\r\n			<span class="onoffswitch-switch"></span>\r\n		</label>\r\n	</div>\r\n</li>\r\n<li>\r\n	<div class="text">Members becomes Online/Offline</div>\r\n	<div class="onoffswitch">\r\n		<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="status" checked>\r\n		<label class="onoffswitch-label" for="status">\r\n			<span class="onoffswitch-inner"></span>\r\n			<span class="onoffswitch-switch"></span>\r\n		</label>\r\n	</div>\r\n</li>\r\n<li>\r\n	<div class="text">Start/Stop Voice Call</div>\r\n	<div class="onoffswitch">\r\n		<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="voicecall" checked>\r\n		<label class="onoffswitch-label" for="voicecall">\r\n			<span class="onoffswitch-inner"></span>\r\n			<span class="onoffswitch-switch"></span>\r\n		</label>\r\n	</div>\r\n</li>\r\n<li>\r\n	<div class="text">Group Voice Mute</div>\r\n	<div class="onoffswitch">\r\n		<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="voicemute" checked>\r\n		<label class="onoffswitch-label" for="voicemute">\r\n			<span class="onoffswitch-inner"></span>\r\n			<span class="onoffswitch-switch"></span>\r\n		</label>\r\n	</div>\r\n</li>\r\n<li>\r\n	<div class="text">Members join/leave group</div>\r\n	<div class="onoffswitch">\r\n		<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="joinleavegroup" checked>\r\n		<label class="onoffswitch-label" for="joinleavegroup">\r\n			<span class="onoffswitch-inner"></span>\r\n			<span class="onoffswitch-switch"></span>\r\n		</label>\r\n	</div>\r\n</li>\r\n<li>\r\n	<div class="text">Group members are kicked</div>\r\n	<div class="onoffswitch">\r\n		<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="memberskicked" checked>\r\n		<label class="onoffswitch-label" for="memberskicked">\r\n			<span class="onoffswitch-inner"></span>\r\n			<span class="onoffswitch-switch"></span>\r\n		</label>\r\n	</div>\r\n</li>\r\n</ul>'}),define("text!templates/settingsnotifications.html",[],function(){return'<div class="titlegreen ">WEB NOTIFICATIONS</div>\r\n<div class="greytext">Available for compatible browser such as Chrome, Safari, Firefox</div>\r\n<ul>\r\n	<li>\r\n		<div class="text">Incoming chat messages</div>\r\n		<div class="onoffswitch">\r\n			<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="incomingchatmessages" checked>\r\n			<label class="onoffswitch-label" for="incomingchatmessages">\r\n				<span class="onoffswitch-inner"></span>\r\n				<span class="onoffswitch-switch"></span>\r\n			</label>\r\n		</div>\r\n	</li>\r\n	<li>\r\n		<div class="text">Incoming group messages</div>\r\n		<div class="onoffswitch">\r\n			<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="incominggroupmessages" checked>\r\n			<label class="onoffswitch-label" for="incominggroupmessages">\r\n				<span class="onoffswitch-inner"></span>\r\n				<span class="onoffswitch-switch"></span>\r\n			</label>\r\n		</div>\r\n	</li>\r\n\r\n	<li>\r\n		<div class="text">Incoming voice call request (popup can\'t be disabled)</div>\r\n		<div class="onoffswitch">\r\n			<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="incomingvoicecall" checked>\r\n			<label class="onoffswitch-label" for="incomingvoicecall">\r\n				<span class="onoffswitch-inner"></span>\r\n				<span class="onoffswitch-switch"></span>\r\n			</label>\r\n		</div>\r\n	</li>\r\n	<li>\r\n		<div class="text">Community announcement is made (subscribed Communities)</div>\r\n		<div class="onoffswitch">\r\n			<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="communityannouncement" checked>\r\n			<label class="onoffswitch-label" for="communityannouncement">\r\n				<span class="onoffswitch-inner"></span>\r\n				<span class="onoffswitch-switch"></span>\r\n			</label>\r\n		</div>\r\n	</li>\r\n	<li>\r\n		<div class="text">Community @mentions</div>\r\n		<div class="onoffswitch">\r\n			<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="communitymentions" checked>\r\n			<label class="onoffswitch-label" for="communitymentions">\r\n				<span class="onoffswitch-inner"></span>\r\n				<span class="onoffswitch-switch"></span>\r\n			</label>\r\n		</div>\r\n	</li>\r\n\r\n</ul>\r\n'}),define("text!templates/settingsprivacy.html",[],function(){return'<div class="titlegreen ">FRIENDS REQUESTS</div>\r\n<div class="greytext">Available for compatible browser such as Chrome, Safari, Firefox</div>\r\n<ul>\r\n	<li>\r\n		<div class="text">Block incoming friends requests</div>\r\n		<div class="onoffswitch">\r\n			<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="blockfriendrequests" checked>\r\n			<label class="onoffswitch-label" for="blockfriendrequests">\r\n				<span class="onoffswitch-inner"></span>\r\n				<span class="onoffswitch-switch"></span>\r\n			</label>\r\n		</div>\r\n	</li>\r\n</ul>\r\n<div class="titlegreen section">BLOCKED CONTACTS</div>\r\n<div class="greytext">You will no longer receive any messages or requests from blocked contacts/groups.</div>\r\n<div class="greytext">You don\'t have any contact or group blocked at the moment.</div>'}),define("text!templates/settingsgeneral.html",[],function(){return'<div class="titlegreen ">GENERAL</div>\n<!--<div class="greytext">Available for compatible browser such as Chrome, Safari, Firefox</div>-->\n<ul>\n	<li>\n		<div class="text">Launch Comms when Windows starts</div>\n		<div class="onoffswitch">\n			<input type="checkbox" name="onoffswitch-autolaunch" class="onoffswitch-checkbox" id="autolaunch" checked>\n			<label class="onoffswitch-label" for="autolaunch">\n				<span class="onoffswitch-inner"></span>\n				<span class="onoffswitch-switch"></span>\n			</label>\n		</div>\n		<ul>\n			<li>\n				<div class="text">Minimize to system tray on startup</div>\n				<div class="onoffswitch">\n					<input type="checkbox" name="onoffswitch-autolaunchsystray" class="onoffswitch-checkbox" id="autolaunchsystray" unchecked>\n					<label class="onoffswitch-label" for="autolaunchsystray">\n						<span class="onoffswitch-inner"></span>\n						<span class="onoffswitch-switch"></span>\n					</label>\n				</div>\n			</li>\n		</ul>\n	</li>\n</ul>\n<!--<div class="titlegreen section">BLOCKED CONTACTS</div>\n<div class="greytext">You will no longer receive any messages or requests from blocked contacts/groups.</div>\n<div class="greytext">You don\'t have any contact or group blocked at the moment.</div>-->'}),define("text!templates/settingsaudio.html",[],function(){return'<div class="titlegreen ">SPEAKER</div>\n<select name="speakers" id="audio-out-select" style="margin-top: 7px; margin-bottom: 14px"></select>\n\n<div class="titlegreen ">MICROPHONE</div>\n<select name="microphones" id="audio-in-select" style="margin-top: 7px; margin-bottom: 14px"></select>\n\n<div class="titlegreen ">MICROPHONE ACTIVATION METHOD</div>\n<!--<div class="greytext">Available for compatible browser such as Chrome, Safari, Firefox</div>-->\n<ul>\n	<li>\n		<div class="text">Voice Activity Detection</div>\n		<div class="onoffswitch">\n			<input type="checkbox" name="onoffswitch-vad" class="onoffswitch-checkbox" id="vad" checked>\n			<label class="onoffswitch-label" for="vad">\n				<span class="onoffswitch-inner"></span>\n				<span class="onoffswitch-switch"></span>\n			</label>\n		</div>\n	</li>\n\n	<li style="height: 80px">\n		<div class="text">Push to Talk</div>\n		<div class="onoffswitch">\n			<input type="checkbox" name="onoffswitch-pushtotalk" class="onoffswitch-checkbox" id="pushtotalk" unchecked>\n			<label class="onoffswitch-label" for="pushtotalk">\n				<span class="onoffswitch-inner"></span>\n				<span class="onoffswitch-switch"></span>\n			</label>\n		</div>\n        <input type="text" class="hotkey-input" name="push-to-talk-keys" id="pttKeys">\n	</li>\n</ul>\n<!--<div class="titlegreen section">BLOCKED CONTACTS</div>\n<div class="greytext">You will no longer receive any messages or requests from blocked contacts/groups.</div>\n<div class="greytext">You don\'t have any contact or group blocked at the moment.</div>-->'}),define("text!templates/settingsabout.html",[],function(){return'<div class="text" style="align: center;">\n    <p>\n        <span>Razer Comms: </span>\n        <span id="comms-version"></span>\n    </p>\n</div>\n<ul>\n    <li>\n    <li><a href="http://dl.razerzone.com/master-guides/RazerComms/v5.12/CommsOMG-ENG.pdf" target=\'_blank\'><div class="text">USER GUIDE</div></a></li>\n    <li>\n    <li><a href="http://rzr.to/licenceagree" target=\'_blank\'><div class="text">License Terms</div></a></li>\n    <li><a href="http://www.razerzone.com/terms-of-service" target=\'_blank\'><div class="text">Terms of Service</div></a></li>\n    <li><a href="http://www.razerzone.com/privacy-policy" target=\'_blank\'><div class="text">Privacy Policy</div></a></li>\n    <li><a href="http://rzr.to/softwarenotices" target=\'_blank\'><div class="text">Open Source Software Notices</div></a></li>\n</ul>\n<div class="text" style="align: center; margin-top:14px">\n    <p>Copyright (c) 2012 - 2016 All Rights Reserved, Razer Inc.</p>\n</div>'}),define("views/settings/settingsview",["jquery","underscore","backbone","text!templates/settingsview.html","animatemodal","rcsidetab","text!templates/settingschat.html","text!templates/settingsnotifications.html","text!templates/settingsprivacy.html","text!templates/settingsgeneral.html","text!templates/settingsaudio.html","text!templates/settingsabout.html"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=n.View.extend({className:"settings-view",pttKeySetting:{capturedKeys:null,isAnyKeyPressed:!1,name:"micMode",data:{isVAD:!0,keys:[]}},events:{"change input#incomingchatmessages":"_onChatChange","change input#incominggroupmessages":"_onGroupChatChange","change input#incomingvoicecall":"_onIncomingCallChange","change input#communityannouncement":"_onCommunityAnnouncementChange","change input#communitymentions":"_onCommunityMentionChange",'change input[type="checkbox"]':"onThemeChanged","change #autolaunch":"_onAutoLaunchChanged","change #autolaunchsystray":"_onAutoLaunchSysTrayChanged","change #vad":"_onVADChanged","change #pushtotalk":"_onPushToTalkChanged","keydown #pttKeys":"_onPttKeysKeydown","keyup #pttKeys":"_onPttKeysKeyup","focus #pttKeys":"_onPttKeysFocus","blur #pttKeys":"_onPttKeysBlur","mousedown #pttKeys":"_onPttKeysMousedown","mouseup #pttKeys":"_onPttKeysMouseup"},initialize:function(e){t.bindAll(this,"render","close","popup","_renderSettings","_setModelValue"),this.options=e,this.template=t.template(r),console.assert(this.options.sharedObjects),console.assert(this.options.sharedObjects.settingsModel),this.model=this.options.sharedObjects.settingsModel,console.debug("Settings model:"),console.debug(JSON.stringify(this.model.toJSON()))},render:function(){this.$el.html(this.template());var t=this;return setTimeout(function(){var n=[];window.nodeRequire?(n=[{name:"GENERAL",id:"settings-general",content:"templates/settingsgeneral.html",html:f},{name:"NOTIFICATIONS",id:"settings-notifications",content:"templates/settingsnotifications.html",html:u},{name:"AUDIO",id:"settings-audio",content:"templates/settingsaudio.html",html:l},{name:"ABOUT",id:"settings-about",content:"templates/settingsabout.html",html:c}],e("#modalsidecontent").rcSidetab2({name:"modal-content",active:"settings-general",tabs:n,content:"modalmaincontent",nocache:!0,onClick:function(){var n=e(this).attr("id");n=="settings-audio"?t._showAudioSettings():n=="settings-general"?t._showAutoLaunch():n=="settings-about"&&t._showAboutSettings()},onLoadFinished:function(){}}),t._showAutoLaunch(),t._initPttKeys()):(n=[{name:"NOTIFICATIONS",id:"settings-notifications",content:"templates/settingsnotifications.html",html:u}],t.$("#modalsidecontent").rcSidetab2({name:"modal-content",active:"settings-notifications",tabs:n,content:"modalmaincontent",nocache:!0,onLoadFinished:function(){var t=e(this).attr("id")}})),t.$("#settings").animatedModal({modalTarget:"settingsModal",animatedIn:"bounceInUp",animatedOut:"bounceOutDown",color:"#222222",beforeOpen:function(){console.debug("beforeOpen"),t.$(".close-settingsModal").show(),t.$("#settingsModal").show()},afterOpen:function(){console.debug("afterOpen")},beforeClose:function(){console.debug("beforeClose"),t.options.onClose&&t.options.onClose()},afterClose:function(){console.debug("afterClose"),t.close()}}),t._renderSettings()},0),this},_renderSettings:function(){var e=this.model.get("notifications"),t=this,n=function(n,r){t.$(r).prop("checked",e.get(n))};n("chat","input#incomingchatmessages"),n("group_chat","input#incominggroupmessages"),n("incoming_call","input#incomingvoicecall"),n("community_announcement","input#communityannouncement"),n("community_mention","input#communitymentions")},popup:function(){console.debug("popup");var e=this;setTimeout(function(){e.$("a").click()},0)},close:function(){console.debug("close"),this.unbind(),this.remove()},_setModelValue:function(e,t){var n=this.$(t).is(":checked");this.model.get("notifications").set(e,n)},_onChatChange:function(){console.debug("_onChatChange"),this._setModelValue("chat","input#incomingchatmessages")},_onGroupChatChange:function(){this._setModelValue("group_chat","input#incominggroupmessages")},_onIncomingCallChange:function(){this._setModelValue("incoming_call","input#incomingvoicecall")},_onCommunityAnnouncementChange:function(){this._setModelValue("community_announcement","input#communityannouncement")},_onCommunityMentionChange:function(){this._setModelValue("community_mention","input#communitymentions")},_initPttKeys:function(){var e=this.model.getAudioSettings();this.pttKeySetting.data.isVAD=e.get("isVAD");var t=e.get("pttKeys");t!==""&&(this.pttKeySetting.data.keys=t.split(","))},_showAudioSettings:function(){console.log("_showAudioSettings");var t=this.pttKeySetting.data;e('input[name="onoffswitch-vad"]').prop("checked",t.isVAD),e('input[name="onoffswitch-pushtotalk"]').prop("checked",!t.isVAD),e("#pttKeys").prop("disabled",t.isVAD),e("#pttKeys").val(this._formatKeyCodes(t.keys));var n=this.model.getAudioSettings(),r=window.nodeRequire("../voice/voice-conference"),i=[{settingId:"audioOutDeviceName",elementId:"audio-out-select",element:e("#audio-out-select"),devices:r.getPlayoutDevices(),setSelect:function(e){r.setPlayoutDevice(e)}},{settingId:"audioInDeviceName",elementId:"audio-in-select",element:e("#audio-in-select"),devices:r.getRecordingDevices(),setSelect:function(e){r.setRecordingDevice(e)}}],s=function(){for(var t=0;t<i.length;++t){var r=i[t];if(r.elementId==e(this).attr("id")){var s=e(this).val(),o=r.devices.indexOf(s);r.setSelect(o),n.set(r.settingId,s);break}}};for(var o=0;o<i.length;++o){var u=i[o],a=u.devices,f=u.element,l=a.length;for(var c=0;c<l;++c){var h=a[c];f.append(e("<option>").text(h))}var p=n.get(u.settingId);p!==""&&f.prop("value",p),f.change(s)}var d=this;const v=nodeRequire("electron").ipcRenderer;v.on("extrabuttonpressed",function(t,n){if(e("#pttKeys").is(":focus")){var r=d.pttKeySetting.capturedKeys;r.indexOf(n)<0&&(r.push(n),e("#pttKeys").val(d._formatKeyCodes(r)),d.pttKeySetting.data.keys=r.slice(),v.send("settings-change",d.pttKeySetting.name,d.pttKeySetting.data),d._savePTTKeys())}}),v.on("extrabuttonreleased",function(t,n){if(e("#pttKeys").is(":focus")){var r=d.pttKeySetting.capturedKeys.indexOf(n);r>=0&&d.pttKeySetting.capturedKeys.splice(r,1)}})},_showAutoLaunch:function(){const t=nodeRequire("electron").ipcRenderer;t.on("settings-get",function(t,n,r){n=="autolaunch"?e('input[name="onoffswitch-autolaunch"]').prop("checked",r):n=="autolaunchsystray"&&e('input[name="onoffswitch-autolaunchsystray"]').prop("checked",r)}),t.send("settings-get","autolaunch"),t.send("settings-get","autolaunchsystray")},_showAboutSettings:function(){const t=nodeRequire("electron").ipcRenderer;t.send("get-comms-version"),t.on("set-comms-version",function(t,n){e("#comms-version").text(n)})},_onAutoLaunchChanged:function(){var t={isAutoLaunch:e('input[name="onoffswitch-autolaunch"]').is(":checked"),isSysTray:e('input[name="onoffswitch-autolaunchsystray"]').is(":checked")};t.isAutoLaunch||e('input[name="onoffswitch-autolaunchsystray"]').attr("checked",!1);const n=nodeRequire("electron").ipcRenderer;n.send("settings-change","autolaunch",t)},_onAutoLaunchSysTrayChanged:function(){var t={isAutoLaunch:e('input[name="onoffswitch-autolaunch"]').is(":checked"),isSysTray:e('input[name="onoffswitch-autolaunchsystray"]').is(":checked")};if(t.isAutoLaunch){const n=nodeRequire("electron").ipcRenderer;n.send("settings-change","autolaunchsystray",t)}},_onVADChanged:function(){var t=this.pttKeySetting.data;t.isVAD=e('input[name="onoffswitch-vad"]').is(":checked"),e('input[name="onoffswitch-pushtotalk"]').prop("checked",!t.isVAD),this._setIsVAD()},_onPushToTalkChanged:function(){var t=this.pttKeySetting.data;t.isVAD=!e('input[name="onoffswitch-pushtotalk"]').is(":checked"),e('input[name="onoffswitch-vad"]').prop("checked",t.isVAD),this._setIsVAD()},_onPttKeysKeydown:function(e){e.preventDefault(),this._processKeydown(e,this.pttKeySetting);if(this.pttKeySetting.data.keys!==undefined){var t=this.model.getAudioSettings();t.set("pttKeys",this.pttKeySetting.data.keys.join(","))}},_onPttKeysKeyup:function(e){e.preventDefault(),this._processKeyup(e,this.pttKeySetting)},_onPttKeysFocus:function(e){this._processFocus(e,this.pttKeySetting)},_onPttKeysBlur:function(e){this._processBlur(e,this.pttKeySetting);var t=this.pttKeySetting.data.keys;if(t===undefined||t.length===0)this.$('input[name="onoffswitch-vad"]').prop("checked",!0),this._onVADChanged()},_onPttKeysMousedown:function(e){this._processMousedown(e,this.pttKeySetting),this._savePTTKeys()},_onPttKeysMouseup:function(e){this._processMouseup(e,this.pttKeySetting)},_setIsVAD:function(){var t=this.pttKeySetting.data;e("#pttKeys").prop("disabled",t.isVAD),t.isVAD||e("#pttKeys").val()===""&&e("#pttKeys").focus();var n=this.model.getAudioSettings();n.set("isVAD",t.isVAD);const r=nodeRequire("electron").ipcRenderer;r.send("settings-change",this.pttKeySetting.name,t)},_processKeydown:function(t,n){n.isAnyKeyPressed=!0;var r=n.capturedKeys;if(r.indexOf(t.which)<0){t.which==17?r.unshift(t.which):t.which==16?r.splice(1,0,t.which):t.which==18?r.splice(2,0,t.which):r.push(t.which),e(t.currentTarget).val(this._formatKeyCodes(r)),n.data.keys=r.slice();const i=nodeRequire("electron").ipcRenderer;i.send("settings-change",n.name,n.data)}},_processKeyup:function(e,t){var n=t.capturedKeys.indexOf(e.which);n>=0&&t.capturedKeys.splice(n,1)},_processFocus:function(t,n){e(t.currentTarget).val(""),n.capturedKeys=[],n.isAnyKeyPressed=!1},_processBlur:function(t,n){const r=nodeRequire("electron").ipcRenderer;!n.isAnyKeyPressed&&n.data.keys!==undefined&&e(t.currentTarget).val(this._formatKeyCodes(n.data.keys)),r.send("stopsendextrabuttontoui")},_formatKeyCodes:function(e){if(e!==undefined&&e.length>0){var t=p[e[0]],n=e.length;for(var r=1;r<n;++r)t+=" + "+p[e[r]];return t}return""},_processMousedown:function(t,n){if(e(t.currentTarget).is(":focus")){n.isAnyKeyPressed=!0;if(t.button>0){t.preventDefault();var r=this._getCorrectMouseBtn(t.button),i=n.capturedKeys;if(i.indexOf(r)<0){i.push(r),e(t.currentTarget).val(this._formatKeyCodes(i)),n.data.keys=i.slice();const s=nodeRequire("electron").ipcRenderer;s.send("settings-change",n.name,n.data)}}}else{const s=nodeRequire("electron").ipcRenderer;s.send("startsendextrabuttontoui")}},_processMouseup:function(e,t){var n=this._getCorrectMouseBtn(e.button),r=t.capturedKeys.indexOf(n);r>=0&&t.capturedKeys.splice(r,1)},_savePTTKeys:function(){if(this.pttKeySetting.data.keys!==undefined){var e=this.model.getAudioSettings();e.set("pttKeys",this.pttKeySetting.data.keys.join(","))}},_getCorrectMouseBtn:function(e){var t=e;return e==1&&(t=4),t}});const p=["","MOUSE:LEFT","MOUSE:RIGHT","CANCEL","MOUSE:MIDDLE","MOUSE:XBUTTON1","MOUSE:XBUTTON2","","BACKSPACE","TAB","","","CLEAR","ENTER","ENTER_SPECIAL","","SHIFT","CTRL","ALT","PAUSE","CAPS_LOCK","KANA","EISU","JUNJA","FINAL","HANJA","","ESCAPE","CONVERT","NONCONVERT","ACCEPT","MODECHANGE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","LEFT","UP","RIGHT","DOWN","SELECT","PRINT","EXECUTE","PRINTSCREEN","INSERT","DELETE","HELP","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","AT","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","OS_KEY","","CONTEXT_MENU","","SLEEP","NUMPAD0","NUMPAD1","NUMPAD2","NUMPAD3","NUMPAD4","NUMPAD5","NUMPAD6","NUMPAD7","NUMPAD8","NUMPAD9","MULTIPLY","ADD","SEPARATOR","SUBTRACT","DECIMAL","DIVIDE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","","","","","","","","","NUM_LOCK","SCROLL_LOCK","WIN_OEM_FJ_JISHO","WIN_OEM_FJ_MASSHOU","WIN_OEM_FJ_TOUROKU","WIN_OEM_FJ_LOYA","WIN_OEM_FJ_ROYA","","","","","","","","","","CIRCUMFLEX","EXCLAMATION","DOUBLE_QUOTE","HASH","DOLLAR","PERCENT","AMPERSAND","UNDERSCORE","OPEN_PAREN","CLOSE_PAREN","ASTERISK","PLUS","PIPE","HYPHEN_MINUS","OPEN_CURLY_BRACKET","CLOSE_CURLY_BRACKET","TILDE","","","","","VOLUME_MUTE","VOLUME_DOWN","VOLUME_UP","","","SEMICOLON","EQUALS","COMMA","MINUS","PERIOD","SLASH","BACK_QUOTE","","","","","","","","","","","","","","","","","","","","","","","","","","","OPEN_BRACKET","BACK_SLASH","CLOSE_BRACKET","QUOTE","","META","ALTGR","","WIN_ICO_HELP","WIN_ICO_00","","WIN_ICO_CLEAR","","","WIN_OEM_RESET","WIN_OEM_JUMP","WIN_OEM_PA1","WIN_OEM_PA2","WIN_OEM_PA3","WIN_OEM_WSCTRL","WIN_OEM_CUSEL","WIN_OEM_ATTN","WIN_OEM_FINISH","WIN_OEM_COPY","WIN_OEM_AUTO","WIN_OEM_ENLW","WIN_OEM_BACKTAB","ATTN","CRSEL","EXSEL","EREOF","PLAY","ZOOM","","PA1","WIN_OEM_CLEAR",""];return h}),define("text!templates/feedbackview.html",[],function(){return'<a id="feedback" href="#feedbackModal"></a>\n<div id="feedbackModal">\n    <div class="close-feedbackModal"> \n        <div class="razericons-close modalclose"></div>\n    </div>      \n    <div class="modal-content">\n            \n        <!-- <select name="software">           \n            <option value="value1" selected>Comms</option> \n        </select>-->        \n        <!-- <div class="software">Comms</div>-->\n        <div class="form">\n            <div class="title">FEEDBACK FORM</div>\n            <div class="helptext">Help us make Comms the product you really need.</div>\n            <select class="typeofissue" name="typeofissue">\n                <option value="value2" selected>Type of issue</option>\n                <option value="value1">I have a problem</option> \n                <option value="value3">I have a suggestion</option>\n            </select>\n            <input class="subject" type="text" name="subject" placeholder="Subject">\n            <textarea class="description" name="textarea" rows="13" cols="50" placeholder="Details of your feedback"></textarea>\n            <div class="sendlog" style="display:none;">\n                    <input id="log" type="checkbox" checked="checked">\n                    <label class="check-box" for="log"></label><div class="labelcheckbox">Send log file</div>\n            </div>\n            <div class="rc-button sendfeedback">SEND</div>\n        </div>\n        \n        \n    </div>\n    <div class="sent_successfully">\n            <div class="tick"><span class="hvalign razericons-validate"></span></div>\n            <div>Your feedback was sent correctly.</div>\n            <div>Your feedbacks are extremely valuable to us.</div>\n            <div class="thankyou">Thank You !</div>\n    </div>\n</div>\n'}),define("views/feedback/feedbackview",["jquery","underscore","backbone","text!templates/feedbackview.html","animatemodal"],function(e,t,n,r,i){var s=n.View.extend({className:"feedback-view",events:{"click .sendfeedback":"_onSendFeedbackClicked","keyup #feedbackModal input.subject":"_checkFeedbackInput","keyup #feedbackModal textarea.description":"_checkFeedbackInput","change #feedbackModal select.typeofissue":"_checkFeedbackInput"},initialize:function(e){t.bindAll(this,"render","close","popup"),this.options=e,this.template=t.template(r),this.comms=this.options.sharedObjects.comms},render:function(){console.debug("render feedbackview"),this.$el.html(this.template());var t=this;return setTimeout(function(){this.$("#feedback").animatedModal({modalTarget:"feedbackModal",animatedIn:"bounceInUp",animatedOut:"bounceOutDown",color:"#222222",beforeOpen:function(){e(".close-feedbackModal").show(),e("#feedbackModal").show(),t._checkFeedbackInput()},afterOpen:function(){},beforeClose:function(){t.options.onClose&&t.options.onClose()},afterClose:function(){t.close()}})},0),this},popup:function(){console.debug("popup");var e=this;setTimeout(function(){e.$("a").click()},0)},close:function(){console.debug("close"),this.unbind(),this.remove()},_onSendFeedbackClicked:function(){console.debug("_onSendFeedbackClicked");var t=this.$("#feedbackModal input.subject").val(),n=this.$("#feedbackModal textarea.description").val(),r=this.$("#feedbackModal select.typeofissue option:selected").text(),i="General";r==="I have a problem"?i="Bug Report":r==="I have a suggestion"&&(i="Feature Request"),console.debug("Title: "+t),console.debug("Description: "+n),console.debug("Issue Type: "+r),console.debug("os: "+navigator.platform),console.debug("os_version: "+navigator.userAgent),console.debug("category: "+i),console.debug(navigator);var s="1.0",o=e(document).find("head link");for(var u=0;u<o.length;++u)if(e(o[u]).attr("rel")==="stylesheet"){var a=e(o[u]).attr("href");console.debug(a);if(a.indexOf("styles.css?v=")!==-1){var f=a.split("=");s="CommsWeb_v"+f[1]}break}var l=this;e("body").addClass("rc-loading");var c=window.nodeRequire?"[Comms] ":"[CommsWeb] ";this.comms.submitFeedback({title:c+t,description:n,category:i,os:navigator.platform,os_version:navigator.userAgent,version:s,success:function(){e("body").removeClass("rc-loading"),l.$("#feedbackModal .modal-content").hide(),l.$("#feedbackModal .sent_successfully").show(),setTimeout(function(){l.$("#feedbackModal .modalclose").click()},3e3)}})},_checkFeedbackInput:function(){var e=this.$("#feedbackModal input.subject").val(),t=this.$("#feedbackModal textarea.description").val();if(e===""||t===""){this.$(".rc-button.sendfeedback").addClass("rc-disabled-button");return}var n=this.$("#feedbackModal select.typeofissue option:selected").text();if(n=="TYPE OF ISSUE"){this.$(".rc-button.sendfeedback").addClass("rc-disabled-button");return}this.$(".rc-button.sendfeedback").removeClass("rc-disabled-button")}});return s}),define("views/usermenu/usermenuview",["jquery","underscore","backbone","text!templates/usermenu.html","models/usermodel","velocity","views/profile/viewprofile","animatemodal","rcsidetab","views/settings/settingsview","views/feedback/feedbackview"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.View.extend({tagName:"div",className:"usermenu-dropdown-view",events:{"click li.presence":"onChangePresence","click li.logout":"onLogout","click .view-profile":"onViewProfileClicked","click .theme.light":"_changeLightTheme","click .theme.dark":"_changeDarkTheme",'change input[type="checkbox"]':"onThemeChanged","click li.settings":"_onSettingsClicked","click li.feedback":"_onFeedbackClicked"},shown:!1,comms:null,user:null,presence:"",initialize:function(e){t.bindAll(this,"render","onChangePresence","show","hide","toggleSettings","autoHideSettingsview"),t.bindAll(this,"_checkFeedbackInput"),this.options=e,this.template=t.template(r),this.shown=!1,this.comms=this.options.sharedObjects.comms,this.commsCommunity=this.options.sharedObjects.commsCommunity,this.router=this.options.sharedObjects.router,this.user=new i(this.options.sharedObjects.comms.user.toJSON())},render:function(){this.presence===""&&(this.presence="online"),this.user.set("presence",this.presence),this.$el.html(this.template(this.user.toJSON()));var t=this;this.$("li.presence").parent().find("[data-val='"+t.presence+"']").addClass("selected"),e(".navigation.short").is(":visible")&&this.$(".dropdowncontent").css("left","55px"),this._showSelectedTheme();if(window.nodeRequire){console.log("init audio settings");var n=this.options.sharedObjects.settingsModel,r=n.getAudioSettings(),i={isVAD:r.get("isVAD"),keys:[]},s=r.get("pttKeys");s!==""&&(i.keys=s.split(",")),console.log("isVAD: "+i.isVAD),console.log("pttKeys: "+s);const o=nodeRequire("electron").ipcRenderer;o.send("settings-change","micMode",i),o.on("node-voice-initialized",function(){console.log("set audio devices according to settings");var e=window.nodeRequire("../voice/voice-conference"),t=r.get("audioOutDeviceName"),n=[],i=-1;t!==""&&(console.log(t),n=e.getPlayoutDevices(),i=n.indexOf(t),i>=0&&e.setPlayoutDevice(i)),t=r.get("audioInDeviceName"),t!==""&&(console.log(t),n=e.getRecordingDevices(),i=n.indexOf(t),i>=0&&e.setRecordingDevice(i))});var u=e(".logout").clone();u.removeClass("logout"),u.addClass("quit"),u.children("div.text").text("Quit"),e(".logout").after(u),u.click(function(){o.send("quit_app")})}return this},show:function(){var t=this;this.user=new i(this.options.sharedObjects.comms.user.toJSON()),this.render(),this.$(".dropdowncontent").velocity("slideDown",{duration:200,complete:function(){t.shown=!0,e(document).bind("click",t.autoHideSettingsview)}})},hide:function(){var t=this;this.$(".dropdowncontent").velocity("slideUp",{duration:200,complete:function(){t.shown=!1,e(document).unbind("click",t.autoHideSettingsview),t.options.onCloseUserMenu&&t.options.onCloseUserMenu()}})},autoHideSettingsview:function(t){var n=this;!e(t.target).closest(".settings").length&&!e(t.target).closest(".usermenu-dropdown-view").length&&t.target.className.indexOf("presence")===-1&&t.target.className.indexOf("text")===-1&&n.hide()},toggleSettings:function(){this.shown?this.hide():this.show()},onChangePresence:function(t){var n=e(t.currentTarget).attr("data-val");this.comms.setPresence({user_id:this.comms.user_id,presence:n}),this.presence=n,this.render(),this.$(".dropdowncontent").show(),this.options.onChangePresence&&this.options.onChangePresence(n)},onLogout:function(){this.comms.close(),this.commsCommunity.close(),window.localStorage.removeItem("comms_api_key"),window.localStorage.removeItem("comms_uuid"),this.router.navigate("login",{trigger:!0})},onViewProfileClicked:function(){var e=t.extend({user_id:this.user.get("id")},this.options);viewProfileView=new o(e),viewProfileView.popup()},close:function(){var e=this;this.remove(),this.unbind()},_onSendFeedbackClicked:function(){console.debug("_onSendFeedbackClicked");var t=this.$("#feedbackModal input.subject").val(),n=this.$("#feedbackModal textarea.description").val(),r=this.$("#feedbackModal select.typeofissue option:selected").text(),i="General";r==="I have a problem"?i="Bug Report":r==="I have a suggestion"&&(i="Feature Request"),console.debug("Title: "+t),console.debug("Description: "+n),console.debug("Issue Type: "+r),console.debug("os: "+navigator.platform),console.debug("os_version: "+navigator.userAgent),console.debug("category: "+i),console.debug(navigator);var s="1.0",o=e(document).find("head link");for(var u=0;u<o.length;++u)if(e(o[u]).attr("rel")==="stylesheet"){var a=e(o[u]).attr("href");console.debug(a);if(a.indexOf("styles.css?v=")!==-1){var f=a.split("=");s="CommsWeb_v"+f[1]}break}var l=this;e("body").addClass("rc-loading"),this.comms.submitFeedback({title:"[CommsWeb] "+t,description:n,category:i,os:navigator.platform,os_version:navigator.userAgent,version:s,success:function(){e("body").removeClass("rc-loading"),l.$("#feedbackModal .modalclose").click()}})},_checkFeedbackInput:function(){var e=this.$("#feedbackModal input.subject").val(),t=this.$("#feedbackModal textarea.description").val();if(e===""||t===""){this.$(".rc-button.sendfeedback").addClass("rc-disabled-button");return}var n=this.$("#feedbackModal select.typeofissue option:selected").text();if(n=="TYPE OF ISSUE"){this.$(".rc-button.sendfeedback").addClass("rc-disabled-button");return}this.$(".rc-button.sendfeedback").removeClass("rc-disabled-button")},_changeTheme:function(e){this.options.changeTheme&&this.options.changeTheme(e),this.setInLocalStorage("theme",e)},setInLocalStorage:function(e,t){var n=window.localStorage.getItem("comms_settings");n?n=JSON.parse(n):n={},n[e]=t,window.localStorage.setItem("comms_settings",JSON.stringify(n))},onThemeChanged:function(){var e=this.$('input[name="theme"]').is(":checked");e?this._changeTheme("dark"):this._changeTheme("light")},_showSelectedTheme:function(){var e="light",t=window.localStorage.getItem("comms_settings");t&&(t=JSON.parse(t),e=t.theme),e==="dark"&&this.$('input[name="theme"]').attr("checked","checked")},_onSettingsClicked:function(){console.debug("_onSettingsClicked");var e=this,t=new f({sharedObjects:this.options.sharedObjects,onClose:function(){e.hide()}});this.$el.append(t.render().el),t.popup()},_onFeedbackClicked:function(){console.debug("_onFeedbackClicked");var e=this,t=new l({sharedObjects:this.options.sharedObjects,onClose:function(){e.hide()}});this.$el.append(t.render().el),t.popup()}});return c}),define("text!templates/communities/communitylistview.html",[],function(){return'<div class="add"><span class="icon hvalign razericons-add"></div>\r\n<ul class="list">\r\n</ul>\r\n<!-- <div class="add"><span class="icon hvalign razericons-add"></div>-->\r\n<div class="create menulist">\r\n	<ul class="menu">\r\n		<li class="create_community">Create a Community</li>\r\n		<li class="search_community">Search Communities</li>\r\n	</ul>\r\n</div>'}),define("text!templates/communities/communityitem.html",[],function(){return'<div class="bullet round"/>\r\n<div class="navtitle textwrap"><%= name_emoji %></div>\r\n<img src="<%- icon %>" class="icon">\r\n<img src="<%- icon %>" class="icon_small">\r\n<div class="unread_mention round"><span class="count"></span><span class="more">...</span></div>\r\n<div class="announcement"><span class="razericons-loudspeaker announcementicon hvalign"/></div>\r\n'}),define("views/communities/communityitem",["jquery","underscore","backbone","text!templates/communities/communityitem.html","models/communities/communitymodel"],function(e,t,n,r,i){var s=n.View.extend({tagName:"li",className:"community-item-view gridnavigation",events:{click:"_onClick"},router:null,current_channel:null,tooltip_initialized:!1,initialize:function(e){t.bindAll(this,"render","close","_onClick","_onCommunityMentioned","_onPostAnnouncement","_onAnnouncementMarked"),this.options=e,this.template=t.template(r),this.router=this.options.sharedObjects.router,console.assert(typeof this.model!="undefined"),this.comms=this.options.sharedObjects.comms,this.commsCommunity=this.options.sharedObjects.commsCommunity,this.model.on("change",this.render,this),this.model.on("change:removed",this.close),this.tooltip_initialized=!1;var n="communityMentioned."+this.model.get("id");this.commsCommunity.on(n,this._onCommunityMentioned,this);var n="communityDeleted."+this.model.get("id");this.commsCommunity.on(n,this._onCommunityDeleted,this);var i="post_announcement."+this.model.get("id");this.commsCommunity.on(i,this._onPostAnnouncement,this);var s="announcementMarked."+this.model.get("id");this.commsCommunity.on(s,this._onAnnouncementMarked,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.mobileView();e||this._addTooltip(this.$(".icon"),this.model.get("name_emoji")),this.model.has("current_channel_id")&&this.model.get("current_channel_id")!==""?this.current_channel=this.model.get("current_channel_id"):this.model.has("lobby_id")&&this.model.get("lobby_id")!==""&&(this.current_channel=this.model.get("lobby_id"));var t=n.history.fragment,r=t.split("/");if(r.length===3){var i=r[1],s=r[2];i===this.model.get("id")&&(this.current_channel=s)}var o=0;if(this.model.has("unread_mention")&&this.model.get("unread_mention")>0){var o=this.model.get("unread_mention");this.$(".announcement").hide(),o>=99?(this.$(".unread_mention span.more").show(),this.$(".unread_mention span.count").hide()):(this.$(".unread_mention span.more").hide(),this.$(".unread_mention span.count").text(o)),this.$(".unread_mention").show()}else this.$(".unread_mention").hide();return this.model.has("last_announcement")&&this.model.get("last_announcement").unread_count>0&&o===0&&this.$(".announcement").show(),this},close:function(){console.debug("close: "+this.model.get("name")),this.stopListening(),this.commsCommunity.off(null,null,this),this.model.off(null,null,this),this.remove(),this.unbind()},_onClick:function(t){e(".tooltiprazer").remove(),this.options.onItemClick(this),this.$el.addClass("active");if(this.current_channel!==""){var n="communities/"+encodeURIComponent(this.model.get("id"));n+="/"+encodeURIComponent(this.current_channel),this.options.sharedObjects.router.navigate(n,{trigger:!0})}else console.warn("Community does not have a lobby_id")},replaceLastPath:function(e,t){var n=e,r="";for(var i=0;i<n.length-2;i++)n[i]!==""&&(r+="/",r+=n[i]);return r+="/"+t+"/",r},_addTooltip:function(t,n){var r=this;this.tooltip_initialized=!0,t.hover(function(){e(".tooltiprazer").remove(),n!=""&&e('<p class="tooltiprazer"></p>').html(n).appendTo("body").fadeIn("slow")},function(){e(".tooltiprazer").remove()}).mousemove(function(n){var r=n.pageX+20,i=n.pageY,s=t.offset().top+4;e(".tooltiprazer").css({top:s,left:"88px"})})},_onCommunityMentioned:function(e){this.model=new i(e),this.render()},_onCommunityDeleted:function(e,t){this.close()},_onPostAnnouncement:function(e,t){console.debug("_onPostAnnouncement"),this.model.set("last_announcement",t.announcement),this.render()},_onAnnouncementMarked:function(e){console.debug("on Announcement marked");var t=this.model.get("last_announcement");t.unread_count=0,this.model.set("last_announcement",t),this.render()},mobileView:function(){var t=e(".main-view").width();return t<MIN_WIDTH?!0:!1}});return s}),define("views/communities/communitylistview",["jquery","underscore","backbone","text!templates/communities/communitylistview.html","views/communities/communityitem","collections/communitycollection","models/communities/communitymodel","velocity-ui","views/communities/create/createcommunity"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({tagName:"div",className:"community-list-view",events:{"click .add":"onCreateClicked","click .create_community":"onCreateCommunityClicked","click .search_community":"onSearchCommunityClicked"},collection:null,comms:null,commsCommunity:null,sorted:!1,createmenushown:!1,createCommunityView:null,initialize:function(e){t.bindAll(this,"render","close","_onItemClick","onCollectionSynced","checkforAnnouncement","_onPubSubMessage","_onCollectionChange","_onCommunityList","autoHideCreateMenu","calculateCreateMenuTop","setLastActiveChannel"),this.options=e,this.template=t.template(r),this.createmenushown=!1,this.comms=this.options.sharedObjects.comms,this.collection=new s,this.options.sharedObjects.communityCollection=this.collection,this.options.sharedObjects.commsCommunity.getCommunityList({success:this._onCommunityList}),this.commsCommunity=this.options.sharedObjects.commsCommunity;var n=this;this.commsCommunity.on("community:created",function(){n.commsCommunity.getCommunityList({success:n._onCommunityList})})},render:function(){this.$el.html(this.template());var e=this;if(this.collection.length>0){this.collection.sort();var n=0;this.collection.each(function(n){if(n.has("lobby_id")&&n.get("lobby_id")!==""){var r=t.extend({model:n,onItemClick:e._onItemClick},e.options),s=new i(r);e.$("ul.list").append(s.render().el)}})}return this},close:function(){this.remove(),this.unbind()},_onItemClick:function(){this.options.highlightCommunityTab&&this.options.highlightCommunityTab(),this.removeSelection()},removeSelection:function(){this.$(".community-item-view").removeClass("active")},onCollectionSynced:function(e){console.debug("onCollectionSynced"),this.collection=e,this.$("ul.list").empty();var t=this;if(e.length>0){this.collection.sort();var n=0;e.each(function(e){if(e.has("lobby_id")&&e.get("lobby_id")!==""){var n={model:e,onItemClick:t._onItemClick,sharedObjects:t.options.sharedObjects},r=new i(n);t.$("ul.list").append(r.render().el)}}),this.checkforAnnouncement()}},_onCollectionChange:function(e){console.debug("_onCollectionChange: "),this.checkforAnnouncement()},checkforAnnouncement:function(){if(this.collection.length>0){var e=0;this.collection.each(function(t){t.has("last_announcement")&&t.get("last_announcement").unread_count>0&&(console.debug("name--"+t.get("name")),e++)}),e>0?this.options.showCommunityNotifications(e):this.options.hideCommunityNotifications(e)}},_onPubSubMessage:function(e){if(e.message.event==="announcement"){var t=this.options.sharedObjects.communityCollection.get(e.message.community_id);if(t){console.debug("community: ");var n=t.get("last_announcement");n.unread_count=1,t.set("last_announcement",n),console.debug(t.toJSON()),this.collection.add(t,{merge:!0}),this.render()}}else if(e.message.event==="delete"){var r=this.collection.get(e.message.community_id);r&&(r.set("removed",!0),this.checkforAnnouncement())}},_onCommunityList:function(e){console.debug("_onCommunityList"),this.collection.each(function(e){e.set("removed",!0)}),this.collection.reset(),this.collection.set(e.data),this.onCollectionSynced(this.collection),this.options.sharedObjects.commsCommunity.joinAllLobby({success:function(){console.debug("joinAllLobby success")}})},onCreateClicked:function(){if(this.createmenushown)this.hideCreateMenu();else{var e=this.$(".add").parent().parent().parent();this.calculateCreateMenuTop(),this.showCreateMenu()}},showCreateMenu:function(){var t=this,n=this.$(".add").parent().parent().parent();this.$(".create").velocity("slideDown",{duration:200,easing:"easeOutCubic",complete:function(){e(document).bind("click",t.autoHideCreateMenu),n.bind("scroll",t.calculateCreateMenuTop),t.createmenushown=!0}})},hideCreateMenu:function(){var t=this,n=this.$(".add").parent().parent().parent();this.$(".create").velocity("slideUp",{duration:200,easing:"easeOutCubic",complete:function(){e(document).unbind("click",t.autoHideCreateMenu),n.unbind("scroll",t.calculateCreateMenuTop),t.createmenushown=!1}})},autoHideCreateMenu:function(){var e=this;!e.$(event.target).closest(".create.menulist").length&&!e.$(event.target).closest(".add").length&&e.hideCreateMenu()},calculateCreateMenuTop:function(){var e=this.$(".add").offset().top+30;this.$(".create").css("top",e)},setLastActiveChannel:function(e,t){if(this.collection.length>0){var n=this.collection.get(e);n&&(console.debug("setLastActiveChannel--"+n.get("name")),n.set("current_channel_id",t))}},onCreateCommunityClicked:function(){this.options.sharedObjects.router.navigate("communities/create",{trigger:!0}),this.hideCreateMenu()},onSearchCommunityClicked:function(){this.options.sharedObjects.router.navigate("communities/discovery",{trigger:!0}),this.hideCreateMenu()}});return f}),define("views/navigationview",["jquery","underscore","backbone","text!templates/navigationview.html","views/usermenu/usermenuview","models/usermodel","views/groups/groupsview","views/creategroup/friendselector","views/communities/communitylistview","views/feedback/feedbackview"],function(e,t,n,r,i,s,o,u,a,f){MIN_WIDTH=600;var l=n.View.extend({tagName:"div",className:"navigation-view",events:{"click .userstatus":"_onUserMenuClicked","click .create_group":"_onCreateGroupClicked","click .slideleft":"_onSlideLeft","click .slideright":"_onSlideRight","click .activity.tab":"_onActivityTabClicked","click .friends.tab":"_onFriendsTabClicked","click .fb_quick":"_onFeedbackClicked"},initialize:function(e){t.bindAll(this,"render","close","_onUserInfo","_onPresenceChanged","_onCreateButtonClicked","communityTab"),this.options=e,this.template=t.template(r),this.user=new s(this.options.sharedObjects.comms.user.toJSON()),this.options.sharedObjects.comms.getUser({user_id:this.options.sharedObjects.comms.user_id,success:this._onUserInfo})},render:function(){this.user.set("presence","online"),this.$el.html(this.template(this.user.toJSON()));var e=t.extend({onCloseUserMenu:this._onUserMenuClosed,onChangePresence:this._onPresenceChanged},this.options);this.userMenuView=new i(e),this.$el.append(this.userMenuView.render().el);var e=t.extend({highlightCommunityTab:this.communityTab},this.options);this.communitiesView=new a(e),this.$(".communitylist").append(this.communitiesView.render().el);var n=/(safari|chrome)/.test(navigator.userAgent.toLowerCase());return n||this.$(".scroller").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this._addTooltip(this.$(".fb_quick"),"Feedback"),this},_onUserMenuClicked:function(){this.userMenuView.toggleSettings()},_onUserInfo:function(t){console.debug("_onUserInfo: "+JSON.stringify(t)),this.user=new s(t),this.$(".userstatus .avatar img").attr("src",this.user.get("avatar")),this.$(".userstatus .name").html(this.user.get("nickname")),this.$(".userinfo").show();var n="1.0",r=e(document).find("head link");for(var i=0;i<r.length;++i)if(e(r[i]).attr("rel")==="stylesheet"){var o=e(r[i]).attr("href");console.debug(o);if(o.indexOf("styles.css?v=")!==-1){var u=o.split("=");n="CommsWeb_v"+u[1]}break}var a=this.options.sharedObjects.comms.options.restBaseUrl+"/dau?client_type=CommsWeb&version=";a+=n,a+="&api_key="+encodeURIComponent(this.options.sharedObjects.apiKey),console.debug("_onUserInfo: DAU url: "+a),e.ajax({type:"POST",url:a,cache:!1}).done(function(e){console.debug("DAU success")}).fail(function(e){console.error("DAU error"),console.error(e)})},close:function(){console.debug("close"),this.userMenuView&&(this.userMenuView.close(),this.userMenuView=null),this.communitiesView&&(this.communitiesView.close(),this.communitiesView=null),this.remove(),this.unbind()},_onPresenceChanged:function(e){this.$(".userinfo .presence").removeClass("busy online dnd away offline invisible").addClass(e)},_onCreateGroupClicked:function(){console.debug("_onCreateGroupClicked");var t=634,n=e(".main-view").height()-100;t>n&&(t=n);var r=this;w2popup.open({width:400,height:t,body:'<div class="friends-container"></div>',showMax:!1,modal:!1,opacity:.9,showClose:!1,onOpen:function(t){t.onComplete=function(){var t={title:"CREATE A GROUP",showCheckbox:!0,showButton:!0,buttonText:"CREATE",onButtonClicked:r._onCreateButtonClicked,onCancelClicked:r.onCancelClicked,showPresence:!0,showOffline:!0,friendCollection:r.options.sharedObjects.friendCollection,niceScrollOptions:r.options.sharedObjects.niceScrollOptions},n=new u(t);e(".w2ui-popup .friends-container").append(n.render().el),e("#w2ui-popup").prepend('<div class="close razericons-close"></div>'),e("#w2ui-popup .close").on("click",function(e){w2popup.close()})}},onClose:function(e){}})},_onCreateButtonClicked:function(e,t){var n=this;this.options.sharedObjects.comms.Groups.create({name:e,noname:!1,success:function(e){console.debug("_onCreateButtonClicked: group created: "+JSON.stringify(e)),setTimeout(function(){for(var r=0;r<t.length;++r)n.options.sharedObjects.comms.Groups.addMember({user_id:t[r],group_id:e.id,lobby_id:e.lobby_id,success:function(e){console.debug("_onCreateButtonClicked: added: "+JSON.stringify(e))}})},1e3),setTimeout(function(){var t="groups/"+encodeURIComponent(e.lobby_id);n.options.sharedObjects.router.navigate(t,{trigger:!0})},0)}}),w2popup.close()},onCancelClicked:function(){w2popup.close()},_onSlideLeft:function(){console.debug("on slide left");var t=this;e(".navigation-view").velocity({width:"80px"},{easing:"easeOutCubic",begin:function(){t.$(".slideleft").hide(),t.$(".slideright").show(),t.$(".navigation").removeClass("large").addClass("short"),t.$(".razericons-triangle_down").hide(),t.$(".userinfo .avatar").css("left","20px"),t.$(".userinfo .presence").css("left","46px")},complete:function(){}}),e(".left-section-view").velocity({left:"80px"},{easing:"easeOutCubic"}),e(".community-main-view").velocity({left:"80px"},{easing:"easeOutCubic"}),e(".main-content-section-view").velocity({left:"380px"},{easing:"easeOutCubic"})},_onSlideRight:function(){console.debug("on slide right");var t=this;e(".navigation-view").velocity({width:"200px"},{easing:"easeOutCubic",begin:function(){t.$(".slideright").hide(),t.$(".slideleft").show(),t.$(".navigation").removeClass("short").addClass("large"),t.$(".razericons-triangle_down").show(),t.$(".userinfo .avatar").css("left","10px"),t.$(".userinfo .presence").css("left","37px")},complete:function(){}}),e(".left-section-view").velocity({left:"200px"},{easing:"easeOutCubic"}),e(".community-main-view").velocity({left:"200px"},{easing:"easeOutCubic"}),e(".main-content-section-view").velocity({left:"500px"},{easing:"easeOutCubic"})},showCommsNotifications:function(e){this.$(".activity.unread .count").text(e),this.$(".activity.unread").show()},hideCommsNotifications:function(){this.$(".activity.unread").hide()},_onActivityTabClicked:function(){this.activityTab(),this.options.sharedObjects.router.navigate("activity",{trigger:!0})},_onFriendsTabClicked:function(){this.friendsTab(),this.options.sharedObjects.router.navigate("friends",{trigger:!0})},activityTab:function(){this.$(".tab").removeClass("active"),this.$(".activity.tab").addClass("active"),this.communitiesView.removeSelection()},friendsTab:function(){this.$(".tab").removeClass("active"),this.$(".friends.tab").addClass("active"),this.communitiesView.removeSelection()},communityTab:function(){this.$(".tab").removeClass("active"),this.$(".community.tab").addClass("active")},unselectTab:function(){this.$(".tab").removeClass("active")},checkToShow:function(){console.debug("checktoshow"),e(".main-view").width()<MIN_WIDTH&&(console.debug("hide"),this.$el.hide())},_onFeedbackClicked:function(){var e=this,t=new f({sharedObjects:this.options.sharedObjects,onClose:function(){}});this.$el.append(t.render().el),t.popup()},_addTooltip:function(t,n){var r=this;t.hover(function(){e(".tooltiprazer").remove(),n!=""&&e('<p class="tooltiprazer"></p>').html(n).appendTo("body").fadeIn("slow")},function(){e(".tooltiprazer").remove()}).mousemove(function(n){var r=n.pageX+20,i=n.pageY,s=t.offset().top+21;e(".tooltiprazer").css({top:s,left:"88px"})})}});return l}),define("text!templates/communities/search/searchcommunity.html",[],function(){return'<div class="header"></div>\r\n<div class="content">\r\n<div class="title">FIND COMMUNITIES</div>\r\n<div class="grey" style="padding-top:14px">Only Public Communities are shown here</div>\r\n<div class="searchinput"><input type="text" name="search" placeholder="Search for a Community"></div>\r\n<div class="list_container">\r\n	<div class="list popular"></div>\r\n	<div class="list search"></div>\r\n	<div class="loader hvalign"></div>\r\n</div>\r\n</div>\r\n'}),define("models/communitymodel",["underscore","backbone","rcemoji/rcemoji"],function(e,t,n){var r=t.Model.extend({defaults:{id:"",name:"",mode:"free",icon:"",banner_type:"color",banner:"",banner_font_color:"",description:"",status:"",owner:"",created:"",active:0,members:0,url:"",role:"",password:"",searchable:!0,"protected":!1,xmpp_server:"",text_muted:!1,voice_muted:!1,channels:0,link:"",subscribed:!0},initialize:function(){this._setEmojiName(),this.on("change:name",this._setEmojiName),this.changeIcon(),this.on("change:icon",this.changeIcon)},_setEmojiName:function(){this.set("name_emoji",n.parse(this.escape("name")))},changeIcon:function(){if(this.get("icon")!==""){var e=this.get("icon"),t=e.replace("http://","https://");this.set("icon",t)}else this.set("icon","assets/images/DefCommntyIcon.svg")}});return r}),define("text!templates/communities/search/searchitem.html",[],function(){return'<img src="<%- icon %>">\r\n<div class="name"><%- name %></div>\r\n<div class="members"><%- members %> members</div>\r\n<div class="desc"><%- description %></div>\r\n<div class="rc-button join">JOIN</div>'}),define("views/communities/search/searchitem",["jquery","underscore","backbone","text!templates/communities/search/searchitem.html"],function(e,t,n,r){var i=n.View.extend({className:"search-item-view",events:{"click .join":"joinCommunity"},initialize:function(e){t.bindAll(this,"render","close","onCommunitySynced"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.options.sharedObjects.communityCollection.get(this.model.get("id"));return e&&this.$(".join").text("OPEN"),this},close:function(){this.remove(),this.unbind()},joinCommunity:function(t){console.debug("joinCommunity"),e("body").addClass("rc-loading"),this.commsCommunity.getCommunity({community_id:this.model.get("id"),success:this.onCommunitySynced})},onCommunitySynced:function(t){this.model.set(t),e("body").removeClass("rc-loading");if(this.model.has("lobby_id")&&this.model.get("lobby_id")!==""){var n="communities/"+encodeURIComponent(this.model.get("id"));n+="/"+encodeURIComponent(this.model.get("lobby_id")),this.options.sharedObjects.router.navigate(n,{trigger:!0})}}});return i}),define("views/communities/search/searchcommunity",["jquery","underscore","backbone","text!templates/communities/search/searchcommunity.html","models/communitymodel","views/communities/search/searchitem"],function(e,t,n,r,i,s){var o=13,u=n.View.extend({className:"search-community-view",events:{'keyup input[name="search"]':"onKeyPressSearch"},initialize:function(e){t.bindAll(this,"render","close","onPopularCommunities"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity,this.commsCommunity.getPopularCommunities({success:this.onPopularCommunities}),this.collection=new n.Collection,this.searchCollection=new n.Collection},render:function(){return this.$el.html(this.template()),this.$(".content").niceScroll(t.extend({},this.options.sharedObjects.niceScrollOptions)),this},close:function(){this.remove(),this.unbind()},onPopularCommunities:function(e){this.collection.reset();for(var t=0;t<e.data.length;++t){var n=new i(e.data[t]);this.collection.add(n)}this.renderCollection(this.collection,"popular")},renderCollection:function(e,t){var n=this;this.$(".loader").hide(),e.each(function(e){var r={model:e,sharedObjects:n.options.sharedObjects},i=new s(r);n.$(".list."+t+"").append(i.render().el)})},onKeyPressSearch:function(e){var t=this,n=this.$('input[name="search"]').val();console.debug("keyword--"+n);if(n===""){this.clearSearchResults();return}e.keyCode===o&&(this.$(".list.popular").hide(),this.$(".list.search").empty(),this.$(".loader").show(),this.searchCollection.reset(),this.commsCommunity.searchCommunities({query:n,success:function(e){if(e.data.length>0){for(var n=0;n<e.data.length;++n){var r=new i(e.data[n]);t.searchCollection.add(r)}t.renderCollection(t.searchCollection,"search")}else t.$(".loader").hide(),t.$(".list.search").html('<div class="nomatch">Sorry No Matching Results found.</div>')}}))},clearSearchResults:function(){this.$(".list.popular").show(),this.$(".list.search").empty()}});return u}),define("text!templates/communities/create/newcreatecommunity.html",[],function(){return'<div class="header"></div>\n<div class="content">\n	<div class="page1">\n		<div class="title">CREATE A COMMUNITY</div>\n		<div class="htext">Whether you are a guild master, a Streamer or you just want to create a Community for your friends, this is for you!</div>\n		<div class="center">\n			<div class="label" style="margin-top:70px">NAME</div>\n			<input name="community-name" class="community-name-input" type="text" placeholder="Give a name to your Community"></input>\n			<div class="label">DESCRIPTION</div>\n			<textarea name="description" placeholder="Says something about it!"></textarea>\n			<div class="privacy_buttons toggle_btn_on_off">\n				<div class="public left on btn">PUBLIC</div>\n				<div class="private right off btn">PRIVATE</div>\n			</div>\n			<div class="privacy_text">Anyone can find a public community when searching for it in Comms.</div>\n			<!-- <div class="step_text">Step 1/2</div>-->\n			<div class="button">\n				<div class="cancel btn" style="margin-right:8px">CANCEL</div>\n				<div class="create btn rc-disabled-button">CREATE</div>\n			</div>\n		</div>\n	</div>\n	<div class="page2">\n		<div class="title">PERSONALIZE YOUR COMMUNITY</div>\n		<div class="htext2">Give your Community a unique look by adding an avatar and a banner.</div>\n		<div class="center">\n			<div class="label" style="margin-top:70px">AVATAR</div>\n			<div class="" style="padding-top:5px" >Personalize your Avatar so people can find your Community easily.</div>\n			<div class="community_icon">\n				<div class="community-icon"><span class="razericons-camera"></span></div>\n				<input class="file-select-icon" type="file" name="upload" accept="image/*" name="community-icon">			\n			</div>\n			<div class="label" style="margin-top:30px">BANNER</div>\n			<div class="" style="padding-top:5px" >The banner will give your Community a special look and identity. Be creative!</div>\n			<div class="community_banner">\n				<div class="community-banner"><span class="razericons-camera"></span></div>\n				<input class="file-select-banner" type="file" name="upload" accept="image/*" name="community-banner">\n			</div>\n			<div style="clear:both;"></div>\n			<!-- <div class="text_game">IS YOUR COMMUNITY GAME SPECIFIC?</div>\n			<div class="game_selector"></div>\n			<div class="step_text">Step 2/2</div>-->\n			<div class="button" style="margin-top:30px">\n				<div class="later btn" style="margin-right:8px">LATER</div>\n				<div class="save btn rc-disabled-button">SAVE</div>				\n			</div>\n		</div>\n	</div>\n</div>\n</div>'}),define("views/communities/create/newcreatecommunity",["jquery","underscore","backbone","text!templates/communities/create/newcreatecommunity.html","rcdialog","w2ui","models/communities/communitymodel","cryptojs_sha1","views/imagecropper/imagecropperview"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({className:"new-create-community-view",events:{"click .create":"onCreateClicked","click .cancel":"onCancelClicked","keyup .community-name-input":"onNameKeyPress",'keyup textarea[name="description"]':"onDescriptionKeyPress","click .privacy_buttons .public":"onPrivacyPublic","click .privacy_buttons .private":"onPrivacyPrivate","click .later":"onLaterClicked","click .save":"updateCommunity","change .file-select-icon":"_uploadCommunityIcon","change .file-select-banner":"_uploadCommunityBanner"},initialize:function(e){t.bindAll(this,"render","close","onNameKeyPress","onDescriptionKeyPress","onPrivacyPublic","onPrivacyPrivate","_uploadCommunityIcon","_uploadCommunityBanner"),this.options=e,this.template=t.template(r),this.commsCommunity=e.sharedObjects.commsCommunity,this.options.model?this.model=new o(this.options.model.toJSON()):this.model=new o},render:function(){this.$el.html(this.template());var e={cursorwidth:"9px",cursorborderradius:"10px",zindex:3};return this.$(".content").niceScroll(t.extend({},e)),this},close:function(){s.close(),this.remove(),this.unbind()},onCancelClicked:function(){window.history.back(),this.close()},onNameKeyPress:function(e){var t=this.$(".community-name-input").val();t!==""?(this.$(".create").removeClass("rc-disabled-button"),this.model.set("name",t)):this.$(".create").addClass("rc-disabled-button")},onDescriptionKeyPress:function(){var e=this.$('textarea[name="description"]').val();this.model.set("description",e)},onPrivacyPublic:function(){this.$(".privacy_buttons .public").hasClass("off")&&(this.selectPublic(),this.model.set("searchable",!0))},onPrivacyPrivate:function(){this.$(".privacy_buttons .private").hasClass("off")&&(this.selectPrivate(),this.model.set("searchable",!1))},selectPublic:function(){this.$(".privacy_buttons .public").removeClass("off").addClass("on"),this.$(".privacy_buttons .private").removeClass("on").addClass("off")},selectPrivate:function(){this.$(".privacy_buttons .private").removeClass("off").addClass("on"),this.$(".privacy_buttons .public").removeClass("on").addClass("off")},onCreateClicked:function(){var t=this.model.get("name");if(t=="")return;var n=this;console.log("=== CREATING COMMUNITY ==="),console.log(JSON.stringify(this.model.toJSON())),e("body").addClass("rc-loading"),this.commsCommunity.createCommunity({community:this.model.toJSON(),success:function(t){e("body").removeClass("rc-loading"),console.debug("community created successfully"),console.debug(t),n.model.set("id",t.id),n.model.set("created",t.created),n.model.set("url",t.url),n.model.set("xmpp_server",t.xmpp_server),n.model.set("lobby_id",t.lobby_id),n.$(".page1").hide(),n.$(".page2").show()}})},routeToNewCommunity:function(){this.commsCommunity.addToCachedCommunities({community_id:this.model.get("id"),community:this.model});var e="communities/"+encodeURIComponent(this.model.get("id"));e+="/"+encodeURIComponent(this.model.get("lobby_id")),this.options.sharedObjects.router.navigate(e,{trigger:!0})},_uploadCommunityIcon:function(){this.showSave();var t=this.$(".file-select-icon")[0].files[0];this.$(".file-select-icon").prop("value",null);var n=this;t&&this.readImageFileForCropper({file:t,onSuccess:function(t){console.log(t.url),n.$(".community-icon").html("<img src="+t.url+">"),e("body").removeClass("rc-loading"),n.model.set("icon",t.url)},onClear:function(){n.model.set("icon","")}})},_uploadCommunityBanner:function(){this.showSave();var t=this.$(".file-select-banner")[0].files[0];this.$(".file-select-banner").prop("value",null);var n=this;t&&this.readImageFileForCropper({title:"Update Community Banner",file:t,isBanner:!0,onSuccess:function(t){console.log(t.url),n.$(".community-banner").html("<img src="+t.url+">"),e("body").removeClass("rc-loading"),n.model.set("banner",t.url),n.model.set("banner_type","url")},onClear:function(){n.model.set("banner",""),n.model.set("banner_type","url")}})},readImageFileForCropper:function(t){var n=this,r=new FileReader;r.addEventListener("load",function(r){var i=new a({url:r.target.result,title:t.title,isBanner:t.isBanner,onDone:function(r){if(r.src.indexOf("data:image")===0){var i=r.src.split(",");if(i.length===2){var s=u.SHA1(i[1]);e("body").addClass("rc-loading"),n.commsCommunity.uploadFile({community_id:n.model.get("id"),filename:s,base64Data:i[1],success:t.onSuccess})}}},onClear:t.onClear});i.popup()},!1),r.readAsDataURL(t.file)},showSave:function(){this.$(".save").removeClass("rc-disabled-button")},updateCommunity:function(){var e=this;this.commsCommunity.updateCommunity({community_id:this.model.get("id"),community:this.model.toJSON(),success:function(t){console.debug(t),e.routeToNewCommunity(),e.close()}})},onLaterClicked:function(){this.routeToNewCommunity(),this.close()}});return f}),define("views/mainview",["jquery","underscore","backbone","text!templates/mainview.html","views/leftsectionview","views/maincontentsectionview","velocity","views/compose/composeview","views/callui/incomingcall","models/usermodel","views/navigationview","views/communities/communitymainview","views/communities/search/searchcommunity","views/communities/create/newcreatecommunity"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=n.View.extend({tagName:"div",className:"main-view",events:{},mainTabView:null,leftSectionView:null,mainContentView:null,composeView:null,incomingCallView:null,windowFocusModel:null,flashInterval:null,communityMainView:null,aoptions:{},newCreateCommunityView:null,initialize:function(e){t.bindAll(this,"render","close","composeMessage","closeMessageComposer","showCommsNotifications","hideCommsNotifications","showCommunityNotifications","hideCommunityNotifications","_incomingCall","_flashCaller","_stopFlashing","_onWindowFocusChange","changeTheme"),t.bindAll(this,"showCommunity","hideCommunity","_profileUpdated"),this.options=e,this.template=t.template(r),this.communityMainView=null,this.options.sharedObjects.comms.on("incomingCall",this._incomingCall,this),this.options.sharedObjects.comms.on("profileUpdated",this._profileUpdated,this),this.windowFocusModel=this.options.sharedObjects.windowFocusModel,this.windowFocusModel.on("change",this._onWindowFocusChange)},render:function(){return this.$el.html(this.template()),this.aoptions=t.extend({showCommsNotifications:this.showCommsNotifications,hideCommsNotifications:this.hideCommsNotifications,showCommunityNotifications:this.showCommunityNotifications,hideCommunityNotifications:this.hideCommunityNotifications,changeTheme:this.changeTheme},this.options),this.renderNavigationView(),this.renderLeftSectionView(),this.renderMainContentSectionView(),this.$el.addClass(this.options.sharedObjects.theme),e("body").addClass(this.options.sharedObjects.theme),this},renderNavigationView:function(){this.navigationView=new l(this.aoptions),this.$el.append(this.navigationView.render().el)},renderLeftSectionView:function(){this.leftSectionView=new i(this.aoptions),this.$el.append(this.leftSectionView.render().el)},renderMainContentSectionView:function(){this.mainContentView=new s(this.options),this.$el.append(this.mainContentView.render().el)},close:function(){console.debug("close"),this.navigationView&&(this.navigationView.close(),this.navigationView=null),this.leftSectionView&&(this.leftSectionView.close(),this.leftSectionView=null),this.mainContentView&&(this.mainContentView.close(),this.mainContentView=null),this.remove(),this.unbind()},composeMessage:function(){console.debug("composeMessage"),this.composeView=new u(this.options),this.$el.append(this.composeView.render().el),this.composeView.focus(),this.leftSectionView.leftHeaderView._onComposeOpened()},closeMessageComposer:function(){this.composeView&&(this.composeView.close(),this.composeView=null),this.leftSectionView.leftHeaderView._onComposeClosed()},showCommsNotifications:function(e){this.navigationView&&this.navigationView.showCommsNotifications(e)},hideCommsNotifications:function(){this.navigationView&&this.navigationView.hideCommsNotifications()},showCommunityNotifications:function(e){},hideCommunityNotifications:function(){},_incomingCall:function(e){console.debug("_incomingCall"),console.debug(e);if(this.options.sharedObjects.callHandler.voiceConnection||this.options.sharedObjects.commsCommunity.CallHandler.isCallActive()){console.info("Already in a call"),this.options.sharedObjects.comms.rejectCall({session_id:e.session_id,user_id:e.user_id});return}var n=t.extend({},this.options);n.model=new f(e),incomingCallView=new a(n),incomingCallView.popup(),console.debug("window in focus---"+this.windowFocusModel.get("in_focus")),this.windowFocusModel.get("in_focus")||this._flashCaller({name:n.model.get("nickname")})},_flashCaller:function(e){var t=""+e.name+" is calling";console.debug("title1---"+t);var n="Comms";this.flashInterval&&clearInterval(this.flashInterval),document.title=n,this.flashInterval=setInterval(function(){document.title=document.title===t?n:t},1e3)},_stopFlashing:function(){clearInterval(this.flashInterval),this.flashInterval=null,document.title="Comms"},_onWindowFocusChange:function(e){e.get("in_focus")&&this.flashInterval&&(console.debug("window flashing"),this._stopFlashing())},changeTheme:function(t){this.$el.removeClass("light dark"),e("body").removeClass("light dark"),this.options.sharedObjects.theme=t,this.$el.addClass(this.options.sharedObjects.theme),e("body").addClass(this.options.sharedObjects.theme)},showCommunity:function(e,t){this.leftSectionView.$el.hide(),this.communityMainView&&(this.communityMainView.close(),this.communityMainView=null);var n={community_id:e,channel_id:t,sharedObjects:this.options.sharedObjects};this.communityMainView=new c(n),this.$el.append(this.communityMainView.render().el)},hideCommunity:function(){this.leftSectionView.$el.show(),this.communityMainView&&(this.communityMainView.close(),this.communityMainView=null)},showCommunityDiscovery:function(){this.hideCommunityDiscovery();var e={sharedObjects:this.options.sharedObjects};this.searchCommunityView=new h(e),this.$el.append(this.searchCommunityView.render().el)},hideCommunityDiscovery:function(){this.searchCommunityView&&(this.searchCommunityView.close(),this.searchCommunityView=null)},showCreateCommunity:function(){this.hideCreateCommunity();var e={sharedObjects:this.options.sharedObjects};this.newCreateCommunityView=new p(e),this.$el.append(this.newCreateCommunityView.render().el)},hideCreateCommunity:function(){this.newCreateCommunityView&&(this.newCreateCommunityView.close(),this.newCreateCommunityView=null)},_profileUpdated:function(){console.debug("_profileUpdated");var e=this,t=this.options.sharedObjects.commsCommunity;t.pubsub.reset(),t.getCommunityList({success:function(){console.debug("_profileUpdated communityList received"),t.joinAllLobby({success:function(){console.debug("_profileUpdated joinAllLobby success")}})}})}});return d}),define("text!templates/loginview.html",[],function(){return'<div class="background">\n	<div class="top_bg"></div>\n	<div class="bottom_bg"></div>\n</div>\n\n<div class="login-container">\n	<img class="logo" src="assets/images/ths_large.svg">\n    <div class="content "> \n		<div class="signin">RAZER SIGN IN</div>\n        <div>\n            <input type="text" placeholder="Email" name="username" id="username"></input>\n        </div>\n        <div>\n            <input type="password" placeholder="Password" name="password" id="password" ></input>\n        </div>\n		<div class="stay_connected">\n				<input id="connected" type="checkbox" checked="checked">\n				<label class="check-box" for="connected"></label><div style="padding-left:4px;display:inline;vertical-align:middle">Stay Connected</div>\n		</div>\n		<div class="forgot_password">Forgot Password ?</div>		\n        <div class="err-mesg">Invalid Email and/or Password</div>\n        <div class="rc-button continue-button rc-disabled-button">SIGN IN</div>\n		<div class="signup">NOT A MEMBER ? SIGN UP, IT\'S SUPERFAST !</div>\n    </div>\n	<div class="shadow"><img src="assets/images/login_shadow.png"></div>\n</div>\n\n<div class="tagline">FOR GAMERS. BY GAMERS</div>\n<div class="copyright">Copyright @2016 Razer Inc. All rights reserved.</div>\n'}),define("communitysdk/pubsubengine2",["underscore","backbone"],function(e,t){var n=function(e){e||(e={}),this.initialize.apply(this,arguments)};return e.extend(n.prototype,t.Events,{ws:null,reqid:0,connected:!1,backoff_delay:0,logout:!1,topics:{},user:null,connection_drop:!1,initialize:function(t){e.bindAll(this,"connect","disconnect","subscribe","unsubscribe","publish","search","getSubscribers","getUserTopics","reset"),e.bindAll(this,"_bindWebSocketEvents","_reconnect"),this.ws=null,this.reqid=0,this.connected=!1,this.backoff_delay=0,this.logout=!1,this.topics={},this.user=null,this.connection_drop=!1;var n={base_url:"https://pubsub.comms.razerzone.com",ws_url:"wss://pubsub.comms.razerzone.com/ws",api_key:""};this.options=e.extend(n,t),console.debug("initialize: options: ",JSON.stringify(this.options))},connect:function(){var e=this;this.logout=!1,this.ws=new WebSocket(this.options.ws_url),this._bindWebSocketEvents()},disconnect:function(){console.debug("disconnect"),this.logout=!0;if(this.ws){var e=this;if(!this.connected){console.debug("disconnect: not yet connected"),this.once("connected",function(){console.debug("connected, disconnecting"),e.disconnect()});return}this.ws.close(1e3),this.ws=null,this.connected=!1,this.trigger("disconnected")}else console.warn("disconnect websocket is not present")},reset:function(){console.debug("reset"),this.topics={},this.ws&&this.ws.close()},subscribe:function(e){console.debug("subscribe: "),console.debug(e),console.assert(e.topics);var t=this;if(!this.connected){console.debug("subscribe: not yet connected"),this.once("connected",function(){console.debug("connected, subscribing"),t.subscribe(e)});return}!e.user&&this.user&&(e.user=this.user);if(this.ws){this.reqid+=1;var n="s-"+this.reqid,r={event:"subscribe",id:n,api_key:t.options.api_key,data:e.topics,user:e.user?e.user:{}};e.info&&(r.info=e.info);var i=function(r){var s=JSON.parse(r.data);s.event==="subscribe"&&s.type==="success"&&s.id===n&&(t.ws.removeEventListener("message",i),e.success&&e.success())};this.ws.addEventListener("message",i),this.ws.send(JSON.stringify(r)),this.options.debugTag&&console.log("%c SENT: "+this.options.debugTag+" "+JSON.stringify(r),"color:gray;");for(var s=0;s<e.topics.length;s++)this.topics[e.topics[s]]=!0;this.user=e.user,console.debug("subscribe: user: "+JSON.stringify(this.user))}else console.warn("publish websocket is not present"),console.assert()},unsubscribe:function(e){console.debug("unsubscribe: "+JSON.stringify(e)),console.assert(e.topics),this.ws||(console.warn("unsubscribe websocket is not present"),console.assert());var t=this;if(!this.connected){this.once("connected",function(){setTimeout(function(){t.unsubscribe(e)},100)});return}this.reqid+=1;var n="un-"+this.reqid,r={event:"unsubscribe",id:n,data:e.topics},i=function(r){var s=JSON.parse(r.data);s.event==="unsubscribe"&&s.type==="success"&&s.id===n&&(t.ws.removeEventListener("message",i),e.success&&e.success())};this.ws.addEventListener("message",i),this.ws.send(JSON.stringify(r));for(var s=0;s<e.topics.length;s++)delete this.topics[e.topics[s]]},publish:function(e){console.assert(e&&e.topic&&e.topic!==""),console.assert(e.data),console.debug("publish: "+JSON.stringify(e));var t=this;this.ws||(console.warn("publish websocket is not present"),console.assert());if(!this.connected){this.once("connected",function(){t.publish(e)});return}this.reqid+=1;var n="p-"+this.reqid,r={event:"publish",id:n,topic:e.topic,api_key:t.options.api_key,data:e.data,user:e.user?e.user:{}},i=function(r){var s=JSON.parse(r.data);s.event==="publish"&&s.type==="success"&&s.id===n&&(t.ws.removeEventListener("message",i),e.success&&e.success())};this.ws.addEventListener("message",i),this.ws.send(JSON.stringify(r))},search:function(e){console.assert(e&&e.topic&&e.topic!==""),console.assert(e&&e.query&&e.query!=="");var t=this,n=t.options.base_url+"/topics/"+e.topic+"/subscribers?q="+encodeURIComponent(e.query);$.ajax({type:"GET",url:n,dataType:"json"}).done(function(t){e.success&&e.success(t)}).fail(function(e){console.error("search error"),console.error(e)})},getSubscribers:function(e){console.assert(e&&e.topic&&e.topic!=="");var t=this,n=100,r=t.options.base_url+"/topics/"+e.topic+"/subscribers?limit="+encodeURIComponent(n);e.offset&&e.offset!==""&&(r+="&offset="+encodeURIComponent(e.offset)),$.ajax({type:"GET",url:r,dataType:"json"}).done(function(t){e.success&&e.success(t)}).fail(function(e){console.error("getSubscribers error"),console.error(e)})},getUserTopics:function(e){console.assert(e&&e.prefix&&e.prefix!==""),console.assert(e.users);var t=this.options.base_url+"/usertopics?"+"prefix="+encodeURIComponent(e.prefix);for(var n=0;n<e.users.length;n++)t+="&id="+encodeURIComponent(e.users[n]);$.ajax({type:"GET",url:t,dataType:"json"}).done(function(t){e.success&&e.success(t)}).fail(function(e){console.error("getUserTopics error"),console.error(e)})},_bindWebSocketEvents:function(){var t=this;this.ws.addEventListener("open",function(n){console.info("websocket connected"),t.connected=!0,t.backoff_delay=0,t.trigger("connected"),t.options.debugTag&&console.log("%c "+t.options.debugTag+" connected","font-weight:bold;"),t.connection_drop&&e.keys(t.topics).length>0&&(console.debug("re-subscribing"),console.debug("user: "+JSON.stringify(t.user)),console.debug("topics: "+JSON.stringify(e.keys(t.topics))),t.subscribe({topics:e.keys(t.topics),user:t.user,success:function(){}})),t.connection_drop=!1}),this.ws.addEventListener("close",function(e){console.info("websocket disconnected"),t.ws=null,t.connected=!1,t.trigger("disconnected"),t.logout?console.info("user initiated disconnect"):(t.connection_drop=!0,t._reconnect())}),this.ws.addEventListener("error",function(e){console.error("websocket onerror"),console.error(e)}),this.ws.onmessage=function(e){var n=JSON.parse(e.data);t.options.debugTag&&console.log("%c MESSAGE: "+t.options.debugTag+" "+e.data,"color:gray;"),n.event==="message"?(t.trigger("message",n),t.trigger("message."+n.topic,n)):n.event==="presence"&&t.trigger("presence",n)},console.debug(this.ws)},_reconnect:function(){console.debug("_reconnect: backoff_delay: "+this.backoff_delay);var e=this;setTimeout(function(){e.connect()},this.backoff_delay*1e3),this.backoff_delay+=5,this.backoff_delay>60&&(this.backoff_delay=60)}}),n});var hexcase=0,b64pad="";define("communitysdk/sha1",function(){}),define("communitysdk/communitymodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{id:"",lobby_id:"",name:"",admins:[],icon:"",banner_type:"color",banner:"",banner_font_color:"",description:"",owner:"",created:"",searchable:!0,text_muted:!1,voice_muted:!1,channels:[],in_focus:!1,unread_mention:0},initialize:function(){}});return n}),define("communitysdk/communitycollection",["underscore","backbone","communitysdk/communitymodel"],function(e,t,n){var r=t.Collection.extend({model:n,comparator:function(e,t){if(e.get("last_announcement")&&e.get("last_announcement").unread_count>0)return-1;if(t.get("last_announcement")&&t.get("last_announcement").unread_count>0)return 1;var n=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();return n>r?1:n<r?-1:0}});return r});var _0x92b2=["use strict","__esModule","VOE","createAudioController","default","call","undefined","constructor","symbol","nodeType","object","global","window","self","pow","prototype","hasOwnProperty","toString","toUpperCase","charAt","slice","10","8.1","8","Server 2008 R2 / 7","Server 2008 / Vista","Server 2003 / XP 64-bit","XP","2000 SP1","2000","NT","ME","test","exec","Windows ","i","replace"," on ","split","$1","x86_64","","."," $1"," OS","Mac OS","web"," CE","length","number","$1?","String","navigator","userAgent","likeChrome","Object","ScriptBridgingProxyObject","Environment","java","JavaPackage","RuntimeObject","environment","a","Î±","b","Î²","document","operamini","opera","[[Class]]","version","function","Trident","WebKit","AppleWebKit","iCab","Presto","NetFront","Tasman","KHTML","Gecko","Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","Iceweasel","SRWare Iron","Iron","K-Meleon","Konqueror","Lunascape","Maxthon","Midori","Nook Browser","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey","Silk","(?:Cloud9|Silk-Accelerated)","Sleipnir","SlimBrowser","Sunrise","Swiftfox","WebPositive","Opera Mini","OPiOS","Opera","OPR","Chrome","Chrome Mobile","(?:CriOS|CrMo)","Firefox","(?:Firefox|Minefield)","IE","IEMobile","MSIE","Safari","BlackBerry","BB10","Galaxy S","GT-I9000","Galaxy S2","GT-I9100","Galaxy S3","GT-I9300","Galaxy S4","GT-I9500","Google TV","Lumia","iPad","iPod","iPhone","Kindle","Kindle Fire","Nook","PlayBook","PlayStation 4","PlayStation 3","PlayStation Vita","TouchPad","Transformer","Wii U","WiiU","Wii","Xbox One","Xbox 360","Xbox","Xoom","Windows Phone ","Android","CentOS","Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","\\b","pattern","label","(?:\\b|\\w*\\d)","(?:/[\\d.]+|[ \\w.]*)"," *\\d+[.\\w_]*","(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","/"," ","(",")[-_.]?(\\w)","$1 $2","; *(?:","[_-])?","(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","description","Simulator","running in Turbo/Uncompressed mode","push","iOS","Google","Android Browser","indexOf"," Browser","Firefox OS","(?:Cloud9|CriOS|CrMo|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version","(?:Firefox|Minefield|NetFront)","Blink"," Mobile",".x","desktop mode","unshift","IE Mobile","Windows Phone 8+","identifying as ","platform preview","System","lang","os.arch","getProperty","os.name","os.version","system","os","ringo/engine","require","join","RingoJS","Narwhal","process","Node.js","arch","platform","Rhino","runtime","Capabilities","flash","phantom","major","minor","patch","documentMode","IE "," mode","toFixed",";","appMinorVersion","beta","alpha","\\+?$","Firefox Mobile","accelerated","mobile mode","Windows CE","external"," *","/([.\\d]+)","Device Software","name","ing as ","identify","mask",".0$1","+","WebKit Nightly","like Safari","4+","like Chrome","13+","21+","27","28","zvav","Mini","Mobile","$","Apple","iOS 4.3+","-","; ",")","on ","family","architecture"," 64-bit","cpuClass","32-bit","layout","manufacturer","prerelease","product","ua","null","parse","exports","webpackPolyfill","deprecate","paths","children","enumerable","configurable","value","writable","key","defineProperty","Cannot call a class as a function","setItem","removeItem","get","getItem","set","stringify","remove","clear","storage","5.0.0","KeybindActions","VoiceConnectionStates","VoiceConnectionQuality","unknown","bad","average","fine","InputModes","VoiceCommand","isArray","keyMirror(...): Argument must be an object.","getUserMedia","webkitGetUserMedia","mozGetUserMedia","AudioContext","webkitAudioContext","mozAudioContext","RTCPeerConnection","mozRTCPeerConnection","webkitRTCPeerConnection","RTCSessionDescription","mozRTCSessionDescription","webkitRTCSessionDescription","iterator","keys","done","next","toLowerCase","return","VOICE_DISCONNECTED","onSpeaking","mute","volume","speaking","destroy","getOutputDevices","getInputDevices","stream","enable","setPTTActive","setMode","stop","setRemoteStream","removeRemoteStream","updateRemoteStream","onVoiceActivity","nextTick","getSources","setSource","echoCancellation","noiseSuppression","automaticGainControl","addstream","on","removestream","connected","reset","once","checking","failed","disconnected","closed","offer","webrtc","connect","close","remoteSDP","id","ended","_sourceId","sources","mode","modeOptions","cleanup","peerConnection","negotiationNeeded","iceConnectionState","iceGatheringState","signalingState","pc","localDescription","remoteDescription","stats","stat","forEach","names","type","timestamp","map","result","getStats","concat","run","fun","array","apply","title","browser","env","argv","versions","addListener","off","removeListener","removeAllListeners","emit","binding","process.binding is not supported","cwd","chdir","process.chdir is not supported","umask","context","logger","AudioInput","create","info","_mute","_echoCancellation","_noiseSuppression","_automaticGainControl","speaking ","onPacket","VOICE_ACTIVITY","getTracks","some","string","PERMISSION_DENIED","PermissionDeniedError","PERMISSION_DISMISSED","PermissionDismissedError","NO_DEVICES_FOUND","DevicesNotFoundError","UNKNOWN","NO_STREAM","mediaDevices","enumerateDevices","mediaDevices.enumerateDevices ","error","catch","deviceId","Default","Device ","kind","audioinput","filter","then","Source ","audio","PUSH_TO_TALK","_pttDelayTimeout","clearTimeout","delay","setTimeout","_setupVoiceActivity","threshold","onProcess","_setupPushToTalk","shortcut","target","body","preventDefault","shortcut-recorder","contains","classList","parentNode","keydown","bindGlobal","keyup","_setSpeaking","_updateAudioTracks","startsWith","getAudioTracks","enabled","callbacks","directMap","sequenceLevels","resetTimer","ignoreNextKeyup","ignoreNextKeypress","nextExpectedAction","element","addEvents","instances","bind","bindMultiple","unbind","trigger","stopCallback","handleKey","bindSingle","getKeyInfo","pickBestAction","getReverseMap","getMatches","resetSequences","fireCallback","bindSequence","resetSequenceTimer","detach","REVERSE_MAP",":"," combokeys ","className","tagName","input","select","textarea","isContentEditable","seq","level","max","callback","combo","keypress","shift","ctrl","alt","meta","eventHandler","addEventListener","attachEvent","removeEventListener","detachEvent","which","keyCode","fromCharCode","shiftKey","backspace","tab","enter","capslock","esc","space","pageup","pagedown","end","home","left","up","right","down","ins","del","plus","minus","f","*","=",",","`","[","\\","]","'","altKey","ctrlKey","metaKey","modifiers","action","1","2","3","4","5","6","7","9","0","any-character","splice","sort","srcElement","returnValue","stopPropagation","cancelBubble","\n  font-weight: bold;\n  color: green;\n","log","warn","trace","%c[","getFloatFrequencyData","createAnalyser","fftSize","smoothingTimeConstant","createMediaStreamSource","createScriptProcessor","onaudioprocess","update","currentVolume","destination","analyser","processor","fftBins","source","speakingHistory","speakingHistoryIndex","speakingCounter","silenceThreshold","silentFrames","disconnect","AudioOutput(","_speaking","_volume","createElement","autoplay","src","createObjectURL","_audioElement","_stream","pause","_updateAudioElement","muted","round","min","this hasn't been initialised - super() hasn't been called","Super expression must either be null or a function, not ","setPrototypeOf","__proto__","from","WebRTC","getPrototypeOf","address","port","userId","ssrc","remoteStreamHistory","remoteStreams","negotiating","payloadType","_remoteSDP","_safeExecuting","_safeQueue","onicecandidate","_handleIceCandidate","onnegotiationneeded","_handleNegotiationNeeded","oniceconnectionstatechange","_handleIceConnectionStateChange","onsignalingstatechange","_handleSignalingStateChange","onaddstream","_handleAddStream","onremovestream","_handleRemoveStream","addStream","_answerRemoteDescriptionArgs","answer","_iceGatheringTimeout","_handleIceGatheringTimeout","equals","_safeExecute","safeExecute: ICE connection closed","safeExecute: currently executing","safeExecute: awaiting remote SDP","stable","safeExecute: signaling state","_createLocalOffer","SENDRECV","RECVONLY","customLocalSessionDescription","createOffer+setLocalDescription success","setLocalDescription","createOffer","_createLocalAnswer","createAnswer+setLocalDescription success","createAnswer","_updateRemoteDescription","createSessionDescription","setRemoteDescription success","setRemoteDescription","_fakeRemoteOffer","_getRemoteStreams","toArray","iceConnectionState =>","completed","signalingState =>","safeExecute: running queued function","complete","ICE gathering never completed,","handleIceCandidate =>","candidate","ICE Ready","sdp","filterTCPCandidates","removeStream","_events","_maxListeners","EventEmitter","defaultMaxListeners","setMaxListeners","n must be a positive number",'Uncaught, unspecified "error" event.',"listener must be a function","newListener","listener","warned","(node) warning: possible EventEmitter memory ","leak detected. %d listeners added. ","Use emitter.setMaxListeners() to increase limit.","listeners","listenerCount","delete","size","isIterable","isKeyed","isIndexed","isAssociative","isOrdered","Keyed","Indexed","Set","@@__IMMUTABLE_ITERABLE__@@","@@__IMMUTABLE_KEYED__@@","@@__IMMUTABLE_INDEXED__@@","@@__IMMUTABLE_ORDERED__@@","@@iterator","[Iterator]","KEYS","VALUES","ENTRIES","inspect","toSource","toSeq","of","Seq {","}","cacheResult","_cache","__iterateUncached","entrySeq","__iterate","__iterator","toKeyedSeq","fromEntrySeq","toIndexedSeq","Seq [","toSetSeq","isSeq","@@__IMMUTABLE_SEQ__@@","_array","has","_object","_keys","_iterable","__iteratorUncached","_iterator","_iteratorCache","Expected Array or iterable object of [k, v] entries, ","or keyed object: ","Expected Array or iterable object of values: ","Expected Array or iterable object of values, or keyed object: ","Abstract","valueOf","toList","toMap","imul","hashCode","charCodeAt","propertyIsEnumerable","Non-extensible objects are not allowed as keys.","Unable to set a non-enumerable property on object.","isExtensible","@","uniqueID","documentElement","__immutablehash__","Cannot perform this action with an infinite size.","_iter","_useKeys","valueSeq","reverse","includes","flip","asMutable","asImmutable","flatten","reduce","pop","Expected [K, V] tuple: ","Expected iterable or array-like: ","withMutations","Map {","_root","setIn","updateIn","deleteIn","__ownerID","__hash","__altered","merge","mergeWith","mergeIn","mergeDeep","mergeDeepWith","mergeDeepIn","sortBy","wasAltered","iterate","__ensureOwner","isMap","@@__IMMUTABLE_MAP__@@","removeIn","ownerID","entries","bitmap","nodes","count","keyHash","entry","_type","_reverse","_stack","node","index","__prev","invalid keyPath","setSize","List [","_origin","_capacity","_level","_tail","isList","@@__IMMUTABLE_LIST__@@","removeBefore","removeAfter","OrderedMap {","_map","_list","isOrderedMap","unshiftAll","Stack [","_head","peek","pushAll","isStack","@@__IMMUTABLE_STACK__@@","add","fromKeys","keySeq","Set {","union","intersect","every","subtract","isSet","@@__IMMUTABLE_SET__@@","__empty","__make","OrderedSet {","isOrderedSet","_name","_defaultValues"," {","_empty",'Cannot set unknown key "','" on ',"Record","Cannot set on an immutable record.","Cannot step a Range by 0","abs","_start","_end","_step","ceil","Range []","Range [ ","..."," by "," ]","floor","lastIndexOf","_value","Repeat []","Repeat [ "," times ]","getOwnPropertySymbols","Iterator","toJS","toJSON","[Iterable]",", ","findEntry","find","getIn","isSubset","first","skip","skipWhile","take","takeWhile","values","__toJS","__toStringMapper","chain","flatMap","noLengthWarning","stack","_wrapObject","iterable.length has been deprecated, ","use iterable.size or iterable.count(). ","This warning will become a silent error in a future version. ","findKey","findLastKey","toObject",": ","keyOf","Immutable","Invalid attempt to destructure non-iterable instance","sendrecv","recvonly","trim","\n","ICE/SDP","RTP/SAVPF ","sdparta_","\na=","sendonly","\na=mid:sdparta_","\na=msid:","\na=rtcp-mux\na=rtpmap:"," opus/48000/2\na=setup:actpass\na=ssrc:"," cname:","m=audio 0 RTP/SAVPF ","\nc=IN IP4 0.0.0.0\na=inactive\na=rtpmap:"," NULL/0","v=0\no=mozilla...THIS_IS_SDPARTA 2802722389878339802 0 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE ","\na=msid-semantic:WMS *","a=ssrc:","\na=ssrc:"," msid:","v=0\no=- 2802722389878339802 3 IN IP4 127.0.0.1\ns=-\nt=0 0\na=setup:","passive","actpass","a=rtcp-mux\na=mid:audio\na=","\na=rtpmap:"," opus/48000/2\na=fmtp:"," minptime=10; useinbandfec=1; usedtx=1\na=maxptime:60","match","a=fmtp:120 PROFILE=0;LEVEL=0;packetization-mode=0;level-asymmetry-allowed=0;parameter-add=1;usedtx=1;stereo=0;useinbandfec=1\r\n","(.+)(111|109)(.+)","120","a=rtpmap:120","a=rtpmap:111","substring","a=rtcp-fb:120","a=rtcp-fb:111","a=rtpmap:109","a=fmtp:120 minptime=10; useinbandfec=1; usedtx=1","a=ssrc:(\\d+)(.+)","TCP","confId","userName","ops","ops.comms.razerzone.com","smsvr","ssrc_ver","media_svr_url","media_svr_ip","media_svr_stun_port","media_svr_selection","onAuthen_sessionVer","onAuthen_sessionId","onAuthen_medias","state","IDLE","_vos_socket","_voe_socket","_vos_backoff","_voe_backoff","_ops_backoff","_destroyed","_stopCallReq","VoiceConnection(","startCall","succeed","sm server ","fails","enterguildtrying ","enterguildtrying","fail","enterguildfailed","VoiceConnection is destroyed.","cancel","wss://","_","connecting","_handleConnecting","_handleConnect","_handleDisconnect","_handleAnswer","reject","_handleReject","_handleSpeaking","heartbeat","_handleHeartbeat","updateusers","_handleUpdateUsers","bye","_handleBye","IceNoRouteReconnect","VoiceEngineReconnect","stopCall","stopAudioInput","ENTER_GUILD","confid","AUTHENTICATE","sendSpeaking","getPings","pings","getAveragePing","getLastPing","setState","_cleanupSocket","Connecting to media server ","Connected to media server","VOICE_CONNECTED","ICE_CHECKING","NO_ROUTE","onConnectionState","Error occurred while connecting to voice engine: ","offer ","GROUP","invite","Disconnected from media server.","Disconnect was not clean! Reconnecting...","answer sdp","handleSessionDescription","reject code "," ssrc ","updateUsers","userlist","quality","_enterGuild","XMLHttpRequest","Microsoft.XMLHTTP","onreadystatechange","readyState","status","responseText","reason","sm_server","?guildid=","&username=","&ver=","VOICE_VERSION","&uuid=","&os=Web&community=0","&token=","now","GET","https://","/enterGuildWeb.php","open","send","_authenticate","Authenticate connecting","_handleAuthenConnect","onAuthen","onAuthen ","ip","OnTurnPing","OnTurnPing ip "," port ","url","OnTurnPing2","OnTurnPing2 ip ","OnTurnPingCompleted","start","Authenticate Disconnect was not clean! Reconnecting...","state ","Authenticate connect"," Authenticate connect","BAD","AVERAGE","FINE","jitter","_current","_timeoutId","_fails","random","callback already pending","current","pending","stunport","ws","byeReq","onopen","onmessage","data","R","S","code","ping_interval","ping","setInterval","INVITE","Q","BYE","t","PONG","l","SPEAKING","UPDATEUSERS","C","onerror","message","onclose","wasClean","clearInterval","PING","ServerSync","session","media","Authenticate","Auth","SetMedia","Close","WhoAmIEx","WhoAmI","TurnPing","constructor ip ","m_mediaServerIP","m_mediaServerPort","m_pingCallback","m_pingCompleted","turn:","?transport=udp","ping@groupclient.razerzone.com","pong","relay","createOffer setLocalDescription success","typ relay","candidate:.+udp\\s+\\d+\\s+(\\d+.\\d+.\\d+.\\d+)\\s+(\\d+)(.+)","m_media_server_ips","m_media_server_port","m_alt_media_server_port","m_turnping_results","m_turnping_objs","m_backoff","handlePingCallback","handlePingCompleted","completed ip "," removed","loaded","m","c","p"];(function(e){function n(r){if(t[r])return t[r][_0x92b2[296]];var i=t[r]={exports:{},id:r,loaded:!1};return e[r][_0x92b2[5]](i[_0x92b2[296]],i,i[_0x92b2[296]],n),i[_0x92b2[1163]]=!0,i[_0x92b2[296]]}var t={};return n[_0x92b2[1164]]=e,n[_0x92b2[1165]]=t,n[_0x92b2[1166]]=_0x92b2[41],n(0)})([function(e,t,n){function h(e){return e&&e[_0x92b2[1]]?e:{"default":e}}_0x92b2[0];var r=n(1),i=h(r),s=n(4),o=h(s),u=n(5),a=n(7),f=h(a),l=n(52),c=h(l);window[_0x92b2[2]]=n(7),window[_0x92b2[3]]=function(e,t,n,r){return new c[_0x92b2[4]](e,t,n,r)}},function(e,t,n){var r;((function(e,i){function s(e){return e&&typeof Symbol!==_0x92b2[6]&&e[_0x92b2[7]]===Symbol?_0x92b2[8]:typeof e}_0x92b2[0],function(){function y(e){return e=String(e),e[_0x92b2[19]](0)[_0x92b2[18]]()+e[_0x92b2[20]](1)}function b(e,t,n){var r={6.4:_0x92b2[21],6.3:_0x92b2[22],6.2:_0x92b2[23],6.1:_0x92b2[24],"6.0":_0x92b2[25],5.2:_0x92b2[26],5.1:_0x92b2[27],5.01:_0x92b2[28],"5.0":_0x92b2[29],"4.0":_0x92b2[30],"4.90":_0x92b2[31]};return t&&n&&/^Win/i[_0x92b2[32]](e)&&(r=r[0,/[\d.]+$/[_0x92b2[33]](e)])&&(e=_0x92b2[34]+r),e=String(e),t&&n&&(e=e[_0x92b2[36]](RegExp(t,_0x92b2[35]),n)),e=E(e[_0x92b2[36]](/ ce$/i,_0x92b2[47])[_0x92b2[36]](/\bhpw/i,_0x92b2[46])[_0x92b2[36]](/\bMacintosh\b/,_0x92b2[45])[_0x92b2[36]](/_PowerPC\b/i,_0x92b2[44])[_0x92b2[36]](/\b(OS X) [^ \d]+/i,_0x92b2[39])[_0x92b2[36]](/\bMac (OS X)\b/,_0x92b2[39])[_0x92b2[36]](/\/(\d)/,_0x92b2[43])[_0x92b2[36]](/_/g,_0x92b2[42])[_0x92b2[36]](/(?: BePC|[ .]*fc[ \d.]+)$/i,_0x92b2[41])[_0x92b2[36]](/\bx86\.64\b/gi,_0x92b2[40])[_0x92b2[36]](/\b(Windows Phone) OS\b/,_0x92b2[39])[_0x92b2[38]](_0x92b2[37])[0]),e}function w(e,t){var n=-1,r=e?e[_0x92b2[48]]:0;if(typeof r==_0x92b2[49]&&r>-1&&r<=h)while(++n<r)t(e[n],n,e);else S(e,t)}function E(e){return e=k(e),/^(?:webOS|i(?:OS|P))/[_0x92b2[32]](e)?e:y(e)}function S(e,t){for(var n in e)m[_0x92b2[5]](e,n)&&t(e[n],n,e)}function x(e){return e==null?y(e):g[_0x92b2[5]](e)[_0x92b2[20]](8,-1)}function T(e,t){var n=e!=null?s(e[t]):_0x92b2[49];return!/^(?:boolean|number|string|undefined)$/[_0x92b2[32]](n)&&(n==_0x92b2[10]?!!e[t]:!0)}function N(e){return String(e)[_0x92b2[36]](/([ -])(?!$)/g,_0x92b2[50])}function C(e,t){var n=null;return w(e,function(r,i){n=t(n,r,i,e)}),n}function k(e){return String(e)[_0x92b2[36]](/^ +| +$/g,_0x92b2[41])}function L(e){function V(t){return C(t,function(t,n){return t||RegExp(_0x92b2[181]+(n[_0x92b2[182]]||N(n))+_0x92b2[181],_0x92b2[35])[_0x92b2[33]](e)&&(n[_0x92b2[183]]||n)})}function $(t){return C(t,function(t,n,r){return t||(n[z]||n[0,/^[a-z]+(?: +[a-z]+\b)*/i[_0x92b2[33]](z)]||RegExp(_0x92b2[181]+N(r)+_0x92b2[184],_0x92b2[35])[_0x92b2[33]](e))&&r})}function J(t){return C(t,function(t,n){return t||RegExp(_0x92b2[181]+(n[_0x92b2[182]]||N(n))+_0x92b2[181],_0x92b2[35])[_0x92b2[33]](e)&&(n[_0x92b2[183]]||n)})}function K(t){return C(t,function(t,n){var r=n[_0x92b2[182]]||N(n);return!t&&(t=RegExp(_0x92b2[181]+r+_0x92b2[185],_0x92b2[35])[_0x92b2[33]](e))&&(t=b(t,r,n[_0x92b2[183]]||n)),t})}function Q(t){return C(t,function(t,n){var r=n[_0x92b2[182]]||N(n);return!t&&(t=RegExp(_0x92b2[181]+r+_0x92b2[186],_0x92b2[35])[_0x92b2[33]](e)||RegExp(_0x92b2[181]+r+_0x92b2[187],_0x92b2[35])[_0x92b2[33]](e))&&((t=String(n[_0x92b2[183]]&&!RegExp(r,_0x92b2[35])[_0x92b2[32]](n[_0x92b2[183]])?n[_0x92b2[183]]:t)[_0x92b2[38]](_0x92b2[188]))[1]&&!/[\d.]+/[_0x92b2[32]](t[0])&&(t[0]+=_0x92b2[189]+t[1]),n=n[_0x92b2[183]]||n,t=E(t[0][_0x92b2[36]](RegExp(r,_0x92b2[35]),n)[_0x92b2[36]](RegExp(_0x92b2[193]+n+_0x92b2[194],_0x92b2[35]),_0x92b2[189])[_0x92b2[36]](RegExp(_0x92b2[190]+n+_0x92b2[191],_0x92b2[35]),_0x92b2[192]))),t})}function G(t){return C(t,function(t,n){return t||(RegExp(n+_0x92b2[195],_0x92b2[35])[_0x92b2[33]](e)||0)[1]||null})}function Y(){return this[_0x92b2[196]]||_0x92b2[41]}var t=u,n=e&&(typeof e===_0x92b2[6]?_0x92b2[6]:s(e))==_0x92b2[10]&&x(e)!=_0x92b2[51];n&&(t=e,e=null);var r=t[_0x92b2[52]]||{},i=r[_0x92b2[53]]||_0x92b2[41];e||(e=i);var o=n||d==a,f=n?!!r[_0x92b2[54]]:/\bChrome\b/[_0x92b2[32]](e)&&!/internal|\n/i[_0x92b2[32]](g.toString()),l=_0x92b2[55],c=n?l:_0x92b2[56],h=n?l:_0x92b2[57],v=n&&t[_0x92b2[58]]?_0x92b2[59]:x(t[_0x92b2[58]]),m=n?l:_0x92b2[60],y=/\bJava/[_0x92b2[32]](v)&&t[_0x92b2[58]],w=y&&x(t[_0x92b2[61]])==h,A=y?_0x92b2[62]:_0x92b2[63],O=y?_0x92b2[64]:_0x92b2[65],M=t[_0x92b2[66]]||{},_=t[_0x92b2[67]]||t[_0x92b2[68]],D=p[_0x92b2[32]](D=n&&_?_[_0x92b2[69]]:x(_))?D:_=null,P,H=e,B=[],j=null,F=e==i,I=F&&_&&typeof _[_0x92b2[70]]==_0x92b2[71]&&_[_0x92b2[70]](),q,R=V([_0x92b2[72],{label:_0x92b2[73],pattern:_0x92b2[74]},_0x92b2[75],_0x92b2[76],_0x92b2[77],_0x92b2[78],_0x92b2[79],_0x92b2[80]]),U=J([_0x92b2[81],_0x92b2[82],_0x92b2[83],_0x92b2[84],_0x92b2[85],_0x92b2[86],_0x92b2[87],_0x92b2[88],_0x92b2[89],_0x92b2[90],_0x92b2[75],_0x92b2[91],{label:_0x92b2[92],pattern:_0x92b2[93]},_0x92b2[94],_0x92b2[95],_0x92b2[96],_0x92b2[97],_0x92b2[98],_0x92b2[99],_0x92b2[100],_0x92b2[101],_0x92b2[102],_0x92b2[103],_0x92b2[104],{label:_0x92b2[105],pattern:_0x92b2[106]},_0x92b2[107],_0x92b2[108],_0x92b2[109],_0x92b2[110],_0x92b2[111],_0x92b2[112],{label:_0x92b2[112],pattern:_0x92b2[113]},_0x92b2[114],{label:_0x92b2[114],pattern:_0x92b2[115]},_0x92b2[116],{label:_0x92b2[117],pattern:_0x92b2[118]},{label:_0x92b2[119],pattern:_0x92b2[120]},{label:_0x92b2[121],pattern:_0x92b2[122]},{label:_0x92b2[121],pattern:_0x92b2[123]},_0x92b2[124]]),z=Q([{label:_0x92b2[125],pattern:_0x92b2[126]},_0x92b2[125],{label:_0x92b2[127],pattern:_0x92b2[128]},{label:_0x92b2[129],pattern:_0x92b2[130]},{label:_0x92b2[131],pattern:_0x92b2[132]},{label:_0x92b2[133],pattern:_0x92b2[134]},_0x92b2[135],_0x92b2[136],_0x92b2[137],_0x92b2[138],_0x92b2[139],_0x92b2[140],{label:_0x92b2[141],pattern:_0x92b2[106]},_0x92b2[142],_0x92b2[143],_0x92b2[144],_0x92b2[145],_0x92b2[146],_0x92b2[147],_0x92b2[148],{label:_0x92b2[149],pattern:_0x92b2[150]},_0x92b2[151],_0x92b2[152],{label:_0x92b2[153],pattern:_0x92b2[154]},_0x92b2[155]]),W=$({Apple:{iPad:1,iPhone:1,iPod:1},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),X=K([_0x92b2[156],_0x92b2[157],_0x92b2[158],_0x92b2[159],_0x92b2[160],_0x92b2[161],_0x92b2[162],_0x92b2[163],_0x92b2[164],_0x92b2[165],_0x92b2[166],_0x92b2[167],_0x92b2[168],_0x92b2[169],_0x92b2[170],_0x92b2[171],_0x92b2[172],_0x92b2[173],_0x92b2[174],_0x92b2[175],_0x92b2[176],_0x92b2[177],_0x92b2[178],_0x92b2[179],_0x92b2[180],_0x92b2[34]]);R&&(R=[R]),W&&!z&&(z=Q([W]));if(P=/\bGoogle TV\b/[_0x92b2[33]](z))z=P[0];/\bSimulator\b/i[_0x92b2[32]](e)&&(z=(z?z+_0x92b2[189]:_0x92b2[41])+_0x92b2[197]),U==_0x92b2[112]&&/\bOPiOS\b/[_0x92b2[32]](e)&&B[_0x92b2[199]](_0x92b2[198]);if(/^iP/[_0x92b2[32]](z))U||(U=_0x92b2[124]),X=_0x92b2[200]+((P=/ OS ([\d_]+)/i[_0x92b2[33]](e))?_0x92b2[189]+P[1][_0x92b2[36]](/_/g,_0x92b2[42]):_0x92b2[41]);else if(U==_0x92b2[95]&&!/buntu/i[_0x92b2[32]](X))X=_0x92b2[164];else if(W&&W!=_0x92b2[201]&&(/Chrome/[_0x92b2[32]](U)&&!/\bMobile Safari\b/i[_0x92b2[32]](e)||/\bVita\b/[_0x92b2[32]](z)))U=_0x92b2[202],X=/\bAndroid\b/[_0x92b2[32]](X)?X:_0x92b2[157];else if(!U||(P=!/\bMinefield\b|\(Android;/i[_0x92b2[32]](e)&&/\b(?:Firefox|Safari)\b/[_0x92b2[33]](U)))U&&!z&&/[\/,]|^[^(]+?\)/[_0x92b2[32]](e[_0x92b2[20]](e[_0x92b2[203]](P+_0x92b2[188])+8))&&(U=null),(P=z||W||X)&&(z||W||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/[_0x92b2[32]](X))&&(U=/[a-z]+(?: Hat)?/i[_0x92b2[33]](/\bAndroid\b/[_0x92b2[32]](X)?X:P)+_0x92b2[204]);(P=/\((Mobile|Tablet).*?Firefox\b/i[_0x92b2[33]](e))&&P[1]&&(X=_0x92b2[205],z||(z=P[1])),I||(I=G([_0x92b2[206],_0x92b2[207],N(U),_0x92b2[208]])),R==_0x92b2[75]&&parseFloat(I)>3?R=[_0x92b2[73]]:R!=_0x92b2[72]&&(P=/\bOpera\b/[_0x92b2[32]](U)&&(/\bOPR\b/[_0x92b2[32]](e)?_0x92b2[209]:_0x92b2[76])||/\b(?:Midori|Nook|Safari)\b/i[_0x92b2[32]](e)&&_0x92b2[73]||!R&&/\bMSIE\b/i[_0x92b2[32]](e)&&(X==_0x92b2[45]?_0x92b2[78]:_0x92b2[72]))?R=[P]:/\bPlayStation\b(?! Vita\b)/i[_0x92b2[32]](U)&&R==_0x92b2[73]&&(R=[_0x92b2[77]]),U==_0x92b2[121]&&(P=(/; *(?:XBLWP|ZuneWP)(\d+)/i[_0x92b2[33]](e)||0)[1])?(U+=_0x92b2[210],X=_0x92b2[156]+(/\+$/[_0x92b2[32]](P)?P:P+_0x92b2[211]),B[_0x92b2[213]](_0x92b2[212])):/\bWPDesktop\b/i[_0x92b2[32]](e)?(U=_0x92b2[214],X=_0x92b2[215],B[_0x92b2[213]](_0x92b2[212]),I||(I=(/\brv:([\d.]+)/[_0x92b2[33]](e)||0)[1])):U!=_0x92b2[121]&&R==_0x92b2[72]&&(P=/\brv:([\d.]+)/[_0x92b2[33]](e))?(/\bWPDesktop\b/i[_0x92b2[32]](e)||(U&&B[_0x92b2[199]](_0x92b2[216]+U+(I?_0x92b2[189]+I:_0x92b2[41])),U=_0x92b2[121]),I=P[1]):(U==_0x92b2[116]||U!=_0x92b2[121])&&(P=/\bEdge\/([\d.]+)/[_0x92b2[33]](e))&&(U=_0x92b2[121],I=P[1],R=[_0x92b2[72]],B[_0x92b2[213]](_0x92b2[217]));if(F){if(T(t,_0x92b2[11])){y&&(P=y[_0x92b2[219]][_0x92b2[218]],H=P[_0x92b2[221]](_0x92b2[220]),X=X||P[_0x92b2[221]](_0x92b2[222])+_0x92b2[189]+P[_0x92b2[221]](_0x92b2[223]));if(o&&T(t,_0x92b2[224])&&(P=[t[_0x92b2[224]]])[0]){X||(X=P[0][_0x92b2[225]]||null);try{P[1]=t[_0x92b2[227]](_0x92b2[226])[_0x92b2[70]],I=P[1][_0x92b2[228]](_0x92b2[42]),U=_0x92b2[229]}catch(Z){P[0][_0x92b2[11]][_0x92b2[224]]==t[_0x92b2[224]]&&(U=_0x92b2[230])}}else s(t[_0x92b2[231]])==_0x92b2[10]&&(P=t[_0x92b2[231]])?(U=_0x92b2[232],H=P[_0x92b2[233]],X=P[_0x92b2[234]],I=/[\d.]+/[_0x92b2[33]](P[_0x92b2[70]])[0]):w&&(U=_0x92b2[235])}else x(P=t[_0x92b2[236]])==c?(U=_0x92b2[81],X=P[_0x92b2[238]][_0x92b2[224]][_0x92b2[237]][_0x92b2[225]]):x(P=t[_0x92b2[239]])==m?(U=_0x92b2[100],I=(P=P[_0x92b2[70]]||null)&&P[_0x92b2[240]]+_0x92b2[42]+P[_0x92b2[241]]+_0x92b2[42]+P[_0x92b2[242]]):typeof M[_0x92b2[243]]==_0x92b2[49]&&(P=/\bTrident\/(\d+)/i[_0x92b2[33]](e))&&(I=[I,M[_0x92b2[243]]],(P=+P[1]+4)!=I[1]&&(B[_0x92b2[199]](_0x92b2[244]+I[1]+_0x92b2[245]),R&&(R[1]=_0x92b2[41]),I[1]=P),I=U==_0x92b2[121]?String(I[1][_0x92b2[246]](1)):I[0]);X=X&&E(X)}I&&(P=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i[_0x92b2[33]](I)||/(?:alpha|beta)(?: ?\d)?/i[_0x92b2[33]](e+_0x92b2[247]+(F&&r[_0x92b2[248]]))||/\bMinefield\b/i[_0x92b2[32]](e)&&_0x92b2[62])&&(j=/b/i[_0x92b2[32]](P)?_0x92b2[249]:_0x92b2[250],I=I[_0x92b2[36]](RegExp(P+_0x92b2[251]),_0x92b2[41])+(j==_0x92b2[249]?O:A)+(/\d+\+?/[_0x92b2[33]](P)||_0x92b2[41])),U==_0x92b2[87]||U==_0x92b2[119]&&/\b(?:Android|Firefox OS)\b/[_0x92b2[32]](X)?U=_0x92b2[252]:U==_0x92b2[97]&&I?I=I[_0x92b2[36]](/\.[\d.]+/,_0x92b2[211]):U==_0x92b2[105]?(/\bMobi/i[_0x92b2[32]](e)||(X=_0x92b2[157],B[_0x92b2[213]](_0x92b2[212])),/Accelerated *= *true/i[_0x92b2[32]](e)&&B[_0x92b2[213]](_0x92b2[253])):/\bXbox\b/i[_0x92b2[32]](z)?(X=null,z==_0x92b2[153]&&/\bIEMobile\b/[_0x92b2[32]](e)&&B[_0x92b2[213]](_0x92b2[254])):(/^(?:Chrome|IE|Opera)$/[_0x92b2[32]](U)||U&&!z&&!/Browser|Mobi/[_0x92b2[32]](U))&&(X==_0x92b2[255]||/Mobi/i[_0x92b2[32]](e))?U+=_0x92b2[210]:U==_0x92b2[121]&&F&&t[_0x92b2[256]]===null?B[_0x92b2[213]](_0x92b2[217]):(/\bBlackBerry\b/[_0x92b2[32]](z)||/\bBB10\b/[_0x92b2[32]](e))&&(P=(RegExp(z[_0x92b2[36]](/ +/g,_0x92b2[257])+_0x92b2[258],_0x92b2[35])[_0x92b2[33]](e)||0)[1]||I)?(P=[P,/BB10/[_0x92b2[32]](e)],X=(P[1]?(z=null,W=_0x92b2[125]):_0x92b2[259])+_0x92b2[189]+P[0],I=null):this!=S&&z!=_0x92b2[151]&&(F&&_||/Opera/[_0x92b2[32]](U)&&/\b(?:MSIE|Firefox)\b/i[_0x92b2[32]](e)||U==_0x92b2[119]&&/\bOS X (?:\d+\.){2,}/[_0x92b2[32]](X)||U==_0x92b2[121]&&(X&&!/^Win/[_0x92b2[32]](X)&&I>5.5||/\bWindows XP\b/[_0x92b2[32]](X)&&I>8||I==8&&!/\bTrident\b/[_0x92b2[32]](e)))&&!p[_0x92b2[32]](P=L[_0x92b2[5]](S,e[_0x92b2[36]](p,_0x92b2[41])+_0x92b2[247]))&&P[_0x92b2[260]]&&(P=_0x92b2[261]+P[_0x92b2[260]]+((P=P[_0x92b2[70]])?_0x92b2[189]+P:_0x92b2[41]),p[_0x92b2[32]](U)?(/\bIE\b/[_0x92b2[32]](P)&&X==_0x92b2[45]&&(X=null),P=_0x92b2[262]+P):(P=_0x92b2[263]+P,D?U=E(D[_0x92b2[36]](/([a-z])([A-Z])/g,_0x92b2[192])):U=_0x92b2[114],/\bIE\b/[_0x92b2[32]](P)&&(X=null),F||(I=null)),R=[_0x92b2[76]],B[_0x92b2[199]](P));if(P=(/\bAppleWebKit\/([\d.]+\+?)/i[_0x92b2[33]](e)||0)[1]){P=[parseFloat(P[_0x92b2[36]](/\.(\d)$/,_0x92b2[264])),P];if(U==_0x92b2[124]&&P[1][_0x92b2[20]](-1)==_0x92b2[265])U=_0x92b2[266],j=_0x92b2[250],I=P[1][_0x92b2[20]](0,-1);else if(I==P[1]||I==(P[2]=(/\bSafari\/([\d.]+\+?)/i[_0x92b2[33]](e)||0)[1]))I=null;P[1]=(/\bChrome\/([\d.]+)/i[_0x92b2[33]](e)||0)[1],P[0]==537.36&&P[2]==537.36&&parseFloat(P[1])>=28&&U!=_0x92b2[121]&&(R=[_0x92b2[209]]),!F||!f&&!P[1]?(R&&(R[1]=_0x92b2[267]),P=(P=P[0],P<400?1:P<500?2:P<526?3:P<533?4:P<534?_0x92b2[268]:P<535?5:P<537?6:P<538?7:P<601?8:_0x92b2[23])):(R&&(R[1]=_0x92b2[269]),P=P[1]||(P=P[0],P<530?1:P<532?2:P<532.05?3:P<533?4:P<534.03?5:P<534.07?6:P<534.1?7:P<534.13?8:P<534.16?9:P<534.24?10:P<534.3?11:P<535.01?12:P<535.02?_0x92b2[270]:P<535.07?15:P<535.11?16:P<535.19?17:P<536.05?18:P<536.1?19:P<537.01?20:P<537.11?_0x92b2[271]:P<537.13?23:P<537.18?24:P<537.24?25:P<537.36?26:R!=_0x92b2[209]?_0x92b2[272]:_0x92b2[273])),R&&(R[1]+=_0x92b2[189]+(P+=typeof P==_0x92b2[49]?_0x92b2[211]:/[.+]/[_0x92b2[32]](P)?_0x92b2[41]:_0x92b2[265])),U==_0x92b2[124]&&(!I||parseInt(I)>45)&&(I=P)}U==_0x92b2[114]&&(P=/\bzbov|zvav$/[_0x92b2[33]](X))?(U+=_0x92b2[189],B[_0x92b2[213]](_0x92b2[212]),P==_0x92b2[274]?(U+=_0x92b2[275],I=null):U+=_0x92b2[276],X=X[_0x92b2[36]](RegExp(_0x92b2[257]+P+_0x92b2[277]),_0x92b2[41])):U==_0x92b2[124]&&/\bChrome\b/[_0x92b2[33]](R&&R[1])&&(B[_0x92b2[213]](_0x92b2[212]),U=_0x92b2[117],I=null,/\bOS X\b/[_0x92b2[32]](X)?(W=_0x92b2[278],X=_0x92b2[279]):X=null),I&&I[_0x92b2[203]](P=/[\d.]+$/[_0x92b2[33]](X))==0&&e[_0x92b2[203]](_0x92b2[188]+P+_0x92b2[280])>-1&&(X=k(X[_0x92b2[36]](P,_0x92b2[41]))),R&&!/\b(?:Avant|Nook)\b/[_0x92b2[32]](U)&&(/Browser|Lunascape|Maxthon/[_0x92b2[32]](U)||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/[_0x92b2[32]](U)&&R[1])&&(P=R[R[_0x92b2[48]]-1])&&B[_0x92b2[199]](P),B[_0x92b2[48]]&&(B=[_0x92b2[190]+B[_0x92b2[228]](_0x92b2[281])+_0x92b2[282]]),W&&z&&z[_0x92b2[203]](W)<0&&B[_0x92b2[199]](_0x92b2[283]+W),z&&B[_0x92b2[199]]((/^on /[_0x92b2[32]](B[B[_0x92b2[48]]-1])?_0x92b2[41]:_0x92b2[283])+z),X&&(P=/ ([\d.+]+)$/[_0x92b2[33]](X),q=P&&X[_0x92b2[19]](X[_0x92b2[48]]-P[0][_0x92b2[48]]-1)==_0x92b2[188],X={architecture:32,family:P&&!q?X[_0x92b2[36]](P[0],_0x92b2[41]):X,version:P?P[1]:null,toString:function(){var t=this[_0x92b2[70]];return this[_0x92b2[284]]+(t&&!q?_0x92b2[189]+t:_0x92b2[41])+(this[_0x92b2[285]]==64?_0x92b2[286]:_0x92b2[41])}}),(P=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i[_0x92b2[33]](H))&&!/\bi686\b/i[_0x92b2[32]](H)&&(X&&(X[_0x92b2[285]]=64,X[_0x92b2[284]]=X[_0x92b2[284]][_0x92b2[36]](RegExp(_0x92b2[257]+P),_0x92b2[41])),U&&(/\bWOW64\b/i[_0x92b2[32]](e)||F&&/\w(?:86|32)$/[_0x92b2[32]](r[_0x92b2[287]]||r[_0x92b2[234]])&&!/\bWin64; x64\b/i[_0x92b2[32]](e))&&B[_0x92b2[213]](_0x92b2[288])),e||(e=null);var et={};return et[_0x92b2[196]]=e,et[_0x92b2[289]]=R&&R[0],et[_0x92b2[290]]=W,et[_0x92b2[260]]=U,et[_0x92b2[291]]=j,et[_0x92b2[292]]=z,et[_0x92b2[293]]=e,et[_0x92b2[70]]=U&&I,et[_0x92b2[225]]=X||{architecture:null,family:null,version:null,toString:function(){return _0x92b2[294]}},et[_0x92b2[295]]=L,et[_0x92b2[17]]=Y,et[_0x92b2[70]]&&B[_0x92b2[213]](I),et[_0x92b2[260]]&&B[_0x92b2[213]](U),X&&U&&(X!=String(X)[_0x92b2[38]](_0x92b2[189])[0]||X!=U[_0x92b2[38]](_0x92b2[189])[0]&&!z)&&B[_0x92b2[199]](z?_0x92b2[190]+X+_0x92b2[282]:_0x92b2[283]+X),B[_0x92b2[48]]&&(et[_0x92b2[196]]=B[_0x92b2[228]](_0x92b2[189])),et}_0x92b2[0];var o={"function":!0,object:!0},u=o[typeof window===_0x92b2[6]?_0x92b2[6]:s(window)]&&window||this,a=u,f=o[s(t)]&&t,l=o[s(e)]&&e&&!e[_0x92b2[9]]&&e,c=f&&l&&(typeof i===_0x92b2[6]?_0x92b2[6]:s(i))==_0x92b2[10]&&i;c&&(c[_0x92b2[11]]===c||c[_0x92b2[12]]===c||c[_0x92b2[13]]===c)&&(u=c);var h=Math[_0x92b2[14]](2,53)-1,p=/\bOpera/,d=this,v=Object[_0x92b2[15]],m=v[_0x92b2[16]],g=v[_0x92b2[17]];_0x92b2[71]==_0x92b2[71]&&s(n(3))==_0x92b2[10]&&n(3)?(r=function(){return L()}[_0x92b2[5]](t,n,t,e),r===undefined||!(e[_0x92b2[296]]=r)):f&&l?S(L(),function(e,t){f[t]=e}):u[_0x92b2[234]]=L()}[_0x92b2[5]](undefined)}))[_0x92b2[5]](t,n(2)(e),function(){return this}())},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){return e[_0x92b2[297]]||(e[_0x92b2[298]]=function(){},e[_0x92b2[299]]=[],e[_0x92b2[300]]=[],e[_0x92b2[297]]=1),e}},function(e,t){((function(t){e[_0x92b2[296]]=t}))[_0x92b2[5]](t,{})},function(e,t){function r(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}function i(){var e=_0x92b2[32];try{return localStorage[_0x92b2[308]](e,e),localStorage[_0x92b2[309]](e),!0}catch(t){return!1}}_0x92b2[0];var n=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var s=function(){function e(){r(this,e)}return n(e,[{key:_0x92b2[310],value:function(t){var n=localStorage[_0x92b2[311]](t);try{n=JSON[_0x92b2[295]](n)}catch(r){}return n}},{key:_0x92b2[312],value:function(t,n){localStorage[_0x92b2[308]](t,JSON[_0x92b2[313]](n))}},{key:_0x92b2[314],value:function(t){localStorage[_0x92b2[309]](t)}},{key:_0x92b2[315],value:function(){localStorage[_0x92b2[315]]()}}]),e}(),o=function(){function e(){r(this,e),this[_0x92b2[316]]={}}return n(e,[{key:_0x92b2[310],value:function(t){return this[_0x92b2[316]][t]}},{key:_0x92b2[312],value:function(t,n){this[_0x92b2[316]][t]=n}},{key:_0x92b2[314],value:function(t){delete this[_0x92b2[316]][t]}},{key:_0x92b2[315],value:function(){this[_0x92b2[316]]={}}}]),e}();t[_0x92b2[4]]=i()?new s:new o},function(e,t,n){function s(e){return e&&e[_0x92b2[1]]?e:{"default":e}}_0x92b2[0];var r=n(6),i=s(r);t[_0x92b2[207]]={VOICE_VERSION:_0x92b2[317],VIDEO_VERSION:_0x92b2[317]},t[_0x92b2[318]]=(0,i[_0x92b2[4]])({UNASSIGNED:null,PUSH_TO_TALK:null,PUSH_TO_MUTE:null,TOGGLE_MUTE:null,TOGGLE_DEAFEN:null,TOGGLE_OVERLAY:null}),t[_0x92b2[319]]=(0,i[_0x92b2[4]])({IDLE:null,ENTER_GUILD:null,AUTHENTICATE:null,CONNECTING:null,CONNECTED:null,DISCONNECTED:null,VOICE_CONNECTING:null,VOICE_CONNECTED:null,VOICE_DISCONNECTED:null,NO_ROUTE:null,ICE_CHECKING:null}),t[_0x92b2[320]]={UNKNOWN:_0x92b2[321],BAD:_0x92b2[322],AVERAGE:_0x92b2[323],FINE:_0x92b2[324]},t[_0x92b2[325]]=(0,i[_0x92b2[4]])({PUSH_TO_TALK:null,VOICE_ACTIVITY:null}),t[_0x92b2[326]]=(0,i[_0x92b2[4]])({INVITE:null,BYE:null,PING:null,PONG:null,SPEAKING:null,UPDATEUSERS:null})},function(e,t){_0x92b2[0];var n=function(t){var n={},r;if(t instanceof Object&&!Array[_0x92b2[327]](t)){for(r in t){if(!t[_0x92b2[16]](r))continue;n[r]=r}return n}throw new Error(_0x92b2[328])};e[_0x92b2[296]]=n},function(e,t,n){function s(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function o(){}_0x92b2[0];var r=n(1),i=s(r);navigator[_0x92b2[329]]=navigator[_0x92b2[329]]||navigator[_0x92b2[330]]||navigator[_0x92b2[331]],window[_0x92b2[332]]=window[_0x92b2[332]]||window[_0x92b2[333]]||navigator[_0x92b2[334]],window[_0x92b2[335]]=window[_0x92b2[335]]||window[_0x92b2[336]]||window[_0x92b2[337]],window[_0x92b2[338]]=window[_0x92b2[338]]||window[_0x92b2[339]]||window[_0x92b2[340]];var u={supported:!1,autoEnable:!1,enable:o,playSound:o,supportsMultiplePTT:o,setForceSend:o,setInputMode:o,setInputVolume:o,stopAudioInput:o,setOutputVolume:o,setVolumeChangeCallback:o,setOnSpeakingCallback:o,setOnVoiceCallback:o,setOnInputEventCallback:o,getMicMute:o,setSelfMute:o,setSelfDeaf:o,setLocalMute:o,setLocalVolume:o,createUser:o,destroyUser:o,onSpeaking:o,onVoiceActivity:o,onDevicesChanged:o,onConnectionState:o,getInputDevices:o,getOutputDevices:o,setInputDevice:o,setOutputDevice:o,canSetInputDevice:function(){return!1},canSetOutputDevice:function(){return!1},setEchoCancellation:o,setNoiseSuppression:o,setAutomaticGainControl:o,setAttenuation:o,supportsAutomaticVAD:function(){return!1},isAttenuationEnabled:function(){return!1},canSetAttenuation:function(){return!1},canSetVoiceProcessing:function(){return!1},connect:o,disconnect:o,handleSpeaking:o,handleSessionDescription:o,inputEventRegister:o,inputEventUnregister:o,debugDump:function(){}};if(window[_0x92b2[332]]&&navigator[_0x92b2[329]]&&window[_0x92b2[335]]){var a={firefox:38,chrome:37,"chrome mobile":48,opera:27},f=!0,l=!1,c=undefined;try{for(var h=Object[_0x92b2[342]](a)[Symbol[_0x92b2[341]]](),p;!(f=(p=h[_0x92b2[344]]())[_0x92b2[343]]);f=!0){var d=p[_0x92b2[303]],v=a[d];if(i[_0x92b2[4]][_0x92b2[260]][_0x92b2[345]]()===d&&parseInt(i[_0x92b2[4]][_0x92b2[70]])>=v){u=n(8)[_0x92b2[4]];break}}}catch(m){l=!0,c=m}finally{try{!f&&h[_0x92b2[346]]&&h[_0x92b2[346]]()}finally{if(l)throw c}}}e[_0x92b2[296]]=u},function(e,t,n){((function(e){function h(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function C(e){var t=E[e];return t!=null?t:p}function k(e){return b*C(e)/p}function L(e){v=e,T&&T(e)}function A(e,t){var n=new a[_0x92b2[4]](e,t);n[_0x92b2[349]]=y||w[e],n[_0x92b2[350]]=k(e),n[_0x92b2[348]]=function(t){return x(e,t)},n[_0x92b2[351]]=S[e]||!1,m[e]=n}function O(e){var t=m[e];t!=null&&(t[_0x92b2[352]](),delete m[e])}function _(){N[_0x92b2[354]](function(e){N[_0x92b2[353]](function(t){M&&M(e,t)})})}function D(){}_0x92b2[0],Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var r=n(1),i=h(r),s=n(10),o=h(s),u=n(47),a=h(u),f=n(48),l=h(f),c=n(5),p=100,d=undefined,v=c[_0x92b2[319]][_0x92b2[347]],m={},g={},y=!1,b=p,w={},E={},S={},x=function(){},T=null,N=new o[_0x92b2[4]];N[_0x92b2[348]]=function(e){return x(null,e)};var M=undefined;setInterval(_,5e3),t[_0x92b2[4]]={supported:!0,autoEnable:!1,enable:function(t){N[_0x92b2[356]](function(e,n){t(e),d&&(d[_0x92b2[355]]=n)})},supportsAutomaticVAD:function(){return!1},supportsMultiplePTT:function(){return!0},supportsPTTReleaseDelay:function(){return!0},setForceSend:function(t){N[_0x92b2[357]](t)},setInputMode:function(t,n){N[_0x92b2[358]](t,n)},setInputVolume:D,stopAudioInput:function(){N[_0x92b2[359]]()},setOutputVolume:function(t){b=t;var n=!0,r=!1,i=undefined;try{for(var s=Object[_0x92b2[342]](m)[Symbol[_0x92b2[341]]](),o;!(n=(o=s[_0x92b2[344]]())[_0x92b2[343]]);n=!0){var u=o[_0x92b2[303]];m[u][_0x92b2[350]]=k(u)}}catch(a){r=!0,i=a}finally{try{!n&&s[_0x92b2[346]]&&s[_0x92b2[346]]()}finally{if(r)throw i}}},setVolumeChangeCallback:D,getMicMute:function(){return N[_0x92b2[349]]},setSelfMute:function(t){N[_0x92b2[349]]=t},setSelfDeaf:function(t){y=t;var n=!0,r=!1,i=undefined;try{for(var s=Object[_0x92b2[342]](m)[Symbol[_0x92b2[341]]](),o;!(n=(o=s[_0x92b2[344]]())[_0x92b2[343]]);n=!0){var u=o[_0x92b2[303]];m[u][_0x92b2[349]]=t||w[u]}}catch(a){r=!0,i=a}finally{try{!n&&s[_0x92b2[346]]&&s[_0x92b2[346]]()}finally{if(r)throw i}}},setLocalMute:function(t,n){w[t]=n,m[t]!=null&&(m[t][_0x92b2[349]]=y||n)},setLocalVolume:function(t,n){E[t]=n,m[t]!=null&&(m[t][_0x92b2[350]]=k(t))},createUser:function(t,n){g[t]=n,d&&d[_0x92b2[360]](t,n)},destroyUser:function(t){delete g[t],d&&d[_0x92b2[361]](t)},updateUsers:function(t){d&&d[_0x92b2[362]](t)},onSpeaking:function(t){x=t},onVoiceActivity:function(t){N[_0x92b2[363]]=t},onDevicesChanged:function(n){M=n,e[_0x92b2[364]](_)},getInputDevices:function(t){N[_0x92b2[354]](t)},getOutputDevices:function(t){N[_0x92b2[353]](t)},canSetInputDevice:function(){return MediaStreamTrack[_0x92b2[365]]!=null},setInputDevice:function(t){N[_0x92b2[366]](t,function(e,t){e==null&&d!=null&&(d[_0x92b2[355]]=t)})},canSetOutputDevice:function(){return!1},setOutputDevice:D,setEchoCancellation:function(t){N[_0x92b2[367]]=t},setNoiseSuppression:function(t){N[_0x92b2[368]]=t},setAutomaticGainControl:function(t){N[_0x92b2[369]]=t},canSetAttenuation:function(){return!1},canSetVoiceProcessing:function(){return i[_0x92b2[4]][_0x92b2[289]]===_0x92b2[209]},setAttenuation:D,onConnectionState:function(t){T=t},connect:function(t,n,r,i,s,o){d=new l[_0x92b2[4]](r,n,i,s),d[_0x92b2[371]](_0x92b2[370],function(e,t){return A(e,t)}),d[_0x92b2[371]](_0x92b2[372],function(e){return O(e)}),d[_0x92b2[375]](_0x92b2[373],function(){N[_0x92b2[374]](),L(c[_0x92b2[319]].VOICE_CONNECTED)}),d[_0x92b2[371]](_0x92b2[376],function(){return L(c[_0x92b2[319]].ICE_CHECKING)}),d[_0x92b2[371]](_0x92b2[377],function(){return L(c[_0x92b2[319]].NO_ROUTE)}),d[_0x92b2[371]](_0x92b2[378],function(){return L(c[_0x92b2[319]].VOICE_DISCONNECTED)}),d[_0x92b2[371]](_0x92b2[379],function(){return L(c[_0x92b2[319]].VOICE_DISCONNECTED)}),d[_0x92b2[375]](_0x92b2[380],function(e){return o(null,_0x92b2[381],e)}),d[_0x92b2[355]]=N[_0x92b2[355]],d[_0x92b2[382]](t),L(c[_0x92b2[319]].VOICE_CONNECTING)},disconnect:function(){g={};var t=!0,n=!1,r=undefined;try{for(var i=Object[_0x92b2[342]](m)[Symbol[_0x92b2[341]]](),s;!(t=(s=i[_0x92b2[344]]())[_0x92b2[343]]);t=!0){var o=s[_0x92b2[303]];O(o)}}catch(u){n=!0,r=u}finally{try{!t&&i[_0x92b2[346]]&&i[_0x92b2[346]]()}finally{if(n)throw r}}d!=null&&(d[_0x92b2[383]](),d=null),x=D,L(c[_0x92b2[319]].VOICE_DISCONNECTED)},handleSessionDescription:function(t){d[_0x92b2[384]]=t},handleSpeaking:function(t,n){n?S[t]=n:delete S[t],m[t]!=null&&(m[t][_0x92b2[351]]=n)},debugDump:function(t){var n=null;N[_0x92b2[355]]!=null&&(n={id:N[_0x92b2[355]][_0x92b2[385]],label:N[_0x92b2[355]][_0x92b2[183]],ended:N[_0x92b2[355]][_0x92b2[386]]});var r={},i=!0,s=!1,o=undefined;try{for(var u=Object[_0x92b2[342]](m)[Symbol[_0x92b2[341]]](),a;!(i=(a=u[_0x92b2[344]]())[_0x92b2[343]]);i=!0){var f=a[_0x92b2[303]],l=m[f];r[l[_0x92b2[385]]]={mute:l[_0x92b2[349]],volume:l[_0x92b2[350]],speaking:l[_0x92b2[351]]}}}catch(c){s=!0,o=c}finally{try{!i&&u[_0x92b2[346]]&&u[_0x92b2[346]]()}finally{if(s)throw o}}var h={implementation:_0x92b2[381],selfDeaf:y,outputVolume:b,input:{mute:N[_0x92b2[349]],speaking:N[_0x92b2[351]],sourceId:N[_0x92b2[387]],souces:N[_0x92b2[388]],mode:N[_0x92b2[389]],modeOptions:N[_0x92b2[390]],modeReady:N[_0x92b2[391]]!=null,stream:n},outputs:r};d!=null?(h[_0x92b2[392]]={negotiationNeeded:d[_0x92b2[393]],iceConnectionState:d[_0x92b2[394]],iceGatheringState:d[_0x92b2[395]],signalingState:d[_0x92b2[396]]},d[_0x92b2[397]]!=null?(h[_0x92b2[392]][_0x92b2[398]]=d[_0x92b2[397]][_0x92b2[398]],h[_0x92b2[392]][_0x92b2[399]]=d[_0x92b2[397]][_0x92b2[399]],d[_0x92b2[397]][_0x92b2[408]](function(e){h[_0x92b2[392]][_0x92b2[400]]=e[_0x92b2[407]]()[_0x92b2[406]](function(e){var t={};return e[_0x92b2[403]]()[_0x92b2[402]](function(n){return t[n]=e[_0x92b2[401]](n)}),t[_0x92b2[385]]=e[_0x92b2[385]],t[_0x92b2[404]]=e[_0x92b2[404]],t[_0x92b2[405]]=e[_0x92b2[405]],t}),t(h)})):t(h)):t(h)}}}))[_0x92b2[5]](t,n(9))},function(e,t){function u(){i=!1,s[_0x92b2[48]]?r=s[_0x92b2[409]](r):o=-1,r[_0x92b2[48]]&&a()}function a(){if(i)return;var e=setTimeout(u);i=!0;var t=r[_0x92b2[48]];while(t){s=r,r=[];while(++o<t)s&&s[o][_0x92b2[410]]();o=-1,t=r[_0x92b2[48]]}s=null,i=!1,clearTimeout(e)}function f(e,t){this[_0x92b2[411]]=e,this[_0x92b2[412]]=t}function l(){}_0x92b2[0];var n=e[_0x92b2[296]]={},r=[],i=!1,s,o=-1;n[_0x92b2[364]]=function(e){var t=new Array(arguments[_0x92b2[48]]-1);if(arguments[_0x92b2[48]]>1)for(var n=1;n<arguments[_0x92b2[48]];n++)t[n-1]=arguments[n];r[_0x92b2[199]](new f(e,t)),r[_0x92b2[48]]===1&&!i&&setTimeout(a,0)},f[_0x92b2[15]][_0x92b2[410]]=function(){this[_0x92b2[411]][_0x92b2[413]](null,this[_0x92b2[412]])},n[_0x92b2[414]]=_0x92b2[415],n[_0x92b2[415]]=!0,n[_0x92b2[416]]={},n[_0x92b2[417]]=[],n[_0x92b2[70]]=_0x92b2[41],n[_0x92b2[418]]={},n[_0x92b2[371]]=l,n[_0x92b2[419]]=l,n[_0x92b2[375]]=l,n[_0x92b2[420]]=l,n[_0x92b2[421]]=l,n[_0x92b2[422]]=l,n[_0x92b2[423]]=l,n[_0x92b2[424]]=function(e){throw new Error(_0x92b2[425])},n[_0x92b2[426]]=function(){return _0x92b2[188]},n[_0x92b2[427]]=function(e){throw new Error(_0x92b2[428])},n[_0x92b2[429]]=function(){return 0}},function(e,t,n){((function(e){function v(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function m(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}_0x92b2[0];var r=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(1),s=v(i),o=n(11),u=v(o),a=n(44),f=v(a),l=n(45),c=v(l),h=n(5),p=n(46),d=v(p),g=function(){function t(){m(this,t),this[_0x92b2[430]]=new AudioContext,this[_0x92b2[431]]=c[_0x92b2[4]][_0x92b2[433]](_0x92b2[432]),this[_0x92b2[431]][_0x92b2[434]](_0x92b2[7]),this[_0x92b2[435]]=!1,this[_0x92b2[436]]=!0,this[_0x92b2[437]]=!0,this[_0x92b2[438]]=!0,this[_0x92b2[387]]=null,this[_0x92b2[355]]=null,this[_0x92b2[351]]=!1,this[_0x92b2[348]]=function(e){this[_0x92b2[431]][_0x92b2[434]](_0x92b2[439]+e)},this[_0x92b2[440]]=function(){},this[_0x92b2[363]]=null,this[_0x92b2[389]]=h[_0x92b2[325]][_0x92b2[441]],this[_0x92b2[390]]={},this[_0x92b2[391]]=null}return r(t,[{key:_0x92b2[374],value:function(){this[_0x92b2[435]]=!1,this._setSpeaking(!1),this._updateAudioTracks()}},{key:_0x92b2[359],value:function(){this[_0x92b2[355]]!=null&&(typeof this[_0x92b2[355]][_0x92b2[442]]===_0x92b2[6]?this[_0x92b2[355]][_0x92b2[359]]():this[_0x92b2[355]][_0x92b2[442]]()[_0x92b2[402]](function(e){e[_0x92b2[359]]()}),this[_0x92b2[355]]=null)}},{key:_0x92b2[356],value:function(t){var n=this;this[_0x92b2[391]]&&(this[_0x92b2[391]](),this[_0x92b2[391]]=null,this[_0x92b2[355]]=null),this[_0x92b2[354]](function(e){var r=[{googEchoCancellation:n[_0x92b2[367]]},{googEchoCancellation2:n[_0x92b2[367]]},{googNoiseSuppression:n[_0x92b2[368]]},{googNoiseSuppression2:n[_0x92b2[368]]},{googAutoGainControl:n[_0x92b2[369]]},{googAutoGainControl2:n[_0x92b2[369]]},{googHighpassFilter:!0},{googTypingNoiseDetection:!0}];e[_0x92b2[443]](function(e){return e[_0x92b2[385]]===n[_0x92b2[387]]})&&r[_0x92b2[199]]({sourceId:n[_0x92b2[387]]}),navigator[_0x92b2[329]]({audio:{optional:r}},function(e){n[_0x92b2[355]]=e,n._updateAudioTracks(),n[_0x92b2[389]]&&n[_0x92b2[358]](n[_0x92b2[389]],n[_0x92b2[390]]),t&&t(null,e)},function(e){if(typeof e!==_0x92b2[444])switch(e[_0x92b2[260]]){case _0x92b2[446]:e=_0x92b2[445];break;case _0x92b2[448]:e=_0x92b2[447];break;case _0x92b2[450]:e=_0x92b2[449];break;default:e=_0x92b2[451]}t&&t(e)})})}},{key:_0x92b2[366],value:function(t){var n=arguments[_0x92b2[48]]<=1||arguments[1]===undefined?null:arguments[1];this[_0x92b2[387]]=t,this[_0x92b2[355]]!=null?this[_0x92b2[356]](n):n!=null&&n(_0x92b2[452])}},{key:_0x92b2[354],value:function(n){var r=this;navigator[_0x92b2[453]]!=null&&navigator[_0x92b2[453]][_0x92b2[454]]!=null?navigator[_0x92b2[453]][_0x92b2[454]]()[_0x92b2[464]](function(e){var t=e[_0x92b2[463]](function(e){return e[_0x92b2[461]]===_0x92b2[462]})[_0x92b2[406]](function(e,t){return{id:e[_0x92b2[458]],index:t,name:e[_0x92b2[183]]||(t===0?_0x92b2[459]:_0x92b2[460]+t)}});n(t)})[_0x92b2[457]](function(e){return r[_0x92b2[431]][_0x92b2[456]](_0x92b2[455],e)}):MediaStreamTrack[_0x92b2[365]]!=null?MediaStreamTrack[_0x92b2[365]](function(e){var t=e[_0x92b2[463]](function(e){return e[_0x92b2[461]]===_0x92b2[466]})[_0x92b2[406]](function(e,t){return{id:e[_0x92b2[385]],index:t,name:e[_0x92b2[183]]||(t===0?_0x92b2[459]:_0x92b2[465]+t)}});n(t)}):e[_0x92b2[364]](function(){n([{id:_0x92b2[4],index:0,name:_0x92b2[459]}])})}},{key:_0x92b2[353],value:function(n){e[_0x92b2[364]](function(){n([{id:_0x92b2[4],index:0,name:_0x92b2[459]}])})}},{key:_0x92b2[358],value:function(t){var n=arguments[_0x92b2[48]]<=1||arguments[1]===undefined?{}:arguments[1];this[_0x92b2[391]]&&this[_0x92b2[391]](),this[_0x92b2[389]]=t,this[_0x92b2[390]]=n;if(this[_0x92b2[355]]==null)return;switch(t){case h[_0x92b2[325]][_0x92b2[467]]:this[_0x92b2[391]]=this._setupPushToTalk(n);break;case h[_0x92b2[325]][_0x92b2[441]]:this[_0x92b2[391]]=this._setupVoiceActivity(n)}}},{key:_0x92b2[357],value:function(t){var n=this;if(this[_0x92b2[349]])return;if(this[_0x92b2[351]]===t)return;this[_0x92b2[468]]&&(window[_0x92b2[469]](this._pttDelayTimeout),this[_0x92b2[468]]=null),t?this._setSpeaking(t):this[_0x92b2[468]]=window[_0x92b2[471]](function(){n._setSpeaking(!1),n[_0x92b2[468]]=null},this[_0x92b2[390]][_0x92b2[470]])}},{key:_0x92b2[472],value:function(t){var n=this,r=new d[_0x92b2[4]](this[_0x92b2[430]],this[_0x92b2[355]],t[_0x92b2[473]]);return r[_0x92b2[474]]=function(e,t){n[_0x92b2[349]]||n._setSpeaking(e),n[_0x92b2[363]]&&n[_0x92b2[363]](t)},function(){r[_0x92b2[359]](),r=null,n._setSpeaking(!1)}}},{key:_0x92b2[475],value:function(t){var n=this,r=t[_0x92b2[476]];if(r==null)return null;var i=(0,f[_0x92b2[4]])(new u[_0x92b2[4]](document));return i[_0x92b2[485]](r,function(e){e[_0x92b2[477]]===document[_0x92b2[478]]&&e[_0x92b2[479]]();if(e[_0x92b2[477]][_0x92b2[483]][_0x92b2[482]][_0x92b2[481]](_0x92b2[480]))return;n[_0x92b2[357]](!0)},_0x92b2[484]),i[_0x92b2[485]](r,function(e){e[_0x92b2[477]]===document[_0x92b2[478]]&&e[_0x92b2[479]]();if(e[_0x92b2[477]][_0x92b2[483]][_0x92b2[482]][_0x92b2[481]](_0x92b2[480]))return;n[_0x92b2[357]](!1)},_0x92b2[486]),function(){i[_0x92b2[374]](),i=null,n._setSpeaking(!1)}}},{key:_0x92b2[487],value:function(t){if(this[_0x92b2[351]]===t)return;this[_0x92b2[351]]=t,this._updateAudioTracks(),this[_0x92b2[348]](t)}},{key:_0x92b2[488],value:function(){if(s[_0x92b2[4]][_0x92b2[260]]===_0x92b2[116]||s[_0x92b2[4]][_0x92b2[260]][_0x92b2[489]](_0x92b2[116])||s[_0x92b2[4]][_0x92b2[260]]===_0x92b2[119]){var t=this[_0x92b2[389]]===h[_0x92b2[325]][_0x92b2[441]]?!this[_0x92b2[349]]:this[_0x92b2[351]];if(this[_0x92b2[355]]!=null){var n=this[_0x92b2[355]][_0x92b2[490]]();for(var r=0,i=n[_0x92b2[48]];r<i;r++)n[r][_0x92b2[491]]=t}}}},{key:_0x92b2[349],get:function(){return this[_0x92b2[435]]},set:function(t){this[_0x92b2[435]]=t,this._setSpeaking(!1),this._updateAudioTracks()}},{key:_0x92b2[367],get:function(){return this[_0x92b2[436]]},set:function(t){this[_0x92b2[436]]=t,this[_0x92b2[355]]&&this[_0x92b2[356]]()}},{key:_0x92b2[368],get:function(){return this[_0x92b2[437]]},set:function(t){this[_0x92b2[437]]=t,this[_0x92b2[355]]&&this[_0x92b2[356]]()}},{key:_0x92b2[369],get:function(){return this[_0x92b2[438]]},set:function(t){this[_0x92b2[438]]=t,this[_0x92b2[355]]&&this[_0x92b2[356]]()}}]),t}();t[_0x92b2[4]]=g}))[_0x92b2[5]](t,n(9))},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e){var t=this,n=t[_0x92b2[7]];return t[_0x92b2[492]]={},t[_0x92b2[493]]={},t[_0x92b2[494]]={},t[_0x92b2[495]],t[_0x92b2[496]]=!1,t[_0x92b2[497]]=!1,t[_0x92b2[498]]=!1,t[_0x92b2[499]]=e,t[_0x92b2[500]](),n[_0x92b2[501]][_0x92b2[199]](t),t},e[_0x92b2[296]][_0x92b2[15]][_0x92b2[502]]=n(12),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[503]]=n(13),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[504]]=n(14),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[505]]=n(15),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[374]]=n(16),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[506]]=n(17),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[507]]=n(18),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[500]]=n(20),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[508]]=n(27),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[509]]=n(28),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[510]]=n(32),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[511]]=n(33),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[512]]=n(34),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[513]]=n(36),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[514]]=n(37),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[515]]=n(40),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[516]]=n(41),e[_0x92b2[296]][_0x92b2[15]][_0x92b2[517]]=n(42),e[_0x92b2[296]][_0x92b2[501]]=[],e[_0x92b2[296]][_0x92b2[374]]=n(43),e[_0x92b2[296]][_0x92b2[518]]=null},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t,n){var r=this;return e=e instanceof Array?e:[e],r[_0x92b2[503]](e,t,n),r}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t,n){var r=this;for(var i=0;i<e[_0x92b2[48]];++i)r[_0x92b2[508]](e[i],t,n)}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t){var n=this;return n[_0x92b2[502]](e,function(){},t)}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t){var n=this;return n[_0x92b2[493]][e+_0x92b2[519]+t]&&n[_0x92b2[493]][e+_0x92b2[519]+t]({},e),this}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(){var e=this;return e[_0x92b2[492]]={},e[_0x92b2[493]]={},this}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t){if((_0x92b2[189]+t[_0x92b2[521]]+_0x92b2[189])[_0x92b2[203]](_0x92b2[520])>-1)return!1;var n=t[_0x92b2[522]][_0x92b2[345]]();return n===_0x92b2[523]||n===_0x92b2[524]||n===_0x92b2[525]||t[_0x92b2[526]]}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e,t,r){var i=this,s,o,u={},a=0,f=!1,l,c;s=i[_0x92b2[512]](e,t,r);for(o=0;o<s[_0x92b2[48]];++o)s[o][_0x92b2[527]]&&(a=Math[_0x92b2[529]](a,s[o][_0x92b2[528]]));for(o=0;o<s[_0x92b2[48]];++o){if(s[o][_0x92b2[527]]){if(s[o][_0x92b2[528]]!==a)continue;f=!0,u[s[o][_0x92b2[527]]]=1,i[_0x92b2[514]](s[o][_0x92b2[530]],r,s[o][_0x92b2[531]],s[o][_0x92b2[527]]);continue}f||i[_0x92b2[514]](s[o][_0x92b2[530]],r,s[o][_0x92b2[531]])}c=r[_0x92b2[404]]===_0x92b2[532]&&i[_0x92b2[497]],l=n(19),r[_0x92b2[404]]===i[_0x92b2[498]]&&!l(e)&&!c&&i[_0x92b2[513]](u),i[_0x92b2[497]]=f&&r[_0x92b2[404]]===_0x92b2[484]}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){return e===_0x92b2[533]||e===_0x92b2[534]||e===_0x92b2[535]||e===_0x92b2[536]}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(){var e=this,t=n(21),r=e[_0x92b2[499]];e[_0x92b2[537]]=n(22)[_0x92b2[502]](e),t(r,_0x92b2[532],e[_0x92b2[537]]),t(r,_0x92b2[484],e[_0x92b2[537]]),t(r,_0x92b2[486],e[_0x92b2[537]])}},function(e,t){function n(e,t,n,r){return!e[_0x92b2[538]]&&(t=_0x92b2[371]+t),(e[_0x92b2[538]]||e[_0x92b2[539]])[_0x92b2[5]](e,t,n,r),n}function r(e,t,n,r){return!e[_0x92b2[540]]&&(t=_0x92b2[371]+t),(e[_0x92b2[540]]||e[_0x92b2[541]])[_0x92b2[5]](e,t,n,r),n}_0x92b2[0],e[_0x92b2[296]]=n,e[_0x92b2[296]][_0x92b2[371]]=n,e[_0x92b2[296]][_0x92b2[420]]=r},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e){var t=this,r,i;typeof e[_0x92b2[542]]!==_0x92b2[49]&&(e[_0x92b2[542]]=e[_0x92b2[543]]),r=n(23);var s=r(e);if(!s)return;if(e[_0x92b2[404]]===_0x92b2[486]&&t[_0x92b2[496]]===s){t[_0x92b2[496]]=!1;return}i=n(26),t[_0x92b2[507]](s,i(e),e)}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e){var t,r;t=n(24),r=n(25);if(e[_0x92b2[404]]===_0x92b2[532]){var i=String[_0x92b2[544]](e[_0x92b2[542]]);return e[_0x92b2[545]]||(i=i[_0x92b2[345]]()),i}return t[e[_0x92b2[542]]]?t[e[_0x92b2[542]]]:r[e[_0x92b2[542]]]?r[e[_0x92b2[542]]]:String[_0x92b2[544]](e[_0x92b2[542]])[_0x92b2[345]]()}},function(e,t){_0x92b2[0],e[_0x92b2[296]]={8:_0x92b2[546],9:_0x92b2[547],13:_0x92b2[548],16:_0x92b2[533],17:_0x92b2[534],18:_0x92b2[535],20:_0x92b2[549],27:_0x92b2[550],32:_0x92b2[551],33:_0x92b2[552],34:_0x92b2[553],35:_0x92b2[554],36:_0x92b2[555],37:_0x92b2[556],38:_0x92b2[557],39:_0x92b2[558],40:_0x92b2[559],45:_0x92b2[560],46:_0x92b2[561],91:_0x92b2[536],93:_0x92b2[536],187:_0x92b2[562],189:_0x92b2[563],224:_0x92b2[536]};for(var n=1;n<20;++n)e[_0x92b2[296]][111+n]=_0x92b2[564]+n;for(n=0;n<=9;++n)e[_0x92b2[296]][n+96]=n},function(e,t){_0x92b2[0],e[_0x92b2[296]]={106:_0x92b2[565],107:_0x92b2[265],109:_0x92b2[280],110:_0x92b2[42],111:_0x92b2[188],186:_0x92b2[247],187:_0x92b2[566],188:_0x92b2[567],189:_0x92b2[280],190:_0x92b2[42],191:_0x92b2[188],192:_0x92b2[568],219:_0x92b2[569],220:_0x92b2[570],221:_0x92b2[571],222:_0x92b2[572]}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){var t=[];return e[_0x92b2[545]]&&t[_0x92b2[199]](_0x92b2[533]),e[_0x92b2[573]]&&t[_0x92b2[199]](_0x92b2[535]),e[_0x92b2[574]]&&t[_0x92b2[199]](_0x92b2[534]),e[_0x92b2[575]]&&t[_0x92b2[199]](_0x92b2[536]),t}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t,n,r,i){var s=this;s[_0x92b2[493]][e+_0x92b2[519]+n]=t,e=e[_0x92b2[36]](/\s+/g,_0x92b2[189]);var o=e[_0x92b2[38]](_0x92b2[189]),u;if(o[_0x92b2[48]]>1){s[_0x92b2[515]](e,o,t,n);return}u=s[_0x92b2[509]](e,n),s[_0x92b2[492]][u[_0x92b2[305]]]=s[_0x92b2[492]][u[_0x92b2[305]]]||[],s[_0x92b2[512]](u[_0x92b2[305]],u[_0x92b2[576]],{type:u[_0x92b2[577]]},r,e,i),s[_0x92b2[492]][u[_0x92b2[305]]][r?_0x92b2[213]:_0x92b2[199]]({callback:t,modifiers:u[_0x92b2[576]],action:u[_0x92b2[577]],seq:r,level:i,combo:e})}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e,t){var r=this,i,s,o,u,a=[],f,l,c;i=n(29),s=i(e),f=n(30),l=n(31),c=n(19);for(u=0;u<s[_0x92b2[48]];++u)o=s[u],f[o]&&(o=f[o]),t&&t!==_0x92b2[532]&&l[o]&&(o=l[o],a[_0x92b2[199]](_0x92b2[533])),c(o)&&a[_0x92b2[199]](o);return t=r[_0x92b2[510]](o,a,t),{key:o,modifiers:a,action:t}}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){return e===_0x92b2[265]?[_0x92b2[265]]:e[_0x92b2[38]](_0x92b2[265])}},function(e,t){_0x92b2[0],e[_0x92b2[296]]={option:_0x92b2[535],command:_0x92b2[536],"return":_0x92b2[548],escape:_0x92b2[550],mod:/Mac|iPod|iPhone|iPad/[_0x92b2[32]](navigator[_0x92b2[234]])?_0x92b2[536]:_0x92b2[534]}},function(e,t){_0x92b2[0],e[_0x92b2[296]]={"~":_0x92b2[568],"!":_0x92b2[578],"@":_0x92b2[579],"#":_0x92b2[580],$:_0x92b2[581],"%":_0x92b2[582],"^":_0x92b2[583],"&":_0x92b2[584],"*":_0x92b2[23],"(":_0x92b2[585],")":_0x92b2[586],_:_0x92b2[280],"+":_0x92b2[566],":":_0x92b2[247],'"':_0x92b2[572],"<":_0x92b2[567],">":_0x92b2[42],"?":_0x92b2[188],"|":_0x92b2[570]}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t,n){var r=this;return n||(n=r[_0x92b2[511]]()[e]?_0x92b2[484]:_0x92b2[532]),n===_0x92b2[532]&&t[_0x92b2[48]]&&(n=_0x92b2[484]),n}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(){var e=this,t=e[_0x92b2[7]],r;if(!t[_0x92b2[518]]){t[_0x92b2[518]]={},r=n(24);for(var i in r){if(i>95&&i<112)continue;r[_0x92b2[16]](i)&&(t[_0x92b2[518]][r[i]]=i)}}return t[_0x92b2[518]]}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e,t,r,i,s,o){var u=this,a,f,l=[],c=r[_0x92b2[404]],h,p;if(c===_0x92b2[532]){var d=u[_0x92b2[492]][_0x92b2[587]]||[];d[_0x92b2[402]](function(e){l[_0x92b2[199]](e)})}if(!u[_0x92b2[492]][e])return l;h=n(19),c===_0x92b2[486]&&h(e)&&(t=[e]);for(a=0;a<u[_0x92b2[492]][e][_0x92b2[48]];++a){f=u[_0x92b2[492]][e][a];if(!i&&f[_0x92b2[527]]&&u[_0x92b2[494]][f[_0x92b2[527]]]!==f[_0x92b2[528]])continue;if(c!==f[_0x92b2[577]])continue;p=n(35);if(c===_0x92b2[532]&&!r[_0x92b2[575]]&&!r[_0x92b2[574]]||p(t,f[_0x92b2[576]])){var v=!i&&f[_0x92b2[531]]===s,m=i&&f[_0x92b2[527]]===i&&f[_0x92b2[528]]===o;(v||m)&&u[_0x92b2[492]][e][_0x92b2[588]](a,1),l[_0x92b2[199]](f)}}return l}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e,t){return e[_0x92b2[589]]()[_0x92b2[228]](_0x92b2[567])===t[_0x92b2[589]]()[_0x92b2[228]](_0x92b2[567])}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){var t=this;e=e||{};var n=!1,r;for(r in t[_0x92b2[494]]){if(e[r]){n=!0;continue}t[_0x92b2[494]][r]=0}n||(t[_0x92b2[498]]=!1)}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e,t,r,i){var s=this,o,u;if(s[_0x92b2[506]](t,t[_0x92b2[477]]||t[_0x92b2[590]],r,i))return;e(t,r)===!1&&(o=n(38),o(t),u=n(39),u(t))}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){if(e[_0x92b2[479]]){e[_0x92b2[479]]();return}e[_0x92b2[591]]=!1}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){if(e[_0x92b2[592]]){e[_0x92b2[592]]();return}e[_0x92b2[593]]=!0}},function(e,t,n){_0x92b2[0],e[_0x92b2[296]]=function(e,t,r,i){function o(t){return function(){s[_0x92b2[498]]=t,++s[_0x92b2[494]][e],s[_0x92b2[516]]()}}function u(t){var o;s[_0x92b2[514]](r,t,e),i!==_0x92b2[486]&&(o=n(23),s[_0x92b2[496]]=o(t)),setTimeout(function(){s[_0x92b2[513]]()},10)}var s=this;s[_0x92b2[494]][e]=0;for(var a=0;a<t[_0x92b2[48]];++a){var f=a+1===t[_0x92b2[48]],l=f?u:o(i||s[_0x92b2[509]](t[a+1])[_0x92b2[577]]);s[_0x92b2[508]](t[a],l,i,e,a)}}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(){var e=this;clearTimeout(e[_0x92b2[495]]),e[_0x92b2[495]]=setTimeout(function(){e[_0x92b2[513]]()},1e3)}},function(e,t,n){_0x92b2[0];var r=n(21)[_0x92b2[420]];e[_0x92b2[296]]=function(){var e=this,t=e[_0x92b2[499]];r(t,_0x92b2[532],e[_0x92b2[537]]),r(t,_0x92b2[484],e[_0x92b2[537]]),r(t,_0x92b2[486],e[_0x92b2[537]])}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(){var e=this;e[_0x92b2[501]][_0x92b2[402]](function(e){e[_0x92b2[374]]()})}},function(e,t){_0x92b2[0],e[_0x92b2[296]]=function(e){var t={},n=e[_0x92b2[506]];return e[_0x92b2[506]]=function(e,r,i,s){return t[i]||t[s]?!1:n(e,r,i)},e[_0x92b2[485]]=function(e,n,r){this[_0x92b2[502]](e,n,r);if(e instanceof Array){for(var i=0;i<e[_0x92b2[48]];i++)t[e[i]]=!0;return}t[e]=!0},e}},function(e,t){function r(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}_0x92b2[0];var n=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=_0x92b2[594],s=!1,o=function(){function e(){var t=arguments[_0x92b2[48]]<=0||arguments[0]===undefined?_0x92b2[4]:arguments[0];r(this,e),this[_0x92b2[260]]=t,this[_0x92b2[595]]=this[_0x92b2[595]][_0x92b2[502]](this),this[_0x92b2[434]]=this[_0x92b2[434]][_0x92b2[502]](this),this[_0x92b2[596]]=this[_0x92b2[596]][_0x92b2[502]](this),this[_0x92b2[456]]=this[_0x92b2[456]][_0x92b2[502]](this),this[_0x92b2[597]]=this[_0x92b2[597]][_0x92b2[502]](this)}return n(e,[{key:_0x92b2[595],value:function(t){for(var n=arguments[_0x92b2[48]],r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(s){var u;(u=console)[t||_0x92b2[595]][_0x92b2[413]](u,[_0x92b2[569]+this[_0x92b2[260]]+_0x92b2[571]][_0x92b2[409]](r))}else{var a;(a=console)[t||_0x92b2[595]][_0x92b2[413]](a,[_0x92b2[598]+this[_0x92b2[260]]+_0x92b2[571],i][_0x92b2[409]](r))}}},{key:_0x92b2[434],value:function(){for(var t=arguments[_0x92b2[48]],n=Array(t),r=0;r<t;r++)n[r]=arguments[r];this[_0x92b2[595]][_0x92b2[413]](this,[_0x92b2[434]][_0x92b2[409]](n))}},{key:_0x92b2[596],value:function(){for(var t=arguments[_0x92b2[48]],n=Array(t),r=0;r<t;r++)n[r]=arguments[r];this[_0x92b2[595]][_0x92b2[413]](this,[_0x92b2[596]][_0x92b2[409]](n))}},{key:_0x92b2[456],value:function(){for(var t=arguments[_0x92b2[48]],n=Array(t),r=0;r<t;r++)n[r]=arguments[r];this[_0x92b2[595]][_0x92b2[413]](this,[_0x92b2[456]][_0x92b2[409]](n))}},{key:_0x92b2[597],value:function(){for(var t=arguments[_0x92b2[48]],n=Array(t),r=0;r<t;r++)n[r]=arguments[r];this[_0x92b2[595]][_0x92b2[413]](this,[_0x92b2[597]][_0x92b2[409]](n))}}]),e}(),u=new o;t[_0x92b2[4]]={create:function(){for(var t=arguments[_0x92b2[48]],n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return new(Function[_0x92b2[15]][_0x92b2[502]][_0x92b2[413]](o,[null][_0x92b2[409]](n)))},log:u[_0x92b2[595]],info:u[_0x92b2[434]],warn:u[_0x92b2[596]],error:u[_0x92b2[456]],trace:u[_0x92b2[597]]}},function(e,t){function r(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}function i(e,t){var n=-Infinity;e[_0x92b2[599]](t);for(var r=4;r<t[_0x92b2[48]];r++)t[r]>n&&t[r]<0&&(n=t[r]);return n}_0x92b2[0];var n=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var s=function(){function e(t,n){var i=arguments[_0x92b2[48]]<=2||arguments[2]===undefined?-40:arguments[2],s=this,o=arguments[_0x92b2[48]]<=3||arguments[3]===undefined?.1:arguments[3];r(this,e);var u=arguments[_0x92b2[48]]<=4||arguments[4]===undefined?10:arguments[4],a=t[_0x92b2[600]]();a[_0x92b2[601]]=512,a[_0x92b2[602]]=o;var f=t[_0x92b2[603]](n);f[_0x92b2[382]](a);var l=[];for(var c=0;c<u;c++)l[_0x92b2[199]](!1);var h=t[_0x92b2[604]](1024,0,1);h[_0x92b2[605]]=function(){s[_0x92b2[606]](),s[_0x92b2[474]]&&s[_0x92b2[474]](s[_0x92b2[351]],s[_0x92b2[607]])},h[_0x92b2[382]](t[_0x92b2[608]]),this[_0x92b2[473]]=i,this[_0x92b2[609]]=a,this[_0x92b2[610]]=h,this[_0x92b2[611]]=new Float32Array(a[_0x92b2[601]]),this[_0x92b2[612]]=f,this[_0x92b2[607]]=0,this[_0x92b2[613]]=l,this[_0x92b2[614]]=0,this[_0x92b2[615]]=0,this[_0x92b2[616]]=this[_0x92b2[613]][_0x92b2[48]]*4,this[_0x92b2[617]]=this[_0x92b2[616]],this[_0x92b2[474]]=null}return n(e,[{key:_0x92b2[606],value:function(){this[_0x92b2[607]]=i(this[_0x92b2[609]],this[_0x92b2[611]]),this[_0x92b2[613]][this[_0x92b2[614]]]&&this[_0x92b2[615]]--;var t=this[_0x92b2[607]]>this[_0x92b2[473]];this[_0x92b2[613]][this[_0x92b2[614]]]=t,t&&this[_0x92b2[615]]++,++this[_0x92b2[614]]===this[_0x92b2[613]][_0x92b2[48]]&&(this[_0x92b2[614]]=0),this[_0x92b2[615]]>0?this[_0x92b2[617]]=0:this[_0x92b2[617]]++}},{key:_0x92b2[359],value:function(){this[_0x92b2[612]][_0x92b2[618]](),this[_0x92b2[610]][_0x92b2[618]](),this[_0x92b2[615]]=0}},{key:_0x92b2[351],get:function(){return this[_0x92b2[615]]>0?!0:this[_0x92b2[617]]<this[_0x92b2[616]]}}]),e}();t[_0x92b2[4]]=s},function(e,t,n){function o(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}_0x92b2[0];var r=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(45),s=o(i),a=function(){function e(t,n){u(this,e),this[_0x92b2[385]]=t,this[_0x92b2[431]]=s[_0x92b2[4]][_0x92b2[433]](_0x92b2[619]+this[_0x92b2[385]]+_0x92b2[282]),this[_0x92b2[620]]=!1,this[_0x92b2[348]]=function(){},this[_0x92b2[435]]=!1,this[_0x92b2[621]]=100;var r=document[_0x92b2[622]](_0x92b2[466]);this._updateAudioElement(r),r[_0x92b2[623]]=!0,r[_0x92b2[624]]=URL[_0x92b2[625]](n),this[_0x92b2[626]]=r,this[_0x92b2[431]][_0x92b2[434]](_0x92b2[433])}return r(e,[{key:_0x92b2[352],value:function(){this[_0x92b2[431]][_0x92b2[434]](_0x92b2[352]),this[_0x92b2[627]]=null,this[_0x92b2[626]][_0x92b2[628]](),this[_0x92b2[626]]=null,this[_0x92b2[351]]=!1,this[_0x92b2[348]]=null}},{key:_0x92b2[629],value:function(t){t=t||this[_0x92b2[626]],t!=null&&(t[_0x92b2[630]]=this[_0x92b2[435]],t[_0x92b2[350]]=this[_0x92b2[621]]/100)}},{key:_0x92b2[349],get:function(){return this[_0x92b2[435]]},set:function(t){this[_0x92b2[435]]=t||!1,this._updateAudioElement()}},{key:_0x92b2[350],get:function(){return this[_0x92b2[621]]},set:function(t){this[_0x92b2[621]]=Math[_0x92b2[632]](Math[_0x92b2[631]](t),100),this._updateAudioElement()}},{key:_0x92b2[351],get:function(){return this[_0x92b2[620]]},set:function(t){if(this[_0x92b2[620]]===t)return;this[_0x92b2[620]]=t,this[_0x92b2[348]](t)}}]),e}();t[_0x92b2[4]]=a},function(e,t,n){function p(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function d(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}function v(e,t){if(!e)throw new ReferenceError(_0x92b2[633]);return!t||typeof t!==_0x92b2[10]&&typeof t!==_0x92b2[71]?e:t}function m(e,t){if(typeof t!==_0x92b2[71]&&t!==null)throw new TypeError(_0x92b2[634]+typeof t);e[_0x92b2[15]]=Object[_0x92b2[433]](t&&t[_0x92b2[15]],{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object[_0x92b2[635]]?Object[_0x92b2[635]](e,t):e[_0x92b2[636]]=t)}function g(e){if(Array[_0x92b2[327]](e)){for(var t=0,n=Array(e[_0x92b2[48]]);t<e[_0x92b2[48]];t++)n[t]=e[t];return n}return Array[_0x92b2[637]](e)}_0x92b2[0];var r=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(1),s=p(i),o=n(49),u=n(50),a=p(u),f=n(45),l=p(f),c=n(51),h=p(c),y=l[_0x92b2[4]][_0x92b2[433]](_0x92b2[638]),b=undefined;s[_0x92b2[4]][_0x92b2[260]]===_0x92b2[119]?b={offerToReceiveAudio:!0,offerToReceiveVideo:!1}:b={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1},optional:[{VoiceActivityDetection:!0}]};var w=function(e){function t(e,n,r,i){d(this,t);var s=v(this,Object[_0x92b2[639]](t)[_0x92b2[5]](this));return s[_0x92b2[397]]=null,s[_0x92b2[640]]=r,s[_0x92b2[641]]=i,s[_0x92b2[642]]=e,s[_0x92b2[643]]=n,s[_0x92b2[644]]=new a[_0x92b2[4]].OrderedMap,s[_0x92b2[645]]=new a[_0x92b2[4]].Map,s[_0x92b2[393]]=!1,s[_0x92b2[646]]=!1,s[_0x92b2[647]]=null,s[_0x92b2[627]]=null,s[_0x92b2[648]]=null,s[_0x92b2[649]]=!1,s[_0x92b2[650]]=[],s}return m(t,e),r(t,[{key:_0x92b2[382],value:function(){var t=this,n=arguments[_0x92b2[48]]<=0||arguments[0]===undefined?null:arguments[0];if(this[_0x92b2[397]]!=null)return;var r=new RTCPeerConnection(n,{optional:[{DtlsSrtpKeyAgreement:!0}]});r[_0x92b2[651]]=this[_0x92b2[652]][_0x92b2[502]](this),r[_0x92b2[653]]=this[_0x92b2[654]][_0x92b2[502]](this),r[_0x92b2[655]]=this[_0x92b2[656]][_0x92b2[502]](this),r[_0x92b2[657]]=this[_0x92b2[658]][_0x92b2[502]](this),r[_0x92b2[659]]=this[_0x92b2[660]][_0x92b2[502]](this),r[_0x92b2[661]]=this[_0x92b2[662]][_0x92b2[502]](this),this[_0x92b2[397]]=r,this[_0x92b2[355]]&&r[_0x92b2[663]](this[_0x92b2[355]]),this._createLocalOffer(function(e,n){t[_0x92b2[664]]=[_0x92b2[665],e,n]}),this[_0x92b2[666]]=setTimeout(this[_0x92b2[667]][_0x92b2[502]](this),5e3)}},{key:_0x92b2[383],value:function(){clearTimeout(this._iceGatheringTimeout);if(this[_0x92b2[397]]!=null){var t=this[_0x92b2[397]];this[_0x92b2[396]]!==_0x92b2[379]&&t[_0x92b2[383]](),t[_0x92b2[651]]=null,t[_0x92b2[653]]=null,t[_0x92b2[655]]=null,t[_0x92b2[657]]=null,t[_0x92b2[659]]=null,t[_0x92b2[661]]=null,this[_0x92b2[397]]=null}this[_0x92b2[422]]()}},{key:_0x92b2[360],value:function(t,n){this[_0x92b2[644]][_0x92b2[481]](n)||(this[_0x92b2[644]]=this[_0x92b2[644]][_0x92b2[312]](n,t));var r=this[_0x92b2[645]][_0x92b2[312]](t,n);r!==this[_0x92b2[645]]&&(this[_0x92b2[645]]=r,this._fakeRemoteOffer())}},{key:_0x92b2[361],value:function(t){var n=this[_0x92b2[645]][_0x92b2[314]](t);n!==this[_0x92b2[645]]&&(this[_0x92b2[645]]=n,this._fakeRemoteOffer())}},{key:_0x92b2[362],value:function(t){var n=this,r=new a[_0x92b2[4]].Map;t[_0x92b2[406]](function(e){var t=e[_0x92b2[642]],i=e[_0x92b2[643]];i!=n[_0x92b2[643]]&&(n[_0x92b2[644]][_0x92b2[481]](i)||(n[_0x92b2[644]]=n[_0x92b2[644]][_0x92b2[312]](i,t)),r=r[_0x92b2[312]](t,i))}),r[_0x92b2[668]](this[_0x92b2[645]])||(this[_0x92b2[645]]=r,this._fakeRemoteOffer())}},{key:_0x92b2[669],value:function(t){if(this[_0x92b2[394]]===_0x92b2[379]){y[_0x92b2[434]](_0x92b2[670]);return}this[_0x92b2[649]]?(y[_0x92b2[434]](_0x92b2[671]),this[_0x92b2[650]][_0x92b2[199]](t)):this[_0x92b2[384]]==null?(y[_0x92b2[434]](_0x92b2[672]),this[_0x92b2[650]][_0x92b2[199]](t)):this[_0x92b2[396]]!==_0x92b2[673]?(y[_0x92b2[434]](_0x92b2[674],this[_0x92b2[396]]),this[_0x92b2[650]][_0x92b2[199]](t)):(this[_0x92b2[649]]=!0,t())}},{key:_0x92b2[675],value:function(t){var n=this,r=this[_0x92b2[355]]!=null?h[_0x92b2[4]][_0x92b2[676]]:h[_0x92b2[4]][_0x92b2[677]],i=this[_0x92b2[384]]!=null?this._getRemoteStreams():[];this[_0x92b2[397]][_0x92b2[681]](function(e){n[_0x92b2[647]]=120,n[_0x92b2[397]][_0x92b2[680]](h[_0x92b2[4]][_0x92b2[678]](e,n[_0x92b2[642]],n[_0x92b2[643]]),function(){y[_0x92b2[434]](_0x92b2[679]),t&&t(r,i)},function(e){throw e})},function(e){throw e},b)}},{key:_0x92b2[682],value:function(t){var n=this;this[_0x92b2[397]][_0x92b2[684]](function(e){n[_0x92b2[397]][_0x92b2[680]](e,function(){y[_0x92b2[434]](_0x92b2[683]),t&&t()},function(e){throw e})},function(e){throw e},b)}},{key:_0x92b2[685],value:function(t,n,r,i){this[_0x92b2[397]][_0x92b2[688]](h[_0x92b2[4]][_0x92b2[686]](t,this[_0x92b2[647]],this[_0x92b2[384]],n,r),function(){y[_0x92b2[434]](_0x92b2[687]),i&&i()},function(e){throw e})}},{key:_0x92b2[689],value:function(){var t=this,n=this._getRemoteStreams();if(n[_0x92b2[48]]===0)return;if(!this[_0x92b2[373]])return;this._safeExecute(function(){t._updateRemoteDescription(_0x92b2[380],t[_0x92b2[355]]!=null?h[_0x92b2[4]][_0x92b2[676]]:h[_0x92b2[4]][_0x92b2[677]],n,function(){t._createLocalAnswer()})})}},{key:_0x92b2[690],value:function(){var t=this;return this[_0x92b2[644]][_0x92b2[406]](function(e,n){return[n,e,t[_0x92b2[645]][_0x92b2[310]](e)===n]})[_0x92b2[691]]()}},{key:_0x92b2[654],value:function(){var t=this;y[_0x92b2[434]](_0x92b2[393]),this._safeExecute(function(){t._createLocalOffer(function(e,n){t._updateRemoteDescription(_0x92b2[665],e,n)})})}},{key:_0x92b2[656],value:function(){var t=this[_0x92b2[397]][_0x92b2[394]];y[_0x92b2[434]](_0x92b2[692],t),t===_0x92b2[693]?(t=_0x92b2[373],this._fakeRemoteOffer()):t===_0x92b2[373]&&this._fakeRemoteOffer(),this[_0x92b2[423]](t)}},{key:_0x92b2[658],value:function(){y[_0x92b2[434]](_0x92b2[694],this[_0x92b2[397]][_0x92b2[396]]);if(this[_0x92b2[397]][_0x92b2[396]]===_0x92b2[673]){this[_0x92b2[649]]=!1;var t=this[_0x92b2[650]][_0x92b2[533]]();t!=null&&(y[_0x92b2[434]](_0x92b2[695]),this._safeExecute(t))}}},{key:_0x92b2[660],value:function(t){/^default/[_0x92b2[32]](t[_0x92b2[355]][_0x92b2[385]])||this[_0x92b2[423]](_0x92b2[370],t[_0x92b2[355]][_0x92b2[385]][_0x92b2[38]](_0x92b2[280])[0],t[_0x92b2[355]])}},{key:_0x92b2[662],value:function(t){/^default/[_0x92b2[32]](t[_0x92b2[355]][_0x92b2[385]])||this[_0x92b2[423]](_0x92b2[372],t[_0x92b2[355]][_0x92b2[385]][_0x92b2[38]](_0x92b2[280])[0],t[_0x92b2[355]])}},{key:_0x92b2[667],value:function(){this[_0x92b2[397]][_0x92b2[395]]!==_0x92b2[696]&&(y[_0x92b2[596]](_0x92b2[697]),this._handleIceCandidate({candidate:null}))}},{key:_0x92b2[652],value:function(t){y[_0x92b2[434]](_0x92b2[698],t[_0x92b2[699]]),t[_0x92b2[699]]==null&&this[_0x92b2[648]]==null&&(y[_0x92b2[434]](_0x92b2[700]),clearTimeout(this._iceGatheringTimeout),this[_0x92b2[423]](_0x92b2[380],h[_0x92b2[4]][_0x92b2[702]](this[_0x92b2[397]][_0x92b2[398]][_0x92b2[701]])))}},{key:_0x92b2[395],get:function(){return this[_0x92b2[397]]&&this[_0x92b2[397]][_0x92b2[395]]}},{key:_0x92b2[394],get:function(){return this[_0x92b2[397]]&&this[_0x92b2[397]][_0x92b2[394]]}},{key:_0x92b2[396],get:function(){try{return this[_0x92b2[397]]&&this[_0x92b2[397]][_0x92b2[396]]}catch(t){return _0x92b2[379]}}},{key:_0x92b2[373],get:function(){return this[_0x92b2[397]]!=null&&/connected|completed/[_0x92b2[32]](this[_0x92b2[397]][_0x92b2[394]])}},{key:_0x92b2[355],get:function(){return this[_0x92b2[627]]},set:function(t){var n=this[_0x92b2[397]]==null||this[_0x92b2[396]]===_0x92b2[379];this[_0x92b2[627]]!=null&&!n&&this[_0x92b2[397]][_0x92b2[703]](this._stream),this[_0x92b2[627]]=t,t!=null&&!n&&this[_0x92b2[397]][_0x92b2[663]](t)}},{key:_0x92b2[384],get:function(){return this[_0x92b2[648]]},set:function(t){this[_0x92b2[648]]=t;var n=this[_0x92b2[664]];delete this[_0x92b2[664]],this[_0x92b2[685]][_0x92b2[413]](this,g(n))}}]),t}(o.EventEmitter);t[_0x92b2[4]]=w},function(e,t){function n(e){return e&&typeof Symbol!==_0x92b2[6]&&e[_0x92b2[7]]===Symbol?_0x92b2[8]:typeof e}function r(){this[_0x92b2[704]]=this[_0x92b2[704]]||{},this[_0x92b2[705]]=this[_0x92b2[705]]||undefined}function i(e){return typeof e===_0x92b2[71]}function s(e){return typeof e===_0x92b2[49]}function o(e){return(typeof e===_0x92b2[6]?_0x92b2[6]:n(e))===_0x92b2[10]&&e!==null}function u(e){return e===void 0}_0x92b2[0],e[_0x92b2[296]]=r,r[_0x92b2[706]]=r,r[_0x92b2[15]][_0x92b2[704]]=undefined,r[_0x92b2[15]][_0x92b2[705]]=undefined,r[_0x92b2[707]]=10,r[_0x92b2[15]][_0x92b2[708]]=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError(_0x92b2[709]);return this[_0x92b2[705]]=e,this},r[_0x92b2[15]][_0x92b2[423]]=function(e){var t,n,r,s,a,f;this[_0x92b2[704]]||(this[_0x92b2[704]]={});if(e===_0x92b2[456])if(!this[_0x92b2[704]][_0x92b2[456]]||o(this[_0x92b2[704]][_0x92b2[456]])&&!this[_0x92b2[704]][_0x92b2[456]][_0x92b2[48]])throw t=arguments[1],t instanceof Error?t:TypeError(_0x92b2[710]);n=this[_0x92b2[704]][e];if(u(n))return!1;if(i(n))switch(arguments[_0x92b2[48]]){case 1:n[_0x92b2[5]](this);break;case 2:n[_0x92b2[5]](this,arguments[1]);break;case 3:n[_0x92b2[5]](this,arguments[1],arguments[2]);break;default:s=Array[_0x92b2[15]][_0x92b2[20]][_0x92b2[5]](arguments,1),n[_0x92b2[413]](this,s)}else if(o(n)){s=Array[_0x92b2[15]][_0x92b2[20]][_0x92b2[5]](arguments,1),f=n[_0x92b2[20]](),r=f[_0x92b2[48]];for(a=0;a<r;a++)f[a][_0x92b2[413]](this,s)}return!0},r[_0x92b2[15]][_0x92b2[419]]=function(e,t){var n;if(!i(t))throw TypeError(_0x92b2[711]);return this[_0x92b2[704]]||(this[_0x92b2[704]]={}),this[_0x92b2[704]][_0x92b2[712]]&&this[_0x92b2[423]](_0x92b2[712],e,i(t[_0x92b2[713]])?t[_0x92b2[713]]:t),this[_0x92b2[704]][e]?o(this[_0x92b2[704]][e])?this[_0x92b2[704]][e][_0x92b2[199]](t):this[_0x92b2[704]][e]=[this[_0x92b2[704]][e],t]:this[_0x92b2[704]][e]=t,o(this[_0x92b2[704]][e])&&!this[_0x92b2[704]][e][_0x92b2[714]]&&(u(this._maxListeners)?n=r[_0x92b2[707]]:n=this[_0x92b2[705]],n&&n>0&&this[_0x92b2[704]][e][_0x92b2[48]]>n&&(this[_0x92b2[704]][e][_0x92b2[714]]=!0,console[_0x92b2[456]](_0x92b2[715]+_0x92b2[716]+_0x92b2[717],this[_0x92b2[704]][e][_0x92b2[48]]),typeof console[_0x92b2[597]]===_0x92b2[71]&&console[_0x92b2[597]]())),this},r[_0x92b2[15]][_0x92b2[371]]=r[_0x92b2[15]][_0x92b2[419]],r[_0x92b2[15]][_0x92b2[375]]=function(e,t){function r(){this[_0x92b2[421]](e,r),n||(n=!0,t[_0x92b2[413]](this,arguments))}if(!i(t))throw TypeError(_0x92b2[711]);var n=!1;return r[_0x92b2[713]]=t,this[_0x92b2[371]](e,r),this},r[_0x92b2[15]][_0x92b2[421]]=function(e,t){var n,r,s,u;if(!i(t))throw TypeError(_0x92b2[711]);if(!this[_0x92b2[704]]||!this[_0x92b2[704]][e])return this;n=this[_0x92b2[704]][e],s=n[_0x92b2[48]],r=-1;if(n===t||i(n[_0x92b2[713]])&&n[_0x92b2[713]]===t)delete this[_0x92b2[704]][e],this[_0x92b2[704]][_0x92b2[421]]&&this[_0x92b2[423]](_0x92b2[421],e,t);else if(o(n)){for(u=s;u-->0;)if(n[u]===t||n[u][_0x92b2[713]]&&n[u][_0x92b2[713]]===t){r=u;break}if(r<0)return this;n[_0x92b2[48]]===1?(n[_0x92b2[48]]=0,delete this[_0x92b2[704]][e]):n[_0x92b2[588]](r,1),this[_0x92b2[704]][_0x92b2[421]]&&this[_0x92b2[423]](_0x92b2[421],e,t)}return this},r[_0x92b2[15]][_0x92b2[422]]=function(e){var t,n;if(!this[_0x92b2[704]])return this;if(!this[_0x92b2[704]][_0x92b2[421]])return arguments[_0x92b2[48]]===0?this[_0x92b2[704]]={}:this[_0x92b2[704]][e]&&delete this[_0x92b2[704]][e],this;if(arguments[_0x92b2[48]]===0){for(t in this[_0x92b2[704]]){if(t===_0x92b2[421])continue;this[_0x92b2[422]](t)}return this[_0x92b2[422]](_0x92b2[421]),this[_0x92b2[704]]={},this}n=this[_0x92b2[704]][e];if(i(n))this[_0x92b2[421]](e,n);else if(n)while(n[_0x92b2[48]])this[_0x92b2[421]](e,n[n[_0x92b2[48]]-1]);return delete this[_0x92b2[704]][e],this},r[_0x92b2[15]][_0x92b2[718]]=function(e){var t;return!this[_0x92b2[704]]||!this[_0x92b2[704]][e]?t=[]:i(this[_0x92b2[704]][e])?t=[this[_0x92b2[704]][e]]:t=this[_0x92b2[704]][e][_0x92b2[20]](),t},r[_0x92b2[15]][_0x92b2[719]]=function(e){if(this[_0x92b2[704]]){var t=this[_0x92b2[704]][e];if(i(t))return 1;if(t)return t[_0x92b2[48]]}return 0},r[_0x92b2[719]]=function(e,t){return e[_0x92b2[719]](t)}},function(e,t,n){function s(e){return e&&typeof Symbol!==_0x92b2[6]&&e[_0x92b2[7]]===Symbol?_0x92b2[8]:typeof e}var r,i;_0x92b2[0],function(o,u){s(t)===_0x92b2[10]&&typeof e!==_0x92b2[6]?e[_0x92b2[296]]=u():(r=u,i=typeof r===_0x92b2[71]?r[_0x92b2[5]](t,n,t,e):r,i===undefined||!(e[_0x92b2[296]]=i))}(undefined,function(){function t(e,t){t&&(e[_0x92b2[15]]=Object[_0x92b2[433]](t[_0x92b2[15]])),e[_0x92b2[15]][_0x92b2[7]]=e}function l(e){return e[_0x92b2[303]]=!1,e}function c(e){e&&(e[_0x92b2[303]]=!0)}function h(){}function p(e,t){t=t||0;var n=Math[_0x92b2[529]](0,e[_0x92b2[48]]-t),r=new Array(n);for(var i=0;i<n;i++)r[i]=e[i+t];return r}function d(e){return e[_0x92b2[721]]===undefined&&(e[_0x92b2[721]]=e.__iterate(m)),e[_0x92b2[721]]}function v(e,t){if(typeof t!==_0x92b2[49]){var n=+t;if(_0x92b2[41]+n!==t)return NaN;t=n}return t<0?d(e)+t:t}function m(){return!0}function g(e,t,n){return(e===0||n!==undefined&&e<=-n)&&(t===undefined||n!==undefined&&t>=n)}function y(e,t){return w(e,t,0)}function b(e,t){return w(e,t,t)}function w(e,t,n){return e===undefined?n:e<0?Math[_0x92b2[529]](0,t+e):t===undefined?e:Math[_0x92b2[632]](t,e)}function E(e){return N(e)?e:J(e)}function S(e){return C(e)?e:K(e)}function x(e){return k(e)?e:Q(e)}function T(e){return N(e)&&!L(e)?e:G(e)}function N(e){return!!e&&!!e[O]}function C(e){return!!e&&!!e[M]}function k(e){return!!e&&!!e[_]}function L(e){return C(e)||k(e)}function A(e){return!!e&&!!e[D]}function q(e){this[_0x92b2[344]]=e}function R(e,t,n,r){var i=e===0?t:e===1?n:[t,n];return r?r[_0x92b2[303]]=i:r={value:i,done:!1},r}function U(){return{value:undefined,done:!0}}function z(e){return!!V(e)}function W(e){return e&&typeof e[_0x92b2[344]]===_0x92b2[71]}function X(e){var t=V(e);return t&&t[_0x92b2[5]](e)}function V(e){var t=e&&(j&&e[j]||e[F]);if(typeof t===_0x92b2[71])return t}function $(e){return e&&typeof e[_0x92b2[48]]===_0x92b2[49]}function J(e){return e===null||e===undefined?st():N(e)?e[_0x92b2[741]]():at(e)}function K(e){return e===null||e===undefined?st()[_0x92b2[751]]():N(e)?C(e)?e[_0x92b2[741]]():e[_0x92b2[752]]():ot(e)}function Q(e){return e===null||e===undefined?st():N(e)?C(e)?e[_0x92b2[748]]():e[_0x92b2[753]]():ut(e)}function G(e){return(e===null||e===undefined?st():N(e)?C(e)?e[_0x92b2[748]]():e:ut(e))[_0x92b2[755]]()}function Z(e){this[_0x92b2[758]]=e,this[_0x92b2[721]]=e[_0x92b2[48]]}function et(e){var t=Object[_0x92b2[342]](e);this[_0x92b2[760]]=e,this[_0x92b2[761]]=t,this[_0x92b2[721]]=t[_0x92b2[48]]}function tt(e){this[_0x92b2[762]]=e,this[_0x92b2[721]]=e[_0x92b2[48]]||e[_0x92b2[721]]}function nt(e){this[_0x92b2[764]]=e,this[_0x92b2[765]]=[]}function rt(e){return!!e&&!!e[Y]}function st(){return it||(it=new Z([]))}function ot(e){var t=Array[_0x92b2[327]](e)?(new Z(e))[_0x92b2[752]]():W(e)?(new nt(e))[_0x92b2[752]]():z(e)?(new tt(e))[_0x92b2[752]]():(typeof e===_0x92b2[6]?_0x92b2[6]:s(e))===_0x92b2[10]?new et(e):undefined;if(!t)throw new TypeError(_0x92b2[766]+_0x92b2[767]+e);return t}function ut(e){var t=ft(e);if(!t)throw new TypeError(_0x92b2[768]+e);return t}function at(e){var t=ft(e)||(typeof e===_0x92b2[6]?_0x92b2[6]:s(e))===_0x92b2[10]&&new et(e);if(!t)throw new TypeError(_0x92b2[769]+e);return t}function ft(e){return $(e)?new Z(e):W(e)?new nt(e):z(e)?new tt(e):undefined}function lt(e,t,n,r){var i=e[_0x92b2[746]];if(i){var s=i[_0x92b2[48]]-1;for(var o=0;o<=s;o++){var u=i[n?s-o:o];if(t(u[1],r?u[0]:o,e)===!1)return o+1}return o}return e.__iterateUncached(t,n)}function ct(e,t,n,r){var i=e[_0x92b2[746]];if(i){var s=i[_0x92b2[48]]-1,o=0;return new q(function(){var e=i[n?s-o:o];return o++>s?U():R(t,r?e[0]:o-1,e[1])})}return e.__iteratorUncached(t,n)}function ht(){throw TypeError(_0x92b2[770])}function pt(){}function dt(){}function vt(){}function mt(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e[_0x92b2[771]]===_0x92b2[71]&&typeof t[_0x92b2[771]]===_0x92b2[71]){e=e.valueOf(),t=t.valueOf();if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return typeof e[_0x92b2[668]]===_0x92b2[71]&&typeof t[_0x92b2[668]]===_0x92b2[71]&&e[_0x92b2[668]](t)?!0:!1}function gt(e,t){return t?yt(t,e,_0x92b2[41],{"":e}):bt(e)}function yt(e,t,n,r){return Array[_0x92b2[327]](t)?e[_0x92b2[5]](r,n,Q(t)[_0x92b2[406]](function(n,r){return yt(e,n,r,t)})):wt(t)?e[_0x92b2[5]](r,n,K(t)[_0x92b2[406]](function(n,r){return yt(e,n,r,t)})):t}function bt(e){return Array[_0x92b2[327]](e)?Q(e)[_0x92b2[406]](bt)[_0x92b2[772]]():wt(e)?K(e)[_0x92b2[406]](bt)[_0x92b2[773]]():e}function wt(e){return e&&(e[_0x92b2[7]]===Object||e[_0x92b2[7]]===undefined)}function St(e){return e>>>1&1073741824|e&3221225471}function xt(e){if(e===!1||e===null||e===undefined)return 0;if(typeof e[_0x92b2[771]]===_0x92b2[71]){e=e.valueOf();if(e===!1||e===null||e===undefined)return 0}if(e===!0)return 1;var t=typeof e===_0x92b2[6]?_0x92b2[6]:s(e);if(t===_0x92b2[49]){var n=e|0;n!==e&&(n^=e*4294967295);while(e>4294967295)e/=4294967295,n^=e;return St(n)}return t===_0x92b2[444]?e[_0x92b2[48]]>Pt?Tt(e):Nt(e):typeof e[_0x92b2[775]]===_0x92b2[71]?e[_0x92b2[775]]():Ct(e)}function Tt(e){var t=jt[e];return t===undefined&&(t=Nt(e),Bt===Ht&&(Bt=0,jt={}),Bt++,jt[e]=t),t}function Nt(e){var t=0;for(var n=0;n<e[_0x92b2[48]];n++)t=31*t+e[_0x92b2[776]](n)|0;return St(t)}function Ct(e){var t;if(Ot){t=Mt[_0x92b2[310]](e);if(t!==undefined)return t}t=e[Dt];if(t!==undefined)return t;if(!Lt){t=e[_0x92b2[777]]&&e[_0x92b2[777]][Dt];if(t!==undefined)return t;t=At(e);if(t!==undefined)return t}t=++_t,_t&1073741824&&(_t=0);if(Ot)Mt[_0x92b2[312]](e,t);else{if(kt!==undefined&&kt(e)===!1)throw new Error(_0x92b2[778]);if(Lt)Object[_0x92b2[306]](e,Dt,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e[_0x92b2[777]]!==undefined&&e[_0x92b2[777]]===e[_0x92b2[7]][_0x92b2[15]][_0x92b2[777]])e[_0x92b2[777]]=function(){return this[_0x92b2[7]][_0x92b2[15]][_0x92b2[777]][_0x92b2[413]](this,arguments)},e[_0x92b2[777]][Dt]=t;else{if(e[_0x92b2[9]]===undefined)throw new Error(_0x92b2[779]);e[Dt]=t}}return t}function At(e){if(e&&e[_0x92b2[9]]>0)switch(e[_0x92b2[9]]){case 1:return e[_0x92b2[782]];case 9:return e[_0x92b2[783]]&&e[_0x92b2[783]][_0x92b2[782]]}}function Ft(e,t){if(!e)throw new Error(t)}function It(e){Ft(e!==Infinity,_0x92b2[785])}function qt(e,t){this[_0x92b2[786]]=e,this[_0x92b2[787]]=t,this[_0x92b2[721]]=e[_0x92b2[721]]}function Rt(e){this[_0x92b2[786]]=e,this[_0x92b2[721]]=e[_0x92b2[721]]}function Ut(e){this[_0x92b2[786]]=e,this[_0x92b2[721]]=e[_0x92b2[721]]}function zt(e){this[_0x92b2[786]]=e,this[_0x92b2[721]]=e[_0x92b2[721]]}function Wt(e){var t=hn(e);return t[_0x92b2[786]]=e,t[_0x92b2[721]]=e[_0x92b2[721]],t[_0x92b2[791]]=function(){return e},t[_0x92b2[789]]=function(){var t=e[_0x92b2[789]][_0x92b2[413]](this);return t[_0x92b2[791]]=function(){return e[_0x92b2[789]]()},t},t[_0x92b2[759]]=function(t){return e[_0x92b2[790]](t)},t[_0x92b2[790]]=function(t){return e[_0x92b2[759]](t)},t[_0x92b2[745]]=pn,t[_0x92b2[747]]=function(t,n){var r=this;return e.__iterate(function(e,n){return t(n,e,r)!==!1},n)},t[_0x92b2[763]]=function(t,n){if(t===B){var r=e.__iterator(t,n);return new q(function(){var e=r[_0x92b2[344]]();if(!e[_0x92b2[343]]){var t=e[_0x92b2[303]][0];e[_0x92b2[303]][0]=e[_0x92b2[303]][1],e[_0x92b2[303]][1]=t}return e})}return e.__iterator(t===H?P:H,n)},t}function Xt(e,t,n){var r=hn(e);return r[_0x92b2[721]]=e[_0x92b2[721]],r[_0x92b2[759]]=function(t){return e[_0x92b2[759]](t)},r[_0x92b2[310]]=function(r,i){var s=e[_0x92b2[310]](r,u);return s===u?i:t[_0x92b2[5]](n,s,r,e)},r[_0x92b2[747]]=function(r,i){var s=this;return e.__iterate(function(e,i,o){return r(t[_0x92b2[5]](n,e,i,o),i,s)!==!1},i)},r[_0x92b2[763]]=function(r,i){var s=e.__iterator(B,i);return new q(function(){var i=s[_0x92b2[344]]();if(i[_0x92b2[343]])return i;var o=i[_0x92b2[303]],u=o[0];return R(r,u,t[_0x92b2[5]](n,o[1],u,e),i)})},r}function Vt(e,t){var n=hn(e);return n[_0x92b2[786]]=e,n[_0x92b2[721]]=e[_0x92b2[721]],n[_0x92b2[789]]=function(){return e},e[_0x92b2[791]]&&(n[_0x92b2[791]]=function(){var t=Wt(e);return t[_0x92b2[789]]=function(){return e[_0x92b2[791]]()},t}),n[_0x92b2[310]]=function(n,r){return e[_0x92b2[310]](t?n:-1-n,r)},n[_0x92b2[759]]=function(n){return e[_0x92b2[759]](t?n:-1-n)},n[_0x92b2[790]]=function(t){return e[_0x92b2[790]](t)},n[_0x92b2[745]]=pn,n[_0x92b2[749]]=function(t,n){var r=this;return e.__iterate(function(e,n){return t(e,n,r)},!n)},n[_0x92b2[750]]=function(t,n){return e.__iterator(t,!n)},n}function $t(e,t,n,r){var i=hn(e);return r&&(i[_0x92b2[759]]=function(r){var i=e[_0x92b2[310]](r,u);return i!==u&&!!t[_0x92b2[5]](n,i,r,e)},i[_0x92b2[310]]=function(r,i){var s=e[_0x92b2[310]](r,u);return s!==u&&t[_0x92b2[5]](n,s,r,e)?s:i}),i[_0x92b2[747]]=function(i,s){var o=this,u=0;return e.__iterate(function(e,s,a){if(t[_0x92b2[5]](n,e,s,a))return u++,i(e,r?s:u-1,o)},s),u},i[_0x92b2[763]]=function(i,s){var o=e.__iterator(B,s),u=0;return new q(function(){for(;;){var s=o[_0x92b2[344]]();if(s[_0x92b2[343]])return s;var a=s[_0x92b2[303]],f=a[0],l=a[1];if(t[_0x92b2[5]](n,l,f,e))return R(i,r?f:u++,l,s)}})},i}function Jt(e,t,n){var r=mn()[_0x92b2[792]]();return e.__iterate(function(i,s){r[_0x92b2[606]](t[_0x92b2[5]](n,i,s,e),0,function(e){return e+1})}),r[_0x92b2[793]]()}function Kt(e,t,n){var r=C(e),i=(A(e)?hr():mn())[_0x92b2[792]]();e.__iterate(function(s,o){i[_0x92b2[606]](t[_0x92b2[5]](n,s,o,e),function(e){return e=e||[],e[_0x92b2[199]](r?[o,s]:s),e})});var s=cn(e);return i[_0x92b2[406]](function(t){return an(e,s(t))})}function Qt(e,t,n,r){var i=e[_0x92b2[721]];t!==undefined&&(t|=0),n!==undefined&&(n|=0);if(g(t,n,i))return e;var s=y(t,i),o=b(n,i);if(s!==s||o!==o)return Qt(e[_0x92b2[741]]()[_0x92b2[745]](),t,n,r);var u=o-s,a;u===u&&(a=u<0?0:u);var f=hn(e);return f[_0x92b2[721]]=a===0?a:e[_0x92b2[721]]&&a||undefined,!r&&rt(e)&&a>=0&&(f[_0x92b2[310]]=function(t,n){return t=v(this,t),t>=0&&t<a?e[_0x92b2[310]](t+s,n):n}),f[_0x92b2[747]]=function(t,n){var i=this;if(a===0)return 0;if(n)return this[_0x92b2[745]]().__iterate(t,n);var o=0,u=!0,f=0;return e.__iterate(function(e,n){if(!u||!(u=o++<s))return f++,t(e,r?n:f-1,i)!==!1&&f!==a}),f},f[_0x92b2[763]]=function(t,n){if(a!==0&&n)return this[_0x92b2[745]]().__iterator(t,n);var i=a!==0&&e.__iterator(t,n),o=0,u=0;return new q(function(){while(o++<s)i[_0x92b2[344]]();if(++u>a)return U();var e=i[_0x92b2[344]]();return r||t===H?e:t===P?R(t,u-1,undefined,e):R(t,u-1,e[_0x92b2[303]][1],e)})},f}function Gt(e,t,n){var r=hn(e);return r[_0x92b2[747]]=function(r,i){var s=this;if(i)return this[_0x92b2[745]]().__iterate(r,i);var o=0;return e.__iterate(function(e,i,u){return t[_0x92b2[5]](n,e,i,u)&&++o&&r(e,i,s)}),o},r[_0x92b2[763]]=function(r,i){var s=this;if(i)return this[_0x92b2[745]]().__iterator(r,i);var o=e.__iterator(B,i),u=!0;return new q(function(){if(!u)return U();var e=o[_0x92b2[344]]();if(e[_0x92b2[343]])return e;var i=e[_0x92b2[303]],a=i[0],f=i[1];return t[_0x92b2[5]](n,f,a,s)?r===B?e:R(r,a,f,e):(u=!1,U())})},r}function Yt(e,t,n,r){var i=hn(e);return i[_0x92b2[747]]=function(i,s){var o=this;if(s)return this[_0x92b2[745]]().__iterate(i,s);var u=!0,a=0;return e.__iterate(function(e,s,f){if(!u||!(u=t[_0x92b2[5]](n,e,s,f)))return a++,i(e,r?s:a-1,o)}),a},i[_0x92b2[763]]=function(i,s){var o=this;if(s)return this[_0x92b2[745]]().__iterator(i,s);var u=e.__iterator(B,s),a=!0,f=0;return new q(function(){var e,s,l;do{e=u[_0x92b2[344]]();if(e[_0x92b2[343]])return r||i===H?e:i===P?R(i,f++,undefined,e):R(i,f++,e[_0x92b2[303]][1],e);var c=e[_0x92b2[303]];s=c[0],l=c[1],a&&(a=t[_0x92b2[5]](n,l,s,o))}while(a);return i===B?e:R(i,s,l,e)})},i}function Zt(e,t){var n=C(e),r=[e][_0x92b2[409]](t)[_0x92b2[406]](function(e){return N(e)?n&&(e=S(e)):e=n?ot(e):ut(Array[_0x92b2[327]](e)?e:[e]),e})[_0x92b2[463]](function(e){return e[_0x92b2[721]]!==0});if(r[_0x92b2[48]]===0)return e;if(r[_0x92b2[48]]===1){var i=r[0];if(i===e||n&&C(i)||k(e)&&k(i))return i}var s=new Z(r);return n?s=s[_0x92b2[751]]():k(e)||(s=s[_0x92b2[755]]()),s=s[_0x92b2[794]](!0),s[_0x92b2[721]]=r[_0x92b2[795]](function(e,t){if(e!==undefined){var n=t[_0x92b2[721]];if(n!==undefined)return e+n}},0),s}function en(e,t,n){var r=hn(e);return r[_0x92b2[747]]=function(r,i){function u(e,a){var f=this;e.__iterate(function(e,i){return(!t||a<t)&&N(e)?u(e,a+1):r(e,n?i:s++,f)===!1&&(o=!0),!o},i)}var s=0,o=!1;return u(e,0),s},r[_0x92b2[763]]=function(r,i){var s=e.__iterator(r,i),o=[],u=0;return new q(function(){while(s){var e=s[_0x92b2[344]]();if(e[_0x92b2[343]]!==!1){s=o[_0x92b2[796]]();continue}var a=e[_0x92b2[303]];r===B&&(a=a[1]);if(!(!t||o[_0x92b2[48]]<t)||!N(a))return n?e:R(r,u++,a,e);o[_0x92b2[199]](s),s=a.__iterator(r,i)}return U()})},r}function tn(e,t,n){var r=cn(e);return e[_0x92b2[741]]()[_0x92b2[406]](function(i,s){return r(t[_0x92b2[5]](n,i,s,e))})[_0x92b2[794]](!0)}function nn(e,t){var n=hn(e);return n[_0x92b2[721]]=e[_0x92b2[721]]&&e[_0x92b2[721]]*2-1,n[_0x92b2[747]]=function(n,r){var i=this,s=0;return e.__iterate(function(e,r){return(!s||n(t,s++,i)!==!1)&&n(e,s++,i)!==!1},r),s},n[_0x92b2[763]]=function(n,r){var i=e.__iterator(H,r),s=0,o;return new q(function(){if(!o||s%2){o=i[_0x92b2[344]]();if(o[_0x92b2[343]])return o}return s%2?R(n,s++,t):R(n,s++,o[_0x92b2[303]],o)})},n}function rn(e,t,n){t||(t=dn);var r=C(e),i=0,s=e[_0x92b2[741]]()[_0x92b2[406]](function(t,r){return[r,t,i++,n?n(t,r,e):t]})[_0x92b2[691]]();return s[_0x92b2[589]](function(e,n){return t(e[3],n[3])||e[2]-n[2]})[_0x92b2[402]](r?function(e,t){s[t][_0x92b2[48]]=2}:function(e,t){s[t]=e[1]}),r?K(s):k(e)?Q(s):G(s)}function sn(e,t,n){t||(t=dn);if(n){var r=e[_0x92b2[741]]()[_0x92b2[406]](function(t,r){return[t,n(t,r,e)]})[_0x92b2[795]](function(e,n){return on(t,e[1],n[1])?n:e});return r&&r[0]}return e[_0x92b2[795]](function(e,n){return on(t,e,n)?n:e})}function on(e,t,n){var r=e(n,t);return r===0&&n!==t&&(n===undefined||n===null||n!==n)||r>0}function un(e,t,n){var r=hn(e);return r[_0x92b2[721]]=(new Z(n))[_0x92b2[406]](function(e){return e[_0x92b2[721]]})[_0x92b2[632]](),r[_0x92b2[749]]=function(e,t){var n=this.__iterator(H,t),r,i=0;while(!(r=n[_0x92b2[344]]())[_0x92b2[343]])if(e(r[_0x92b2[303]],i++,this)===!1)break;return i},r[_0x92b2[763]]=function(e,r){var i=n[_0x92b2[406]](function(e){return e=E(e),X(r?e[_0x92b2[789]]():e)}),s=0,o=!1;return new q(function(){var n;return o||(n=i[_0x92b2[406]](function(e){return e[_0x92b2[344]]()}),o=n[_0x92b2[443]](function(e){return e[_0x92b2[343]]})),o?U():R(e,s++,t[_0x92b2[413]](null,n[_0x92b2[406]](function(e){return e[_0x92b2[303]]})))})},r}function an(e,t){return rt(e)?t:e[_0x92b2[7]](t)}function fn(e){if(e!==Object(e))throw new TypeError(_0x92b2[797]+e)}function ln(e){return It(e[_0x92b2[721]]),d(e)}function cn(e){return C(e)?S:k(e)?x:T}function hn(e){return Object[_0x92b2[433]]((C(e)?K:k(e)?Q:G)[_0x92b2[15]])}function pn(){return this[_0x92b2[786]][_0x92b2[745]]?(this[_0x92b2[786]][_0x92b2[745]](),this[_0x92b2[721]]=this[_0x92b2[786]][_0x92b2[721]],this):J[_0x92b2[15]][_0x92b2[745]][_0x92b2[5]](this)}function dn(e,t){return e>t?1:e<t?-1:0}function vn(e){var t=X(e);if(!t){if(!$(e))throw new TypeError(_0x92b2[798]+e);t=X(E(e))}return t}function mn(e){return e===null||e===undefined?On():gn(e)&&!A(e)?e:On()[_0x92b2[799]](function(t){var n=S(e);It(n[_0x92b2[721]]),n[_0x92b2[402]](function(e,n){return t[_0x92b2[312]](n,e)})})}function gn(e){return!!e&&!!e[yn]}function wn(e,t){this[_0x92b2[821]]=e,this[_0x92b2[822]]=t}function En(e,t,n){this[_0x92b2[821]]=e,this[_0x92b2[823]]=t,this[_0x92b2[824]]=n}function Sn(e,t,n){this[_0x92b2[821]]=e,this[_0x92b2[825]]=t,this[_0x92b2[824]]=n}function xn(e,t,n){this[_0x92b2[821]]=e,this[_0x92b2[826]]=t,this[_0x92b2[822]]=n}function Tn(e,t,n){this[_0x92b2[821]]=e,this[_0x92b2[826]]=t,this[_0x92b2[827]]=n}function Nn(e,t,n){this[_0x92b2[828]]=t,this[_0x92b2[829]]=n,this[_0x92b2[830]]=e[_0x92b2[801]]&&kn(e._root)}function Cn(e,t){return R(e,t[0],t[1])}function kn(e,t){return{node:e,index:0,__prev:t}}function Ln(e,t,n,r){var i=Object[_0x92b2[433]](bn);return i[_0x92b2[721]]=e,i[_0x92b2[801]]=t,i[_0x92b2[805]]=n,i[_0x92b2[806]]=r,i[_0x92b2[807]]=!1,i}function On(){return An||(An=Ln(0))}function Mn(e,t,n){var r,i;if(!e[_0x92b2[801]]){if(n===u)return e;i=1,r=new wn(e.__ownerID,[[t,n]])}else{var s=l(a),o=l(f);r=_n(e._root,e.__ownerID,0,undefined,t,n,s,o);if(!o[_0x92b2[303]])return e;i=e[_0x92b2[721]]+(s[_0x92b2[303]]?n===u?-1:1:0)}return e[_0x92b2[805]]?(e[_0x92b2[721]]=i,e[_0x92b2[801]]=r,e[_0x92b2[806]]=undefined,e[_0x92b2[807]]=!0,e):r?Ln(i,r):On()}function _n(e,t,n,r,i,s,o,a){return e?e[_0x92b2[606]](t,n,r,i,s,o,a):s===u?e:(c(a),c(o),new Tn(t,r,[i,s]))}function Dn(e){return e[_0x92b2[7]]===Tn||e[_0x92b2[7]]===xn}function Pn(e,t,n,i,s){if(e[_0x92b2[826]]===i)return new xn(t,i,[e[_0x92b2[827]],s]);var u=(n===0?e[_0x92b2[826]]:e[_0x92b2[826]]>>>n)&o,a=(n===0?i:i>>>n)&o,f,l=u===a?[Pn(e,t,n+r,i,s)]:(f=new Tn(t,i,s),u<a?[e,f]:[f,e]);return new En(t,1<<u|1<<a,l)}function Hn(e,t,n,r){e||(e=new h);var i=new Tn(e,xt(n),[n,r]);for(var s=0;s<t[_0x92b2[48]];s++){var o=t[s];i=i[_0x92b2[606]](e,0,undefined,o[0],o[1])}return i}function Bn(e,t,n,r){var i=0,s=0,o=new Array(n);for(var u=0,a=1,f=t[_0x92b2[48]];u<f;u++,a<<=1){var l=t[u];l!==undefined&&u!==r&&(i|=a,o[s++]=l)}return new En(e,i,o)}function jn(e,t,n,r,s){var o=0,u=new Array(i);for(var a=0;n!==0;a++,n>>>=1)u[a]=n&1?t[o++]:undefined;return u[r]=s,new Sn(e,o+1,u)}function Fn(e,t,n){var r=[];for(var i=0;i<n[_0x92b2[48]];i++){var s=n[i],o=S(s);N(s)||(o=o[_0x92b2[406]](function(e){return gt(e)})),r[_0x92b2[199]](o)}return qn(e,t,r)}function In(e){return function(t,n,r){return t&&t[_0x92b2[812]]&&N(n)?t[_0x92b2[812]](e,n):e?e(t,n,r):n}}function qn(e,t,n){return n=n[_0x92b2[463]](function(e){return e[_0x92b2[721]]!==0}),n[_0x92b2[48]]===0?e:e[_0x92b2[721]]===0&&!e[_0x92b2[805]]&&n[_0x92b2[48]]===1?e[_0x92b2[7]](n[0]):e[_0x92b2[799]](function(e){var r=t?function(n,r){e[_0x92b2[606]](r,u,function(e){return e===u?n:t(e,n,r)})}:function(t,n){e[_0x92b2[312]](n,t)};for(var i=0;i<n[_0x92b2[48]];i++)n[i][_0x92b2[402]](r)})}function Rn(e,t,n,r){var i=e===u,s=t[_0x92b2[344]]();if(s[_0x92b2[343]]){var o=i?n:e,a=r(o);return a===o?e:a}Ft(i||e&&e[_0x92b2[312]],_0x92b2[834]);var f=s[_0x92b2[303]],l=i?u:e[_0x92b2[310]](f,u),c=Rn(l,t,n,r);return c===l?e:c===u?e[_0x92b2[314]](f):(i?On():e)[_0x92b2[312]](f,c)}function Un(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function zn(e,t,n,r){var i=r?e:p(e);return i[t]=n,i}function Wn(e,t,n,r){var i=e[_0x92b2[48]]+1;if(r&&t+1===i)return e[t]=n,e;var s=new Array(i),o=0;for(var u=0;u<i;u++)u===t?(s[u]=n,o=-1):s[u]=e[u+o];return s}function Xn(e,t,n){var r=e[_0x92b2[48]]-1;if(n&&t===r)return e[_0x92b2[796]](),e;var i=new Array(r),s=0;for(var o=0;o<r;o++)o===t&&(s=1),i[o]=e[o+s];return i}function Kn(e){var t=ir();if(e===null||e===undefined)return t;if(Qn(e))return e;var n=x(e),s=n[_0x92b2[721]];return s===0?t:(It(s),s>0&&s<i?nr(0,s,r,null,new Zn(n[_0x92b2[691]]())):t[_0x92b2[799]](function(e){e[_0x92b2[835]](s),n[_0x92b2[402]](function(t,n){return e[_0x92b2[312]](n,t)})}))}function Qn(e){return!!e&&!!e[Gn]}function Zn(e,t){this[_0x92b2[412]]=e,this[_0x92b2[821]]=t}function tr(e,t){function a(e,t,n){return t===0?f(e,n):l(e,t,n)}function f(e,r){var a=r===o?u&&u[_0x92b2[412]]:e&&e[_0x92b2[412]],f=r>n?0:n-r,l=s-r;return l>i&&(l=i),function(){if(f===l)return er;var e=t?--l:f++;return a&&a[e]}}function l(e,o,u){var f,l=e&&e[_0x92b2[412]],c=u>n?0:n-u>>o,h=(s-u>>o)+1;return h>i&&(h=i),function(){do{if(f){var e=f();if(e!==er)return e;f=null}if(c===h)return er;var n=t?--h:c++;f=a(l&&l[n],o-r,u+(n<<o))}while(!0)}}var n=e[_0x92b2[837]],s=e[_0x92b2[838]],o=cr(s),u=e[_0x92b2[840]];return a(e._root,e._level,0)}function nr(e,t,n,r,i,s,o){var u=Object[_0x92b2[433]](Yn);return u[_0x92b2[721]]=t-e,u[_0x92b2[837]]=e,u[_0x92b2[838]]=t,u[_0x92b2[839]]=n,u[_0x92b2[801]]=r,u[_0x92b2[840]]=i,u[_0x92b2[805]]=s,u[_0x92b2[806]]=o,u[_0x92b2[807]]=!1,u}function ir(){return rr||(rr=nr(0,0,r))}function sr(e,t,n){t=v(e,t);if(t!==t)return e;if(t>=e[_0x92b2[721]]||t<0)return e[_0x92b2[799]](function(e){t<0?fr(e,t)[_0x92b2[312]](0,n):fr(e,0,t+1)[_0x92b2[312]](t,n)});t+=e[_0x92b2[837]];var r=e[_0x92b2[840]],i=e[_0x92b2[801]],s=l(f);return t>=cr(e._capacity)?r=or(r,e.__ownerID,0,t,n,s):i=or(i,e.__ownerID,e._level,t,n,s),s[_0x92b2[303]]?e[_0x92b2[805]]?(e[_0x92b2[801]]=i,e[_0x92b2[840]]=r,e[_0x92b2[806]]=undefined,e[_0x92b2[807]]=!0,e):nr(e._origin,e._capacity,e._level,i,r):e}function or(e,t,n,i,s,u){var a=i>>>n&o,f=e&&a<e[_0x92b2[412]][_0x92b2[48]];if(!f&&s===undefined)return e;var l;if(n>0){var h=e&&e[_0x92b2[412]][a],p=or(h,t,n-r,i,s,u);return p===h?e:(l=ur(e,t),l[_0x92b2[412]][a]=p,l)}return f&&e[_0x92b2[412]][a]===s?e:(c(u),l=ur(e,t),s===undefined&&a===l[_0x92b2[412]][_0x92b2[48]]-1?l[_0x92b2[412]][_0x92b2[796]]():l[_0x92b2[412]][a]=s,l)}function ur(e,t){return t&&e&&t===e[_0x92b2[821]]?e:new Zn(e?e[_0x92b2[412]][_0x92b2[20]]():[],t)}function ar(e,t){if(t>=cr(e._capacity))return e[_0x92b2[840]];if(t<1<<e[_0x92b2[839]]+r){var n=e[_0x92b2[801]],i=e[_0x92b2[839]];while(n&&i>0)n=n[_0x92b2[412]][t>>>i&o],i-=r;return n}}function fr(e,t,n){t!==undefined&&(t|=0),n!==undefined&&(n|=0);var i=e[_0x92b2[805]]||new h,s=e[_0x92b2[837]],u=e[_0x92b2[838]],a=s+t,f=n===undefined?u:n<0?u+n:s+n;if(a===s&&f===u)return e;if(a>=f)return e[_0x92b2[315]]();var l=e[_0x92b2[839]],c=e[_0x92b2[801]],p=0;while(a+p<0)c=new Zn(c&&c[_0x92b2[412]][_0x92b2[48]]?[undefined,c]:[],i),l+=r,p+=1<<l;p&&(a+=p,s+=p,f+=p,u+=p);var d=cr(u),v=cr(f);while(v>=1<<l+r)c=new Zn(c&&c[_0x92b2[412]][_0x92b2[48]]?[c]:[],i),l+=r;var m=e[_0x92b2[840]],g=v<d?ar(e,f-1):v>d?new Zn([],i):m;if(m&&v>d&&a<u&&m[_0x92b2[412]][_0x92b2[48]]){c=ur(c,i);var y=c;for(var b=l;b>r;b-=r){var w=d>>>b&o;y=y[_0x92b2[412]][w]=ur(y[_0x92b2[412]][w],i)}y[_0x92b2[412]][d>>>r&o]=m}f<u&&(g=g&&g[_0x92b2[844]](i,0,f));if(a>=v)a-=v,f-=v,l=r,c=null,g=g&&g[_0x92b2[843]](i,0,a);else if(a>s||v<d){p=0;while(c){var E=a>>>l&o;if(E!==v>>>l&o)break;E&&(p+=(1<<l)*E),l-=r,c=c[_0x92b2[412]][E]}c&&a>s&&(c=c[_0x92b2[843]](i,l,a-p)),c&&v<d&&(c=c[_0x92b2[844]](i,l,v-p)),p&&(a-=p,f-=p)}return e[_0x92b2[805]]?(e[_0x92b2[721]]=f-a,e[_0x92b2[837]]=a,e[_0x92b2[838]]=f,e[_0x92b2[839]]=l,e[_0x92b2[801]]=c,e[_0x92b2[840]]=g,e[_0x92b2[806]]=undefined,e[_0x92b2[807]]=!0,e):nr(a,f,l,c,g)}function lr(e,t,n){var r=[],i=0;for(var s=0;s<n[_0x92b2[48]];s++){var o=n[s],u=x(o);u[_0x92b2[721]]>i&&(i=u[_0x92b2[721]]),N(o)||(u=u[_0x92b2[406]](function(e){return gt(e)})),r[_0x92b2[199]](u)}return i>e[_0x92b2[721]]&&(e=e[_0x92b2[835]](i)),qn(e,t,r)}function cr(e){return e<i?0:e-1>>>r<<r}function hr(e){return e===null||e===undefined?mr():pr(e)?e:mr()[_0x92b2[799]](function(t){var n=S(e);It(n[_0x92b2[721]]),n[_0x92b2[402]](function(e,n){return t[_0x92b2[312]](n,e)})})}function pr(e){return gn(e)&&A(e)}function dr(e,t,n,r){var i=Object[_0x92b2[433]](hr[_0x92b2[15]]);return i[_0x92b2[721]]=e?e[_0x92b2[721]]:0,i[_0x92b2[846]]=e,i[_0x92b2[847]]=t,i[_0x92b2[805]]=n,i[_0x92b2[806]]=r,i}function mr(){return vr||(vr=dr(On(),ir()))}function gr(e,t,n){var r=e[_0x92b2[846]],s=e[_0x92b2[847]],o=r[_0x92b2[310]](t),a=o!==undefined,f,l;if(n===u){if(!a)return e;s[_0x92b2[721]]>=i&&s[_0x92b2[721]]>=r[_0x92b2[721]]*2?(l=s[_0x92b2[463]](function(e,t){return e!==undefined&&o!==t}),f=l[_0x92b2[751]]()[_0x92b2[406]](function(e){return e[0]})[_0x92b2[791]]()[_0x92b2[773]](),e[_0x92b2[805]]&&(f[_0x92b2[805]]=l[_0x92b2[805]]=e[_0x92b2[805]])):(f=r[_0x92b2[314]](t),l=o===s[_0x92b2[721]]-1?s[_0x92b2[796]]():s[_0x92b2[312]](o,undefined))}else if(a){if(n===s[_0x92b2[310]](o)[1])return e;f=r,l=s[_0x92b2[312]](o,[t,n])}else f=r[_0x92b2[312]](t,s[_0x92b2[721]]),l=s[_0x92b2[312]](s[_0x92b2[721]],[t,n]);return e[_0x92b2[805]]?(e[_0x92b2[721]]=f[_0x92b2[721]],e[_0x92b2[846]]=f,e[_0x92b2[847]]=l,e[_0x92b2[806]]=undefined,e):dr(f,l)}function yr(e){return e===null||e===undefined?Tr():br(e)?e:Tr()[_0x92b2[849]](e)}function br(e){return!!e&&!!e[wr]}function Sr(e,t,n,r){var i=Object[_0x92b2[433]](Er);return i[_0x92b2[721]]=e,i[_0x92b2[851]]=t,i[_0x92b2[805]]=n,i[_0x92b2[806]]=r,i[_0x92b2[807]]=!1,i}function Tr(){return xr||(xr=Sr(0))}function Nr(e){return e===null||e===undefined?_r():Cr(e)&&!A(e)?e:_r()[_0x92b2[799]](function(t){var n=T(e);It(n[_0x92b2[721]]),n[_0x92b2[402]](function(e){return t[_0x92b2[856]](e)})})}function Cr(e){return!!e&&!!e[kr]}function Ar(e,t){return e[_0x92b2[805]]?(e[_0x92b2[721]]=t[_0x92b2[721]],e[_0x92b2[846]]=t,e):t===e[_0x92b2[846]]?e:t[_0x92b2[721]]===0?e.__empty():e.__make(t)}function Or(e,t){var n=Object[_0x92b2[433]](Lr);return n[_0x92b2[721]]=e?e[_0x92b2[721]]:0,n[_0x92b2[846]]=e,n[_0x92b2[805]]=t,n}function _r(){return Mr||(Mr=Or(On()))}function Dr(e){return e===null||e===undefined?Fr():Pr(e)?e:Fr()[_0x92b2[799]](function(t){var n=T(e);It(n[_0x92b2[721]]),n[_0x92b2[402]](function(e){return t[_0x92b2[856]](e)})})}function Pr(e){return Cr(e)&&A(e)}function Br(e,t){var n=Object[_0x92b2[433]](Hr);return n[_0x92b2[721]]=e?e[_0x92b2[721]]:0,n[_0x92b2[846]]=e,n[_0x92b2[805]]=t,n}function Fr(){return jr||(jr=Br(mr()))}function Ir(e,t){var n,r=function(o){if(o instanceof r)return o;if(!(this instanceof r))return new r(o);if(!n){n=!0;var u=Object[_0x92b2[342]](e);zr(i,u),i[_0x92b2[721]]=u[_0x92b2[48]],i[_0x92b2[870]]=t,i[_0x92b2[761]]=u,i[_0x92b2[871]]=e}this[_0x92b2[846]]=mn(o)},i=r[_0x92b2[15]]=Object[_0x92b2[433]](qr);return i[_0x92b2[7]]=r,r}function Rr(e,t,n){var r=Object[_0x92b2[433]](Object[_0x92b2[639]](e));return r[_0x92b2[846]]=t,r[_0x92b2[805]]=n,r}function Ur(e){return e[_0x92b2[870]]||e[_0x92b2[7]][_0x92b2[260]]||_0x92b2[876]}function zr(e,t){try{t[_0x92b2[402]](Wr[_0x92b2[502]](undefined,e))}catch(n){}}function Wr(e,t){Object[_0x92b2[306]](e,t,{get:function(){return this[_0x92b2[310]](t)},set:function(n){Ft(this.__ownerID,_0x92b2[877]),this[_0x92b2[312]](t,n)}})}function Xr(e,t){if(e===t)return!0;if(!N(t)||e[_0x92b2[721]]!==undefined&&t[_0x92b2[721]]!==undefined&&e[_0x92b2[721]]!==t[_0x92b2[721]]||e[_0x92b2[806]]!==undefined&&t[_0x92b2[806]]!==undefined&&e[_0x92b2[806]]!==t[_0x92b2[806]]||C(e)!==C(t)||k(e)!==k(t)||A(e)!==A(t))return!1;if(e[_0x92b2[721]]===0&&t[_0x92b2[721]]===0)return!0;var n=!L(e);if(A(e)){var r=e[_0x92b2[822]]();return t[_0x92b2[862]](function(e,t){var i=r[_0x92b2[344]]()[_0x92b2[303]];return i&&mt(i[1],e)&&(n||mt(i[0],t))})&&r[_0x92b2[344]]()[_0x92b2[343]]}var i=!1;if(e[_0x92b2[721]]===undefined)if(t[_0x92b2[721]]===undefined)typeof e[_0x92b2[745]]===_0x92b2[71]&&e[_0x92b2[745]]();else{i=!0;var s=e;e=t,t=s}var o=!0,a=t.__iterate(function(t,r){if(n?!e[_0x92b2[759]](t):i?!mt(t,e[_0x92b2[310]](r,u)):!mt(e[_0x92b2[310]](r,u),t))return o=!1,!1});return o&&e[_0x92b2[721]]===a}function Vr(e,t,n){if(!(this instanceof Vr))return new Vr(e,t,n);Ft(n!==0,_0x92b2[878]),e=e||0,t===undefined&&(t=Infinity),n=n===undefined?1:Math[_0x92b2[879]](n),t<e&&(n=-n),this[_0x92b2[880]]=e,this[_0x92b2[881]]=t,this[_0x92b2[882]]=n,this[_0x92b2[721]]=Math[_0x92b2[529]](0,Math[_0x92b2[883]]((t-e)/n-1)+1);if(this[_0x92b2[721]]===0){if($r)return $r;$r=this}}function Jr(e,t){if(!(this instanceof Jr))return new Jr(e,t);this[_0x92b2[891]]=e,this[_0x92b2[721]]=t===undefined?Infinity:Math[_0x92b2[529]](0,t);if(this[_0x92b2[721]]===0){if(Kr)return Kr;Kr=this}}function Qr(e,t){var n=function(r){e[_0x92b2[15]][r]=t[r]};return Object[_0x92b2[342]](t)[_0x92b2[402]](n),Object[_0x92b2[895]]&&Object[_0x92b2[895]](t)[_0x92b2[402]](n),e}function Zr(e,t){return t}function ei(e,t){return[t,e]}function ti(e){return function(){return!e[_0x92b2[413]](this,arguments)}}function ni(e){return function(){return-e[_0x92b2[413]](this,arguments)}}function ri(e){return typeof e===_0x92b2[444]?JSON[_0x92b2[313]](e):e}function ii(){return p(arguments)}function si(e,t){return e<t?1:e>t?-1:0}function oi(e){if(e[_0x92b2[721]]===Infinity)return 0;var t=A(e),n=C(e),r=t?1:0,i=e.__iterate(n?t?function(e,t){r=31*r+ai(xt(e),xt(t))|0}:function(e,t){r=r+ai(xt(e),xt(t))|0}:t?function(e){r=31*r+xt(e)|0}:function(e){r=r+xt(e)|0});return ui(i,r)}function ui(e,t){return t=Et(t,3432918353),t=Et(t<<15|t>>>-15,461845907),t=Et(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=Et(t^t>>>16,2246822507),t=Et(t^t>>>13,3266489909),t=St(t^t>>>16),t}function ai(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}_0x92b2[0];var e=Array[_0x92b2[15]][_0x92b2[20]],n=_0x92b2[720],r=5,i=1<<r,o=i-1,u={},a={value:!1},f={value:!1};t(S,E),t(x,E),t(T,E),E[_0x92b2[722]]=N,E[_0x92b2[723]]=C,E[_0x92b2[724]]=k,E[_0x92b2[725]]=L,E[_0x92b2[726]]=A,E[_0x92b2[727]]=S,E[_0x92b2[728]]=x,E[_0x92b2[729]]=T;var O=_0x92b2[730],M=_0x92b2[731],_=_0x92b2[732],D=_0x92b2[733],P=0,H=1,B=2,j=typeof Symbol===_0x92b2[71]&&Symbol[_0x92b2[341]],F=_0x92b2[734],I=j||F;q[_0x92b2[15]][_0x92b2[17]]=function(){return _0x92b2[735]},q[_0x92b2[736]]=P,q[_0x92b2[737]]=H,q[_0x92b2[738]]=B,q[_0x92b2[15]][_0x92b2[739]]=q[_0x92b2[15]][_0x92b2[740]]=function(){return this.toString()},q[_0x92b2[15]][I]=function(){return this},t(J,E),J[_0x92b2[742]]=function(){return J(arguments)},J[_0x92b2[15]][_0x92b2[741]]=function(){return this},J[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[743],_0x92b2[744])},J[_0x92b2[15]][_0x92b2[745]]=function(){return!this[_0x92b2[746]]&&this[_0x92b2[747]]&&(this[_0x92b2[746]]=this[_0x92b2[748]]()[_0x92b2[691]](),this[_0x92b2[721]]=this[_0x92b2[746]][_0x92b2[48]]),this},J[_0x92b2[15]][_0x92b2[749]]=function(e,t){return lt(this,e,t,!0)},J[_0x92b2[15]][_0x92b2[750]]=function(e,t){return ct(this,e,t,!0)},t(K,J),K[_0x92b2[15]][_0x92b2[751]]=function(){return this},t(Q,J),Q[_0x92b2[742]]=function(){return Q(arguments)},Q[_0x92b2[15]][_0x92b2[753]]=function(){return this},Q[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[754],_0x92b2[571])},Q[_0x92b2[15]][_0x92b2[749]]=function(e,t){return lt(this,e,t,!1)},Q[_0x92b2[15]][_0x92b2[750]]=function(e,t){return ct(this,e,t,!1)},t(G,J),G[_0x92b2[742]]=function(){return G(arguments)},G[_0x92b2[15]][_0x92b2[755]]=function(){return this},J[_0x92b2[756]]=rt,J[_0x92b2[727]]=K,J[_0x92b2[729]]=G,J[_0x92b2[728]]=Q;var Y=_0x92b2[757];J[_0x92b2[15]][Y]=!0,t(Z,Q),Z[_0x92b2[15]][_0x92b2[310]]=function(e,t){return this[_0x92b2[759]](e)?this[_0x92b2[758]][v(this,e)]:t},Z[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this[_0x92b2[758]],r=n[_0x92b2[48]]-1;for(var i=0;i<=r;i++)if(e(n[t?r-i:i],i,this)===!1)return i+1;return i},Z[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this[_0x92b2[758]],r=n[_0x92b2[48]]-1,i=0;return new q(function(){return i>r?U():R(e,i,n[t?r-i++:i++])})},t(et,K),et[_0x92b2[15]][_0x92b2[310]]=function(e,t){return t!==undefined&&!this[_0x92b2[759]](e)?t:this[_0x92b2[760]][e]},et[_0x92b2[15]][_0x92b2[759]]=function(e){return this[_0x92b2[760]][_0x92b2[16]](e)},et[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this[_0x92b2[760]],r=this[_0x92b2[761]],i=r[_0x92b2[48]]-1;for(var s=0;s<=i;s++){var o=r[t?i-s:s];if(e(n[o],o,this)===!1)return s+1}return s},et[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this[_0x92b2[760]],r=this[_0x92b2[761]],i=r[_0x92b2[48]]-1,s=0;return new q(function(){var o=r[t?i-s:s];return s++>i?U():R(e,o,n[o])})},et[_0x92b2[15]][D]=!0,t(tt,Q),tt[_0x92b2[15]][_0x92b2[747]]=function(e,t){if(t)return this[_0x92b2[745]]().__iterate(e,t);var n=this[_0x92b2[762]],r=X(n),i=0;if(W(r)){var s;while(!(s=r[_0x92b2[344]]())[_0x92b2[343]])if(e(s[_0x92b2[303]],i++,this)===!1)break}return i},tt[_0x92b2[15]][_0x92b2[763]]=function(e,t){if(t)return this[_0x92b2[745]]().__iterator(e,t);var n=this[_0x92b2[762]],r=X(n);if(!W(r))return new q(U);var i=0;return new q(function(){var t=r[_0x92b2[344]]();return t[_0x92b2[343]]?t:R(e,i++,t[_0x92b2[303]])})},t(nt,Q),nt[_0x92b2[15]][_0x92b2[747]]=function(e,t){if(t)return this[_0x92b2[745]]().__iterate(e,t);var n=this[_0x92b2[764]],r=this[_0x92b2[765]],i=0;while(i<r[_0x92b2[48]])if(e(r[i],i++,this)===!1)return i;var s;while(!(s=n[_0x92b2[344]]())[_0x92b2[343]]){var o=s[_0x92b2[303]];r[i]=o;if(e(o,i++,this)===!1)break}return i},nt[_0x92b2[15]][_0x92b2[763]]=function(e,t){if(t)return this[_0x92b2[745]]().__iterator(e,t);var n=this[_0x92b2[764]],r=this[_0x92b2[765]],i=0;return new q(function(){if(i>=r[_0x92b2[48]]){var t=n[_0x92b2[344]]();if(t[_0x92b2[343]])return t;r[i]=t[_0x92b2[303]]}return R(e,i,r[i++])})};var it;t(ht,E),t(pt,ht),t(dt,ht),t(vt,ht),ht[_0x92b2[727]]=pt,ht[_0x92b2[728]]=dt,ht[_0x92b2[729]]=vt;var Et=typeof Math[_0x92b2[774]]===_0x92b2[71]&&Math[_0x92b2[774]](4294967295,2)===-2?Math[_0x92b2[774]]:function(t,n){t|=0,n|=0;var r=t&65535,i=n&65535;return r*i+((t>>>16)*i+r*(n>>>16)<<16>>>0)|0},kt=Object[_0x92b2[780]],Lt=function(){try{return Object[_0x92b2[306]]({},_0x92b2[781],{}),!0}catch(e){return!1}}(),Ot=typeof WeakMap===_0x92b2[71],Mt;Ot&&(Mt=new WeakMap);var _t=0,Dt=_0x92b2[784];typeof Symbol===_0x92b2[71]&&(Dt=Symbol(Dt));var Pt=16,Ht=255,Bt=0,jt={};t(qt,K),qt[_0x92b2[15]][_0x92b2[310]]=function(e,t){return this[_0x92b2[786]][_0x92b2[310]](e,t)},qt[_0x92b2[15]][_0x92b2[759]]=function(e){return this[_0x92b2[786]][_0x92b2[759]](e)},qt[_0x92b2[15]][_0x92b2[788]]=function(){return this[_0x92b2[786]][_0x92b2[788]]()},qt[_0x92b2[15]][_0x92b2[789]]=function(){var e=this,t=Vt(this,!0);return this[_0x92b2[787]]||(t[_0x92b2[788]]=function(){return e[_0x92b2[786]][_0x92b2[741]]()[_0x92b2[789]]()}),t},qt[_0x92b2[15]][_0x92b2[406]]=function(e,t){var n=this,r=Xt(this,e,t);return this[_0x92b2[787]]||(r[_0x92b2[788]]=function(){return n[_0x92b2[786]][_0x92b2[741]]()[_0x92b2[406]](e,t)}),r},qt[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this,r;return this[_0x92b2[786]].__iterate(this[_0x92b2[787]]?function(t,r){return e(t,r,n)}:(r=t?ln(this):0,function(i){return e(i,t?--r:r++,n)}),t)},qt[_0x92b2[15]][_0x92b2[750]]=function(e,t){if(this[_0x92b2[787]])return this[_0x92b2[786]].__iterator(e,t);var n=this[_0x92b2[786]].__iterator(H,t),r=t?ln(this):0;return new q(function(){var i=n[_0x92b2[344]]();return i[_0x92b2[343]]?i:R(e,t?--r:r++,i[_0x92b2[303]],i)})},qt[_0x92b2[15]][D]=!0,t(Rt,Q),Rt[_0x92b2[15]][_0x92b2[790]]=function(e){return this[_0x92b2[786]][_0x92b2[790]](e)},Rt[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this,r=0;return this[_0x92b2[786]].__iterate(function(t){return e(t,r++,n)},t)},Rt[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this[_0x92b2[786]].__iterator(H,t),r=0;return new q(function(){var t=n[_0x92b2[344]]();return t[_0x92b2[343]]?t:R(e,r++,t[_0x92b2[303]],t)})},t(Ut,G),Ut[_0x92b2[15]][_0x92b2[759]]=function(e){return this[_0x92b2[786]][_0x92b2[790]](e)},Ut[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this;return this[_0x92b2[786]].__iterate(function(t){return e(t,t,n)},t)},Ut[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this[_0x92b2[786]].__iterator(H,t);return new q(function(){var t=n[_0x92b2[344]]();return t[_0x92b2[343]]?t:R(e,t[_0x92b2[303]],t[_0x92b2[303]],t)})},t(zt,K),zt[_0x92b2[15]][_0x92b2[748]]=function(){return this[_0x92b2[786]][_0x92b2[741]]()},zt[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this;return this[_0x92b2[786]].__iterate(function(t){if(t){fn(t);var r=N(t);return e(r?t[_0x92b2[310]](1):t[1],r?t[_0x92b2[310]](0):t[0],n)}},t)},zt[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this[_0x92b2[786]].__iterator(H,t);return new q(function(){for(;;){var t=n[_0x92b2[344]]();if(t[_0x92b2[343]])return t;var r=t[_0x92b2[303]];if(r){fn(r);var i=N(r);return R(e,i?r[_0x92b2[310]](0):r[0],i?r[_0x92b2[310]](1):r[1],t)}}})},Rt[_0x92b2[15]][_0x92b2[745]]=qt[_0x92b2[15]][_0x92b2[745]]=Ut[_0x92b2[15]][_0x92b2[745]]=zt[_0x92b2[15]][_0x92b2[745]]=pn,t(mn,pt),mn[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[800],_0x92b2[744])},mn[_0x92b2[15]][_0x92b2[310]]=function(e,t){return this[_0x92b2[801]]?this[_0x92b2[801]][_0x92b2[310]](0,undefined,e,t):t},mn[_0x92b2[15]][_0x92b2[312]]=function(e,t){return Mn(this,e,t)},mn[_0x92b2[15]][_0x92b2[802]]=function(e,t){return this[_0x92b2[803]](e,u,function(){return t})},mn[_0x92b2[15]][_0x92b2[314]]=function(e){return Mn(this,e,u)},mn[_0x92b2[15]][_0x92b2[804]]=function(e){return this[_0x92b2[803]](e,function(){return u})},mn[_0x92b2[15]][_0x92b2[606]]=function(e,t,n){return arguments[_0x92b2[48]]===1?e(this):this[_0x92b2[803]]([e],t,n)},mn[_0x92b2[15]][_0x92b2[803]]=function(e,t,n){n||(n=t,t=undefined);var r=Rn(this,vn(e),t,n);return r===u?undefined:r},mn[_0x92b2[15]][_0x92b2[315]]=function(){return this[_0x92b2[721]]===0?this:this[_0x92b2[805]]?(this[_0x92b2[721]]=0,this[_0x92b2[801]]=null,this[_0x92b2[806]]=undefined,this[_0x92b2[807]]=!0,this):On()},mn[_0x92b2[15]][_0x92b2[808]]=function(){return Fn(this,undefined,arguments)},mn[_0x92b2[15]][_0x92b2[809]]=function(t){var n=e[_0x92b2[5]](arguments,1);return Fn(this,t,n)},mn[_0x92b2[15]][_0x92b2[810]]=function(t){var n=e[_0x92b2[5]](arguments,1);return this[_0x92b2[803]](t,On(),function(e){return typeof e[_0x92b2[808]]===_0x92b2[71]?e[_0x92b2[808]][_0x92b2[413]](e,n):n[n[_0x92b2[48]]-1]})},mn[_0x92b2[15]][_0x92b2[811]]=function(){return Fn(this,In(undefined),arguments)},mn[_0x92b2[15]][_0x92b2[812]]=function(t){var n=e[_0x92b2[5]](arguments,1);return Fn(this,In(t),n)},mn[_0x92b2[15]][_0x92b2[813]]=function(t){var n=e[_0x92b2[5]](arguments,1);return this[_0x92b2[803]](t,On(),function(e){return typeof e[_0x92b2[811]]===_0x92b2[71]?e[_0x92b2[811]][_0x92b2[413]](e,n):n[n[_0x92b2[48]]-1]})},mn[_0x92b2[15]][_0x92b2[589]]=function(e){return hr(rn(this,e))},mn[_0x92b2[15]][_0x92b2[814]]=function(e,t){return hr(rn(this,t,e))},mn[_0x92b2[15]][_0x92b2[799]]=function(e){var t=this[_0x92b2[792]]();return e(t),t[_0x92b2[815]]()?t.__ensureOwner(this.__ownerID):this},mn[_0x92b2[15]][_0x92b2[792]]=function(){return this[_0x92b2[805]]?this:this.__ensureOwner(new h)},mn[_0x92b2[15]][_0x92b2[793]]=function(){return this.__ensureOwner()},mn[_0x92b2[15]][_0x92b2[815]]=function(){return this[_0x92b2[807]]},mn[_0x92b2[15]][_0x92b2[750]]=function(e,t){return new Nn(this,e,t)},mn[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this,r=0;return this[_0x92b2[801]]&&this[_0x92b2[801]][_0x92b2[816]](function(t){return r++,e(t[1],t[0],n)},t),r},mn[_0x92b2[15]][_0x92b2[817]]=function(e){return e===this[_0x92b2[805]]?this:e?Ln(this[_0x92b2[721]],this._root,e,this.__hash):(this[_0x92b2[805]]=e,this[_0x92b2[807]]=!1,this)},mn[_0x92b2[818]]=gn;var yn=_0x92b2[819],bn=mn[_0x92b2[15]];bn[yn]=!0,bn[n]=bn[_0x92b2[314]],bn[_0x92b2[820]]=bn[_0x92b2[804]],wn[_0x92b2[15]][_0x92b2[310]]=function(e,t,n,r){var i=this[_0x92b2[822]];for(var s=0,o=i[_0x92b2[48]];s<o;s++)if(mt(n,i[s][0]))return i[s][1];return r},wn[_0x92b2[15]][_0x92b2[606]]=function(e,t,n,r,i,s,o){var a=i===u,f=this[_0x92b2[822]],l=0;for(var h=f[_0x92b2[48]];l<h;l++)if(mt(r,f[l][0]))break;var d=l<h;if(d?f[l][1]===i:a)return this;c(o),(a||!d)&&c(s);if(a&&f[_0x92b2[48]]===1)return;if(!d&&!a&&f[_0x92b2[48]]>=Vn)return Hn(e,f,r,i);var v=e&&e===this[_0x92b2[821]],m=v?f:p(f);return d?a?l===h-1?m[_0x92b2[796]]():m[l]=m[_0x92b2[796]]():m[l]=[r,i]:m[_0x92b2[199]]([r,i]),v?(this[_0x92b2[822]]=m,this):new wn(e,m)},En[_0x92b2[15]][_0x92b2[310]]=function(e,t,n,i){t===undefined&&(t=xt(n));var s=1<<((e===0?t:t>>>e)&o),u=this[_0x92b2[823]];return(u&s)===0?i:this[_0x92b2[824]][Un(u&s-1)][_0x92b2[310]](e+r,t,n,i)},En[_0x92b2[15]][_0x92b2[606]]=function(e,t,n,i,s,a,f){n===undefined&&(n=xt(i));var l=(t===0?n:n>>>t)&o,c=1<<l,h=this[_0x92b2[823]],p=(h&c)!==0;if(!p&&s===u)return this;var d=Un(h&c-1),v=this[_0x92b2[824]],m=p?v[d]:undefined,g=_n(m,e,t+r,n,i,s,a,f);if(g===m)return this;if(!p&&g&&v[_0x92b2[48]]>=$n)return jn(e,v,h,l,g);if(p&&!g&&v[_0x92b2[48]]===2&&Dn(v[d^1]))return v[d^1];if(p&&g&&v[_0x92b2[48]]===1&&Dn(g))return g;var y=e&&e===this[_0x92b2[821]],b=p?g?h:h^c:h|c,w=p?g?zn(v,d,g,y):Xn(v,d,y):Wn(v,d,g,y);return y?(this[_0x92b2[823]]=b,this[_0x92b2[824]]=w,this):new En(e,b,w)},Sn[_0x92b2[15]][_0x92b2[310]]=function(e,t,n,i){t===undefined&&(t=xt(n));var s=(e===0?t:t>>>e)&o,u=this[_0x92b2[824]][s];return u?u[_0x92b2[310]](e+r,t,n,i):i},Sn[_0x92b2[15]][_0x92b2[606]]=function(e,t,n,i,s,a,f){n===undefined&&(n=xt(i));var l=(t===0?n:n>>>t)&o,c=s===u,h=this[_0x92b2[824]],p=h[l];if(c&&!p)return this;var d=_n(p,e,t+r,n,i,s,a,f);if(d===p)return this;var v=this[_0x92b2[825]];if(!p)v++;else if(!d){v--;if(v<Jn)return Bn(e,h,v,l)}var m=e&&e===this[_0x92b2[821]],g=zn(h,l,d,m);return m?(this[_0x92b2[825]]=v,this[_0x92b2[824]]=g,this):new Sn(e,v,g)},xn[_0x92b2[15]][_0x92b2[310]]=function(e,t,n,r){var i=this[_0x92b2[822]];for(var s=0,o=i[_0x92b2[48]];s<o;s++)if(mt(n,i[s][0]))return i[s][1];return r},xn[_0x92b2[15]][_0x92b2[606]]=function(e,t,n,r,i,s,o){n===undefined&&(n=xt(r));var a=i===u;if(n!==this[_0x92b2[826]])return a?this:(c(o),c(s),Pn(this,e,t,n,[r,i]));var f=this[_0x92b2[822]],l=0;for(var h=f[_0x92b2[48]];l<h;l++)if(mt(r,f[l][0]))break;var d=l<h;if(d?f[l][1]===i:a)return this;c(o),(a||!d)&&c(s);if(a&&h===2)return new Tn(e,this[_0x92b2[826]],f[l^1]);var v=e&&e===this[_0x92b2[821]],m=v?f:p(f);return d?a?l===h-1?m[_0x92b2[796]]():m[l]=m[_0x92b2[796]]():m[l]=[r,i]:m[_0x92b2[199]]([r,i]),v?(this[_0x92b2[822]]=m,this):new xn(e,this[_0x92b2[826]],m)},Tn[_0x92b2[15]][_0x92b2[310]]=function(e,t,n,r){return mt(n,this[_0x92b2[827]][0])?this[_0x92b2[827]][1]:r},Tn[_0x92b2[15]][_0x92b2[606]]=function(e,t,n,r,i,s,o){var a=i===u,f=mt(r,this[_0x92b2[827]][0]);if(f?i===this[_0x92b2[827]][1]:a)return this;c(o);if(a){c(s);return}return f?e&&e===this[_0x92b2[821]]?(this[_0x92b2[827]][1]=i,this):new Tn(e,this[_0x92b2[826]],[r,i]):(c(s),Pn(this,e,t,xt(r),[r,i]))},wn[_0x92b2[15]][_0x92b2[816]]=xn[_0x92b2[15]][_0x92b2[816]]=function(e,t){var n=this[_0x92b2[822]];for(var r=0,i=n[_0x92b2[48]]-1;r<=i;r++)if(e(n[t?i-r:r])===!1)return!1},En[_0x92b2[15]][_0x92b2[816]]=Sn[_0x92b2[15]][_0x92b2[816]]=function(e,t){var n=this[_0x92b2[824]];for(var r=0,i=n[_0x92b2[48]]-1;r<=i;r++){var s=n[t?i-r:r];if(s&&s[_0x92b2[816]](e,t)===!1)return!1}},Tn[_0x92b2[15]][_0x92b2[816]]=function(e,t){return e(this[_0x92b2[827]])},t(Nn,q),Nn[_0x92b2[15]][_0x92b2[344]]=function(){var e=this[_0x92b2[828]],t=this[_0x92b2[830]];while(t){var n=t[_0x92b2[831]],r=t[_0x92b2[832]]++,i;if(n[_0x92b2[827]]){if(r===0)return Cn(e,n[_0x92b2[827]])}else if(n[_0x92b2[822]]){i=n[_0x92b2[822]][_0x92b2[48]]-1;if(r<=i)return Cn(e,n[_0x92b2[822]][this[_0x92b2[829]]?i-r:r])}else{i=n[_0x92b2[824]][_0x92b2[48]]-1;if(r<=i){var s=n[_0x92b2[824]][this[_0x92b2[829]]?i-r:r];if(s){if(s[_0x92b2[827]])return Cn(e,s[_0x92b2[827]]);t=this[_0x92b2[830]]=kn(s,t)}continue}}t=this[_0x92b2[830]]=this[_0x92b2[830]][_0x92b2[833]]}return U()};var An,Vn=i/4,$n=i/2,Jn=i/4;t(Kn,dt),Kn[_0x92b2[742]]=function(){return this(arguments)},Kn[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[836],_0x92b2[571])},Kn[_0x92b2[15]][_0x92b2[310]]=function(e,t){e=v(this,e);if(e>=0&&e<this[_0x92b2[721]]){e+=this[_0x92b2[837]];var n=ar(this,e);return n&&n[_0x92b2[412]][e&o]}return t},Kn[_0x92b2[15]][_0x92b2[312]]=function(e,t){return sr(this,e,t)},Kn[_0x92b2[15]][_0x92b2[314]]=function(e){return this[_0x92b2[759]](e)?e===0?this[_0x92b2[533]]():e===this[_0x92b2[721]]-1?this[_0x92b2[796]]():this[_0x92b2[588]](e,1):this},Kn[_0x92b2[15]][_0x92b2[315]]=function(){return this[_0x92b2[721]]===0?this:this[_0x92b2[805]]?(this[_0x92b2[721]]=this[_0x92b2[837]]=this[_0x92b2[838]]=0,this[_0x92b2[839]]=r,this[_0x92b2[801]]=this[_0x92b2[840]]=null,this[_0x92b2[806]]=undefined,this[_0x92b2[807]]=!0,this):ir()},Kn[_0x92b2[15]][_0x92b2[199]]=function(){var e=arguments,t=this[_0x92b2[721]];return this[_0x92b2[799]](function(n){fr(n,0,t+e[_0x92b2[48]]);for(var r=0;r<e[_0x92b2[48]];r++)n[_0x92b2[312]](t+r,e[r])})},Kn[_0x92b2[15]][_0x92b2[796]]=function(){return fr(this,0,-1)},Kn[_0x92b2[15]][_0x92b2[213]]=function(){var e=arguments;return this[_0x92b2[799]](function(t){fr(t,-e[_0x92b2[48]]);for(var n=0;n<e[_0x92b2[48]];n++)t[_0x92b2[312]](n,e[n])})},Kn[_0x92b2[15]][_0x92b2[533]]=function(){return fr(this,1)},Kn[_0x92b2[15]][_0x92b2[808]]=function(){return lr(this,undefined,arguments)},Kn[_0x92b2[15]][_0x92b2[809]]=function(t){var n=e[_0x92b2[5]](arguments,1);return lr(this,t,n)},Kn[_0x92b2[15]][_0x92b2[811]]=function(){return lr(this,In(undefined),arguments)},Kn[_0x92b2[15]][_0x92b2[812]]=function(t){var n=e[_0x92b2[5]](arguments,1);return lr(this,In(t),n)},Kn[_0x92b2[15]][_0x92b2[835]]=function(e){return fr(this,0,e)},Kn[_0x92b2[15]][_0x92b2[20]]=function(e,t){var n=this[_0x92b2[721]];return g(e,t,n)?this:fr(this,y(e,n),b(t,n))},Kn[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=0,r=tr(this,t);return new q(function(){var t=r();return t===er?U():R(e,n++,t)})},Kn[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=0,r=tr(this,t),i;while((i=r())!==er)if(e(i,n++,this)===!1)break;return n},Kn[_0x92b2[15]][_0x92b2[817]]=function(e){return e===this[_0x92b2[805]]?this:e?nr(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this[_0x92b2[805]]=e,this)},Kn[_0x92b2[841]]=Qn;var Gn=_0x92b2[842],Yn=Kn[_0x92b2[15]];Yn[Gn]=!0,Yn[n]=Yn[_0x92b2[314]],Yn[_0x92b2[802]]=bn[_0x92b2[802]],Yn[_0x92b2[804]]=Yn[_0x92b2[820]]=bn[_0x92b2[820]],Yn[_0x92b2[606]]=bn[_0x92b2[606]],Yn[_0x92b2[803]]=bn[_0x92b2[803]],Yn[_0x92b2[810]]=bn[_0x92b2[810]],Yn[_0x92b2[813]]=bn[_0x92b2[813]],Yn[_0x92b2[799]]=bn[_0x92b2[799]],Yn[_0x92b2[792]]=bn[_0x92b2[792]],Yn[_0x92b2[793]]=bn[_0x92b2[793]],Yn[_0x92b2[815]]=bn[_0x92b2[815]],Zn[_0x92b2[15]][_0x92b2[843]]=function(e,t,n){if(n===t?1<<t:this[_0x92b2[412]][_0x92b2[48]]===0)return this;var i=n>>>t&o;if(i>=this[_0x92b2[412]][_0x92b2[48]])return new Zn([],e);var s=i===0,u;if(t>0){var a=this[_0x92b2[412]][i];u=a&&a[_0x92b2[843]](e,t-r,n);if(u===a&&s)return this}if(s&&!u)return this;var f=ur(this,e);if(!s)for(var l=0;l<i;l++)f[_0x92b2[412]][l]=undefined;return u&&(f[_0x92b2[412]][i]=u),f},Zn[_0x92b2[15]][_0x92b2[844]]=function(e,t,n){if(n===(t?1<<t:0)||this[_0x92b2[412]][_0x92b2[48]]===0)return this;var i=n-1>>>t&o;if(i>=this[_0x92b2[412]][_0x92b2[48]])return this;var s;if(t>0){var u=this[_0x92b2[412]][i];s=u&&u[_0x92b2[844]](e,t-r,n);if(s===u&&i===this[_0x92b2[412]][_0x92b2[48]]-1)return this}var a=ur(this,e);return a[_0x92b2[412]][_0x92b2[588]](i+1),s&&(a[_0x92b2[412]][i]=s),a};var er={},rr;t(hr,mn),hr[_0x92b2[742]]=function(){return this(arguments)},hr[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[845],_0x92b2[744])},hr[_0x92b2[15]][_0x92b2[310]]=function(e,t){var n=this[_0x92b2[846]][_0x92b2[310]](e);return n!==undefined?this[_0x92b2[847]][_0x92b2[310]](n)[1]:t},hr[_0x92b2[15]][_0x92b2[315]]=function(){return this[_0x92b2[721]]===0?this:this[_0x92b2[805]]?(this[_0x92b2[721]]=0,this[_0x92b2[846]][_0x92b2[315]](),this[_0x92b2[847]][_0x92b2[315]](),this):mr()},hr[_0x92b2[15]][_0x92b2[312]]=function(e,t){return gr(this,e,t)},hr[_0x92b2[15]][_0x92b2[314]]=function(e){return gr(this,e,u)},hr[_0x92b2[15]][_0x92b2[815]]=function(){return this[_0x92b2[846]][_0x92b2[815]]()||this[_0x92b2[847]][_0x92b2[815]]()},hr[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this;return this[_0x92b2[847]].__iterate(function(t){return t&&e(t[1],t[0],n)},t)},hr[_0x92b2[15]][_0x92b2[750]]=function(e,t){return this[_0x92b2[847]][_0x92b2[752]]().__iterator(e,t)},hr[_0x92b2[15]][_0x92b2[817]]=function(e){if(e===this[_0x92b2[805]])return this;var t=this[_0x92b2[846]].__ensureOwner(e),n=this[_0x92b2[847]].__ensureOwner(e);return e?dr(t,n,e,this.__hash):(this[_0x92b2[805]]=e,this[_0x92b2[846]]=t,this[_0x92b2[847]]=n,this)},hr[_0x92b2[848]]=pr,hr[_0x92b2[15]][D]=!0,hr[_0x92b2[15]][n]=hr[_0x92b2[15]][_0x92b2[314]];var vr;t(yr,dt),yr[_0x92b2[742]]=function(){return this(arguments)},yr[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[850],_0x92b2[571])},yr[_0x92b2[15]][_0x92b2[310]]=function(e,t){var n=this[_0x92b2[851]];e=v(this,e);while(n&&e--)n=n[_0x92b2[344]];return n?n[_0x92b2[303]]:t},yr[_0x92b2[15]][_0x92b2[852]]=function(){return this[_0x92b2[851]]&&this[_0x92b2[851]][_0x92b2[303]]},yr[_0x92b2[15]][_0x92b2[199]]=function(){if(arguments[_0x92b2[48]]===0)return this;var e=this[_0x92b2[721]]+arguments[_0x92b2[48]],t=this[_0x92b2[851]];for(var n=arguments[_0x92b2[48]]-1;n>=0;n--)t={value:arguments[n],next:t};return this[_0x92b2[805]]?(this[_0x92b2[721]]=e,this[_0x92b2[851]]=t,this[_0x92b2[806]]=undefined,this[_0x92b2[807]]=!0,this):Sr(e,t)},yr[_0x92b2[15]][_0x92b2[853]]=function(e){e=x(e);if(e[_0x92b2[721]]===0)return this;It(e[_0x92b2[721]]);var t=this[_0x92b2[721]],n=this[_0x92b2[851]];return e[_0x92b2[789]]()[_0x92b2[402]](function(e){t++,n={value:e,next:n}}),this[_0x92b2[805]]?(this[_0x92b2[721]]=t,this[_0x92b2[851]]=n,this[_0x92b2[806]]=undefined,this[_0x92b2[807]]=!0,this):Sr(t,n)},yr[_0x92b2[15]][_0x92b2[796]]=function(){return this[_0x92b2[20]](1)},yr[_0x92b2[15]][_0x92b2[213]]=function(){return this[_0x92b2[199]][_0x92b2[413]](this,arguments)},yr[_0x92b2[15]][_0x92b2[849]]=function(e){return this[_0x92b2[853]](e)},yr[_0x92b2[15]][_0x92b2[533]]=function(){return this[_0x92b2[796]][_0x92b2[413]](this,arguments)},yr[_0x92b2[15]][_0x92b2[315]]=function(){return this[_0x92b2[721]]===0?this:this[_0x92b2[805]]?(this[_0x92b2[721]]=0,this[_0x92b2[851]]=undefined,this[_0x92b2[806]]=undefined,this[_0x92b2[807]]=!0,this):Tr()},yr[_0x92b2[15]][_0x92b2[20]]=function(e,t){if(g(e,t,this[_0x92b2[721]]))return this;var n=y(e,this[_0x92b2[721]]),r=b(t,this[_0x92b2[721]]);if(r!==this[_0x92b2[721]])return dt[_0x92b2[15]][_0x92b2[20]][_0x92b2[5]](this,e,t);var i=this[_0x92b2[721]]-n,s=this[_0x92b2[851]];while(n--)s=s[_0x92b2[344]];return this[_0x92b2[805]]?(this[_0x92b2[721]]=i,this[_0x92b2[851]]=s,this[_0x92b2[806]]=undefined,this[_0x92b2[807]]=!0,this):Sr(i,s)},yr[_0x92b2[15]][_0x92b2[817]]=function(e){return e===this[_0x92b2[805]]?this:e?Sr(this[_0x92b2[721]],this._head,e,this.__hash):(this[_0x92b2[805]]=e,this[_0x92b2[807]]=!1,this)},yr[_0x92b2[15]][_0x92b2[749]]=function(e,t){if(t)return this[_0x92b2[789]]().__iterate(e);var n=0,r=this[_0x92b2[851]];while(r){if(e(r[_0x92b2[303]],n++,this)===!1)break;r=r[_0x92b2[344]]}return n},yr[_0x92b2[15]][_0x92b2[750]]=function(e,t){if(t)return this[_0x92b2[789]]().__iterator(e);var n=0,r=this[_0x92b2[851]];return new q(function(){if(r){var t=r[_0x92b2[303]];return r=r[_0x92b2[344]],R(e,n++,t)}return U()})},yr[_0x92b2[854]]=br;var wr=_0x92b2[855],Er=yr[_0x92b2[15]];Er[wr]=!0,Er[_0x92b2[799]]=bn[_0x92b2[799]],Er[_0x92b2[792]]=bn[_0x92b2[792]],Er[_0x92b2[793]]=bn[_0x92b2[793]],Er[_0x92b2[815]]=bn[_0x92b2[815]];var xr;t(Nr,vt),Nr[_0x92b2[742]]=function(){return this(arguments)},Nr[_0x92b2[857]]=function(e){return this(S(e)[_0x92b2[858]]())},Nr[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[859],_0x92b2[744])},Nr[_0x92b2[15]][_0x92b2[759]]=function(e){return this[_0x92b2[846]][_0x92b2[759]](e)},Nr[_0x92b2[15]][_0x92b2[856]]=function(e){return Ar(this,this[_0x92b2[846]][_0x92b2[312]](e,!0))},Nr[_0x92b2[15]][_0x92b2[314]]=function(e){return Ar(this,this[_0x92b2[846]][_0x92b2[314]](e))},Nr[_0x92b2[15]][_0x92b2[315]]=function(){return Ar(this,this[_0x92b2[846]][_0x92b2[315]]())},Nr[_0x92b2[15]][_0x92b2[860]]=function(){var t=e[_0x92b2[5]](arguments,0);return t=t[_0x92b2[463]](function(e){return e[_0x92b2[721]]!==0}),t[_0x92b2[48]]===0?this:this[_0x92b2[721]]===0&&!this[_0x92b2[805]]&&t[_0x92b2[48]]===1?this[_0x92b2[7]](t[0]):this[_0x92b2[799]](function(e){for(var n=0;n<t[_0x92b2[48]];n++)T(t[n])[_0x92b2[402]](function(t){return e[_0x92b2[856]](t)})})},Nr[_0x92b2[15]][_0x92b2[861]]=function(){var t=e[_0x92b2[5]](arguments,0);if(t[_0x92b2[48]]===0)return this;t=t[_0x92b2[406]](function(e){return T(e)});var n=this;return this[_0x92b2[799]](function(e){n[_0x92b2[402]](function(n){t[_0x92b2[862]](function(e){return e[_0x92b2[790]](n)})||e[_0x92b2[314]](n)})})},Nr[_0x92b2[15]][_0x92b2[863]]=function(){var t=e[_0x92b2[5]](arguments,0);if(t[_0x92b2[48]]===0)return this;t=t[_0x92b2[406]](function(e){return T(e)});var n=this;return this[_0x92b2[799]](function(e){n[_0x92b2[402]](function(n){t[_0x92b2[443]](function(e){return e[_0x92b2[790]](n)})&&e[_0x92b2[314]](n)})})},Nr[_0x92b2[15]][_0x92b2[808]]=function(){return this[_0x92b2[860]][_0x92b2[413]](this,arguments)},Nr[_0x92b2[15]][_0x92b2[809]]=function(t){var n=e[_0x92b2[5]](arguments,1);return this[_0x92b2[860]][_0x92b2[413]](this,n)},Nr[_0x92b2[15]][_0x92b2[589]]=function(e){return Dr(rn(this,e))},Nr[_0x92b2[15]][_0x92b2[814]]=function(e,t){return Dr(rn(this,t,e))},Nr[_0x92b2[15]][_0x92b2[815]]=function(){return this[_0x92b2[846]][_0x92b2[815]]()},Nr[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this;return this[_0x92b2[846]].__iterate(function(t,r){return e(r,r,n)},t)},Nr[_0x92b2[15]][_0x92b2[750]]=function(e,t){return this[_0x92b2[846]][_0x92b2[406]](function(e,t){return t}).__iterator(e,t)},Nr[_0x92b2[15]][_0x92b2[817]]=function(e){if(e===this[_0x92b2[805]])return this;var t=this[_0x92b2[846]].__ensureOwner(e);return e?this.__make(t,e):(this[_0x92b2[805]]=e,this[_0x92b2[846]]=t,this)},Nr[_0x92b2[864]]=Cr;var kr=_0x92b2[865],Lr=Nr[_0x92b2[15]];Lr[kr]=!0,Lr[n]=Lr[_0x92b2[314]],Lr[_0x92b2[811]]=Lr[_0x92b2[808]],Lr[_0x92b2[812]]=Lr[_0x92b2[809]],Lr[_0x92b2[799]]=bn[_0x92b2[799]],Lr[_0x92b2[792]]=bn[_0x92b2[792]],Lr[_0x92b2[793]]=bn[_0x92b2[793]],Lr[_0x92b2[866]]=_r,Lr[_0x92b2[867]]=Or;var Mr;t(Dr,Nr),Dr[_0x92b2[742]]=function(){return this(arguments)},Dr[_0x92b2[857]]=function(e){return this(S(e)[_0x92b2[858]]())},Dr[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(_0x92b2[868],_0x92b2[744])},Dr[_0x92b2[869]]=Pr;var Hr=Dr[_0x92b2[15]];Hr[D]=!0,Hr[_0x92b2[866]]=Fr,Hr[_0x92b2[867]]=Br;var jr;t(Ir,pt),Ir[_0x92b2[15]][_0x92b2[17]]=function(){return this.__toString(Ur(this)+_0x92b2[872],_0x92b2[744])},Ir[_0x92b2[15]][_0x92b2[759]]=function(e){return this[_0x92b2[871]][_0x92b2[16]](e)},Ir[_0x92b2[15]][_0x92b2[310]]=function(e,t){if(!this[_0x92b2[759]](e))return t;var n=this[_0x92b2[871]][e];return this[_0x92b2[846]]?this[_0x92b2[846]][_0x92b2[310]](e,n):n},Ir[_0x92b2[15]][_0x92b2[315]]=function(){if(this[_0x92b2[805]])return this[_0x92b2[846]]&&this[_0x92b2[846]][_0x92b2[315]](),this;var e=this[_0x92b2[7]];return e[_0x92b2[873]]||(e[_0x92b2[873]]=Rr(this,On()))},Ir[_0x92b2[15]][_0x92b2[312]]=function(e,t){if(!this[_0x92b2[759]](e))throw new Error(_0x92b2[874]+e+_0x92b2[875]+Ur(this));var n=this[_0x92b2[846]]&&this[_0x92b2[846]][_0x92b2[312]](e,t);return this[_0x92b2[805]]||n===this[_0x92b2[846]]?this:Rr(this,n)},Ir[_0x92b2[15]][_0x92b2[314]]=function(e){if(!this[_0x92b2[759]](e))return this;var t=this[_0x92b2[846]]&&this[_0x92b2[846]][_0x92b2[314]](e);return this[_0x92b2[805]]||t===this[_0x92b2[846]]?this:Rr(this,t)},Ir[_0x92b2[15]][_0x92b2[815]]=function(){return this[_0x92b2[846]][_0x92b2[815]]()},Ir[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this;return S(this._defaultValues)[_0x92b2[406]](function(e,t){return n[_0x92b2[310]](t)}).__iterator(e,t)},Ir[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this;return S(this._defaultValues)[_0x92b2[406]](function(e,t){return n[_0x92b2[310]](t)}).__iterate(e,t)},Ir[_0x92b2[15]][_0x92b2[817]]=function(e){if(e===this[_0x92b2[805]])return this;var t=this[_0x92b2[846]]&&this[_0x92b2[846]].__ensureOwner(e);return e?Rr(this,t,e):(this[_0x92b2[805]]=e,this[_0x92b2[846]]=t,this)};var qr=Ir[_0x92b2[15]];qr[n]=qr[_0x92b2[314]],qr[_0x92b2[804]]=qr[_0x92b2[820]]=bn[_0x92b2[820]],qr[_0x92b2[808]]=bn[_0x92b2[808]],qr[_0x92b2[809]]=bn[_0x92b2[809]],qr[_0x92b2[810]]=bn[_0x92b2[810]],qr[_0x92b2[811]]=bn[_0x92b2[811]],qr[_0x92b2[812]]=bn[_0x92b2[812]],qr[_0x92b2[813]]=bn[_0x92b2[813]],qr[_0x92b2[802]]=bn[_0x92b2[802]],qr[_0x92b2[606]]=bn[_0x92b2[606]],qr[_0x92b2[803]]=bn[_0x92b2[803]],qr[_0x92b2[799]]=bn[_0x92b2[799]],qr[_0x92b2[792]]=bn[_0x92b2[792]],qr[_0x92b2[793]]=bn[_0x92b2[793]],t(Vr,Q),Vr[_0x92b2[15]][_0x92b2[17]]=function(){return this[_0x92b2[721]]===0?_0x92b2[884]:_0x92b2[885]+this[_0x92b2[880]]+_0x92b2[886]+this[_0x92b2[881]]+(this[_0x92b2[882]]>1?_0x92b2[887]+this[_0x92b2[882]]:_0x92b2[41])+_0x92b2[888]},Vr[_0x92b2[15]][_0x92b2[310]]=function(e,t){return this[_0x92b2[759]](e)?this[_0x92b2[880]]+v(this,e)*this[_0x92b2[882]]:t},Vr[_0x92b2[15]][_0x92b2[790]]=function(e){var t=(e-this[_0x92b2[880]])/this[_0x92b2[882]];return t>=0&&t<this[_0x92b2[721]]&&t===Math[_0x92b2[889]](t)},Vr[_0x92b2[15]][_0x92b2[20]]=function(e,t){return g(e,t,this[_0x92b2[721]])?this:(e=y(e,this[_0x92b2[721]]),t=b(t,this[_0x92b2[721]]),t<=e?new Vr(0,0):new Vr(this[_0x92b2[310]](e,this._end),this[_0x92b2[310]](t,this._end),this._step))},Vr[_0x92b2[15]][_0x92b2[203]]=function(e){var t=e-this[_0x92b2[880]];if(t%this[_0x92b2[882]]===0){var n=t/this[_0x92b2[882]];if(n>=0&&n<this[_0x92b2[721]])return n}return-1},Vr[_0x92b2[15]][_0x92b2[890]]=function(e){return this[_0x92b2[203]](e)},Vr[_0x92b2[15]][_0x92b2[749]]=function(e,t){var n=this[_0x92b2[721]]-1,r=this[_0x92b2[882]],i=t?this[_0x92b2[880]]+n*r:this[_0x92b2[880]];for(var s=0;s<=n;s++){if(e(i,s,this)===!1)return s+1;i+=t?-r:r}return s},Vr[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this[_0x92b2[721]]-1,r=this[_0x92b2[882]],i=t?this[_0x92b2[880]]+n*r:this[_0x92b2[880]],s=0;return new q(function(){var o=i;return i+=t?-r:r,s>n?U():R(e,s++,o)})},Vr[_0x92b2[15]][_0x92b2[668]]=function(e){return e instanceof Vr?this[_0x92b2[880]]===e[_0x92b2[880]]&&this[_0x92b2[881]]===e[_0x92b2[881]]&&this[_0x92b2[882]]===e[_0x92b2[882]]:Xr(this,e)};var $r;t(Jr,Q),Jr[_0x92b2[15]][_0x92b2[17]]=function(){return this[_0x92b2[721]]===0?_0x92b2[892]:_0x92b2[893]+this[_0x92b2[891]]+_0x92b2[189]+this[_0x92b2[721]]+_0x92b2[894]},Jr[_0x92b2[15]][_0x92b2[310]]=function(e,t){return this[_0x92b2[759]](e)?this[_0x92b2[891]]:t},Jr[_0x92b2[15]][_0x92b2[790]]=function(e){return mt(this._value,e)},Jr[_0x92b2[15]][_0x92b2[20]]=function(e,t){var n=this[_0x92b2[721]];return g(e,t,n)?this:new Jr(this._value,b(t,n)-y(e,n))},Jr[_0x92b2[15]][_0x92b2[789]]=function(){return this},Jr[_0x92b2[15]][_0x92b2[203]]=function(e){return mt(this._value,e)?0:-1},Jr[_0x92b2[15]][_0x92b2[890]]=function(e){return mt(this._value,e)?this[_0x92b2[721]]:-1},Jr[_0x92b2[15]][_0x92b2[749]]=function(e,t){for(var n=0;n<this[_0x92b2[721]];n++)if(e(this._value,n,this)===!1)return n+1;return n},Jr[_0x92b2[15]][_0x92b2[750]]=function(e,t){var n=this,r=0;return new q(function(){return r<n[_0x92b2[721]]?R(e,r++,n._value):U()})},Jr[_0x92b2[15]][_0x92b2[668]]=function(e){return e instanceof Jr?mt(this._value,e._value):Xr(e)};var Kr;E[_0x92b2[896]]=q,Qr(E,{toArray:function(){It(this[_0x92b2[721]]);var t=new Array(this[_0x92b2[721]]||0);return this[_0x92b2[788]]().__iterate(function(e,n){t[n]=e}),t},toIndexedSeq:function(){return new Rt(this)},toJS:function(){return this[_0x92b2[741]]()[_0x92b2[406]](function(e){return e&&typeof e[_0x92b2[897]]===_0x92b2[71]?e[_0x92b2[897]]():e}).__toJS()},toJSON:function(){return this[_0x92b2[741]]()[_0x92b2[406]](function(e){return e&&typeof e[_0x92b2[898]]===_0x92b2[71]?e[_0x92b2[898]]():e}).__toJS()},toKeyedSeq:function(){return new qt(this,!0)},toMap:function(){return mn(this[_0x92b2[751]]())},toObject:function(){It(this[_0x92b2[721]]);var t={};return this.__iterate(function(e,n){t[n]=e}),t},toOrderedMap:function(){return hr(this[_0x92b2[751]]())},toOrderedSet:function(){return Dr(C(this)?this[_0x92b2[788]]():this)},toSet:function(){return Nr(C(this)?this[_0x92b2[788]]():this)},toSetSeq:function(){return new Ut(this)},toSeq:function(){return k(this)?this[_0x92b2[753]]():C(this)?this[_0x92b2[751]]():this[_0x92b2[755]]()},toStack:function(){return yr(C(this)?this[_0x92b2[788]]():this)},toList:function(){return Kn(C(this)?this[_0x92b2[788]]():this)},toString:function(){return _0x92b2[899]},__toString:function(t,n){return this[_0x92b2[721]]===0?t+n:t+_0x92b2[189]+this[_0x92b2[741]]()[_0x92b2[406]](this.__toStringMapper)[_0x92b2[228]](_0x92b2[900])+_0x92b2[189]+n},concat:function(){var n=e[_0x92b2[5]](arguments,0);return an(this,Zt(this,n))},includes:function(t){return this[_0x92b2[443]](function(e){return mt(e,t)})},entries:function(){return this.__iterator(B)},every:function(t,n){It(this[_0x92b2[721]]);var r=!0;return this.__iterate(function(e,i,s){if(!t[_0x92b2[5]](n,e,i,s))return r=!1,!1}),r},filter:function(t,n){return an(this,$t(this,t,n,!0))},find:function(t,n,r){var i=this[_0x92b2[901]](t,n);return i?i[1]:r},findEntry:function(t,n){var r;return this.__iterate(function(e,i,s){if(t[_0x92b2[5]](n,e,i,s))return r=[i,e],!1}),r},findLastEntry:function(t,n){return this[_0x92b2[741]]()[_0x92b2[789]]()[_0x92b2[901]](t,n)},forEach:function(t,n){return It(this[_0x92b2[721]]),this.__iterate(n?t[_0x92b2[502]](n):t)},join:function(t){It(this[_0x92b2[721]]),t=t!==undefined?_0x92b2[41]+t:_0x92b2[567];var n=_0x92b2[41],r=!0;return this.__iterate(function(e){r?r=!1:n+=t,n+=e!==null&&e!==undefined?e.toString():_0x92b2[41]}),n},keys:function(){return this.__iterator(P)},map:function(t,n){return an(this,Xt(this,t,n))},reduce:function(t,n,r){It(this[_0x92b2[721]]);var i,s;return arguments[_0x92b2[48]]<2?s=!0:i=n,this.__iterate(function(e,n,o){s?(s=!1,i=e):i=t[_0x92b2[5]](r,i,e,n,o)}),i},reduceRight:function(t,n,r){var i=this[_0x92b2[751]]()[_0x92b2[789]]();return i[_0x92b2[795]][_0x92b2[413]](i,arguments)},reverse:function(){return an(this,Vt(this,!0))},slice:function(t,n){return an(this,Qt(this,t,n,!0))},some:function(t,n){return!this[_0x92b2[862]](ti(t),n)},sort:function(t){return an(this,rn(this,t))},values:function(){return this.__iterator(H)},butLast:function(){return this[_0x92b2[20]](0,-1)},isEmpty:function(){return this[_0x92b2[721]]!==undefined?this[_0x92b2[721]]===0:!this[_0x92b2[443]](function(){return!0})},count:function(t,n){return d(t?this[_0x92b2[741]]()[_0x92b2[463]](t,n):this)},countBy:function(t,n){return Jt(this,t,n)},equals:function(t){return Xr(this,t)},entrySeq:function(){var t=this;if(t[_0x92b2[746]])return new Z(t._cache);var n=t[_0x92b2[741]]()[_0x92b2[406]](ei)[_0x92b2[753]]();return n[_0x92b2[752]]=function(){return t[_0x92b2[741]]()},n},filterNot:function(t,n){return this[_0x92b2[463]](ti(t),n)},findLast:function(t,n,r){return this[_0x92b2[751]]()[_0x92b2[789]]()[_0x92b2[902]](t,n,r)},first:function(){return this[_0x92b2[902]](m)},flatMap:function(t,n){return an(this,tn(this,t,n))},flatten:function(t){return an(this,en(this,t,!0))},fromEntrySeq:function(){return new zt(this)},get:function(t,n){return this[_0x92b2[902]](function(e,n){return mt(n,t)},undefined,n)},getIn:function(t,n){var r=this,i=vn(t),s;while(!(s=i[_0x92b2[344]]())[_0x92b2[343]]){var o=s[_0x92b2[303]];r=r&&r[_0x92b2[310]]?r[_0x92b2[310]](o,u):u;if(r===u)return n}return r},groupBy:function(t,n){return Kt(this,t,n)},has:function(t){return this[_0x92b2[310]](t,u)!==u},hasIn:function(t){return this[_0x92b2[903]](t,u)!==u},isSubset:function(t){return t=typeof t[_0x92b2[790]]===_0x92b2[71]?t:E(t),this[_0x92b2[862]](function(e){return t[_0x92b2[790]](e)})},isSuperset:function(t){return t=typeof t[_0x92b2[904]]===_0x92b2[71]?t:E(t),t[_0x92b2[904]](this)},keySeq:function(){return this[_0x92b2[741]]()[_0x92b2[406]](Zr)[_0x92b2[753]]()},last:function(){return this[_0x92b2[741]]()[_0x92b2[789]]()[_0x92b2[905]]()},max:function(t){return sn(this,t)},maxBy:function(t,n){return sn(this,n,t)},min:function(t){return sn(this,t?ni(t):si)},minBy:function(t,n){return sn(this,n?ni(n):si,t)},rest:function(){return this[_0x92b2[20]](1)},skip:function(t){return this[_0x92b2[20]](Math[_0x92b2[529]](0,t))},skipLast:function(t){return an(this,this[_0x92b2[741]]()[_0x92b2[789]]()[_0x92b2[906]](t)[_0x92b2[789]]())},skipWhile:function(t,n){return an(this,Yt(this,t,n,!0))},skipUntil:function(t,n){return this[_0x92b2[907]](ti(t),n)},sortBy:function(t,n){return an(this,rn(this,n,t))},take:function(t){return this[_0x92b2[20]](0,Math[_0x92b2[529]](0,t))},takeLast:function(t){return an(this,this[_0x92b2[741]]()[_0x92b2[789]]()[_0x92b2[908]](t)[_0x92b2[789]]())},takeWhile:function(t,n){return an(this,Gt(this,t,n))},takeUntil:function(t,n){return this[_0x92b2[909]](ti(t),n)},valueSeq:function(){return this[_0x92b2[753]]()},hashCode:function(){return this[_0x92b2[806]]||(this[_0x92b2[806]]=oi(this))}});var Gr=E[_0x92b2[15]];Gr[O]=!0,Gr[I]=Gr[_0x92b2[910]],Gr[_0x92b2[911]]=Gr[_0x92b2[691]],Gr[_0x92b2[912]]=ri,Gr[_0x92b2[739]]=Gr[_0x92b2[740]]=function(){return this.toString()},Gr[_0x92b2[913]]=Gr[_0x92b2[914]],Gr[_0x92b2[481]]=Gr[_0x92b2[790]],function(){try{Object[_0x92b2[306]](Gr,_0x92b2[48],{get:function(){if(!E[_0x92b2[915]]){var t;try{throw new Error}catch(n){t=n[_0x92b2[916]]}if(t[_0x92b2[203]](_0x92b2[917])===-1)return console&&console[_0x92b2[596]]&&console[_0x92b2[596]](_0x92b2[918]+_0x92b2[919]+_0x92b2[920]+t),this[_0x92b2[721]]}}})}catch(e){}}(),Qr(S,{flip:function(){return an(this,Wt(this))},findKey:function(t,n){var r=this[_0x92b2[901]](t,n);return r&&r[0]},findLastKey:function(t,n){return this[_0x92b2[741]]()[_0x92b2[789]]()[_0x92b2[921]](t,n)},keyOf:function(t){return this[_0x92b2[921]](function(e){return mt(e,t)})},lastKeyOf:function(t){return this[_0x92b2[922]](function(e){return mt(e,t)})},mapEntries:function(t,n){var r=this,i=0;return an(this,this[_0x92b2[741]]()[_0x92b2[406]](function(e,s){return t[_0x92b2[5]](n,[s,e],i++,r)})[_0x92b2[752]]())},mapKeys:function(t,n){var r=this;return an(this,this[_0x92b2[741]]()[_0x92b2[791]]()[_0x92b2[406]](function(e,i){return t[_0x92b2[5]](n,e,i,r)})[_0x92b2[791]]())}});var Yr=S[_0x92b2[15]];Yr[M]=!0,Yr[I]=Gr[_0x92b2[822]],Yr[_0x92b2[911]]=Gr[_0x92b2[923]],Yr[_0x92b2[912]]=function(e,t){return JSON[_0x92b2[313]](t)+_0x92b2[924]+ri(e)},Qr(x,{toKeyedSeq:function(){return new qt(this,!1)},filter:function(t,n){return an(this,$t(this,t,n,!1))},findIndex:function(t,n){var r=this[_0x92b2[901]](t,n);return r?r[0]:-1},indexOf:function(t){var n=this[_0x92b2[751]]()[_0x92b2[925]](t);return n===undefined?-1:n},lastIndexOf:function(t){return this[_0x92b2[741]]()[_0x92b2[789]]()[_0x92b2[203]](t)},reverse:function(){return an(this,Vt(this,!1))},slice:function(t,n){return an(this,Qt(this,t,n,!1))},splice:function(t,n){var r=arguments[_0x92b2[48]];n=Math[_0x92b2[529]](n|0,0);if(r===0||r===2&&!n)return this;t=y(t,t<0?this[_0x92b2[825]]():this[_0x92b2[721]]);var i=this[_0x92b2[20]](0,t);return an(this,r===1?i:i[_0x92b2[409]](p(arguments,2),this[_0x92b2[20]](t+n)))},findLastIndex:function(t,n){var r=this[_0x92b2[751]]()[_0x92b2[922]](t,n);return r===undefined?-1:r},first:function(){return this[_0x92b2[310]](0)},flatten:function(t){return an(this,en(this,t,!1))},get:function(t,n){return t=v(this,t),t<0||this[_0x92b2[721]]===Infinity||this[_0x92b2[721]]!==undefined&&t>this[_0x92b2[721]]?n:this[_0x92b2[902]](function(e,n){return n===t},undefined,n)},has:function(t){return t=v(this,t),t>=0&&(this[_0x92b2[721]]!==undefined?this[_0x92b2[721]]===Infinity||t<this[_0x92b2[721]]:this[_0x92b2[203]](t)!==-1)},interpose:function(t){return an(this,nn(this,t))},interleave:function(){var t=[this][_0x92b2[409]](p(arguments)),n=un(this[_0x92b2[741]](),Q[_0x92b2[742]],t),r=n[_0x92b2[794]](!0);return n[_0x92b2[721]]&&(r[_0x92b2[721]]=n[_0x92b2[721]]*t[_0x92b2[48]]),an(this,r)},last:function(){return this[_0x92b2[310]](-1)},skipWhile:function(t,n){return an(this,Yt(this,t,n,!1))},zip:function(){var t=[this][_0x92b2[409]](p(arguments));return an(this,un(this,ii,t))},zipWith:function(t){var n=p(arguments);return n[0]=this,an(this,un(this,t,n))}}),x[_0x92b2[15]][_]=!0,x[_0x92b2[15]][D]=!0,Qr(T,{get:function(t,n){return this[_0x92b2[759]](t)?t:n},includes:function(t){return this[_0x92b2[759]](t)},keySeq:function(){return this[_0x92b2[788]]()}}),T[_0x92b2[15]][_0x92b2[759]]=Gr[_0x92b2[790]],Qr(K,S[_0x92b2[15]]),Qr(Q,x[_0x92b2[15]]),Qr(G,T[_0x92b2[15]]),Qr(pt,S[_0x92b2[15]]),Qr(dt,x[_0x92b2[15]]),Qr(vt,T[_0x92b2[15]]);var fi={Iterable:E,Seq:J,Collection:ht,Map:mn,OrderedMap:hr,List:Kn,Stack:yr,Set:Nr,OrderedSet:Dr,Record:Ir,Range:Vr,Repeat:Jr,is:mt,fromJS:gt};return fi})},function(e,t,n){function o(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function u(e){if(Array[_0x92b2[327]](e)){for(var t=0,n=Array(e[_0x92b2[48]]);t<e[_0x92b2[48]];t++)n[t]=e[t];return n}return Array[_0x92b2[637]](e)}function l(){for(var e=arguments[_0x92b2[48]],t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[_0x92b2[228]](_0x92b2[931])[_0x92b2[930]]()+_0x92b2[931]}function c(e,t){return e[_0x92b2[36]](_0x92b2[932],_0x92b2[933]+t)[_0x92b2[930]]()}_0x92b2[0];var r=function(){function e(e,t){var n=[],r=!0,i=!1,s=undefined;try{for(var o=e[Symbol[_0x92b2[341]]](),u;!(r=(u=o[_0x92b2[344]]())[_0x92b2[343]]);r=!0){n[_0x92b2[199]](u[_0x92b2[303]]);if(t&&n[_0x92b2[48]]===t)break}}catch(a){i=!0,s=a}finally{try{!r&&o[_0x92b2[346]]&&o[_0x92b2[346]]()}finally{if(i)throw s}}return n}return function(t,n){if(Array[_0x92b2[327]](t))return t;if(Symbol[_0x92b2[341]]in Object(t))return e(t,n);throw new TypeError(_0x92b2[927])}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(1),s=o(i),a=_0x92b2[928],f=_0x92b2[929],h=undefined;s[_0x92b2[4]][_0x92b2[260]]===_0x92b2[119]?function(){var e=[0,_0x92b2[4],!0];h=function(t,n,i,s,o){i=c(i,n),o=[e][_0x92b2[409]](u(o));var f=o[_0x92b2[406]](function(e,t){return _0x92b2[934]+t})[_0x92b2[228]](_0x92b2[189]),h=o[_0x92b2[406]](function(e,t){var o=r(e,3),u=o[0],f=o[1],l=o[2];return l?i+_0x92b2[935]+(s===a&&t===0?_0x92b2[928]:_0x92b2[936])+_0x92b2[937]+t+_0x92b2[938]+f+_0x92b2[280]+u+_0x92b2[189]+f+_0x92b2[280]+u+_0x92b2[939]+n+_0x92b2[940]+u+_0x92b2[941]+f+_0x92b2[280]+u:_0x92b2[942]+n+_0x92b2[943]+n+_0x92b2[944]});return l[_0x92b2[413]](undefined,[_0x92b2[945]+f+_0x92b2[946]][_0x92b2[409]](u(h)))}}():h=function(e,t,n,i,s){var o=s[_0x92b2[463]](function(e){var t=r(e,3),n=t[0],i=t[1],s=t[2];return s})[_0x92b2[406]](function(e){var t=r(e,2),n=t[0],i=t[1];return _0x92b2[947]+n+_0x92b2[941]+i+_0x92b2[948]+n+_0x92b2[949]+i+_0x92b2[189]+i});return l[_0x92b2[413]](undefined,[_0x92b2[950]+(e===_0x92b2[665]?_0x92b2[951]:_0x92b2[952]),c(n,t),_0x92b2[953]+(i==a?_0x92b2[928]:_0x92b2[936])+_0x92b2[954]+t+_0x92b2[955]+t+_0x92b2[956]][_0x92b2[409]](u(o)))},t[_0x92b2[4]]={SENDRECV:a,RECVONLY:f,getOpusPayloadType:function(t){return t[_0x92b2[957]](/a=rtpmap:(\d+) opus/)[1]},customLocalSessionDescription:function(t,n,r){var i=t[_0x92b2[701]];return/o=mozilla...THIS_IS_SDPARTA/i[_0x92b2[32]](i)&&(i=t[_0x92b2[701]]+_0x92b2[958]),t[_0x92b2[701]]=i[_0x92b2[36]](/\r/g,_0x92b2[41])[_0x92b2[38]](_0x92b2[931])[_0x92b2[406]](function(e){if(/^m=audio/i[_0x92b2[32]](e)){var t=new RegExp(_0x92b2[959]),n=e[_0x92b2[957]](t);return n&&n[_0x92b2[48]]===4?n[1]+_0x92b2[960]+n[3]:e}if(/^a=rtpmap:111/i[_0x92b2[32]](e))return _0x92b2[961]+e[_0x92b2[963]](_0x92b2[962][_0x92b2[48]]);if(/^a=rtcp-fb:111/i[_0x92b2[32]](e))return _0x92b2[964]+e[_0x92b2[963]](_0x92b2[965][_0x92b2[48]]);if(/^a=rtpmap:109/i[_0x92b2[32]](e))return _0x92b2[961]+e[_0x92b2[963]](_0x92b2[966][_0x92b2[48]]);if(/^a=fmtp:111 minptime=10;/i[_0x92b2[32]](e))return _0x92b2[967];if(/^a=ssrc:/i[_0x92b2[32]](e)){var t=new RegExp(_0x92b2[968]),n=e[_0x92b2[957]](t);return n&&n[_0x92b2[48]]===3?_0x92b2[947]+r+n[2]:null}return e})[_0x92b2[463]](function(e){return e!=null})[_0x92b2[228]](_0x92b2[931]),t},createSessionDescription:function(t,n,r,i,s){return new RTCSessionDescription({type:t,sdp:h(t,n,r,i,s)})},filterTCPCandidates:function(t){return t[_0x92b2[36]](/\r/g,_0x92b2[41])[_0x92b2[38]](_0x92b2[931])[_0x92b2[406]](function(e){if(!/^a=candidate:/[_0x92b2[32]](e))return e;var t=e[_0x92b2[38]](_0x92b2[189]);return t=t[_0x92b2[20]](0,2)[_0x92b2[409]]([t[2][_0x92b2[18]]()][_0x92b2[409]](u(t[_0x92b2[20]](3)))),t[2]===_0x92b2[969]?null:t[_0x92b2[228]](_0x92b2[189])})[_0x92b2[463]](function(e){return e!=null})[_0x92b2[228]](_0x92b2[931])}}},function(e,t,n){function y(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function b(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}function w(e,t){if(!e)throw new ReferenceError(_0x92b2[633]);return!t||typeof t!==_0x92b2[10]&&typeof t!==_0x92b2[71]?e:t}function E(e,t){if(typeof t!==_0x92b2[71]&&t!==null)throw new TypeError(_0x92b2[634]+typeof t);e[_0x92b2[15]]=Object[_0x92b2[433]](t&&t[_0x92b2[15]],{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object[_0x92b2[635]]?Object[_0x92b2[635]](e,t):e[_0x92b2[636]]=t)}_0x92b2[0];var r=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(49),s=n(45),o=y(s),u=n(53),a=y(u),f=n(7),l=y(f),c=n(54),h=y(c),p=n(56),d=y(p),v=n(57),m=y(v),g=n(5),S=500,x=250,T=function(e){function t(e,n,r){b(this,t);var i=arguments[_0x92b2[48]]<=3||arguments[3]===undefined?null:arguments[3],s=w(this,Object[_0x92b2[639]](t)[_0x92b2[5]](this));return s[_0x92b2[970]]=e,s[_0x92b2[642]]=n,s[_0x92b2[971]]=r,i!=null?s[_0x92b2[972]]=i:s[_0x92b2[972]]=_0x92b2[973],s[_0x92b2[974]]=null,s[_0x92b2[975]]=null,s[_0x92b2[643]]=null,s[_0x92b2[976]]=null,s[_0x92b2[977]]=null,s[_0x92b2[978]]=null,s[_0x92b2[979]]=null,s[_0x92b2[980]]=null,s[_0x92b2[981]]=null,s[_0x92b2[982]]=null,s[_0x92b2[983]]=g[_0x92b2[319]][_0x92b2[984]],s[_0x92b2[985]]=null,s[_0x92b2[986]]=null,s[_0x92b2[987]]=new a[_0x92b2[4]](1e3,1e4),s[_0x92b2[988]]=new a[_0x92b2[4]](1e3,1e4),s[_0x92b2[989]]=new a[_0x92b2[4]](1e3,1e4),s[_0x92b2[990]]=!1,s[_0x92b2[991]]=!1,s[_0x92b2[595]]=o[_0x92b2[4]][_0x92b2[433]](_0x92b2[992]+e+_0x92b2[282]),s}return E(t,e),r(t,[{key:_0x92b2[993],value:function(){var t=this;this._enterGuild(function(e,n,r,i){e==200&&n==0?(t[_0x92b2[989]][_0x92b2[994]](),t[_0x92b2[974]]=i,t[_0x92b2[595]][_0x92b2[434]](_0x92b2[995],t[_0x92b2[974]]),t._authenticate()):t[_0x92b2[989]][_0x92b2[996]]<5?(t[_0x92b2[595]][_0x92b2[596]](_0x92b2[997],t[_0x92b2[989]][_0x92b2[996]]),t[_0x92b2[423]](_0x92b2[998],t[_0x92b2[970]],e),t[_0x92b2[989]][_0x92b2[999]](function(){return t[_0x92b2[993]]()})):(t[_0x92b2[595]][_0x92b2[596]](_0x92b2[1e3]),t[_0x92b2[423]](_0x92b2[1e3],t[_0x92b2[970]]),t[_0x92b2[989]][_0x92b2[994]]())})}},{key:_0x92b2[382],value:function(t,n,r,i,s){if(this[_0x92b2[990]])throw new Error(_0x92b2[1001]);this[_0x92b2[988]][_0x92b2[1002]](),this._cleanupSocket();if(t!=null&&n!=null&&r!=null&&i!=null&&s!=null){this[_0x92b2[975]]=t,this[_0x92b2[643]]=n,this[_0x92b2[976]]=r,this[_0x92b2[977]]=i,this[_0x92b2[978]]=s;var o=_0x92b2[1003]+this[_0x92b2[976]]+_0x92b2[188]+this[_0x92b2[970]]+_0x92b2[1004]+this[_0x92b2[642]];this[_0x92b2[986]]=new h[_0x92b2[4]](o,s),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[1005],this[_0x92b2[1006]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[382],this[_0x92b2[1007]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[618],this[_0x92b2[1008]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[665],this[_0x92b2[1009]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[1010],this[_0x92b2[1011]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[351],this[_0x92b2[1012]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[1013],this[_0x92b2[1014]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[1015],this[_0x92b2[1016]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[371]](_0x92b2[1017],this[_0x92b2[1018]][_0x92b2[502]](this)),this[_0x92b2[986]][_0x92b2[382]]()}}},{key:_0x92b2[1019],value:function(){if(this[_0x92b2[991]])return;this[_0x92b2[986]]!=null&&this[_0x92b2[986]][_0x92b2[383]]()}},{key:_0x92b2[1020],value:function(){if(this[_0x92b2[991]])return;this[_0x92b2[986]]!=null&&this[_0x92b2[986]][_0x92b2[383]](),this._authenticate()}},{key:_0x92b2[352],value:function(){this[_0x92b2[985]]!=null&&(this[_0x92b2[985]][_0x92b2[422]](),this[_0x92b2[985]][_0x92b2[383]](),this[_0x92b2[985]]=null),this[_0x92b2[979]]!=null&&(this[_0x92b2[979]][_0x92b2[359]](),this[_0x92b2[979]]=null),this[_0x92b2[989]][_0x92b2[1002]](),this[_0x92b2[987]][_0x92b2[1002]](),this[_0x92b2[988]][_0x92b2[1002]](),this._cleanupSocket(),this[_0x92b2[422]](),this[_0x92b2[990]]=!0}},{key:_0x92b2[1021],value:function(){this[_0x92b2[991]]=!0,l[_0x92b2[4]][_0x92b2[1022]](),this[_0x92b2[983]]==g[_0x92b2[319]][_0x92b2[984]]||this[_0x92b2[983]]==g[_0x92b2[319]][_0x92b2[1023]]?this[_0x92b2[423]](_0x92b2[1017],this[_0x92b2[1024]],200):this[_0x92b2[983]]==g[_0x92b2[319]][_0x92b2[1025]]?(this[_0x92b2[985]]!=null&&(this[_0x92b2[985]][_0x92b2[422]](),this[_0x92b2[643]]!=null?this[_0x92b2[985]].Close(this[_0x92b2[643]]):this[_0x92b2[985]][_0x92b2[383]]()),this[_0x92b2[423]](_0x92b2[1017],this[_0x92b2[1024]],200)):(this[_0x92b2[985]]!=null&&(this[_0x92b2[985]][_0x92b2[422]](),this[_0x92b2[643]]!=null?this[_0x92b2[985]].Close(this[_0x92b2[643]]):this[_0x92b2[985]][_0x92b2[383]]()),this[_0x92b2[986]]!=null&&this[_0x92b2[986]][_0x92b2[1017]]())}},{key:_0x92b2[1026],value:function(t,n){this[_0x92b2[986]]!=null&&this[_0x92b2[986]][_0x92b2[351]](t,n)}},{key:_0x92b2[1027],value:function(){return this[_0x92b2[986]]!=null?this[_0x92b2[986]][_0x92b2[1028]]:[]}},{key:_0x92b2[1029],value:function(){var t=this[_0x92b2[986]];return t==null||t[_0x92b2[1028]][_0x92b2[48]]===0?0:t[_0x92b2[1028]][_0x92b2[795]](function(e,t){return e+t},0)/t[_0x92b2[1028]][_0x92b2[48]]}},{key:_0x92b2[1030],value:function(){return this[_0x92b2[986]]&&this[_0x92b2[986]][_0x92b2[1028]][this[_0x92b2[986]][_0x92b2[1028]][_0x92b2[48]]-1]||0}},{key:_0x92b2[1031],value:function(t){var n=arguments[_0x92b2[48]]<=1||arguments[1]===undefined?{}:arguments[1];this[_0x92b2[983]]=t,this[_0x92b2[423]](_0x92b2[983],t,n)}},{key:_0x92b2[1032],value:function(){this[_0x92b2[986]]!=null&&(this[_0x92b2[986]][_0x92b2[422]](),this[_0x92b2[986]][_0x92b2[383]](),this[_0x92b2[986]]=null,this._handleDisconnect(!0,1e3,_0x92b2[41]))}},{key:_0x92b2[1006],value:function(){this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1033],this[_0x92b2[976]]),this[_0x92b2[1031]](g[_0x92b2[319]].CONNECTING)}},{key:_0x92b2[1007],value:function(){var t=this;this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1034]);var n=this[_0x92b2[986]];l[_0x92b2[4]][_0x92b2[1038]](function(e){if(n!==t[_0x92b2[986]])return;var r=t[_0x92b2[983]];t[_0x92b2[1031]](e),r===g[_0x92b2[319]][_0x92b2[1035]]&&e===g[_0x92b2[319]][_0x92b2[347]]?t.VoiceEngineReconnect():r===g[_0x92b2[319]][_0x92b2[1036]]&&e===g[_0x92b2[319]][_0x92b2[1037]]&&t.IceNoRouteReconnect()}),l[_0x92b2[4]][_0x92b2[348]](function(e,n){e==null&&t[_0x92b2[423]](_0x92b2[351],t[_0x92b2[970]],t[_0x92b2[642]],t[_0x92b2[643]],n)}),this[_0x92b2[1031]](g[_0x92b2[319]].CONNECTED),l[_0x92b2[4]][_0x92b2[382]](null,this[_0x92b2[643]],this[_0x92b2[642]],this[_0x92b2[977]],this[_0x92b2[978]],function(e,r,i){if(n!==t[_0x92b2[986]])return;if(e!=null){t[_0x92b2[595]][_0x92b2[456]](_0x92b2[1039]+e);return}t[_0x92b2[595]][_0x92b2[434]](_0x92b2[1040],i),t[_0x92b2[986]][_0x92b2[1042]](t[_0x92b2[970]],_0x92b2[1041],t[_0x92b2[642]],t[_0x92b2[971]],t[_0x92b2[975]],t[_0x92b2[643]],i)}),this[_0x92b2[988]][_0x92b2[994]]()}},{key:_0x92b2[1008],value:function(t,n,r){var i=this;this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1043],{wasClean:t,code:n,reason:r});var s=n!==1e3;s&&(this[_0x92b2[595]][_0x92b2[596]](_0x92b2[1044]),this[_0x92b2[988]][_0x92b2[999]](function(){return i.VoiceEngineReconnect()})),l[_0x92b2[4]][_0x92b2[1038]](null),l[_0x92b2[4]][_0x92b2[618]](),this[_0x92b2[1031]](g[_0x92b2[319]].DISCONNECTED,{willReconnect:s})}},{key:_0x92b2[1009],value:function(t){this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1045],t),l[_0x92b2[4]][_0x92b2[1046]](t)}},{key:_0x92b2[1011],value:function(t){this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1047],t),this[_0x92b2[423]](_0x92b2[1010],this[_0x92b2[970]],t)}},{key:_0x92b2[1018],value:function(t){this[_0x92b2[423]](_0x92b2[1017],this[_0x92b2[970]],t)}},{key:_0x92b2[1016],value:function(t){var n=this;t[_0x92b2[406]](function(e){return n[_0x92b2[595]][_0x92b2[434]](e[_0x92b2[642]],_0x92b2[1048],e[_0x92b2[643]])}),l[_0x92b2[4]][_0x92b2[1049]](t),this[_0x92b2[423]](_0x92b2[1050],this[_0x92b2[970]],t)}},{key:_0x92b2[1012],value:function(t,n,r){this[_0x92b2[423]](_0x92b2[351],this[_0x92b2[970]],t,n,r)}},{key:_0x92b2[1014],value:function(){this[_0x92b2[423]](_0x92b2[1013],this[_0x92b2[970]],this[_0x92b2[1051]])}},{key:_0x92b2[1052],value:function(t){this[_0x92b2[1031]](g[_0x92b2[319]].ENTER_GUILD);var n=null;window[_0x92b2[1053]]?n=new XMLHttpRequest:n=new ActiveXObject(_0x92b2[1054]),n[_0x92b2[1055]]=function(){if(n[_0x92b2[1056]]==4)if(n[_0x92b2[1057]]==200){var e=JSON[_0x92b2[295]](n[_0x92b2[1058]]);t(200,e[_0x92b2[407]],e[_0x92b2[1059]],e[_0x92b2[1060]])}else t(n[_0x92b2[1057]],null,null,null)};var r=_0x92b2[1061]+this[_0x92b2[970]]+_0x92b2[1062]+encodeURIComponent(this[_0x92b2[971]])+_0x92b2[1063]+g[_0x92b2[207]][_0x92b2[1064]]+_0x92b2[1065]+this[_0x92b2[642]]+_0x92b2[1066]+_0x92b2[1067]+Date[_0x92b2[1068]]();n[_0x92b2[1072]](_0x92b2[1069],_0x92b2[1070]+this[_0x92b2[972]]+_0x92b2[1071]+r,!0),n[_0x92b2[1073]]()}},{key:_0x92b2[1074],value:function(){var t=this;this[_0x92b2[1031]](g[_0x92b2[319]].AUTHENTICATE),this[_0x92b2[985]]==null?(this[_0x92b2[985]]=new d[_0x92b2[4]](_0x92b2[1003]+this[_0x92b2[974]],this[_0x92b2[970]],this[_0x92b2[642]],this[_0x92b2[971]]),this[_0x92b2[985]][_0x92b2[371]](_0x92b2[1005],function(){return t[_0x92b2[595]][_0x92b2[434]](_0x92b2[1075])}),this[_0x92b2[985]][_0x92b2[371]](_0x92b2[382],this[_0x92b2[1076]][_0x92b2[502]](this)),this[_0x92b2[985]][_0x92b2[371]](_0x92b2[1077],function(e,n,r){t[_0x92b2[595]][_0x92b2[434]](_0x92b2[1078],e,n,r);if(r[_0x92b2[48]]>0){t[_0x92b2[980]]=n,t[_0x92b2[981]]=e,t[_0x92b2[982]]=r;var i=[];r[_0x92b2[406]](function(e){i[_0x92b2[199]](e[_0x92b2[1079]])}),t[_0x92b2[979]]=new m[_0x92b2[4]](i),t[_0x92b2[979]][_0x92b2[371]](_0x92b2[1080],function(e,n){t[_0x92b2[595]][_0x92b2[434]](_0x92b2[1081],e,_0x92b2[1082],n);var r=t[_0x92b2[980]],i=t[_0x92b2[981]],s=null,o=e,u=parseInt(n),a=t[_0x92b2[982]][_0x92b2[902]](function(t){return t[_0x92b2[1079]]===e});a&&(s=a[_0x92b2[1083]]),t[_0x92b2[985]].SetMedia(i,o+_0x92b2[519]+u),t[_0x92b2[382]](r,i,s,o,u)}),t[_0x92b2[979]][_0x92b2[371]](_0x92b2[1084],function(e,n){t[_0x92b2[595]][_0x92b2[434]](_0x92b2[1085],e,_0x92b2[1082],n)}),t[_0x92b2[979]][_0x92b2[371]](_0x92b2[1086],function(){t[_0x92b2[979]]&&(t[_0x92b2[595]][_0x92b2[434]](_0x92b2[1086]),t[_0x92b2[979]]=null,t[_0x92b2[980]]=null,t[_0x92b2[981]]=null,t[_0x92b2[982]]=null)}),t[_0x92b2[979]][_0x92b2[1087]]()}}),this[_0x92b2[985]][_0x92b2[371]](_0x92b2[618],function(e,n,r){var i=n!==1e3;i&&(t[_0x92b2[595]][_0x92b2[596]](_0x92b2[1088]),t[_0x92b2[987]][_0x92b2[999]](function(){return t[_0x92b2[985]][_0x92b2[382]]()}))}),this[_0x92b2[985]][_0x92b2[382]]()):this[_0x92b2[985]].Authenticate()}},{key:_0x92b2[1076],value:function(){this[_0x92b2[643]]==null?this[_0x92b2[985]].WhoAmI():this[_0x92b2[985]].WhoAmIEx(this[_0x92b2[975]],this[_0x92b2[643]]),this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1089],this[_0x92b2[983]]),this[_0x92b2[983]]==g[_0x92b2[319]][_0x92b2[1025]]?(this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1090]),this[_0x92b2[985]].Authenticate()):this[_0x92b2[595]][_0x92b2[434]](_0x92b2[1089],this[_0x92b2[983]],_0x92b2[1091])}},{key:_0x92b2[1051],get:function(){var t=this[_0x92b2[1030]]();return this[_0x92b2[983]]!==g[_0x92b2[319]][_0x92b2[1035]]||t===0?g[_0x92b2[320]][_0x92b2[451]]:t>S?g[_0x92b2[320]][_0x92b2[1092]]:t>x?g[_0x92b2[320]][_0x92b2[1093]]:g[_0x92b2[320]][_0x92b2[1094]]}}]),t}(i.EventEmitter);t[_0x92b2[4]]=T},function(e,t){function r(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}_0x92b2[0];var n=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=function(){function e(){var t=arguments[_0x92b2[48]]<=0||arguments[0]===undefined?500:arguments[0],n=arguments[_0x92b2[48]]<=1||arguments[1]===undefined?null:arguments[1];r(this,e);var i=arguments[_0x92b2[48]]<=2||arguments[2]===undefined?!0:arguments[2];this[_0x92b2[632]]=t,this[_0x92b2[529]]=n!=null?n:t*10,this[_0x92b2[1095]]=i,this[_0x92b2[1096]]=t,this[_0x92b2[1097]]=null,this[_0x92b2[1098]]=0}return n(e,[{key:_0x92b2[994],value:function(){this[_0x92b2[1002]](),this[_0x92b2[1098]]=0,this[_0x92b2[1096]]=this[_0x92b2[632]]}},{key:_0x92b2[999],value:function(){var t=this,n=arguments[_0x92b2[48]]<=0||arguments[0]===undefined?null:arguments[0];this[_0x92b2[1098]]+=1;var r=this[_0x92b2[1096]]*2;this[_0x92b2[1095]]&&(r*=Math[_0x92b2[1099]]()),this[_0x92b2[1096]]=Math[_0x92b2[632]](this[_0x92b2[1096]]+r,this[_0x92b2[529]]);if(n!=null){if(this[_0x92b2[1097]]!=null)throw new Error(_0x92b2[1100]);this[_0x92b2[1097]]=setTimeout(function(){try{n()}finally{t[_0x92b2[1097]]=null}},this._current)}return this[_0x92b2[1096]]}},{key:_0x92b2[1002],value:function(){this[_0x92b2[1097]]!=null&&(clearTimeout(this._timeoutId),this[_0x92b2[1097]]=null)}},{key:_0x92b2[996],get:function(){return this[_0x92b2[1098]]}},{key:_0x92b2[1101],get:function(){return this[_0x92b2[1096]]}},{key:_0x92b2[1102],get:function(){return this[_0x92b2[1097]]!=null}}]),e}();t[_0x92b2[4]]=i},function(e,t,n){((function(e){function l(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function c(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}function h(e,t){if(!e)throw new ReferenceError(_0x92b2[633]);return!t||typeof t!==_0x92b2[10]&&typeof t!==_0x92b2[71]?e:t}function p(e,t){if(typeof t!==_0x92b2[71]&&t!==null)throw new TypeError(_0x92b2[634]+typeof t);e[_0x92b2[15]]=Object[_0x92b2[433]](t&&t[_0x92b2[15]],{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object[_0x92b2[635]]?Object[_0x92b2[635]](e,t):e[_0x92b2[636]]=t)}_0x92b2[0];var r=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(49),s=n(1),o=l(s),u=n(5),a=n(55),f=l(a),d=0,v=1,m=2,g=3,y=20,b=function(t){function n(e){c(this,n);var t=arguments[_0x92b2[48]]<=1||arguments[1]===undefined?4e4:arguments[1],r=h(this,Object[_0x92b2[639]](n)[_0x92b2[5]](this));return r[_0x92b2[1083]]=e,r[_0x92b2[1103]]=t,r[_0x92b2[1104]]=null,r[_0x92b2[1028]]=[],r[_0x92b2[1105]]=!1,r}return p(n,t),r(n,[{key:_0x92b2[382],value:function(){var n=this;if(this[_0x92b2[1104]]!=null)return;var r=null,i=!1,s=!1,o=this[_0x92b2[1104]]=new WebSocket(this[_0x92b2[1083]]);o[_0x92b2[1106]]=function(){i=!0,n[_0x92b2[1028]]=[],n[_0x92b2[423]](_0x92b2[382])},o[_0x92b2[1107]]=function(e){var t=JSON[_0x92b2[295]](e[_0x92b2[1108]]);switch(t[_0x92b2[1123]]){case u[_0x92b2[326]][_0x92b2[1115]]:if(t[_0x92b2[1109]]==_0x92b2[1110])if(t[_0x92b2[1111]]==200){var i=t[_0x92b2[1112]];r=f[_0x92b2[4]][_0x92b2[1114]](function(){return n[_0x92b2[1113]]()},i),n[_0x92b2[423]](_0x92b2[665],t[_0x92b2[701]]),n[_0x92b2[1113]]()}else n[_0x92b2[423]](_0x92b2[1010],t[_0x92b2[1111]]);break;case u[_0x92b2[326]][_0x92b2[1117]]:t[_0x92b2[1109]]==_0x92b2[1110]?(n[_0x92b2[383]](),n[_0x92b2[423]](_0x92b2[1017],t[_0x92b2[1111]])):t[_0x92b2[1109]]==_0x92b2[1116]&&(n[_0x92b2[1073]]({C:u[_0x92b2[326]][_0x92b2[1117]],R:_0x92b2[1110],code:200}),n[_0x92b2[383]](),n[_0x92b2[423]](_0x92b2[1017],0));break;case u[_0x92b2[326]][_0x92b2[1119]]:var s=performance[_0x92b2[1068]]()[_0x92b2[246]]()-t[_0x92b2[1118]];n[_0x92b2[1028]][_0x92b2[199]](s),n[_0x92b2[1028]][_0x92b2[48]]===y&&n[_0x92b2[1028]][_0x92b2[533]](),n[_0x92b2[423]](_0x92b2[1013]);break;case u[_0x92b2[326]][_0x92b2[1121]]:n[_0x92b2[423]](_0x92b2[351],t[_0x92b2[1120]]);break;case u[_0x92b2[326]][_0x92b2[1122]]:n[_0x92b2[423]](_0x92b2[1015],t[_0x92b2[1120]])}},o[_0x92b2[1124]]=function(e){o[_0x92b2[1126]]({wasClean:!1,code:0,reason:e[_0x92b2[1125]]})},o[_0x92b2[1126]]=function(e){var t=e[_0x92b2[1127]],i=e[_0x92b2[1111]],o=e[_0x92b2[1059]];f[_0x92b2[4]][_0x92b2[1128]](r),s||(s=!0,n[_0x92b2[1104]]=null,n[_0x92b2[1105]]?n[_0x92b2[423]](_0x92b2[1017],0):n[_0x92b2[423]](_0x92b2[618],t,i,o))},e[_0x92b2[364]](function(){i||n[_0x92b2[423]](_0x92b2[1005])})}},{key:_0x92b2[1073],value:function(t){if(this[_0x92b2[1104]]==null||this[_0x92b2[1104]][_0x92b2[1056]]!==v)return;var n=JSON[_0x92b2[313]](t);try{this[_0x92b2[1104]][_0x92b2[1073]](n)}catch(r){}}},{key:_0x92b2[383],value:function(){if(this[_0x92b2[1104]]==null)return;this[_0x92b2[1104]][_0x92b2[383]](),this[_0x92b2[1104]]=null}},{key:_0x92b2[352],value:function(){this[_0x92b2[383]]()}},{key:_0x92b2[1042],value:function(t,n,r,i,s,a,f){this[_0x92b2[1073]]({C:u[_0x92b2[326]][_0x92b2[1115]],R:_0x92b2[1116],stunport:this[_0x92b2[1103]],conf:t,type:n,userId:r,userName:i,ssrc_ver:s,ssrc:a,userAgent:o[_0x92b2[4]][_0x92b2[260]],sdp:f})}},{key:_0x92b2[1017],value:function(){this[_0x92b2[1105]]=!0,this[_0x92b2[373]]?this[_0x92b2[1073]]({C:u[_0x92b2[326]][_0x92b2[1117]],R:_0x92b2[1116]}):(this[_0x92b2[352]](),this[_0x92b2[423]](_0x92b2[1017],0))}},{key:_0x92b2[1113],value:function(){this[_0x92b2[1073]]({C:u[_0x92b2[326]][_0x92b2[1129]],R:_0x92b2[1116],t:performance[_0x92b2[1068]]()[_0x92b2[246]]()})}},{key:_0x92b2[351],value:function(t){var n=arguments[_0x92b2[48]]<=1||arguments[1]===undefined?0:arguments[1];this[_0x92b2[1073]]({C:u[_0x92b2[326]][_0x92b2[1121]],R:_0x92b2[1116],speaking:t,delay:n})}},{key:_0x92b2[373],get:function(){return this[_0x92b2[1104]]!=null&&this[_0x92b2[1104]][_0x92b2[1056]]===v}}]),n}(i.EventEmitter);t[_0x92b2[4]]=b}))[_0x92b2[5]](t,n(9))},function(e,t){_0x92b2[0],Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var n={setInterval:function(t,n){return window[_0x92b2[1114]](t,n)},clearInterval:function(t){window[_0x92b2[1128]](t)}};t[_0x92b2[4]]=n},function(e,t,n){((function(e){function o(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}function u(e,t){if(!e)throw new ReferenceError(_0x92b2[633]);return!t||typeof t!==_0x92b2[10]&&typeof t!==_0x92b2[71]?e:t}function a(e,t){if(typeof t!==_0x92b2[71]&&t!==null)throw new TypeError(_0x92b2[634]+typeof t);e[_0x92b2[15]]=Object[_0x92b2[433]](t&&t[_0x92b2[15]],{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object[_0x92b2[635]]?Object[_0x92b2[635]](e,t):e[_0x92b2[636]]=t)}_0x92b2[0];var r=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(49),s=n(5),f=0,l=1,c=2,h=3,p=function(t){function n(e,t,r,i){o(this,n);var s=u(this,Object[_0x92b2[639]](n)[_0x92b2[5]](this));return s[_0x92b2[1083]]=e,s[_0x92b2[970]]=t,s[_0x92b2[642]]=r,s[_0x92b2[971]]=i,s[_0x92b2[1104]]=null,s}return a(n,t),r(n,[{key:_0x92b2[382],value:function(){var n=this;if(this[_0x92b2[1104]]!=null)return;var r=!1,i=!1,s=this[_0x92b2[1104]]=new WebSocket(this[_0x92b2[1083]]);s[_0x92b2[1106]]=function(){r=!0,n[_0x92b2[423]](_0x92b2[382])},s[_0x92b2[1107]]=function(e){var t=JSON[_0x92b2[295]](e[_0x92b2[1108]]);t[_0x92b2[404]]==_0x92b2[1130]&&n[_0x92b2[423]](_0x92b2[1077],t[_0x92b2[1131]],t[_0x92b2[70]],t[_0x92b2[1132]])},s[_0x92b2[1124]]=function(e){s[_0x92b2[1126]]({wasClean:!1,code:0,reason:e[_0x92b2[1125]]})},s[_0x92b2[1126]]=function(e){var t=e[_0x92b2[1127]],r=e[_0x92b2[1111]],s=e[_0x92b2[1059]];i||(i=!0,n[_0x92b2[1104]]=null,n[_0x92b2[423]](_0x92b2[618],t,r,s))},e[_0x92b2[364]](function(){r||n[_0x92b2[423]](_0x92b2[1005])})}},{key:_0x92b2[1073],value:function(t){if(this[_0x92b2[1104]]==null||this[_0x92b2[1104]][_0x92b2[1056]]!==l)return;var n=JSON[_0x92b2[313]](t);try{this[_0x92b2[1104]][_0x92b2[1073]](n)}catch(r){}}},{key:_0x92b2[383],value:function(){if(this[_0x92b2[1104]]==null)return;this[_0x92b2[1104]][_0x92b2[383]](),this[_0x92b2[1104]]=null}},{key:_0x92b2[352],value:function(){this[_0x92b2[383]]()}},{key:_0x92b2[1133],value:function(){this[_0x92b2[1073]]({type:_0x92b2[1134],channel:this[_0x92b2[970]],user_id:this[_0x92b2[642]],name:this[_0x92b2[971]],version:s[_0x92b2[207]][_0x92b2[1064]]})}},{key:_0x92b2[1135],value:function(t,n){this[_0x92b2[1073]]({type:_0x92b2[1130],session:t,media:n})}},{key:_0x92b2[1136],value:function(t){this[_0x92b2[1073]]({type:_0x92b2[1136],session:t})}},{key:_0x92b2[1137],value:function(t,n){this[_0x92b2[1073]]({type:_0x92b2[1138],channel:this[_0x92b2[970]],user_id:this[_0x92b2[642]],name:this[_0x92b2[971]],version:s[_0x92b2[207]][_0x92b2[1064]],session_version:t,session_id:n})}},{key:_0x92b2[1138],value:function(){this[_0x92b2[1073]]({type:_0x92b2[1138],channel:this[_0x92b2[970]],user_id:this[_0x92b2[642]],name:this[_0x92b2[971]],version:s[_0x92b2[207]][_0x92b2[1064]]})}},{key:_0x92b2[373],get:function(){return this[_0x92b2[1104]]!=null&&this[_0x92b2[1104]][_0x92b2[1056]]===l}}]),n}(i.EventEmitter);t[_0x92b2[4]]=p}))[_0x92b2[5]](t,n(9))},function(e,t,n){function p(e){return e&&e[_0x92b2[1]]?e:{"default":e}}function d(e,t){if(!e)throw new ReferenceError(_0x92b2[633]);return!t||typeof t!==_0x92b2[10]&&typeof t!==_0x92b2[71]?e:t}function v(e,t){if(typeof t!==_0x92b2[71]&&t!==null)throw new TypeError(_0x92b2[634]+typeof t);e[_0x92b2[15]]=Object[_0x92b2[433]](t&&t[_0x92b2[15]],{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object[_0x92b2[635]]?Object[_0x92b2[635]](e,t):e[_0x92b2[636]]=t)}function m(e,t){if(!(e instanceof t))throw new TypeError(_0x92b2[307])}_0x92b2[0];var r=function(){function e(e,t){for(var n=0;n<t[_0x92b2[48]];n++){var r=t[n];r[_0x92b2[301]]=r[_0x92b2[301]]||!1,r[_0x92b2[302]]=!0,_0x92b2[303]in r&&(r[_0x92b2[304]]=!0),Object[_0x92b2[306]](e,r[_0x92b2[305]],r)}}return function(t,n,r){return n&&e(t[_0x92b2[15]],n),r&&e(t,r),t}}();Object[_0x92b2[306]](t,_0x92b2[1],{value:!0});var i=n(49),s=n(50),o=p(s),u=n(1),a=p(u),f=n(45),l=p(f),c=n(53),h=p(c),g=undefined;a[_0x92b2[4]][_0x92b2[260]]===_0x92b2[119]?g={offerToReceiveAudio:!0,offerToReceiveVideo:!1}:g={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1},optional:[{VoiceActivityDetection:!0}]};var y=function(){function e(t,n,r,i){m(this,e),this[_0x92b2[431]]=l[_0x92b2[4]][_0x92b2[433]](_0x92b2[1139]),this[_0x92b2[431]][_0x92b2[434]](_0x92b2[1140],t,_0x92b2[1082],n),this[_0x92b2[1141]]=t,this[_0x92b2[1142]]=n,this[_0x92b2[1143]]=r,this[_0x92b2[1144]]=i,this[_0x92b2[397]]=null}return r(e,[{key:_0x92b2[1087],value:function(){var t=this;this[_0x92b2[359]]();var n={iceServers:[{urls:_0x92b2[1145]+this[_0x92b2[1141]]+_0x92b2[519]+this[_0x92b2[1142]]+_0x92b2[1146],username:_0x92b2[1147],credential:_0x92b2[1148]}],iceTransports:_0x92b2[1149]};this[_0x92b2[397]]=new RTCPeerConnection(n),this[_0x92b2[397]][_0x92b2[651]]=this[_0x92b2[652]][_0x92b2[502]](this),this[_0x92b2[397]][_0x92b2[681]](function(e){t[_0x92b2[397]][_0x92b2[680]](e,function(){t[_0x92b2[431]][_0x92b2[434]](_0x92b2[1150])},function(e){throw e})},function(e){throw e},g)}},{key:_0x92b2[652],value:function(t){this[_0x92b2[431]][_0x92b2[434]](_0x92b2[698],t[_0x92b2[699]]);if(t[_0x92b2[699]]==null)this[_0x92b2[359]](),this[_0x92b2[431]][_0x92b2[434]](_0x92b2[700]),this[_0x92b2[1144]]&&this[_0x92b2[1144]](this[_0x92b2[1141]],this[_0x92b2[1142]]);else if(t[_0x92b2[699]][_0x92b2[699]][_0x92b2[203]](_0x92b2[1151])!==-1){var n=t[_0x92b2[699]][_0x92b2[699]],r=new RegExp(_0x92b2[1152],_0x92b2[35]),i=n[_0x92b2[957]](r);i&&i[_0x92b2[48]]===4&&this[_0x92b2[1143]]&&this[_0x92b2[1143]](i[1],i[2])}}},{key:_0x92b2[359],value:function(){this[_0x92b2[397]]!==null&&(this[_0x92b2[397]][_0x92b2[383]](),this[_0x92b2[397]][_0x92b2[651]]=null,this[_0x92b2[397]]=null)}}]),e}(),b=function(e){function t(e){m(this,t);var n=d(this,Object[_0x92b2[639]](t)[_0x92b2[5]](this));return n[_0x92b2[1153]]=e,n[_0x92b2[1154]]=4e4,n[_0x92b2[1155]]=4e4+Math[_0x92b2[889]](Math[_0x92b2[1099]]()*1e4+2),n[_0x92b2[1155]]%2&&(n[_0x92b2[1155]]+=1),n[_0x92b2[1155]]>49998&&(n[_0x92b2[1155]]=49998),n[_0x92b2[1156]]=new o[_0x92b2[4]].Map,n[_0x92b2[1157]]=[],n[_0x92b2[1158]]=new h[_0x92b2[4]](1e3,1e4),n}return v(t,e),r(t,[{key:_0x92b2[1087],value:function(){var t=this;this[_0x92b2[1153]][_0x92b2[406]](function(e){var n=new y(e,t[_0x92b2[1154]],t[_0x92b2[1159]][_0x92b2[502]](t),t[_0x92b2[1160]][_0x92b2[502]](t));t[_0x92b2[1157]][_0x92b2[199]](n);var n=new y(e,t[_0x92b2[1155]],t[_0x92b2[1159]][_0x92b2[502]](t),t[_0x92b2[1160]][_0x92b2[502]](t));t[_0x92b2[1157]][_0x92b2[199]](n)}),this[_0x92b2[1157]][_0x92b2[406]](function(e){return e[_0x92b2[1087]]()})}},{key:_0x92b2[359],value:function(){this[_0x92b2[1157]]&&(this[_0x92b2[1157]][_0x92b2[406]](function(e){return e[_0x92b2[359]]()}),this[_0x92b2[1157]]=null,this[_0x92b2[1156]]=null)}},{key:_0x92b2[1159],value:function(t,n){if(this[_0x92b2[1156]][_0x92b2[721]]===0){var r=this[_0x92b2[1156]][_0x92b2[312]](t,0);this[_0x92b2[1156]]=r,this[_0x92b2[423]](_0x92b2[1080],t,n),this[_0x92b2[1153]][_0x92b2[48]]===1&&(this[_0x92b2[1157]][_0x92b2[406]](function(e){return e[_0x92b2[359]]()}),this[_0x92b2[1157]]=null,this[_0x92b2[1156]]=null,this[_0x92b2[423]](_0x92b2[1086]))}else{var r=this[_0x92b2[1156]][_0x92b2[312]](t,0);r!==this[_0x92b2[1156]]&&(this[_0x92b2[1156]]=r,this[_0x92b2[1157]][_0x92b2[406]](function(e){return e[_0x92b2[359]]()}),this[_0x92b2[1157]]=null,this[_0x92b2[1156]]=null,this[_0x92b2[423]](_0x92b2[1084],t,n),this[_0x92b2[423]](_0x92b2[1086]))}}},{key:_0x92b2[1160],value:function(t,n){var r=this,i=-1;for(var s=0;s<this[_0x92b2[1157]][_0x92b2[48]];s++)if(this[_0x92b2[1157]][s][_0x92b2[1141]]===t&&this[_0x92b2[1157]][s][_0x92b2[1142]]===n){i=s;break}i!==-1&&(this[_0x92b2[1157]][_0x92b2[588]](i,1),console[_0x92b2[595]](_0x92b2[1161],t,_0x92b2[1082],n,_0x92b2[1162])),this[_0x92b2[1157]][_0x92b2[48]]===0&&(this[_0x92b2[1156]][_0x92b2[721]]===0?this[_0x92b2[1158]][_0x92b2[999]](function(){return r[_0x92b2[1087]]()}):(this[_0x92b2[1158]][_0x92b2[994]](),this[_0x92b2[423]](_0x92b2[1086])))}}]),t}(i.EventEmitter);t[_0x92b2[4]]=b}]),define("webaudio",function(){}),define("webaudiowrapper",["backbone","webaudio"],function(e,t){var n=function(e){e||(e={}),this.initialize.apply(this,arguments)};_.extend(n.prototype,e.Events,{vc:null,nodeVoice:null,webAudioWrapper:null,users:[],initialize:function(e){_.bindAll(this,"startCall","stopCall","destroy"),_.bindAll(this,"_onVcState","_onSpeaking","_onBye","_onUserList"),console.debug("initialize: "+JSON.stringify(e)),this.options=e,this.users=[]},startCall:function(){console.debug("startCall");var e=this;if(window.nodeRequire){console.assert(this.nodeVoice),this.nodeVoice.start(this.options.session_id,function(t){console.debug("nodeVoice start success"),console.debug(t),e.trigger("state","VOICE_CONNECTED"),e.nodeVoice.on("talkStatus",function(t){console.debug("nodeVoice: talkStatus: "+t),e.trigger("speaking",e.options.session_id,e.options.user_id,"",t)}),e.nodeVoice.on("memberJoined",function(t){console.debug("memberJoined: "+t);if(e.users.indexOf(t)==-1){e.users.push(t),console.debug("memberJoinded users: "),console.debug(e.users);var n=[];for(var r=0;r<e.users.length;r++){var i={ssrc:0,userId:e.users[r]};n.push(i)}e._onUserList(e.options.session_id,n)}}),e.nodeVoice.on("memberLeft",function(t){console.debug("memberLeft: "+t);var n=e.users.indexOf(t);if(n!==-1){e.users.splice(n,1),console.debug("memberLeft users: "),console.debug(e.users);var r=[];for(var i=0;i<e.users.length;i++){var s={ssrc:0,userId:e.users[i]};r.push(s)}e._onUserList(e.options.session_id,r)}});const n=nodeRequire("electron").ipcRenderer;n.on("enable-push-to-talk",function(t,r){e.nodeVoice.setPTT(r),r?n.send("start-hotkeys-if-enabled","push-to-talk"):n.send("stop-hotkeys","push-to-talk")}),n.on("hotkey-activate-ptt",function(t,n){n?e.nodeVoice.activatePTT():e.nodeVoice.deactivatePTT()}),n.sendSync("start-hotkeys-if-enabled","push-to-talk")&&e.nodeVoice.setPTT(!0)},function(e){console.debug("nodeVoice start error"),console.debug(e)});return}this.vc=window.createAudioController_orig(this.options.session_id,this.options.user_id,this.options.nickname),this.vc.on("state",this._onVcState),this.vc.on("speaking",this._onSpeaking),this.vc.on("bye",this._onBye),this.vc.on("userlist",this._onUserList),this.vc.startCall()},destroy:function(){console.debug("destroy"),this.vc!==null&&(this.vc.destroy(),this.vc=null),window.nodeRequire&&this._clearHotkeysChannels(),this.unbind()},stopCall:function(){console.debug("stopCall");var e=this;if(window.nodeRequire){this.nodeVoice.stop(function(t){console.debug("nodeVoice stop success"),console.debug(t),setTimeout(function(){e.trigger("state","DISCONNECTED"),e.trigger("bye",!0)},0)}),this._clearHotkeysChannels();return}this.vc.stopCall()},_onVcState:function(e){console.debug("_onVcState: "+e),this.trigger("state",e)},_onSpeaking:function(e,t,n,r){this.trigger("speaking",e,t,n,r)},_onBye:function(e){this.trigger("bye",e)},_onUserList:function(e,t){this.trigger("userlist",e,t)},_clearHotkeysChannels:function(){const e=nodeRequire("electron").ipcRenderer;e.send("stop-hotkeys","push-to-talk"),e.removeAllListeners("enable-push-to-talk"),e.removeAllListeners("hotkey-activate-ptt")}});var r=function(e){if(r._instance)return r._instance;e||(e={}),this.initialize.apply(this,arguments),r._instance=this};return _.extend(r.prototype,e.Events,{nodeInitialized:!1,nodeVoice:null,user:null,initialize:function(e){_.bindAll(this,"enable","createAudioController","setUser"),_.bindAll(this,"setSelfMute","setSelfDeaf","setLocalMute","setLocalVolume"),window.VOE&&!window.VOE_orig&&(window.VOE_orig=window.VOE,delete window.VOE,window.createAudioController_orig=window.createAudioController,delete window.createAudioController),console.debug("webaudiowrapper initialize: "),this.nodeInitialized=!1},setUser:function(e,t){console.assert(e&&e!==""),console.assert(t&&t!==""),this.user={id:e,nickname:t};if(window.nodeRequire){if(!this.nodeInitialized){console.info("Initializing nodeVoice"),this.nodeInitialized=!0,this.nodeVoice=window.nodeRequire("../voice/voice-conference"),this.nodeVoice.init(e,"",t,function(){console.info("nodeVoice initialized")});const n=nodeRequire("electron").ipcRenderer;n.send("node-voice-initialized"),n.send("show_mainWindow");return}console.info("NodeVoice already initialized")}},enable:function(e){console.debug("enable");if(window.nodeRequire){e();return}window.VOE_orig.enable(function(){e()})},createAudioController:function(e,t,r){console.assert(this.user);var i=new n({session_id:e,user_id:t,nickname:r});return window.nodeRequire&&(i.nodeVoice=this.nodeVoice),i.webAudioWrapper=this,i},setSelfMute:function(e){console.debug("setSelfMute: "+e),window.nodeRequire?e?this.nodeVoice.muteSelf():this.nodeVoice.unmuteSelf():window.VOE_orig.setSelfMute(e)},setOutputVolume:function(e){console.debug("setOutputVolume: "+e),window.nodeRequire?this.nodeVoice.setSpeakerVolume(e):window.VOE_orig.setOutputVolume(e)},getOutputVolume:function(){if(window.nodeRequire)return this.nodeVoice.getSpeakerVolume()},setLocalMute:function(e,t){console.debug("setLocalMute: "+e,0+t),window.nodeRequire?t?this.nodeVoice.deafen(e):this.nodeVoice.undeafen(e):window.VOE_orig.setLocalMute(e,t)},setLocalVolume:function(e,t){console.debug("setLocalVolume: "+e+" "+t),window.nodeRequire?this.nodeVoice.setMemberSpeakerVolume(e,t):window.VOE_orig.setLocalVolume(e,t)},setSelfDeaf:function(e){console.debug("setSelfDeaf: "+e),window.nodeRequire?e?this.nodeVoice.deafenAll():this.nodeVoice.undeafenAll():window.VOE_orig.setSelfDeaf(e)}}),r}),define("communitysdk/callhandler",["jquery","underscore","backbone","webaudiowrapper"],function(e,t,n,r){var i=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(i.prototype,n.Events,{VOICE_CONNECTED:"VOICE_CONNECTED",VOICE_DISCONNECTED:"DISCONNECTED",voiceConnection:null,user:null,sessionId:null,callInterval:null,timeStart:null,callDuration:null,localMuted:{},webAudio:null,initialize:function(e){t.bindAll(this,"callIn","hangupCall","selfMute","selfUnmute","changeSpeakerVolume","setLocalMute","setLocalVolume","muteAll","unMuteAll","setUser","isCallActive","getActive","listenForTalkState","unlistenForTalkState","triggerJoinSession","isLocallyMuted"),t.bindAll(this,"_onPubSubPresence","_onSpeaking"),console.assert(e),console.assert(e.pubsub),this.options=e,this.voiceConnection=null,this.user=null,this.sessionId=null,this.callInterval=null,this.timeStart=null,this.callDuration=0,this.localMuted={},this.options.pubsub.on("presence",this._onPubSubPresence),this.webAudio=new r},setUser:function(e){this.user=e,this.webAudio.setUser(e.id,e.nickname)},callIn:function(e){console.assert(e&&e.session_id&&e.session_id!==""),console.assert(this.voiceConnection===null),console.assert(this.user),console.debug("callIn: options: "+JSON.stringify(e)),console.debug("callIn: userProfile: "+JSON.stringify(this.user)),this.sessionId=e.session_id;var t=this;this.voiceConnection&&(console.error("makeCall: already have a voiceConnection"),this.voiceConnection.stopCall(),this.voiceConnection=null),this.webAudio.enable(function(){t.voiceConnection=t.webAudio.createAudioController(t.sessionId,t.user.id,t.user.nickname),t.voiceConnection.on("state",function(n){console.debug("state: "+n),t.state=n,n===t.VOICE_CONNECTED?(e.success&&e.success(),t.timeStart=Date.now(),t.callInterval=setInterval(function(){t.callDuration=Math.round((Date.now()-t.timeStart)/1e3),t.trigger("timerTick",t.callDuration)},1e3),t.options.pubsub.subscribe({topics:["channel.voice."+t.sessionId+":presence","channel.voice."+t.sessionId]})):n===t.VOICE_DISCONNECTED&&(t.callDuration=0),t.trigger("webRtcState",n)}),t.voiceConnection.on("speaking",t._onSpeaking),t.voiceConnection.startCall(),t.trigger("startCall",t.sessionId)})},hangupCall:function(){var e=this,t=this.sessionId;for(var n in this.localMuted)this.localMuted.hasOwnProperty(n)&&this.setLocalMute(n,!1);this.voiceConnection&&(this.voiceConnection.on("bye",function(t){console.debug("hangupCall: got 'bye' event"),e.voiceConnection&&(e.voiceConnection.destroy(),e.voiceConnection=null),e.sessionId=null}),this.voiceConnection.stopCall()),this.trigger("endCall",t),this.callInterval&&(console.debug("hangupCall: duration: "+this.callDuration),clearInterval(this.callInterval),this.timeStart=null,this.callInterval=null),this.options.pubsub.unsubscribe({topics:["channel.voice."+t],success:function(){e.options.pubsub.unsubscribe({topics:["channel.voice."+t+":presence"]})}})},isCallActive:function(){return this.voiceConnection?!0:!1},getActive:function(e){console.assert(e&&e.community_id&&e.community_id!==""),console.assert(e.channel_id&&e.channel_id!==""),this.options.pubsub.getSubscribers({topic:"channel.voice."+e.channel_id,success:function(t){e.success&&e.success(t.data)}})},selfMute:function(){this.webAudio.setSelfMute(!0)},selfUnmute:function(){this.webAudio.setSelfMute(!1)},changeSpeakerVolume:function(e){console.debug("changeSpeakerVolume: "+e),this.webAudio.setOutputVolume(e)},setLocalMute:function(e,t){this.webAudio.setLocalMute(e,t),t?this.localMuted[e]=!0:delete this.localMuted[e],this.trigger("localMute",{channel:{id:this.sessionId},user:{id:e},value:t})},isLocallyMuted:function(e){return this.localMuted[e]?!0:!1},setLocalVolume:function(e,t){this.webAudio.setLocalVolume(e,t)},muteAll:function(){console.debug("muteAll"),this.webAudio.setSelfDeaf(!0)},unMuteAll:function(){console.debug("unMuteAll"),this.webAudio.setSelfDeaf(!1)},listenForTalkState:function(e){console.assert(e&&e.channel_id&&e.channel_id!==""),console.assert(e&&e.community_id&&e.community_id!==""),console.assert(e.context);var t=this;this.getActive({community_id:e.community_id,channel_id:e.channel_id,success:function(t){for(var n=0;n<t.length;n++)e.onJoinSession({channel:{id:e.channel_id},user:t[n]})}}),this.on("joinSession."+e.channel_id,function(t){e.onJoinSession(t)},e.context),this.on("leaveSession."+e.channel_id,function(t){e.onLeaveSession(t)},e.context),this.options.pubsub.subscribe({topics:["channel.voice."+e.channel_id+":presence","channel.talkstate."+e.channel_id]}),this.options.pubsub.on("message.channel.talkstate."+e.channel_id,function(t){e.onTalkState&&e.onTalkState(t)})},unlistenForTalkState:function(e){console.assert(e&&e.context),console.assert(e.channel_id&&e.channel_id!==""),this.off(null,null,e.context),this.options.pubsub.unsubscribe({topics:["channel.voice."+e.channel_id+":presence","channel.talkstate."+e.channel_id]}),this.options.pubsub.off("message.channel.talkstate."+e.channel_id)},_onPubSubPresence:function(e){console.assert(e.topic&&e.topic!==""),console.assert(e.event==="presence"),console.assert(e.type&&e.type!=="");var t=e.topic,n=t.split(".");if(n.length!==3)return;if(n[0]!=="channel")return;if(n[1]!=="voice")return;console.debug("_onPubSubPresence: "+JSON.stringify(e));var r=n[2],i={channel:{id:r},user:e.user};e.type==="join"?(this.trigger("joinSession",i),this.trigger("joinSession."+r,i)):e.type==="leave"&&(this.trigger("leaveSession",i),this.trigger("leaveSession."+r,i))},triggerJoinSession:function(e,t){var n=this;this.getActive({community_id:e,channel_id:t,success:function(e){for(var r=0;r<e.length;r++)n.trigger("joinSession",{channel:{id:t},user:e[r]}),n.trigger("joinSession."+t,{channel:{id:t},user:e[r]})}})},_onSpeaking:function(e,t,n,r){var i={event:"talkState",speaking:r},s="channel.talkstate."+e;this.options.pubsub.publish({topic:s,data:i,success:function(){}})}}),i}),define("communitysdk/adminrightsmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{edit_community:null,create_channel:null,edit_channel:null,delete_channel:null,mute_member:null,mute_channel:null,mute_community:null,kick_user:null,ban_user:null,promote_user:null,edit_rights:null}});return n}),define("communitysdk/pubsubhandler",["underscore","backbone"],function(e,t){var n=function(e){e||(e={}),this.initialize.apply(this,arguments)};return e.extend(n.prototype,t.Events,{commsCommunity:null,pubsub:null,initialize:function(t){e.bindAll(this,"_bindPubSubEvents","_onPubSubMessage","_onPubSubPresence","_subscribeToOwnNode"),e.bindAll(this,"_handleOwnNodeMessage"),console.assert(t),console.assert(t.commsCommunity),console.assert(t.pubsub),this.commsCommunity=t.commsCommunity,this.pubsub=t.pubsub,this._bindPubSubEvents(),this._subscribeToOwnNode()},_bindPubSubEvents:function(){this.pubsub.on("message",this._onPubSubMessage),this.pubsub.on("presence",this._onPubSubPresence)},_subscribeToOwnNode:function(){var e=this,t=function(){var t=e.commsCommunity.user_profile;console.assert(t&&t.id&&t.id!==""),e.pubsub.subscribe({topics:["community:"+t.id],success:function(){console.debug("_subscribeToOwnNode: success")}})};this.commsCommunity.user_profile&&this.commsCommunity.user_profile&&this.commsCommunity.user_profile.id!==""?t():this.commsCommunity.once("user_profile_success",function(){t()})},_onPubSubMessage:function(e){console.debug("_onPubSubMessage: "+JSON.stringify(e)),console.assert(e),console.assert(e.topic&&e.topic!==""),console.assert(e.event==="message"),console.assert(e.data);var t=this.commsCommunity.user_profile;if(t&&t.id&&t.id!==""){var n="community:"+t.id;if(e.topic==n){this._handleOwnNodeMessage(e);return}}var r=this,i="",s=e.topic,o=e.data;e.user&&e.user.id&&(o.sender=e.user.id);var u="",a=s.split(".");a.length===3&&(a[0]==="channel"?u=a[2]:a[0]==="community"&&(i=a[2]));if(a.length===3)if(a[0]==="channel"&&a[1]==="messages")setTimeout(function(){r.commsCommunity.trigger("message",s,o),r.commsCommunity.trigger("message."+u,s,o),r.commsCommunity._appendToMessageCollection(u,o);if(o.mention){var e=o.target;for(var t=0;t<e.length;t++){var n=e[t];if(n===r.commsCommunity.user_profile.id){var i=r.commsCommunity.communities.get(o.community_id);console.debug("I am being mentioned in focus--"+i.get("in_focus"));var a=o;a.icon=i.get("icon"),r.commsCommunity.trigger("mention",s,a);if(!i.get("in_focus")){var f=i.get("unread_mention");i.set("unread_mention",f+1);var l="communityMentioned."+i.get("id");r.commsCommunity.trigger(l,i.toJSON())}}}}},0);else if(a[0]==="community"&&a[1]==="events"){console.debug("Got community events");if(o&&o.event){if(o.event==="adminRightsChanged"){r.commsCommunity.trigger("adminRightsChanged",s,o);var i=o.community_id,f="adminRightsChanged."+i;r.commsCommunity.trigger(f,s,o)}if(o.event==="promote"){var f="promote."+o.user_id+o.community_id;r.commsCommunity.trigger("promote",s,o),r.commsCommunity.trigger(f,s,o)}if(o.event==="demote"){var f="demote."+o.user_id+o.community_id;r.commsCommunity.trigger("demote",s,o),r.commsCommunity.trigger(f,s,o)}if(o.event==="communityDeleted"){var i=o.community_id,f="communityDeleted."+i;r.commsCommunity.trigger(f,s,o)}if(o.event==="communityLeft")var i=o.community_id,f="communityDeleted."+i;if(o.event==="communityEdited"){var i=o.community_id,f="communityChange."+i,l=r.commsCommunity.communities.get(o.community_id);r.commsCommunity.trigger(f,l.toJSON())}if(o.event==="ban"){var i=o.community_id;r.commsCommunity.trigger("ban",s,o)}if(o.event==="post_announcement"){var c=o.announcement;c.unread_count=1;var l=r.commsCommunity.communities.get(o.community_id);l.set("last_announcement",c);var h="post_announcement."+o.community_id;r.commsCommunity.trigger(h,s,o),r.commsCommunity.trigger("post_announcement",s,o)}if(o.event==="clear_announcement"){var f="communityChange."+o.community_id,h="clear_announcement."+o.community_id,l=r.commsCommunity.communities.get(o.community_id);r.commsCommunity.trigger(h,s,o)}if(o.event==="delete_channel"){var f="delete_channel."+o.channel_id;r.commsCommunity.trigger(f,s,o),r.commsCommunity.trigger("delete_channel",s,o)}o.event==="create_channel"&&r.commsCommunity.trigger("create_channel",s,o),o.event==="edit_channel"&&r.commsCommunity.trigger("edit_channel",s,o)}}},_onPubSubPresence:function(e){console.assert(e.topic&&e.topic!==""),console.assert(e.event==="presence"),console.assert(e.type&&e.type!=="");var t=e.topic,n=t.split(".");if(n.length!==3)return;if(n[0]!=="channel")return;if(n[1]!=="messages")return;var r=n[2];if(e.type==="join"){var i={channel:{id:r},user:e.user};this.commsCommunity.trigger("joinChannel",t,i),this.commsCommunity.trigger("joinChannel."+r,t,i)}else if(e.type==="leave"){var i={channel:{id:r},user:e.user};this.commsCommunity.trigger("leaveChannel",t,i),this.commsCommunity.trigger("leaveChannel."+r,t,i)}},_handleOwnNodeMessage:function(e){console.debug("_handleOwnNodeMessage: "+JSON.stringify(e));var t=this.commsCommunity.user_profile;if(e.user.id!==t.id){console.assert(!1);return}var n=this;setTimeout(function(){n.commsCommunity.trigger(e.data.event,e.data)},0)}}),n}),define("communitysdk/commscommunity",["jquery","underscore","backbone","communitysdk/pubsubengine2","communitysdk/sha1","communitysdk/communitycollection","communitysdk/communitymodel","communitysdk/callhandler","communitysdk/adminrightsmodel","communitysdk/pubsubhandler"],function(e,t,n,r,i,s,o,u,a,f){var l=102,c=function(e){e=e||{},this.initialize.apply(this,arguments)};return t.extend(c.prototype,n.Events,{options:{},pubsub:null,pubsubHandler:null,communities:null,channels:null,channels_map:[],current_channel_id:null,joining_channel_id:null,user_map:[],messages_map:[],active_channel_map:[],user_profile:{id:"",nickname:"",avatar:"",comms_id:""},admin_rights_map:[],CallHandler:null,newlyCreatedCommunityId:"",announcement_markers:[],initialize:function(e){t.bindAll(this,"disconnect","getCommunityList","getCommunity","getChannels","getChannel","getMessages","joinChannel","leaveChannel","sendMessage","getCachedCommunity","getUser","createCommunity","close","joinAllLobby","cacheChannels","joinCommunity","createChannel","promoteUser","demoteUser","getCurrentChannel","isCurrentUser","getRole","saveLinkPreview","getMessages2","getAnnouncementMarker"),t.bindAll(this,"_triggerJoinSession","_onJoinVoiceSession","_onLeaveVoiceSession","_onLocalMute","_setLocallyMutedUsersFromCache","_subscribeToCommunityEvents","cacheCommunities","setRole","onPromote","onDemote","_generateAnnouncementId","_onAnnouncement"),console.debug("initialize: "),this.options=t.extend({restBaseUrl:"https://api-dev.comms.razerzone.com",restBaseUrl2:"https://api-dev.comms.razerzone.com:9090",pubsubServer:"wss://pubsub.comms.razerzone.com:443/ws",pubsubBaseUrl:"https://pubsub.comms.razerzone.com",nickname:"",avatar:""},e),console.debug(this.options),console.assert(this.options.api_key&&this.options.api_key!==""),this.communities=null,this.channels=null,this.channels_map=[],this.messages_map=[],this.current_channel_id=null,this.joining_channel_id=null,this.user_map=[],this.active_channel_map=[],this.user_proflie=null,this.communities=new s,this.channels=new n.Collection,this.announcement_markers=[],this.latest_message_id=[],this.pubsub=new r({base_url:this.options.pubsubBaseUrl,ws_url:this.options.pubsubServer,api_key:this.options.api_key}),this.pubsubHandler=new f({commsCommunity:this,pubsub:this.pubsub}),this.on("post_announcement",this._onAnnouncement),this.pubsub.connect(),this.CallHandler=new u({pubsub:this.pubsub}),this.CallHandler.on("joinSession",this._onJoinVoiceSession),this.CallHandler.on("leaveSession",this._onLeaveVoiceSession),this.CallHandler.on("localMute",this._onLocalMute),this.on("joinChannel",this.onJoinChannel),this.on("leaveChannel",this.onLeaveChannel),this.on("adminRightsChanged",this.updateAdminRightsMap),this.on("promote",this.onPromote),this.on("demote",this.onDemote),this.on("ban",this.onBan),this.on("create_channel",this.onChannelCreated)},onJoinChannel:function(e,t){var n=t.channel.id;this.addToCachedMembers({channel_id:n,user:t.user})},onLeaveChannel:function(e,t){var n=t.channel.id;this.deleteFromCachedMembers({channel_id:n,user:t.user})},disconnect:function(){console.debug("CommsCommunity disconnect"),this.pubsub&&(this.pubsub.disconnect(),this.pubsub=null),this.CallHandler.isCallActive()&&this.CallHandler.hangupCall(),this.current_channel_id=null,this.communities=null,this.channels=null,this.channels_map=null,this.joining_channel_id=null,this.user_map=null,this.messages_map=null,this.active_channel_map=null,this.unbind()},close:function(){this.disconnect()},getCommunityList:function(t){console.debug("getCommunityList");var n=this,r=this.options.restBaseUrl2+"/communities";r+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){n.cacheCommunities(e.data),n.user_profile=e.user,n.CallHandler.setUser(n.user_profile),n.trigger("user_profile_success"),t.success&&t.success(e),n._subscribeToCommunityEvents({success:function(){}}),setTimeout(function(){n.trigger("communityList",e)},0)}).fail(function(e){console.error("getCommunityList error"),console.error(e)})},cacheCommunities:function(e){for(var t=0;t<e.length;t++){var n=new o(e[t]);this.communities.add(n)}this.cacheChannels()},joinAllLobby:function(e){var t=this;if(this.communities){var n=[],r={},i=0;this.communities.each(function(e){var s=e.get("channels");for(var o=0;o<s.length;o++)if(s[o].lobby){var u="channel.messages."+s[o].id;n.push(u+":presence",u);var a={role:t.getRole(e.get("id"),t.user_profile.id),comms_id:t.user_profile.comms_id};r[u]=a,i++}}),console.debug("joinAllLobby: total: "+i+" nickname: "+this.user_profile.nickname),console.assert(this.user_profile),this.user_profile||(this.user_profile={}),this.pubsub.subscribe({topics:n,user:this.user_profile,info:r,success:function(){console.debug("joinAllLobby: success:")}});var s=0;this.communities.each(function(n){var r=n.get("channels");for(var o=0;o<r.length;o++)if(r[o].lobby){var u=n.get("id"),a=r[o].id;t.joinChannel({community_id:u,channel_id:a,no_pubsub:!0,no_restapi:!0,success:function(){s++,s===i&&e.success&&e.success()}})}})}else console.warn("joinAllLobby: no community list yet"),console.assert(!1)},cacheChannels:function(){var e=this;if(!this.communities)return;this.communities.each(function(t){e.cacheChannelsPerCommunity(t)}),e.trigger("community_fetch_success")},cacheChannelsPerCommunity:function(e){var t=e.get("id"),n=e.get("name"),r=e.get("channels"),i=this;if(r.length>0)for(var s=0;s<r.length;s++){var o=r[s];i.addtoChannelsMap(o,t,n,e);var u=o.channels;if(u.length>0)for(var a=0;a<u.length;a++){var f=u[a];i.addtoChannelsMap(f,t,n,e);var l=f.channels;if(l.length>0)for(var c=0;c<l.length;c++){var h=l[c];i.addtoChannelsMap(h,t,n,e)}}}},addtoChannelsMap:function(e,t,n,r){e.community_id=t,e.community_name=n;if(this.channels){var i=this.channels.remove(e.id);i&&(i.has("expanded")&&i.get("expanded")?(console.debug(e.name+"---expanded---"+i.get("expanded")),e.expanded=!0):e.expanded=!1)}this.channels.add(e),this.setRoleMembers(e,r),this.setRoleFriends(e,r)},setRoleMembers:function(e,t){var n=[],r=t.get("admins"),i=t.get("owner"),s=e.online_members;if(s.length>0)for(var o=0;o<s.length;o++){var u=this.checkRole(s[o],r,i);n.push(u)}},setRoleFriends:function(e,t){var n=[],r=t.get("admins"),i=t.get("owner"),s=e.online_friends;if(s.length>0)for(var o=0;o<s.length;o++){var u=this.checkRole(s[o],r,i);n.push(u)}},checkRole:function(e,t,n){var r={comms_id:"",role:"member"};e.info=r;var i=e.id;if(i===n)return e.info.role="owner",e;if(t.length>0)for(var s=0;s<t.length;s++)i===t[s]&&(e.info.role="admin");return e},getCommunity:function(t){console.debug("getCommunity: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl2+"/communities/"+encodeURIComponent(t.community_id);n+="?api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){r.getAdminRights({community_id:t.community_id,success:function(n){e.adminRights=n,t.success&&t.success(e)}}),e.user&&(r.user_map[t.community_id]=e.user),r._setLocallyMutedUsersFromCache(e.channels),r._updateCommunityCache(e),r.setCommunityFocus({community_id:e.id,in_focus:!0}),r.user_profile.id===""&&e.user&&(r.user_profile=e.user,r.CallHandler.setUser(r.user_profile),r.trigger("user_profile_success")),r._triggerJoinSession(e.id,e.channels)}).fail(function(e){console.error("getCommunity error"),console.error(e),t.error&&t.error(e)})},_updateCommunityCache:function(e){console.debug("_updateCommunityCache");var t=new o(e);this.communities&&this.communities.remove(t.get("id")),this.communities.add(t),console.debug("updating channels cache"),this.cacheChannelsPerCommunity(t)},getCachedCommunity:function(e){if(this.communities){var t=this.communities.get(e.community_id);if(t)return t.toJSON()}return null},setCommunityFocus:function(e){console.debug("setCommunityFocus");if(this.communities.length>0){var t=this.communities.get(e.community_id);if(!t){console.info("setCommunityFocus: community model not found");return}t.set("in_focus",e.in_focus);if(e.in_focus===!0){t.set("unread_mention",0);var n="communityMentioned."+t.get("id");this.trigger(n,t.toJSON())}}},getCachedChannels:function(e){var t=this.getCachedCommunity(e);return t&&t.channels?t.channels:null},getCachedChannel:function(e){if(this.channels){var t=this.channels.get(e.channel_id);if(t)return t.toJSON()}return null},addToCachedMembers:function(e){if(this.channels){var t=this.channels.get(e.channel_id);if(t)if(e.user){var n=t.get("online_members");n.length<=l&&(n.push(e.user),t.set("online_members",n))}else console.debug("user info not available")}},deleteFromCachedMembers:function(e){if(this.channels){var t=this.channels.get(e.channel_id);if(t)if(e.user){var n=t.get("online_members"),r=t.get("online_members_count");for(var i=0;i<n.length;i++){var s=n[i];e.user.offset===s.offset&&e.user.id===s.id&&n.splice(i,1)}t.set("online_members_count",r-1),t.set("online_members",n)}else console.debug("user info not available")}},updateCachedFriends:function(e){if(this.channels){var t=this.channels.get(e.channel_id);t&&t.set("online_friends",e.online_friends)}},setChannelExpanded:function(e){console.debug("setChannelExpanded--"+JSON.stringify(e));if(this.channels){var t=this.channels.get(e.channel_id);t&&t.set("expanded",e.expand)}},getCachedMembers:function(e){var t=this.getCachedCommunity(e);if(t){var n=this.getCachedChannel(e);if(n)return n.online_members}return null},getChannels:function(t){console.debug("getChannels: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!=="");var n=this,r=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);r+="/channels?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getChannels error"),console.error(e)})},getChannel:function(t){console.debug("getChannel: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t.channel_id&&t.channel_id!=="");var n=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);n+="/channels/"+encodeURIComponent(t.channel_id),n+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getChannel error"),console.error(e)})},getMessages:function(t){console.debug("getMessages: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t&&t.channel_id&&t.channel_id!=="");var n=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);n+="/channels/"+encodeURIComponent(t.channel_id),n+="/messages?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getMessages error"),console.error(e)})},getMessages2:function(t){console.debug("getMessages2: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t&&t.channel_id&&t.channel_id!=="");var n=this,r=this.options.restBaseUrl2+"/communities/"+encodeURIComponent(t.community_id);r+="/channels/"+encodeURIComponent(t.channel_id),r+="/messages?api_key="+encodeURIComponent(this.options.api_key),t.limit&&(r+="&limit="+t.limit),t.offset&&(r+="&offset="+t.offset),e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){var r=t.channel_id;n.messages_map[r]=e,e.data.length>0&&(n.announcement_markers[t.channel_id]||(n.announcement_markers[t.channel_id]=e.data[e.data.length-1].message_id)),t.success&&t.success(e)}).fail(function(e){console.error("getMessages error"),console.error(e)})},getCachedMessages:function(e){console.debug("getCachedMessages"),console.assert(e&&e.community_id&&e.community_id!==""),console.assert(e.channel_id&&e.channel_id!=="");if(this.messages_map){var t=e.channel_id;if(this.messages_map[t])return this.messages_map[t]}return null},joinChannel:function(t){console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t&&t.channel_id&&t.channel_id!=="");var n=this,r=this.active_channel_map[t.community_id];if(r&&r!==t.channel_id){console.info("joinChannel: unsubscribing to current channel: "+r);var i="channel.messages."+r;n.pubsub.unsubscribe({topics:[i],success:function(){console.debug("joinChannel: unsubscribed to previous channel")}})}this.current_channel_id=t.channel_id,this.joining_channel_id=t.channel_id;if(this.user_profile.id===""){this.once("user_profile_success",function(){this.joinChannel(t)});return}var s=this.getRole(t.community_id,this.user_profile.id);if(!s||s==="")console.warn("joinChannel: user role cannot be determined"),s="member";if(t.no_restapi){n.active_channel_map[t.community_id]=t.channel_id,n.current_channel_id=t.channel_id,n.joining_channel_id=null,t.success&&t.success();return}var o={password:""};t.password&&(o.password=t.password);var u=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);u+="/channels/"+encodeURIComponent(t.channel_id),u+="/join?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"POST",url:u,dataType:"json",data:JSON.stringify(o)}).done(function(e){n.active_channel_map[t.community_id]=t.channel_id;if(t.no_pubsub){n.current_channel_id=t.channel_id,n.joining_channel_id=null,t.success&&t.success(e);return}var r="channel.messages."+t.channel_id;n.pubsub.subscribe({topics:[r+":presence",r],user:{nickname:n.user_profile.nickname,avatar:n.user_profile.avatar,info:{comms_id:n.user_profile.comms_id,role:s}},success:function(){n.current_channel_id=t.channel_id,n.joining_channel_id=null,t.success&&t.success(e);var r="join_channel_success."+t.channel_id;n.trigger(r,{id:t.channel_id}),n.trigger("join_channel_success",{id:t.channel_id})}})}).fail(function(e){t.error&&t.error(e)})},leaveChannel:function(e){console.debug("leaveChannel: "+JSON.stringify(e)),console.assert(e&&e.community_id&&e.community_id!==""),console.assert(e&&e.channel_id&&e.channel_id!=="");var t=this.getCachedChannel({community_id:e.community_id,channel_id:e.channel_id});if(!t){console.warn("leaveChannel: channel not found in cache"),e.success&&e.success();return}var n=this.getUser({community_id:e.community_id});if(!n){console.warn("leaveChannel: user not found"),e.success&&e.success();return}if(!this.pubsub){console.warn("leaveChannel: pubsub is null"),e.success&&e.success();return}delete this.active_channel_map[e.community_id];var r="channel.messages."+e.channel_id;this.pubsub.unsubscribe({topics:[r],success:function(){e.success()}})},sendMessage:function(n){console.debug("sendMessage: "+JSON.stringify(n)),console.assert(n&&n.community_id&&n.community_id!==""),console.assert(n&&n.channel_id&&n.channel_id!==""),console.assert(n&&n.message&&n.message!=="");var r=this._generateMessageId(n.message.message,n.channel_id,n.message.sender);console.debug("sendMessage: msg_id: "+r);var i=this,s=t.extend({message_id:r,community_id:n.community_id},n.message),o="channel.messages."+n.channel_id;this.pubsub.publish({topic:o,data:s,user:{nickname:this.options.nickname,avatar:this.options.avatar},success:function(){var t=i.options.restBaseUrl+"/communities/"+encodeURIComponent(n.community_id);t+="/channels/"+encodeURIComponent(n.channel_id),t+="/messages/"+encodeURIComponent(r),t+="?api_key="+encodeURIComponent(i.options.api_key),e.ajax({type:"PUT",url:t,data:JSON.stringify({message:n.message.message}),dataType:"json"}).done(function(e){n.success(r)})}})},getActive:function(e){console.debug("getActive: "+JSON.stringify(e)),console.assert(e&&e.community_id&&e.community_id!==""),console.assert(e&&e.channel_id&&e.channel_id!=="");if(this.joining_channel_id&&this.joining_channel_id===e.channel_id){console.info("getActive: join channel not yet finished: "+this.joining_channel_id);var t=this,n="join_channel_success."+e.channel_id;this.once(n,function(){t.getActive(e)});return}var r="channel.messages."+e.channel_id,i={topic:r,success:function(t){e.success(t)}};typeof e.offset!="undefined"&&(i.offset=e.offset),typeof e.limit!="undefined"&&(i.limit=e.limit),this.pubsub.getSubscribers(i)},search:function(e){console.debug("search: "+JSON.stringify(e)),console.assert(e&&e.channel_id&&e.channel_id!==""),console.assert(e&&e.query&&e.query!=="");var t="channel.messages."+e.channel_id;this.pubsub.search({topic:t,query:e.query,success:function(t){e.success(t)}})},getUser:function(e){return this.user_map[e.community_id]?this.user_map[e.community_id]:null},joinCommunity:function(t){console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id)+"/join",n+="?api_key="+encodeURIComponent(this.options.api_key);var r={password:""};t.password&&(r.password=t.password),e.ajax({type:"POST",url:n,dataType:"json",data:JSON.stringify(r)}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("joinCommunity error"),console.error(e),t.error&&t.error(e)})},promoteUser:function(t){console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t.user_id&&t.user_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/members/"+encodeURIComponent(t.user_id)+"/promote?role=admin",n+="&api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"POST",url:n,dataType:"json"}).done(function(e){var n="community.events."+t.community_id;r.pubsub.publish({topic:n,data:{event:"promote",user_id:t.user_id,community_id:t.community_id},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.error("promoteUser error"),console.error(e)})},demoteUser:function(t){console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t.user_id&&t.user_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/members/"+encodeURIComponent(t.user_id)+"/demote?role=member",n+="&api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"POST",url:n,dataType:"json"}).done(function(e){var n="community.events."+t.community_id;r.pubsub.publish({topic:n,data:{event:"demote",user_id:t.user_id,community_id:t.community_id},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.error("demoteUser error"),console.error(e)})},getCurrentChannel:function(e){var t=this.active_channel_map[e];if(t)return this.getCachedChannel({community_id:e,channel_id:t})},isCurrentUser:function(e){return this.user_profile.id!==""&&this.user_profile.id===e?!0:!1},getRole:function(e,t){console.assert(e&&e!==""),console.assert(t&&t!=="");if(this.communities){var n=this.communities.get(e);if(n)return n.get("owner")===t?"owner":n.get("admins").indexOf(t)!==-1?"admin":"member"}var r=this.getUser({community_id:e});if(r)return r.role},_generateMessageId:function(e,t,n){var r,i=new Date,s={channel:t,sender:n,message:e,timestamp:i.getTime()};return r=hex_sha1(JSON.stringify(s)),r},_appendToMessageCollection:function(e,t){if(this.messages_map){var n=e;if(this.messages_map[n]){var r=this.messages_map[n].data;r.push(t);if(r.length>40)if(t.community_id){var i=this.getCachedCommunity({community_id:t.community_id});i.unread_mention===0&&r.splice(0,1)}else r.splice(0,1);this.messages_map[n].data=r}}},_triggerJoinSession:function(e,t){for(var n=0;n<t.length;n++)this.CallHandler.triggerJoinSession(e,t[n].id),this._triggerJoinSession(e,t[n].channels)},_setLocallyMutedUsersFromCache:function(e){for(var t=0;t<e.length;t++){for(var n=0;n<e[t].online_members.length;n++)this.CallHandler.isLocallyMuted(e[t].online_members[n].id)&&(console.debug("_setLocallyMutedUsersFromCache: "+e[t].online_members[n].id+" is muted"),e[t].online_members[n].local_mute=!0);for(n=0;n<e[t].online_friends.length;n++)this.CallHandler.isLocallyMuted(e[t].online_friends[n].id)&&(e[t].online_friends[n].local_mute=!0);this._setLocallyMutedUsersFromCache(e[t].channels)}},_onJoinVoiceSession:function(e){var t=this.getCachedChannel({channel_id:e.channel.id});if(t){var n;for(var r=0;r<t.online_members.length;r++)n=t.online_members[r],n.id===e.user.id&&(n.voice_enabled=!0);for(r=0;r<t.online_friends.length;r++)n=t.online_friends[r],n.id===e.user.id&&(n.voice_enabled=!0)}},_onLeaveVoiceSession:function(e){var t=this.getCachedChannel({channel_id:e.channel.id});if(t){var n=0,r;for(n=0;n<t.online_members.length;n++)r=t.online_members[n],r.id===e.user.id&&(r.voice_enabled=!1);for(n=0;n<t.online_friends.length;n++)r=t.online_friends[n],r.id===e.user.id&&(r.voice_enabled=!1)}},_onLocalMute:function(e){var t=this.getCachedChannel({channel_id:e.channel.id});if(t){var n=0,r;for(n=0;n<t.online_members.length;n++)r=t.online_members[n],r.id===e.user.id&&(r.local_mute=e.value);for(n=0;n<t.online_friends.length;n++)r=t.online_friends[n],r.id===e.user.id&&(r.local_mute=e.value)}},getMemberList:function(t){console.debug("getMemberList: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!=="");var n=this,r=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);r+="/members?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getMemberList error"),console.error(e)})},getBanList:function(t){console.debug("getMemberList: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!=="");var n=this,r=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);r+="/banlist?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getMemberList error"),console.error(e)})},unBanUser:function(t){console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t.user_id&&t.user_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/members/"+encodeURIComponent(t.user_id)+"/unban",n+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"POST",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("unBanUser error"),console.error(e)})},banUser:function(t){console.assert(t&&t.community_id&&t.community_id!==""),console.assert(t.user_id&&t.user_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/members/"+encodeURIComponent(t.user_id)+"/ban",n+="?api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"POST",url:n,dataType:"json"}).done(function(e){var n="community.events."+t.community_id;r.pubsub.publish({topic:n,data:{event:"ban",user_id:t.user_id,community_id:t.community_id},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.error("unBanUser error"),console.error(e)})},_subscribeToCommunityEvents:function(e){var t=this,n=[];if(!this.communities){console.warn("_subscribeToCommunityEvents: communities not found");return}console.assert(this.communities),this.communities.each(function(e){var t="community.events."+e.get("id");n.push(t)}),this.pubsub.subscribe({topics:n,user:this.user_profile,success:function(){e.success()}})},getAdminRights:function(t){console.debug("getAdminRights: "+JSON.stringify(t)),console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);n+="/adminRights?api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){r.admin_rights_map[t.community_id]=e,t.success&&t.success(e)}).fail(function(e){console.error("getAdminRights error"),console.error(e)})},getCachedAdminRights:function(e){return this.admin_rights_map?this.admin_rights_map[e.community_id]?this.admin_rights_map[e.community_id]:null:null},hasRights:function(e){console.debug("hasRights: "+JSON.stringify(e)),console.assert(e&&e.community_id&&e.community_id!=="");if(this.user_map){var t=this.user_map[e.community_id];if(t){var n=t.role;if(n==="owner")return!0;if(n==="member")return!1;if(n==="admin"){if(!e.operation)return!0;if(this.admin_rights_map){var r=this.admin_rights_map[e.community_id];if(r){var i=new a(r);if(e.operation==="voice_text")return i.get("mute_channel");if(e.operation==="create_edit_delete_channel")return i.get("create_channel")===!0&&i.get("edit_channel")===!0&&i.get("delete_channel")===!0?!0:!1;if(e.operation==="ban_user")return i.get("ban_user");if(e.operation==="kick_user")return i.get("kick_user");if(e.operation==="edit_rights")return i.get("edit_rights");if(e.operation==="edit_community")return i.get("edit_community");if(e.operation==="promote_demote_user")return!1;if(e.operation==="delete_community")return!1}}}}}},getMyRole:function(e){console.assert(e&&e.community_id&&e.community_id!=="");if(this.user_map){var t=this.user_map[e.community_id];if(t)return t.role}},updateAdminRights:function(t){console.debug("updateAdminRights: "+JSON.stringify(t));var n=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);n+="/adminRights?api_key="+encodeURIComponent(this.options.api_key);var r=JSON.stringify(t.admin_rights),i=this;e.ajax({type:"PUT",url:n,dataType:"json",data:r}).done(function(e){i.admin_rights_map[t.community_id]=t.admin_rights;var n="community.events."+t.community_id;i.pubsub.publish({topic:n,data:{event:"adminRightsChanged",admin_rights:t.admin_rights,community_id:t.community_id},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.error("updateAdminRights error"),console.error(e)})},updateAdminRightsMap:function(e,t){console.debug("updateAdminRightsMap"),this.admin_rights_map[t.community_id]=t.admin_rights,console.debug("new admin rights"),console.debug(this.admin_rights_map[t.community_id])},isActive:function(e){var t=this.getCachedCommunity(e),n=!1;if(t){var r=t.channels;if(r.length>0)for(var i=0;i<r.length;i++){var s=r[i];n=this.checkOnlineMembers(s.id,e.user_id);if(n)return n;var o=s.channels;if(o.length>0)for(var u=0;u<o.length;u++){var a=o[u];n=this.checkOnlineMembers(a.id,e.user_id);if(n)return n;var f=a.channels;if(f.length>0)for(var l=0;l<f.length;l++){var c=f[l];n=this.checkOnlineMembers(c.id,e.user_id);if(n)return n}}}}return n},checkOnlineMembers:function(e,t){var n=this.getCachedChannel({channel_id:e});if(n){var r=n.online_members;if(r.length>0)for(var i=0;i<r.length;i++){var s=r[i].id;if(s===t)return!0}}return!1},deleteCommunity:function(t){console.assert(t&&t.community_id&&t.community_id!=="");var n=this,r=this.options.restBaseUrl+"/communities/";r+=encodeURIComponent(t.community_id),r+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"DELETE",url:r,dataType:"json"}).done(function(e){var r="community.events."+t.community_id;n.pubsub.publish({topic:r,data:{event:"communityDeleted",community_id:t.community_id},success:function(){}}),t.success&&t.success(e)}).fail(function(e){console.error("Delete error"),console.error(e)})},getOwnGameList:function(t){console.debug("getOwnGameList: "+JSON.stringify(t));var n=this.options.restBaseUrl+"/users/me/games?api_key="+encodeURIComponent(this.options.api_key),r=this;e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getOwnGameList error"),console.error(e)})},getMasterGameList:function(t){console.debug("getMasterGameList: "+JSON.stringify(t));var n=this.options.restBaseUrl+"/mgl?api_key="+encodeURIComponent(this.options.api_key),r=this;e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getMasterGameList"),console.error(e)})},createCommunity:function(t){var n=this.options.restBaseUrl+"/communities",r=JSON.stringify(t.community),i=this,s={type:"POST",url:n,dataType:"json",cache:!1,data:r};i.options.api_key&&i.options.api_key!==""&&(s.headers={Authorization:"Basic "+btoa(i.options.api_key+":"+"")}),e.ajax(s).done(function(e){i.newlyCreatedCommunityId=e.id;var n={name:"Game lobby",lobby:!0};i.createChannel({community_id:e.id,channel:n,success:function(n){e.lobby_id=n.id,t.success&&t.success(e),i.user_profile&&i.user_profile.id!==""&&i.pubsub.publish({topic:"community:"+i.user_profile.id,data:{event:"community:created",community:e}})}})}).fail(function(e){console.log("Create community error: "+e.responseText)})},createChannel:function(n){var r=this.options.restBaseUrl+"/communities/"+encodeURIComponent(n.community_id);r+="/channels?api_key="+encodeURIComponent(this.options.api_key);var i=JSON.stringify(n.channel),s=this,o={type:"POST",url:r,dataType:"json",cache:!1,data:i};e.ajax(o).done(function(e){var r=t.extend({},n.channel,e);r.lobby=!1,r.active_count=0,r.active=0,r.topic="",r.anti_spam=!1,r.online_members_count=0,r.online_members=[],r.channels=[],r.online_friends=[];var i="community.events."+n.community_id;s.pubsub.publish({topic:i,data:{event:"create_channel",community_id:n.community_id,channel:r},success:function(){n.success&&n.success(e)}})}).fail(function(e){console.log("Create community error: "+e.responseText)})},createSubChannel:function(n){var r=this.options.restBaseUrl+"/communities/"+encodeURIComponent(n.community_id);r+="/channels/"+encodeURIComponent(n.parent_id)+"/channels?api_key="+encodeURIComponent(this.options.api_key);var i=JSON.stringify(n.channel),s=this,o={type:"POST",url:r,dataType:"json",cache:!1,data:i};e.ajax(o).done(function(e){var r=t.extend({},n.channel,e);r.lobby=!1,r.active_count=0,r.active=0,r.topic="",r.anti_spam=!1,r.online_members_count=0,r.online_members=[],r.channels=[],r.online_friends=[];var i="community.events."+n.community_id;s.pubsub.publish({topic:i,data:{event:"create_channel",community_id:n.community_id,channel:r},success:function(){n.success&&n.success(e)}})}).fail(function(e){console.log("Create community error: "+e.responseText)})},deleteChannel:function(t){var n=this.options.restBaseUrl+"/communities/"+encodeURIComponent(t.community_id);n+="/channels/"+encodeURIComponent(t.channel_id)+"?api_key="+encodeURIComponent(this.options.api_key);var r=this,i={type:"DELETE",url:n,dataType:"json"};e.ajax(i).done(function(e){var n="community.events."+t.community_id;r.pubsub.publish({topic:n,data:{event:"delete_channel",community_id:t.community_id,channel_id:t.channel_id,channel:{id:t.channel_id}},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.log("Delete Channel error: "+e.responseText)})},onChannelCreated:function(e,t){console.debug("onChannelCreated updating the cache");var n=t.channel,r=this.getCachedChannels({community_id:t.community_id});if(n.parent&&n.parent!==""){var i=this.getCachedChannel({channel_id:n.parent});i&&i.channels.push(n)}else n.parent_id="",r.push(n);var s=this.communities.get(t.community_id);s.set("channels",r),this.cacheChannelsPerCommunity(s)},addToCachedCommunities:function(e){this.communities.add(e.community);var t=this;this.getCommunity({community_id:e.community_id,success:function(e){t._updateCommunityCache(e)}})},uploadFile:function(t){var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/files/"+encodeURIComponent(t.filename)+"?base64=true",n+="&api_key="+encodeURIComponent(this.options.api_key);var r=t.base64Data,i=this,s={type:"POST",url:n,dataType:"json",cache:!1,data:r};e.ajax(s).done(function(e){t.success&&t.success(e)}).fail(function(e){console.log("uploadFile error: "+e.responseText)})},updateCommunity:function(t){var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="?api_key="+encodeURIComponent(this.options.api_key);var r=JSON.stringify(t.community),i=this,s={type:"PUT",url:n,dataType:"json",cache:!1,data:r};e.ajax(s).done(function(e){var n="community.events."+t.community_id;i.pubsub.publish({topic:n,data:{event:"communityEdited",community_id:t.community_id},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.log("updateCommunity: "+e.responseText)})},onPromote:function(e,t){console.debug("onPromote");var n=t.user_id,r=this.getUser({community_id:t.community_id});r&&r.id===n&&this.setRole("admin",t)},onDemote:function(e,t){console.debug("onDemote");var n=t.user_id,r=this.getUser({community_id:t.community_id});console.debug("me"),console.debug(r),r&&r.id===n&&this.setRole("member",t)},setRole:function(e,t){console.debug("setRole--"+e);var n=this.communities.get(t.community_id);console.debug("community"),console.debug(n);var r=n.get("user");r.role=e,n.set("user",r),this.user_map[t.community_id]=r},onBan:function(e,t){var n=t.user_id,r=this.getUser({community_id:t.community_id});if(r&&r.id===n){console.debug("I am banned"),this.trigger("me_banned",t);var i="communityDeleted."+t.community_id;this.trigger(i,e,t)}},leaveCommunity:function(t){console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/leave?api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"POST",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e);var n="communityDeleted."+t.community_id;r.trigger(n)}).fail(function(e){console.error("leaveCommunity error"),console.error(e)})},sendAnnouncement:function(t){console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/announcements?api_key="+encodeURIComponent(this.options.api_key);var r=this._generateAnnouncementId(t),i={message:t.message,message_id:r};i=JSON.stringify(i);var s=this;e.ajax({type:"POST",url:n,dataType:"json",data:i}).done(function(e){var n="community.events."+t.community_id;s.pubsub.publish({topic:n,data:{event:"post_announcement",community_id:t.community_id,announcement:e},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.error("sendAnnouncement error"),console.error(e)})},_generateAnnouncementId:function(e){var t,n=new Date,r={community:e.community_id,message:e.message,timestamp:n.getTime()};return t=hex_sha1(JSON.stringify(r)),t},deleteAnnouncements:function(t){console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/announcements?api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"DELETE",url:n,dataType:"json"}).done(function(e){var n="community.events."+t.community_id;r.pubsub.publish({topic:n,data:{event:"clear_announcement",community_id:t.community_id},success:function(){t.success&&t.success(e)}});if(r.communities){var i=r.communities.get(t.community_id);i&&(console.debug("Unsetting last_announcement"),i.unset("last_announcement"))}}).fail(function(e){console.error("deleteAnnouncements error"),console.error(e)})},markAnnouncementRead:function(t){console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/announcements/"+encodeURIComponent(t.message_id)+"/mark?api_key="+encodeURIComponent(this.options.api_key);var r=this;e.ajax({type:"POST",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e);var n="announcementMarked."+t.community_id;r.trigger(n)}).fail(function(e){console.error("markAnnouncementRead error"),console.error(e)})},updateChannel:function(t){console.assert(t&&t.community_id&&t.community_id!=="");var n=this.options.restBaseUrl+"/communities/";n+=encodeURIComponent(t.community_id),n+="/channels/"+encodeURIComponent(t.channel_id)+"?api_key="+encodeURIComponent(this.options.api_key);var r=this,i=JSON.stringify(t.channel);e.ajax({type:"PUT",url:n,dataType:"json",data:i}).done(function(e){t.channel.id=t.channel_id;var n="community.events."+t.community_id;r.pubsub.publish({topic:n,data:{event:"edit_channel",community_id:t.community_id,channel:t.channel},success:function(){t.success&&t.success(e)}})}).fail(function(e){console.error("updateChannel error"),console.error(e)})},getPopularCommunities:function(t){var n=this,r=this.options.restBaseUrl+"/communities/recommendations/popular?sort=members&all=true";r+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("getPopularCommunities error"),console.error(e)})},searchCommunities:function(t){var n=this,r=this.options.restBaseUrl+"/communities/search?keyword="+encodeURIComponent(t.query);e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("searchCommunities error"),console.error(e)})},saveLinkPreview:function(n){console.assert(n);var r=t.extend({community_id:"",channel_id:"",message_id:"",type:"website",data:{}},n);console.assert(r.channel_id!==""),console.assert(r.community_id!==""),console.assert(r.message_id!=="");var i=this.options.restBaseUrl2+"/communities/"+encodeURIComponent(r.community_id);i+="/attachments",i+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"POST",url:i,dataType:"json",contentType:"application/json",data:JSON.stringify(r)}).done(function(e){n.success&&n.success(e)}).fail(function(e){console.error("saveLinkPreview: error:"),console.error(e),n.error&&n.error(e)})},getAnnouncementMarker:function(e){if(!this.announcement_markers[e])return null;var t=this.announcement_markers[e];return t},_onAnnouncement:function(e,t){console.debug("_onAnnouncement: topic: "+e),console.debug(t);var n=this,r=t.community_id,i=this.getCachedChannels({community_id:r});if(i&&i.length){var s=function(e){for(var t=0;t<e.length;t++)delete n.announcement_markers[e[t].id],e[t].channels&&e[t].channels.length>0&&s(e[t].channels)};s(i)}}}),c}),define("views/loginview",["jquery","underscore","backbone","text!templates/loginview.html","velocity-ui","communitysdk/commscommunity"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"login-view",isWebkit:!1,events:{"click .continue-button":"_onLoginClick",'keyup input[name="password"]':"_onPasswordKeyup",'change input[name="password"]':"_checkforPasswordEmail","click .forgot_password":"_onForgotPasswordClicked",'change input[type="checkbox"]':"onCheckboxChanged","click .signup":"_onSignupClicked",'keyup input[name="username"]':"_InputKeypressUserName",'change input[name="username"]':"_checkforPasswordEmail"},stay_connected:!0,firsttime:!0,initialize:function(e){t.bindAll(this,"close","_checkforPasswordEmail"),this.options=e,this.template=t.template(r);var n=this;this.isWebkit=/(safari|chrome)/.test(navigator.userAgent.toLowerCase());var i=setInterval(function(){n.firsttime?n._checkforPasswordEmail():clearInterval(i)},500);window.localStorage.setItem("stay_connected",this.stay_connected)},render:function(){this.$el.html(this.template()),this.$(".logo").velocity("transition.expandIn"),this._checkforPasswordEmail();if(window.nodeRequire){const e=nodeRequire("electron").ipcRenderer;e.send("show_mainWindow")}return this},close:function(){console.debug("close"),this.remove(),this.unbind()},_InputKeypressUserName:function(){this._checkforPasswordEmail()},_onLoginClick:function(){var t=this.$('input[name="username"]').val(),n=this.$('input[name="password"]').val();if(t===""||n==="")return;console.debug("_onLoginClick: uname: '"+t+"'"),e("body").addClass("rc-loading");var r=this;this.options.sharedObjects.comms.login({username:t,password:n,success:function(t){console.debug("login success: "+JSON.stringify(t));var n=t.api_key,i=t.uuid,o=t.refresh_token;r.options.sharedObjects.commsCommunity=new s({api_key:n});var u=function(){r.options.sharedObjects.apiKey=n,window.localStorage.setItem("comms_api_key",n),window.localStorage.setItem("comms_uuid",i),o&&o!==""&&window.localStorage.setItem("rt",o);var e=sessionStorage.getItem("fragment");e&&e!==""?(sessionStorage.removeItem("fragment"),r.options.sharedObjects.router.navigate(e,{trigger:!0})):r.options.sharedObjects.router.navigate("activity",{trigger:!0})};r.options.sharedObjects.comms.getUser({user_id:t.user_id,server_cache:!1,success:function(t){e("body").removeClass("rc-loading"),console.debug("getUser response: "+JSON.stringify(t));var s=!1;if(!t.nickname||t.nickname==="")console.info("no nickname"),s=!0;if(!t.comms_id||t.comms_id==="")s=!0;s?(window.localStorage.setItem("comms_api_key",n),window.localStorage.setItem("comms_uuid",i),o&&o!==""&&window.localStorage.setItem("rt",o),r.options.sharedObjects.router.navigate("updatenick",{trigger:!0})):u()}})},error:function(){e("body").removeClass("rc-loading"),r.$("input").velocity("callout.shake"),r.$(".err-mesg").show()}})},_onPasswordKeyup:function(e){this._checkforPasswordEmail(),e.which===13&&this._onLoginClick()},_inWhiteList:function(e){if(e.indexOf("@razerzone.com")!==-1)return!0;if(e.indexOf("yvonne2012")===0)return!0;if(e.indexOf("yvonne2016")===0)return!0;if(e.indexOf("rzxmpp@gmail.com")===0)return!0;if(e.indexOf("wingy.phone@gmail.com")===0)return!0;if(e.indexOf("wingy.trade@gmail.com")===0)return!0;if(e.indexOf("pallavi_242654")===0)return!0;if(e.indexOf("tonjun")===0)return!0;var t=["01eddardstark@gmail.com","02aryastark@gmail.com","03jonnysnow@gmail.com","commie001@mailinator.com","commie002@mailinator.com","commie003@mailinator.com","timmymayes@gmail.com","rzintern1@gmail.com","rzintern1@hotmail.com","rzintern1@yahoo.com.sg","rzintern1adm@gmail.com","rzintern2@hotmail.com","rzintern2@gmail.com","rzintern2adm@hotmail.com","rzintern2adm@hotmail.com","rzintern03@gmail.com","rzintern03@yahoo.com.sg","rzintern03@hotmail.com","rzinternadm03@gmail.com","rzintern4@yahoo.com.sg","rzintern4@hotmail.com","rzintern4@gmail.com","rzinternadm04@gmail.com","710956@gmail.com.","fexslpro@gmail.com","yunooi@yahoo.com","quietuslstd@hotmail.com","david.lstd@gmail.com","quietuslstd@yahoo.com","laurent@legraverend.fr","bouillotalexandre@gmail.com","quentinbeau@noos.fr","quentinbeau@gmail.com"];return t.indexOf(e)!==-1?(console.info("in allow list"),!0):!1},_onForgotPasswordClicked:function(){window.open("https://ec.razerzone.com/requestreset?l=en","Password")},onCheckboxChanged:function(){var e=this.$('input[type="checkbox"]').is(":checked");this.stay_connected=e,console.debug("  is_checked: "+e),window.localStorage.setItem("stay_connected",this.stay_connected)},_onSignupClicked:function(){console.debug("_onSignupClicked");var e="https://razer-id.razerzone.com/new?redirect=https%3A%2F%2Fweb.comms.razerzone.com";window.location.assign(e)},_checkforPasswordEmail:function(){var e=this.$('input[name="username"]').val(),t=this.$('input[type="password"]').val();if(!this.isWebkit)e!==""&&e!==undefined&&t!==undefined&&t!==""?(this.$(".continue-button").removeClass("rc-disabled-button"),this.firsttime=!1):this.$(".continue-button").addClass("rc-disabled-button");else{var n=this.$("#password:-webkit-autofill").length>0;e!==""&&e!==undefined&&(t!==undefined&&t!==""||n)?(this.$(".continue-button").removeClass("rc-disabled-button"),this.firsttime=!1):this.$(".continue-button").addClass("rc-disabled-button")}}});return o}),function(e,t){typeof define=="function"&&define.amd?define("razercomms",["jquery","underscore","backbone"],t):e.RazerComms=t(e.$)}(this,function(e){function t(e){return p(s(c(e),8*e.length))}function n(e){return h(s(c(e),8*e.length))}function r(e,t){return p(a(e,t))}function i(e,t){return h(a(e,t))}function s(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n,r,i,s,a,c,h,p,d=new Array(80),v=1732584193,m=-271733879,g=-1732584194,y=271733878,b=-1009589776;for(n=0;n<e.length;n+=16){for(s=v,a=m,c=g,h=y,p=b,r=0;80>r;r++)d[r]=16>r?e[n+r]:l(d[r-3]^d[r-8]^d[r-14]^d[r-16],1),i=f(f(l(v,5),o(r,m,g,y)),f(f(b,d[r]),u(r))),b=y,y=g,g=l(m,30),m=v,v=i;v=f(v,s),m=f(m,a),g=f(g,c),y=f(y,h),b=f(b,p)}return[v,m,g,y,b]}function o(e,t,n,r){return 20>e?t&n|~t&r:40>e?t^n^r:60>e?t&n|t&r|n&r:t^n^r}function u(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function a(e,t){var n=c(e);n.length>16&&(n=s(n,8*e.length));for(var r=new Array(16),i=new Array(16),o=0;16>o;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var u=s(r.concat(c(t)),512+8*t.length);return s(i.concat(u),672)}function f(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function l(e,t){return e<<t|e>>>32-t}function c(e){for(var t=[],n=255,r=0;r<8*e.length;r+=8)t[r>>5]|=(e.charCodeAt(r/8)&n)<<24-r%32;return t}function h(e){for(var t="",n=255,r=0;r<32*e.length;r+=8)t+=String.fromCharCode(e[r>>5]>>>24-r%32&n);return t}function p(e){for(var t,n,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",s=0;s<4*e.length;s+=3)for(t=(e[s>>2]>>8*(3-s%4)&255)<<16|(e[s+1>>2]>>8*(3-(s+1)%4)&255)<<8|e[s+2>>2]>>8*(3-(s+2)%4)&255,n=0;4>n;n++)i+=8*s+6*n>32*e.length?"=":r.charAt(t>>6*(3-n)&63);return i}function d(e){return E(b(T(e)))}function t(e){return S(b(T(e)))}function v(e,t){return x(b(T(e)),t)}function m(e,t){return E(w(T(e),T(t)))}function r(e,t){return S(w(T(e),T(t)))}function g(e,t,n){return x(w(T(e),T(t)),n)}function y(){return d("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function b(e){return L(A(k(e),e.length*8))}function w(e,t){var n=k(e);n.length>16&&(n=A(n,e.length*8));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=A(r.concat(k(t)),512+t.length*8);return L(A(i.concat(o),672))}function E(e){try{j}catch(t){j=0}var n=j?"0123456789ABCDEF":"0123456789abcdef",r="",i;for(var s=0;s<e.length;s++)i=e.charCodeAt(s),r+=n.charAt(i>>>4&15)+n.charAt(i&15);return r}function S(e){try{F}catch(t){F=""}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=e.length;for(var s=0;s<i;s+=3){var o=e.charCodeAt(s)<<16|(s+1<i?e.charCodeAt(s+1)<<8:0)|(s+2<i?e.charCodeAt(s+2):0);for(var u=0;u<4;u++)s*8+u*6>e.length*8?r+=F:r+=n.charAt(o>>>6*(3-u)&63)}return r}function x(e,t){var n=t.length,r=Array(),i,s,o,u,a=Array(Math.ceil(e.length/2));for(i=0;i<a.length;i++)a[i]=e.charCodeAt(i*2)<<8|e.charCodeAt(i*2+1);while(a.length>0){u=Array(),o=0;for(i=0;i<a.length;i++){o=(o<<16)+a[i],s=Math.floor(o/n),o-=s*n;if(u.length>0||s>0)u[u.length]=s}r[r.length]=o,a=u}var f="";for(i=r.length-1;i>=0;i--)f+=t.charAt(r[i]);var l=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));for(i=f.length;i<l;i++)f=t[0]+f;return f}function T(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t}function N(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function C(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function k(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<24-n%32;return t}function L(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function A(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n=Array(80),r=1732584193,i=-271733879,s=-1732584194,a=271733878,l=-1009589776;for(var c=0;c<e.length;c+=16){var h=r,p=i,d=s,v=a,m=l;for(var g=0;g<80;g++){g<16?n[g]=e[c+g]:n[g]=O(n[g-3]^n[g-8]^n[g-14]^n[g-16],1);var y=f(f(O(r,5),o(g,i,s,a)),f(f(l,n[g]),u(g)));l=a,a=s,s=O(i,30),i=r,r=y}r=f(r,h),i=f(i,p),s=f(s,d),a=f(a,v),l=f(l,m)}return Array(r,i,s,a,l)}function o(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function u(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function f(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function O(e,t){return e<<t|e>>>32-t}var M,D,P;(function(e){function t(e,t){return g.call(e,t)}function n(e,t){var n,r,i,s,o,u,a,f,l,c,h,p=t&&t.split("/"),d=v.map,m=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,v.nodeIdCompat&&b.test(e[o])&&(e[o]=e[o].replace(b,"")),e=p.slice(0,p.length-1).concat(e);for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||m)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,u=l;break}}}if(s)break;!a&&m&&m[r]&&(a=m[r],f=l)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function r(t,n){return function(){var r=y.call(arguments,0);return typeof r[0]!="string"&&r.length===1&&r.push(null),l.apply(e,r.concat([t,n]))}}function i(e){return function(t){return n(t,e)}}function s(e){return function(t){p[e]=t}}function o(n){if(t(d,n)){var r=d[n];delete d[n],m[n]=!0,f.apply(e,r)}if(!t(p,n)&&!t(m,n))throw new Error("No "+n);return p[n]}function u(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function a(e){return function(){return v&&v.config&&v.config[e]||{}}}var f,l,c,h,p={},d={},v={},m={},g=Object.prototype.hasOwnProperty,y=[].slice,b=/\.js$/;c=function(e,t){var r,s=u(e),a=s[0];return e=s[1],a&&(a=n(a,t),r=o(a)),a?r&&r.normalize?e=r.normalize(e,i(t)):e=n(e,t):(e=n(e,t),s=u(e),a=s[0],e=s[1],a&&(r=o(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:r}},h={require:function(e){return r(e)},exports:function(e){var t=p[e];return typeof t!="undefined"?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:a(e)}}},f=function(n,i,u,a){var f,l,v,g,y,b=[],w=typeof u,E;a=a||n;if(w==="undefined"||w==="function"){i=!i.length&&u.length?["require","exports","module"]:i;for(y=0;y<i.length;y+=1){g=c(i[y],a),l=g.f;if(l==="require")b[y]=h.require(n);else if(l==="exports")b[y]=h.exports(n),E=!0;else if(l==="module")f=b[y]=h.module(n);else if(t(p,l)||t(d,l)||t(m,l))b[y]=o(l);else{if(!g.p)throw new Error(n+" missing "+l);g.p.load(g.n,r(a,!0),s(l),{}),b[y]=p[l]}}v=u?u.apply(p[n],b):undefined;if(n)if(f&&f.exports!==e&&f.exports!==p[n])p[n]=f.exports;else if(v!==e||!E)p[n]=v}else n&&(p[n]=u)},M=D=l=function(t,n,r,i,s){if(typeof t=="string")return h[t]?h[t](n):o(c(t,n).f);if(!t.splice){v=t,v.deps&&l(v.deps,v.callback);if(!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},typeof r=="function"&&(r=i,i=s),i?f(e,t,n,r):setTimeout(function(){f(e,t,n,r)},4),l},l.config=function(e){return l(e)},M._defined=p,P=function(e,n,r){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");n.splice||(r=n,n=[]),!t(p,e)&&!t(d,e)&&(d[e]=[e,n,r])},P.amd={jQuery:!0}})(),P("../tools/almond",function(){});var H=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t){var n,r,i,s,o,u,a,f="",l=0;do n=t.charCodeAt(l++),r=t.charCodeAt(l++),i=t.charCodeAt(l++),s=n>>2,o=(3&n)<<4|r>>4,u=(15&r)<<2|i>>6,a=63&i,isNaN(r)?u=a=64:isNaN(i)&&(a=64),f=f+e.charAt(s)+e.charAt(o)+e.charAt(u)+e.charAt(a);while(l<t.length);return f},decode:function(t){var n,r,i,s,o,u,a,f="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do s=e.indexOf(t.charAt(l++)),o=e.indexOf(t.charAt(l++)),u=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),n=s<<2|o>>4,r=(15&o)<<4|u>>2,i=(3&u)<<6|a,f+=String.fromCharCode(n),64!=u&&(f+=String.fromCharCode(r)),64!=a&&(f+=String.fromCharCode(i));while(l<t.length);return f}};return t}(),B=function(){var e=function(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n},t=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},r=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},i=function(e){for(var t="0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n},s=function(n,r,i,s,o,u){return e(t(e(e(r,n),e(s,u)),o),i)},o=function(e,t,n,r,i,o,u){return s(t&n|~t&r,e,t,i,o,u)},u=function(e,t,n,r,i,o,u){return s(t&r|n&~r,e,t,i,o,u)},a=function(e,t,n,r,i,o,u){return s(t^n^r,e,t,i,o,u)},f=function(e,t,n,r,i,o,u){return s(n^(t|~r),e,t,i,o,u)},l=function(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var r,i,s,l,c=1732584193,h=-271733879,p=-1732584194,d=271733878,v=0;v<t.length;v+=16)r=c,i=h,s=p,l=d,c=o(c,h,p,d,t[v+0],7,-680876936),d=o(d,c,h,p,t[v+1],12,-389564586),p=o(p,d,c,h,t[v+2],17,606105819),h=o(h,p,d,c,t[v+3],22,-1044525330),c=o(c,h,p,d,t[v+4],7,-176418897),d=o(d,c,h,p,t[v+5],12,1200080426),p=o(p,d,c,h,t[v+6],17,-1473231341),h=o(h,p,d,c,t[v+7],22,-45705983),c=o(c,h,p,d,t[v+8],7,1770035416),d=o(d,c,h,p,t[v+9],12,-1958414417),p=o(p,d,c,h,t[v+10],17,-42063),h=o(h,p,d,c,t[v+11],22,-1990404162),c=o(c,h,p,d,t[v+12],7,1804603682),d=o(d,c,h,p,t[v+13],12,-40341101),p=o(p,d,c,h,t[v+14],17,-1502002290),h=o(h,p,d,c,t[v+15],22,1236535329),c=u(c,h,p,d,t[v+1],5,-165796510),d=u(d,c,h,p,t[v+6],9,-1069501632),p=u(p,d,c,h,t[v+11],14,643717713),h=u(h,p,d,c,t[v+0],20,-373897302),c=u(c,h,p,d,t[v+5],5,-701558691),d=u(d,c,h,p,t[v+10],9,38016083),p=u(p,d,c,h,t[v+15],14,-660478335),h=u(h,p,d,c,t[v+4],20,-405537848),c=u(c,h,p,d,t[v+9],5,568446438),d=u(d,c,h,p,t[v+14],9,-1019803690),p=u(p,d,c,h,t[v+3],14,-187363961),h=u(h,p,d,c,t[v+8],20,1163531501),c=u(c,h,p,d,t[v+13],5,-1444681467),d=u(d,c,h,p,t[v+2],9,-51403784),p=u(p,d,c,h,t[v+7],14,1735328473),h=u(h,p,d,c,t[v+12],20,-1926607734),c=a(c,h,p,d,t[v+5],4,-378558),d=a(d,c,h,p,t[v+8],11,-2022574463),p=a(p,d,c,h,t[v+11],16,1839030562),h=a(h,p,d,c,t[v+14],23,-35309556),c=a(c,h,p,d,t[v+1],4,-1530992060),d=a(d,c,h,p,t[v+4],11,1272893353),p=a(p,d,c,h,t[v+7],16,-155497632),h=a(h,p,d,c,t[v+10],23,-1094730640),c=a(c,h,p,d,t[v+13],4,681279174),d=a(d,c,h,p,t[v+0],11,-358537222),p=a(p,d,c,h,t[v+3],16,-722521979),h=a(h,p,d,c,t[v+6],23,76029189),c=a(c,h,p,d,t[v+9],4,-640364487),d=a(d,c,h,p,t[v+12],11,-421815835),p=a(p,d,c,h,t[v+15],16,530742520),h=a(h,p,d,c,t[v+2],23,-995338651),c=f(c,h,p,d,t[v+0],6,-198630844),d=f(d,c,h,p,t[v+7],10,1126891415),p=f(p,d,c,h,t[v+14],15,-1416354905),h=f(h,p,d,c,t[v+5],21,-57434055),c=f(c,h,p,d,t[v+12],6,1700485571),d=f(d,c,h,p,t[v+3],10,-1894986606),p=f(p,d,c,h,t[v+10],15,-1051523),h=f(h,p,d,c,t[v+1],21,-2054922799),c=f(c,h,p,d,t[v+8],6,1873313359),d=f(d,c,h,p,t[v+15],10,-30611744),p=f(p,d,c,h,t[v+6],15,-1560198380),h=f(h,p,d,c,t[v+13],21,1309151649),c=f(c,h,p,d,t[v+4],6,-145523070),d=f(d,c,h,p,t[v+11],10,-1120210379),p=f(p,d,c,h,t[v+2],15,718787259),h=f(h,p,d,c,t[v+9],21,-343485551),c=e(c,r),h=e(h,i),p=e(p,s),d=e(d,l);return[c,h,p,d]},c={hexdigest:function(e){return i(l(n(e),8*e.length))},hash:function(e){return r(l(n(e),8*e.length))}};return c}();Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,r=Array.prototype.concat,i=n.call(arguments,1);return function(){return t.apply(e?e:this,r.call(i,n.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),function(e){function t(e,t){return new f.Builder(e,t)}function s(e){return new f.Builder("message",e)}function o(e){return new f.Builder("iq",e)}function u(e){return new f.Builder("presence",e)}var f;f={VERSION:"1.1.3",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<f.XHTML.tags.length;t++)if(e==f.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof f.XHTML.attributes[e]&&f.XHTML.attributes[e].length>0)for(var n=0;n<f.XHTML.attributes[e].length;n++)if(t==f.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<f.XHTML.css.length;t++)if(e==f.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){f.NS[e]=t},forEachChild:function(e,t,n){var r,i;for(r=0;r<e.childNodes.length;r++)i=e.childNodes[r],i.nodeType!=f.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)},isTagEqual:function(e,t){return e.tagName.toLowerCase()==t.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return f._xmlGenerator||(f._xmlGenerator=f._makeGenerator()),f._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(r){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,r,i=f.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++)if(arguments[t])if("string"==typeof arguments[t]||"number"==typeof arguments[t])i.appendChild(f.xmlTextNode(arguments[t]));else if("object"==typeof arguments[t]&&"function"==typeof arguments[t].sort)for(n=0;n<arguments[t].length;n++)"object"==typeof arguments[t][n]&&"function"==typeof arguments[t][n].sort&&i.setAttribute(arguments[t][n][0],arguments[t][n][1]);else if("object"==typeof arguments[t])for(r in arguments[t])arguments[t].hasOwnProperty(r)&&i.setAttribute(r,arguments[t][r]);return i},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlTextNode:function(e){return f.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==f.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType==f.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return f.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType==f.ElementType.NORMAL){for(n=f.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName.toLowerCase(),e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(f.copyElement(e.childNodes[t]))}else e.nodeType==f.ElementType.TEXT&&(n=f.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,r,i,s,o,u,a,l,c,h;if(e.nodeType==f.ElementType.NORMAL)if(i=e.nodeName.toLowerCase(),f.XHTML.validTag(i))try{for(n=f.xmlElement(i),t=0;t<f.XHTML.attributes[i].length;t++)if(s=f.XHTML.attributes[i][t],o=e.getAttribute(s),"undefined"!=typeof o&&null!==o&&""!==o&&o!==!1&&0!==o)if("style"==s&&"object"==typeof o&&"undefined"!=typeof o.cssText&&(o=o.cssText),"style"==s){for(u=[],a=o.split(";"),r=0;r<a.length;r++)l=a[r].split(":"),c=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),f.XHTML.validCSS(c)&&(h=l[1].replace(/^\s*/,"").replace(/\s*$/,""),u.push(c+": "+h));u.length>0&&(o=u.join("; "),n.setAttribute(s,o))}else n.setAttribute(s,o);for(t=0;t<e.childNodes.length;t++)n.appendChild(f.createHtml(e.childNodes[t]))}catch(p){n=f.xmlTextNode("")}else for(n=f.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(f.createHtml(e.childNodes[t]));else if(e.nodeType==f.ElementType.FRAGMENT)for(n=f.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(f.createHtml(e.childNodes[t]));else e.nodeType==f.ElementType.TEXT&&(n=f.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=f.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},log:function(){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,r,i=e.nodeName;for(e.getAttribute("_realname")&&(i=e.getAttribute("_realname")),t="<"+i,n=0;n<e.attributes.length;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName.toLowerCase()+"='"+e.attributes[n].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch(r=e.childNodes[n],r.nodeType){case f.ElementType.NORMAL:t+=f.serialize(r);break;case f.ElementType.TEXT:t+=f.xmlescape(r.nodeValue);break;case f.ElementType.CDATA:t+="<![CDATA["+r.nodeValue+"]]>"}t+="</"+i+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){f._connectionPlugins[e]=t}},f.Builder=function(e,t){("presence"==e||"message"==e||"iq"==e)&&(t&&!t.xmlns?t.xmlns=f.NS.CLIENT:t||(t={xmlns:f.NS.CLIENT})),this.nodeTree=f.xmlElement(e,t),this.node=this.nodeTree},f.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return f.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t]);return this},c:function(e,t,n){var r=f.xmlElement(e,t,n);return this.node.appendChild(r),n||(this.node=r),this},cnode:function(e){var t,n=f.xmlGenerator();try{t=void 0!==n.importNode}catch(r){t=!1}var i=t?n.importNode(e,!0):f.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(e){var t=f.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=f.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},f.Handler=function(e,t,n,r,i,s,o){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=o||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?s?f.getBareJidFromJid(s):null:s,this.user=!0},f.Handler.prototype={isMatch:function(e){var t,n=null;if(n=this.options.matchBare?f.getBareJidFromJid(e.getAttribute("from")):e.getAttribute("from"),t=!1,this.ns){var r=this;f.forEachChild(e,null,function(e){e.getAttribute("xmlns")==r.ns&&(t=!0)}),t=t||e.getAttribute("xmlns")==this.ns}else t=!0;return!t||this.name&&!f.isTagEqual(e,this.name)||this.type&&e.getAttribute("type")!=this.type||this.id&&e.getAttribute("id")!=this.id||this.from&&n!=this.from?!1:!0},run:function(e){var t=null;try{t=this.handler(e)}catch(n){throw n.sourceURL?f.fatal("error: "+this.handler+" "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message):n.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",n,n.message)),f.fatal("error: "+this.handler+" "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message)):f.fatal("error: "+n.message+"\n"+n.stack),n}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},f.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},f.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},f.Connection=function(e,t){this.service=e,this.options=t||{};var n=this.options.protocol||"";this._proto=0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?new f.Websocket(this):new f.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var r in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(r)){var i=f._connectionPlugins[r],s=function(){};s.prototype=i,this[r]=new s,this[r].init(this)}},f.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){return"string"==typeof e||"number"==typeof e?++this._uniqueId+":"+e:++this._uniqueId+""},connect:function(e,t,n,r,i,s){this.jid=e,this.authzid=f.getBareJidFromJid(this.jid),this.authcid=f.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.domain=f.getDomainFromJid(this.jid),this._changeConnectStatus(f.Status.CONNECTING,null),this._proto._connect(r,i,s)},attach:function(e,t,n,r,i,s,o){this._proto._attach(e,t,n,r,i,s,o)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(e,t,n,r){var i=null,s=this;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o));var u=this.addHandler(function(e){i&&s.deleteTimedHandler(i);var r=e.getAttribute("type");if("result"==r)t&&t(e);else{if("error"!=r)throw{name:"StropheError",message:"Got bad IQ type of "+r};n&&n(e)}},null,"iq",null,o);return r&&(i=this.addTimedHandler(r,function(){return s.deleteHandler(u),n&&n(null),!1})),this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(e,t){var n=new f.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,r,i,s,o){var u=new f.Handler(e,t,n,r,i,s,o);return this.addHandlers.push(u),u},deleteHandler:function(e){this.removeHandlers.push(e)},disconnect:function(e){if(this._changeConnectStatus(f.Status.DISCONNECTING,e),f.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=u({xmlns:f.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}},_changeConnectStatus:function(e,t){for(var n in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(n)){var r=this[n];if(r.statusChanged)try{r.statusChanged(e,t)}catch(i){f.error(""+n+" plugin caused an exception changing status: "+i)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(s){f.error("User connection callback caused an exception: "+s)}},_doDisconnect:function(){null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),f.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(f.Status.DISCONNECTED,null),this.connected=!1},_dataRecv:function(e,t){f.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){this.xmlInput!==f.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==f.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(f.serialize(n)));for(var r,i;this.removeHandlers.length>0;)i=this.removeHandlers.pop(),r=this.handlers.indexOf(i),r>=0&&this.handlers.splice(r,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return this._doDisconnect(),void 0;var s,o,u=n.getAttribute("type");if(null!==u&&"terminate"==u){if(this.disconnecting)return;return s=n.getAttribute("condition"),o=n.getElementsByTagName("conflict"),null!==s?("remote-stream-error"==s&&o.length>0&&(s="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,s)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"),this.disconnect("unknown stream-error"),void 0}var a=this;f.forEachChild(n,null,function(e){var t,n;for(n=a.handlers,a.handlers=[],t=0;t<n.length;t++){var r=n[t];try{!r.isMatch(e)||!a.authenticated&&r.user?a.handlers.push(r):r.run(e)&&a.handlers.push(r)}catch(i){f.warn("Removing Strophe handlers due to uncaught exception: "+i.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){f.info("_connect_cb was called"),this.connected=!0;var r=this._proto._reqToData(e);if(r){this.xmlInput!==f.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==f.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(f.serialize(r)));var i=this._proto._connect_cb(r);if(i!==f.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var s=r.getElementsByTagName("stream:features").length>0;s||(s=r.getElementsByTagName("features").length>0);var o,u,a=r.getElementsByTagName("mechanism"),l=[],c=!1;if(!s)return this._proto._no_auth_received(t),void 0;if(a.length>0)for(o=0;o<a.length;o++)u=f.getText(a[o]),this.mechanisms[u]&&l.push(this.mechanisms[u]);return this._authentication.legacy_auth=r.getElementsByTagName("auth").length>0,(c=this._authentication.legacy_auth||l.length>0)?(this.do_authentication!==!1&&this.authenticate(l),void 0):(this._proto._no_auth_received(t),void 0)}}},authenticate:function(e){var n;for(n=0;n<e.length-1;++n){for(var r=n,i=n+1;i<e.length;++i)e[i].prototype.priority>e[r].prototype.priority&&(r=i);if(r!=n){var s=e[n];e[n]=e[r],e[r]=s}}var u=!1;for(n=0;n<e.length;++n)if(e[n].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var a=t("auth",{xmlns:f.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var l=this._sasl_mechanism.onChallenge(this,null);a.t(H.encode(l))}this.send(a.tree()),u=!0;break}u||(null===f.getNodeFromJid(this.jid)?(this._changeConnectStatus(f.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(e){var n=H.decode(f.getText(e)),r=this._sasl_mechanism.onChallenge(this,n),i=t("response",{xmlns:f.NS.SASL});return""!==r&&i.t(H.encode(r)),this.send(i.tree()),!0},_auth1_cb:function(){var e=o({type:"set",id:"_auth_2"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return f.getResourceFromJid(this.jid)||(this.jid=f.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(f.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t,n=H.decode(f.getText(e)),r=/([a-z]+)=([^,]+)(,|$)/,i=n.match(r);if("v"==i[1]&&(t=i[2]),t!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return f.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=f.getResourceFromJid(this.jid);return r?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).c("resource",{}).t(r).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"==e.getAttribute("type")){f.info("SASL binding failed.");var t,n=e.getElementsByTagName("conflict");return n.length>0&&(t="conflict"),this._changeConnectStatus(f.Status.AUTHFAIL,t),!1}var r,i=e.getElementsByTagName("bind");return i.length>0?(r=i[0].getElementsByTagName("jid"),r.length>0&&(this.jid=f.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:f.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null))),void 0):(f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return f.info("Session creation failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(f.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new f.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,r,i){var s=new f.Handler(e,t,n,r,i);return s.user=!1,this.addHandlers.push(s),s},_onDisconnectTimeout:function(){return f.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,r;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),e>=0&&this.timedHandlers.splice(e,1);var i=(new Date).getTime();for(r=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],(this.authenticated||!t.user)&&(n=t.lastCalled+t.period,0>=n-i?t.run()&&r.push(t):r.push(t));this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},e&&e(f,t,s,o,u),f.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},f.SASLMechanism.prototype={test:function(){return!0},onStart:function(e){this._connection=e},onChallenge:function(){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},f.SASLAnonymous=function(){},f.SASLAnonymous.prototype=new f.SASLMechanism("ANONYMOUS",!1,10),f.SASLAnonymous.test=function(e){return null===e.authcid},f.Connection.prototype.mechanisms[f.SASLAnonymous.prototype.name]=f.SASLAnonymous,f.SASLPlain=function(){},f.SASLPlain.prototype=new f.SASLMechanism("PLAIN",!0,20),f.SASLPlain.test=function(e){return null!==e.authcid},f.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass},f.Connection.prototype.mechanisms[f.SASLPlain.prototype.name]=f.SASLPlain,f.SASLSHA1=function(){},f.SASLSHA1.prototype=new f.SASLMechanism("SCRAM-SHA-1",!0,40),f.SASLSHA1.test=function(e){return null!==e.authcid},f.SASLSHA1.prototype.onChallenge=function(e,t,s){var o=s||B.hexdigest(1234567890*Math.random()),u="n="+e.authcid;return u+=",r=",u+=o,e._sasl_data.cnonce=o,e._sasl_data["client-first-message-bare"]=u,u="n,,"+u,this.onChallenge=function(e,t){for(var s,o,u,f,l,c,p,d,v,m,g,y="c=biws,",b=e._sasl_data["client-first-message-bare"]+","+t+",",w=e._sasl_data.cnonce,E=/([a-z]+)=([^,]+)(,|$)/;t.match(E);){var S=t.match(E);switch(t=t.replace(S[0],""),S[1]){case"r":s=S[2];break;case"s":o=S[2];break;case"i":u=S[2]}}if(s.substr(0,w.length)!==w)return e._sasl_data={},e._sasl_failure_cb();for(y+="r="+s,b+=y,o=H.decode(o),o+="\0\0\0",f=c=a(e.pass,o),p=1;u>p;p++){for(l=a(e.pass,h(c)),d=0;5>d;d++)f[d]^=l[d];c=l}for(f=h(f),v=a(f,"Client Key"),m=i(f,"Server Key"),g=a(n(h(v)),b),e._sasl_data["server-signature"]=r(m,b),d=0;5>d;d++)v[d]^=g[d];return y+=",p="+H.encode(h(v))}.bind(this),u},f.Connection.prototype.mechanisms[f.SASLSHA1.prototype.name]=f.SASLSHA1,f.SASLMD5=function(){},f.SASLMD5.prototype=new f.SASLMechanism("DIGEST-MD5",!1,30),f.SASLMD5.test=function(e){return null!==e.authcid},f.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},f.SASLMD5.prototype.onChallenge=function(e,t,n){for(var r,i=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=n||B.hexdigest(""+1234567890*Math.random()),o="",u=null,a="",f="";t.match(i);)switch(r=t.match(i),t=t.replace(r[0],""),r[2]=r[2].replace(/^"(.+)"$/,"$1"),r[1]){case"realm":o=r[2];break;case"nonce":a=r[2];break;case"qop":f=r[2];break;case"host":u=r[2]}var l=e.servtype+"/"+e.domain;null!==u&&(l=l+"/"+u);var c=B.hash(e.authcid+":"+o+":"+this._connection.pass)+":"+a+":"+s,h="AUTHENTICATE:"+l,p="";return p+="charset=utf-8,",p+="username="+this._quote(e.authcid)+",",p+="realm="+this._quote(o)+",",p+="nonce="+this._quote(a)+",",p+="nc=00000001,",p+="cnonce="+this._quote(s)+",",p+="digest-uri="+this._quote(l)+",",p+="response="+B.hexdigest(B.hexdigest(c)+":"+a+":00000001:"+s+":auth:"+B.hexdigest(h))+",",p+="qop=auth",this.onChallenge=function(){return""}.bind(this),p},f.Connection.prototype.mechanisms[f.SASLMD5.prototype.name]=f.SASLMD5}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.Request=function(e,t,n,r){this.id=++Strophe._requestId,this.xmlData=e,this.data=Strophe.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=0/0,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)));return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},Strophe.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var e=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});n&&r.attrs({route:n});var i=this._conn._connect_cb;this._requests.push(new Strophe.Request(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,r,i,s,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=s||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_connect_cb:function(e){var t,n,r=e.getAttribute("type");if(null!==r&&"terminate"==r)return Strophe.error("BOSH-Connection failed: "+t),t=e.getAttribute("condition"),n=e.getElementsByTagName("conflict"),null!==t?("remote-stream-error"==t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(),Strophe.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var i=e.getAttribute("requests");i&&(this.window=parseInt(i,10));var s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));var o=e.getAttribute("wait");o&&(this.wait=parseInt(o,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random())},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,Strophe.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),e.push(null)),this._requests.length<2&&e.length>0&&!this._conn.paused){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}},_onRequestStateChange:function(e,t){if(Strophe.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return t.abort=!1,void 0;var n;if(4==t.xhr.readyState){n=0;try{n=t.xhr.status}catch(r){}if("undefined"==typeof n&&(n=0),this.disconnecting&&n>=400)return this._hitError(n),void 0;var i=this._requests[0]==t,s=this._requests[1]==t;(n>0&&500>n||t.sends>5)&&(this._removeRequest(t),Strophe.debug("request id "+t.id+" should now be removed")),200==n?((s||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),Strophe.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):(Strophe.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),(0===n||n>=400&&600>n||n>=12e3)&&(this._hitError(n),n>=400&&500>n&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect()))),n>0&&500>n||t.sends>5||this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],r=-1;try{4==n.xhr.readyState&&(r=n.xhr.status)}catch(i){Strophe.error("caught an error in _requests["+e+"], reqStatus: "+r)}if("undefined"==typeof r&&(r=-1),n.sends>this.maxRetries)return this._onDisconnectTimeout(),void 0;var s=n.age(),o=!isNaN(s)&&s>Math.floor(Strophe.TIMEOUT*this.wait),u=null!==n.dead&&n.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),a=4==n.xhr.readyState&&(1>r||r>=500);if((o||u||a)&&(u&&Strophe.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new Strophe.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){Strophe.debug("request id "+n.id+"."+n.sends+" posting");try{n.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0)}catch(f){return Strophe.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),this._conn.disconnect(),void 0}var l=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var r in e)e.hasOwnProperty(r)&&n.xhr.setRequestHeader(r,e[r])}n.xhr.send(n.data)};if(n.sends>1){var c=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(l,c)}else l();n.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else Strophe.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)},_removeRequest:function(e){Strophe.debug("removing request");var t;for(t=this._requests.length-1;t>=0;t--)e==this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){Strophe.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?Strophe.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Strophe.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},Strophe.Websocket=function(e){this._conn=e,this.strip="stream:stream";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";n+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==t.indexOf("/")?window.location.pathname+t:t,e.service=n}},Strophe.Websocket.prototype={_buildStream:function(){return $build("stream:stream",{to:this._conn.domain,xmlns:Strophe.NS.CLIENT,"xmlns:stream":Strophe.NS.STREAM,version:"1.0"})},_check_streamerror:function(e,t){var n=e.getElementsByTagName("stream:error");if(0===n.length)return!1;for(var r=n[0],i="",s="",o="urn:ietf:params:xml:ns:xmpp-streams",u=0;u<r.childNodes.length;u++){var a=r.childNodes[u];if(a.getAttribute("xmlns")!==o)break;"text"===a.nodeName?s=a.textContent:i=a.nodeName}var f="WebSocket stream error: ";return f+=i?i:"unknown",s&&(f+=" - "+i),Strophe.error(f),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var t=this._check_streamerror(e,Strophe.Status.CONNFAIL);return t?Strophe.Status.CONNFAIL:void 0},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in stream:stream":n!==Strophe.NS.CLIENT&&(t="Wrong xmlns in stream:stream: "+n);var r=e.namespaceURI;"string"!=typeof r?t="Missing xmlns:stream in stream:stream":r!==Strophe.NS.STREAM&&(t="Wrong xmlns:stream in stream:stream: "+r);var i=e.getAttribute("version");return"string"!=typeof i?t="Missing version in stream:stream":"1.0"!==i&&(t="Wrong version in stream:stream: "+i),t?(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<stream:stream ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;t=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>");var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&(this._connect_cb(n),this.streamStart=e.data.replace(/^<stream:(.*)\/>$/,"<stream:$1>"))}else{if("</stream:stream>"===e.data)return this._conn.rawInput(e.data),this._conn.xmlInput(document.createElement("stream:stream")),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect(),void 0;var r=this._streamWrap(e.data),i=(new DOMParser).parseFromString(r,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(i,null,e.data)}},_disconnect:function(e){if(this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t="</stream:stream>";this._conn.xmlOutput(document.createElement("stream:stream")),this._conn.rawOutput(t);try{this.socket.send(t)}catch(n){Strophe.info("Couldn't send closing stream tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return this.streamStart+e+"</stream:stream>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(e){Strophe.error("Server did not send any auth methods"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_onError:function(e){Strophe.error("Websocket error "+e),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n,r;"restart"===e[t]?(n=this._buildStream(),r=this._removeClosingTag(n),n=n.tree()):(n=e[t],r=Strophe.serialize(n)),this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var t,n;if("</stream:stream>"===e.data){var r="</stream:stream>";return this._conn.rawInput(r),this._conn.xmlInput(document.createElement("stream:stream")),this._conn.disconnecting||this._conn._doDisconnect(),void 0}if(0===e.data.search("<stream:stream ")){if(n=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>"),t=(new DOMParser).parseFromString(n,"text/xml").documentElement,!this._handleStreamStart(t))return}else n=this._streamWrap(e.data),t=(new DOMParser).parseFromString(n,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),this._conn.rawInput(Strophe.serialize(t)),void 0):(this._conn._dataRecv(t,e.data),void 0)},_onOpen:function(){Strophe.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=this._removeClosingTag(e);this._conn.rawOutput(t),this.socket.send(t)},_removeClosingTag:function(e){var t=Strophe.serialize(e);return t=t.replace(/<(stream:stream .*[^\/])\/>$/,"<$1>")},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},P("strophe",function(e){return function(){var t,n;return t||e.Strophe}}(this));var j=0,F="";return P("razercomms/sha1",function(){}),P("razercomms/chatengine",["underscore","backbone","strophe","razercomms/sha1"],function(e,t,n,r){var i="muc.razerzone.com",s="0.1",o=t.Model.extend({defaults:{server:"wss://comms-cxmpp.razersynapse.com:443/websocket",api_key:"",user_id:""},pubsubDomain:"pubsub.razerzone.com",authJid:"x-razer-comms-token@razerzone.com/web_js",anonAuthJid:"razerzone.com/readonly_chat",pubsubEventNs:"http://jabber.org/protocol/pubsub#event",namespace:{client:"jabber:client",roster:"jabber:iq:roster",vcard:"vcard-temp",vcardUpdate:"vcard-temp:x:update",nick:"http://jabber.org/protocol/nick",chatMarkers:"urn:xmpp:chat-markers:0",messageReceipts:"urn:xmpp:receipts",userRegister:"jabber:iq:register",xData:"jabber:x:data",muc:"http://jabber.org/protocol/muc",pubsub:"http://jabber.org/protocol/pubsub",pubsubEvent:"http://jabber.org/protocol/pubsub#event",caps:"http://jabber.org/protocol/caps",discoInfo:"http://jabber.org/protocol/disco#info",json:"urn:xmpp:json:0",forwarded:"urn:xmpp:forward:0",mucUser:"http://jabber.org/protocol/muc#user",pubsubSelf:"razer:pubsub:self",razerMucMessage:"razer:muc:message",razerMucChannel:"razer:muc:channel",razerPresence:"razer:presence",razerMuc:"razer:muc",conferenceInfo:"urn:ietf:params:xml:ns:conference-info",mucOwner:"http://jabber.org/protocol/muc#owner",chatStates:"http://jabber.org/protocol/chatstates"},node:"",xmpp:null,connected:!1,pendingNode:"",logout:!1,nodes:[],disconnect_ts:0,packet_ts:0,for_reload:!1,anonymous:!1,debugTag:null,autoAcceptFriends:[],user:null,avatarHash:"",nodeUri:"http://www.razerzone.com/comms/web",currentPresence:null,reconnectDelay:1e4,initialize:function(){e.bindAll(this,"_allServerPacketHandler","isConnected","setUserModel"),e.bindAll(this,"addFriend","acceptFriend","rejectFriend","_handleAddFriendRequest","enterChannel"),e.bindAll(this,"joinGroup","leaveGroup","destroyGroup"),e.bindAll(this,"_onConnectionStatus","_sendPing"),e.bindAll(this,"_send","_rawInput","_rawOutput","_getVcard","_createVcard","_handleMessageEvent","_addHandlers","_handleIqSetRoster","_handleGroupMessageEvent","_handlesetPresenceRequest","setPresence","publish","subscribe","_sendPresence","_handleDiscoInfoQuery","_handlePubSubMessageEvent","_forwardToOtherDevices","_handleForwardedMessage","_publishSyncHistory","_handleMarkMessagePubsub","_handleMarkGroupMessagePubsub","_handleGroupInviteMessage","_handleAdhocInviteMessage","_handleAcceptVoiceInviteMessage","_handleRejectVoiceInviteMessage","_handleLeaveGroupPubSub","_handleMucPresence","_handleConferenceInfoEvent","_handleChatState","_handleGroupChatState","_handleCancelVoiceInviteMessage","_handleMemberPresence"),e.bindAll(this,"disconnect","publishMarkMessage","publishMarkGroupMessage","sendGroupInvite","inviteToVoice","acceptVoiceInvite","sendAudioStatus","sendAdhocGroupInvite","publishGroupUpdate","setChatState","subscribeToPubSub","unsubscribeToPubSub","publishToPubSub","setAvatarHash","cancelVoiceInvite","generateMessageId","sendGroupPresence","subscribeToGroupPresence","unsubscribeToGroupPresence","publishMucEvent"),this.node="",this.connected=!1,this.pendingNode="",this.logout=!1,this.nodes=[],this.disconnect_ts=0,this.packet_ts=0,this.for_reload=!1,this.anonymous=!1,this.debugTag=null,this.autoAcceptFriends=[],this.user=null,this.avatarHash="",this.currentPresence=null,this.reconnectDelay=1e4;if(this.has("connect")&&!this.get("connect")){console.info("Not connecting to XMPP server");return}this.xmpp=new n.Connection(this.get("server")),!this.has("api_key")||this.get("api_key")===""?console.assert(!1):(this.get("debug")&&(this.xmpp.rawInput=this._rawInput,this.xmpp.rawOutput=this._rawOutput),this.xmpp.connect(this.authJid,this.get("api_key"),this._onConnectionStatus),this.anonymous=!1),n.log=function(e,t){e>1&&(console.log("StropheLog: "+e+" "+t),e>2&&console.error("StropheLog: "+e+" "+t))}},addFriend:function(e,t){console.debug(this.debugTag+" addFriend: "+e),console.assert(typeof e!="undefined");var n=this;if(t)console.debug("addFriend from accept: "+this.xmpp.jid);else{this.autoAcceptFriends.push(e);var r=function(e){if(e.subscription==="none"){var t=e.packet.getElementsByTagNameNS(n.namespace.roster,"item");if(t.length>0){var i=t[0].getAttribute("ask");i==="subscribe"&&(n.trigger("reloadFriends"),n.off("rosterPush",r))}}};this.on("rosterPush",r)}if(!this.user){console.warn(this.debugTag+" addFriend: current UserModel not present, waiting"),this.once("currentUser",function(t){console.debug(n.debugTag+" addFriend: got current user: "+JSON.stringify(t.toJSON())),n.addFriend(e)});return}var i=$iq({type:"set",id:this.xmpp.getUniqueId()});i.c("query",{xmlns:this.namespace.roster}).c("item",{jid:e}),this._send(i);var s=$pres({to:e,type:"subscribe"}),o=this._createVcard(this.user.toJSON());s.cnode(o.node),this._send(s)},acceptFriend:function(e){console.assert(typeof e!="undefined");var t=$pres({to:e,type:"subscribed"});this._send(t),this.addFriend(e,!0);var n=this,r=function(e){e.subscription==="both"&&(n.trigger("reloadFriends"),n.off("rosterPush",r))};this.on("rosterPush",r)},rejectFriend:function(e){console.assert(typeof e!="undefined");var t=$pres({to:e,type:"unsubscribed"});this._send(t)},sendMessage:function(e,t,n,r){console.assert(typeof e!="undefined"),console.assert(typeof t!="undefined"),n||(n=this.generateMessageId(t+e));var i=this;if(!this.user)return console.warn(this.debugTag+" sendMessage: current UserModel not present, waiting message_id: "+n),this.once("currentUser",function(s){console.debug(i.debugTag+" sendMessage: got current user: "+JSON.stringify(s.toJSON())),i.sendMessage(e,t,n,r)}),n;console.debug("sendMessage: message_id: "+n);var s=$msg({to:e,type:"chat",id:n});s.c("body").t(t).up().c("nick",{xmlns:this.namespace.nick}).t(this.user.get("nickname")).up().c("markable",{xmlns:this.namespace.chatMarkers}).up().c("request",{xmlns:this.namespace.messageReceipts});var o=this._createVcard(this.user.toJSON());s.up().cnode(o.node),this.xmpp.addHandler(function(e){if(r){var t=e.getElementsByTagNameNS(i.namespace.messageReceipts,"received");if(t.length>0){var s=t[0].getAttribute("id");if(s!==n)return console.info("sendMessage: not my message_id: "+n+" id "+s),!0;r(n)}}return!1},this.namespace.messageReceipts,"message",null,null,e,null),this._send(s),this._forwardToOtherDevices(s),this._publishSyncHistory();var u={chat_id:e,message:t,direction:"outgoing",group_chat:!1,message_id:n,timestamp:Math.floor(Date.now()/1e3),unread:0};try{this.trigger("outgoingMessage",u)}catch(a){console.error("Exception"),console.error(a)}return n},removeFriend:function(e){console.assert(typeof e!="undefined"),console.assert(e!==""),console.debug(this.debugTag+" removeFriend: "+e),console.debug(this.xmpp.jid);var t=$iq({type:"set",id:this.xmpp.getUniqueId()});t.c("query",{xmlns:this.namespace.roster}).c("item",{jid:e,subscription:"remove"}),this._send(t)},joinGroup:function(e,t){if(!this.user){var n=this;console.warn(this.debugTag+" joinGroup: current UserModel not present, waiting"),this.once("currentUser",function(r){n.joinGroup(e,t)});return}var r="join-group-"+e,i=$iq({to:e,type:"set",id:r});i.c("query",{xmlns:this.namespace.userRegister}).c("x",{xmlns:this.namespace.xData,type:"submit"});var s=$build("field",{"var":"FORM_TYPE"});s.c("value","http://jabber.org/protocol/muc#register"),s.up(),i.cnode(s.node),s=$build("field",{"var":"muc#register_roomnick"}),s.c("value",this.user.get("nickname")),s.up(),i.up(),i.cnode(s.node),this.xmpp.addHandler(function(e){return t&&t(),!1},this.namespace.userRegister,"iq","result",r,e,null),this._send(i)},leaveGroup:function(e){if(!this.user){var t=this;this.once("currentUser",function(n){t.leaveGroup(e)});return}var r=e+"/"+n.escapeNode(this.user.get("comms_id")),i=$pres({to:r,type:"unavailable"});i.c("x",{xmlns:this.namespace.muc}).up().c("ext",{xmlns:"razer:presence:muc"}).c("unsubscribe"),this._send(i);var s=this.get("user_id"),o=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});o.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:s}).c("item").c("leave-group",{xmlns:this.namespace.pubsubSelf}).c("group-id").t(e),this._send(o)},destroyGroup:function(e){var t=$iq({to:e,type:"set",id:this.xmpp.getUniqueId()});t.c("query",{xmlns:this.namespace.mucOwner}).c("destroy"),this._send(t)},enterGroup:function(e){console.assert(e&&e!=="");if(!this.user){var t=this;this.once("currentUser",function(n){t.enterGroup(e)});return}var r=e+"/"+n.escapeNode(this.user.get("comms_id")),i=$pres({to:r});i.c("x",{xmlns:this.namespace.muc}).up().c("x",{xmlns:this.namespace.razerPresence,type:"unsubscribed"}).up().c("ext",{xmlns:"razer:presence:muc"}).c("enter"),this._send(i)},enterChannel:function(e){console.assert(e&&e!=="");if(!this.user){var t=this;this.once("currentUser",function(n){t.enterChannel(e)});return}var r=e+"/"+n.escapeNode(this.user.get("comms_id")),i=$pres({to:r});i.c("x",{xmlns:this.namespace.muc}).up().c("x",{xmlns:this.namespace.razerPresence,type:"unsubscribed"}),this._send(i)},sendGroupMessage:function(e,t,n,r){console.assert(typeof e!="undefined"),console.assert(typeof t!="undefined"),console.debug("sendGroupMessage: lobby_id: "+e+" message: "+t),n||(n=this.generateMessageId(t+e));var i=this;if(!this.user)return console.warn(this.debugTag+" sendGroupMessage: current UserModel not present, waiting"),this.once("currentUser",function(s){i.sendGroupMessage(e,t,n,r)}),n;console.debug("sendGroupMessage: message_id: "+n);var s=$msg({to:e,type:"groupchat",id:n});s.c("body").t(t).up().c("nick",{xmlns:this.namespace.nick}).t(this.user.get("nickname")).up().c("markable",{xmlns:this.namespace.chatMarkers}).up().c("request",{xmlns:this.namespace.messageReceipts});var o=this._createVcard(this.user.toJSON());return s.up().cnode(o.node),r&&this.xmpp.addHandler(function(e){var t=e.getElementsByTagNameNS(i.namespace.messageReceipts,"received");if(t.length>0){var s=t[0].getAttribute("id");if(s!==n)return console.info("sendGroupMessage: not my message_id: "+n+" id "+s),!0;r(n)}return!1},this.namespace.messageReceipts,"message",null,null,e,null),this._send(s),n},setUserModel:function(e){console.debug("setuserModel: "+JSON.stringify(e.toJSON())),this.user=e;try{this.trigger("currentUser",e)}catch(t){console.error("Exception"),console.error(t)}this.debugTag||(this.debugTag=this.user.get("comms_id"))},setPresence:function(e){console.assert(typeof e!="undefined");if(e!=="online")if(e==="busy")e="dnd";else if(e!=="away"&&e!=="invisible"&&e!=="dnd"){console.error("Invalid presence: "+e),console.trace();return}this.currentPresence=e;if(!this.user){var t=this;console.warn(this.debugTag+" setPresence: current UserModel not present, waiting"),this.once("currentUser",function(n){t.setPresence(e)});return}var n=this._generateVerificationString(this.get("user_id")),r=$pres({});e!=="online"&&(r.c("show",{xmlns:this.namespace.client}).t(e),r.up()),r.c("c",{xmlns:this.namespace.caps,hash:"sha-1",node:this.nodeUri,ver:n}),this.avatarHash!==""&&r.up().c("x",{xmlns:this.namespace.vcardUpdate}).c("photo").t(this.avatarHash),this._send(r)},publish:function(e,t){var n=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});n.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:e}).c("item").c("json",{xmlns:this.namespace.json}).t(JSON.stringify(t)),this._send(n)},subscribe:function(e){var t=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});t.c("pubsub",{xmlns:this.namespace.pubsub}).c("subscribe",{node:e}),this._send(t)},disconnect:function(){console.info("disconnecting"),this.logout=!0,this.xmpp.disconnect(),this.xmpp=null},isConnected:function(){return this.connected},isGroupChat:function(e){var t=n.getDomainFromJid(e);return t===i?!0:!1},publishMarkMessage:function(e,t){var n=this.get("user_id"),r=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});r.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:n}).c("item").c("mark-message",{xmlns:this.namespace.pubsubSelf}).c("sender-id").t(e).up().c("message-id").t(t),this._send(r),this._publishSyncHistory()},publishMarkGroupMessage:function(e,t,n){var r=this.get("user_id"),i=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});i.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:r}).c("item").c("mark-group-message",{xmlns:this.namespace.pubsubSelf}).c("group-id").t(e).up().c("channel-id").t(t).up().c("message-id").t(n),this._send(i),this._publishSyncHistory()},sendGroupInvite:function(e,t,n,r){if(!this.user){var i=this;console.warn(this.debugTag+" sendGroupInvite: current UserModel not present, waiting"),this.once("currentUser",function(s){i.sendGroupInvite(e,t,n,r)});return}r=r?r:"";var s=$msg({to:n});s.c("nick",{xmlns:this.namespace.nick}).t(this.user.get("nickname")).up().c("x",{xmlns:this.namespace.mucUser}).c("invite",{to:e}).up().up().c("channel",{xmlns:this.namespace.razerMucChannel}).c("group-id").t(t).up().c("channel-id").t(n).up().c("group-name").t(r),this._send(s)},inviteToVoice:function(e,t){console.assert(e&&e!==""),console.assert(t&&t!=="");if(!this.user){var n=this;console.warn(this.debugTag+" inviteToVoice: current UserModel not present, waiting"),this.once("currentUser",function(r){n.inviteToVoice(e,t)});return}var r=$msg({to:e});r.c("nick",{xmlns:this.namespace.nick}).t(this.user.get("nickname")).up().c("x",{xmlns:this.namespace.mucUser}).c("invite",{to:t}).up().c("ext",{xmlns:this.namespace.razerMucMessage,"invite-type":"voice","one-to-one":"true","room-name":e,"room-owner":this.get("user_id"),"room-type":"AdHoc"}),this._send(r)},acceptVoiceInvite:function(e,t){console.assert(e&&e!==""),console.assert(t&&t!=="");var n=$msg({to:e});n.c("x",{xmlns:this.namespace.mucUser}).c("accept",{xmlns:this.namespace.razerMucMessage,to:t}).up().c("ext",{xmlns:this.namespace.razerMucMessage,"invite-type":"voice"}),this._send(n);var r=this.get("user_id"),i=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});i.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:r}).c("item").c("muc-invite",{xmlns:this.namespace.pubsubSelf,action:"accept-voice"}).c("group-id").t(e).up().c("sender-id").t(t),this._send(i)},rejectVoiceInvite:function(e,t){console.assert(e&&e!==""),console.assert(t&&t!=="");var n=$msg({to:e});n.c("x",{xmlns:this.namespace.mucUser}).c("decline",{to:t}).up().c("ext",{xmlns:this.namespace.razerMucMessage,"invite-type":"voice"}),this._send(n);var r=this.get("user_id"),i=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});i.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:r}).c("item").c("muc-invite",{xmlns:this.namespace.pubsubSelf,action:"decline-voice"}).c("group-id").t(e).up().c("sender-id").t(t),this._send(i)},sendAudioStatus:function(e,t,r){if(!this.user){var i=this;console.warn(this.debugTag+" sendAudioStatus: current UserModel not present, waiting"),this.once("currentUser",function(n){i.sendAudioStatus(e,t,r)});return}var s=e+"/"+n.escapeNode(this.user.get("comms_id")),o=$pres({to:s});o.c("x",{xmlns:this.namespace.muc}).up().c("ext",{xmlns:this.namespace.razerPresence}).c("audio-status").t(t),r!=="online"&&(r==="busy"?r="dnd":r!=="away"&&r!=="invisible"&&r!=="dnd"&&(r="online",console.error("Invalid presence_show: "+r))),r!=="online"&&o.up().up().c("show",{xmlns:this.namespace.client}).t(r),this._send(o)},sendAdhocGroupInvite:function(e,t){if(!this.user){var n=this;console.warn(this.debugTag+" sendAdhocGroupInvite: current UserModel not present, waiting"),this.once("currentUser",function(r){n.sendAdhocGroupInvite(e,t)});return}console.debug("sendAdhocGroupInvite: user_id: "+e+" group_id: "+t);var r=$msg({to:t});r.c("nick",{xmlns:this.namespace.nick}).t(this.user.get("nickname")).up().c("x",{xmlns:this.namespace.mucUser}).c("invite",{to:e}).up().c("ext",{xmlns:this.namespace.razerMucMessage,"invite-type":"chat","one-to-one":"false","room-name":t,"room-owner":this.get("user_id"),"room-type":"AdHoc"}),this._send(r)},publishGroupUpdate:function(e){if(!this.user){var t=this;console.warn(this.debugTag+" publishGroupUpdate: current UserModel not present, waiting"),this.once("currentUser",function(n){t.publishGroupUpdate(e)});return}var r=e+"/"+n.escapeNode(this.user.get("comms_id")),i=this.namespace.conferenceInfo,s=$iq({to:r,type:"set",id:this.xmpp.getUniqueId()});s.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:i}).c("item").c("room",{xmlns:this.namespace.razerMuc}).c("action").t("update").up().c("group-id").t(e),this._send(s)},setChatState:function(e,t){if(t!=="composing"&&t!=="paused"&&t!=="active"&&t!=="inactive"&&t!=="gone")return;if(!this.user){var n=this;console.warn(this.debugTag+" setChatState: current UserModel not present, waiting"),this.once("currentUser",function(r){n.setChatState(e,t)});return}var r;this.isGroupChat(e)?(r=$msg({to:e,type:"groupchat"}),r.c(t,{xmlns:this.namespace.chatStates}).up().c("nick",{xmlns:this.namespace.nick}).t(this.user.get("nickname")),this._send(r)):(r=$msg({to:e,type:"chat"}),r.c(t,{xmlns:this.namespace.chatStates}),this._send(r))},subscribeToPubSub:function(e,t){var n=$iq({to:this.pubsubDomain,type:"set",id:"subscribe."+e});n.c("pubsub",{xmlns:this.namespace.pubsub}).c("subscribe",{node:e});var r=this;this.xmpp.addHandler(function(e){return t&&t(),!1},"jabber:client","iq","result","subscribe."+e,null,null),this._send(n)},unsubscribeToPubSub:function(e,t){var n=$iq({to:this.pubsubDomain,type:"set",id:"unsubscribe."+e});n.c("pubsub",{xmlns:this.namespace.pubsub}).c("unsubscribe",{node:e});var r=this;this.xmpp.addHandler(function(n){return console.info("unsubscribe success: node: "+e),t&&t(),!1},"jabber:client","iq","result","unsubscribe."+e,null,null),this._send(n)},publishToPubSub:function(e,t,n){var r="publish."+e+this.xmpp.getUniqueId(),i=$iq({to:this.pubsubDomain,type:"set",id:r});i.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:e}).c("item").c("json",{xmlns:this.namespace.json}).t(JSON.stringify(t)),this.xmpp.addHandler(function(t){return console.info("publish success: node: "+e),n&&n(),!1},"jabber:client","iq","result",r,null,null),this._send(i)},setAvatarHash:function(e){var t=this;this.connected?(t.avatarHash=e,t.currentPresence?t.setPresence(t.currentPresence):t.setPresence("online")):(console.info("setAvatarHash: not yet connected"),this.once("connected",function(){t.setAvatarHash(e)}))},cancelVoiceInvite:function(e,t){console.assert(e&&e!==""),console.assert(t&&t!=="");var n=$msg({to:e});n.c("x",{xmlns:this.namespace.mucUser}).c("cancel",{xmlns:this.namespace.razerMucMessage,to:t}).up().c("ext",{xmlns:this.namespace.razerMucMessage,"invite-type":"voice"}),this._send(n)},generateMessageId:function(e){var t,r=new Date,i={sender:n.getBareJidFromJid(this.xmpp.jid),message:e,timestamp:r.getTime()};return t=d(JSON.stringify(i)),t},sendGroupPresence:function(e,t,r){if(!this.user){var i=this;console.warn(this.debugTag+" sendGroupPresence: current UserModel not present, waiting"),this.once("currentUser",function(n){i.sendGroupPresence(e,t,r)});return}console.assert(typeof t!="undefined");if(t!=="online")if(t==="busy")t="dnd";else if(t!=="away"&&t!=="invisible"&&t!=="dnd"){console.error("Invalid presence: "+t),console.trace();return}var s=e+"/"+n.escapeNode(this.user.get("comms_id")),o=$pres({to:s});o.c("x",{xmlns:this.namespace.muc}).up().c("ext",{xmlns:this.namespace.razerPresence}).c("audio-status").t(r),t!=="online"&&(o.up().up(),o.c("show",{xmlns:this.namespace.client}).t(t),o.up()),this._send(o)},subscribeToGroupPresence:function(e,t){var n="subscribe-presence-"+e,r=$iq({to:e,type:"set",id:n});r.c("query",{xmlns:this.namespace.razerPresence}).t("subscribe"),this.xmpp.addHandler(function(e){return t&&t(),!1},this.namespace.razerPresence,"iq","result",n,e,null),this._send(r)},unsubscribeToGroupPresence:function(e,t){var n="unsubscribe-presence-"+e,r=$iq({to:e,type:"set",id:n});r.c("query",{xmlns:this.namespace.razerPresence}).t("unsubscribe"),this.xmpp.addHandler(function(e){return t&&t(),!1},this.namespace.razerPresence,"iq","result",n,e,null),this._send(r)},publishMucEvent:function(e,t,r){console.assert(t),console.assert(e&&e!=="");var i=this;if(!this.user){this.once("currentUser",function(){i.publishMucEvent(e,t,r)});return}var s=e+"/"+n.escapeNode(this.user.get("comms_id")),o="muc_event_"+this.xmpp.getUniqueId(),u=$iq({to:s,type:"set",id:o});u.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:this.namespace.conferenceInfo}).c("item").c("json",{xmlns:this.namespace.json}).t(JSON.stringify(t)),this.xmpp.addHandler(function(e){return r&&r(),!1},"jabber:client","iq","result",o,null,null),this._send(u)},_onConnectionStatus:function(e){var t=this;if(e===n.Status.CONNECTING)console.debug("status is connecting.");else if(e===n.Status.CONNFAIL)console.info("Strophe failed to connect."),this.connected=!1;else if(e===n.Status.AUTHENTICATING)console.debug("Strophe authenticating");else if(e===n.Status.AUTHFAIL)console.error("Strophe AUTH fail"),this.connected=!1,this.logout||(console.assert(!1),setTimeout(function(){console.info("reconnecting..."),t.anonymous?t.xmpp.connect(t.anonAuthJid,"",t._onConnectionStatus):t.xmpp.connect(t.authJid,t.get("api_key"),t._onConnectionStatus)},t.reconnectDelay));else if(e===n.Status.DISCONNECTING)console.debug("status is disconnecting."),this.connected=!1;else if(e===n.Status.DISCONNECTED){console.info("status is disconnected "+this.xmpp.jid),this.connected=!1,this.disconnect_ts===0&&(this.disconnect_ts=Date.now());if(this.packet_ts!==0){var r=Date.now()-this.packet_ts;r>12e4?(console.info("no server packet for more than 2 min, page is scheduled to be reloaded"),this.for_reload=!0):console.info("no server packet for "+r/1e3+" secs")}try{this.trigger("disconnected")}catch(i){console.error("Exception"),console.error(i)}this.logout||setTimeout(function(){t.xmpp&&(console.info("reconnecting..."),t.anonymous?t.xmpp.connect(t.anonAuthJid,"",t._onConnectionStatus):t.xmpp.connect(t.authJid,t.get("api_key"),t._onConnectionStatus))},t.reconnectDelay)}else if(e===n.Status.CONNECTED){console.debug("status is connected. "+this.xmpp.service+" jid: "+this.xmpp.jid),this.connected=!0,this.xmpp.addTimedHandler(4e4,this._sendPing),this.set("user_id",n.getBareJidFromJid(this.xmpp.jid)),this.set("resource",n.getResourceFromJid(this.xmpp.jid));var s=this._generateVerificationString(this.get("user_id"));this._sendPresence({caps:{hash:"sha-1",node:this.nodeUri,ver:s},photo_hash:this.avatarHash}),this._addHandlers();for(var o=0;o<this.nodes.length;++o)console.info("subscribing to: "+this.nodes[o]),this._subscribeToNode(this.nodes[o]);if(this.disconnect_ts!==0){var u=Date.now()-this.disconnect_ts;console.info("disconnected for "+u+" ms"),u>12e4?this.trigger("reload"):this.trigger("reconnected")}this.for_reload&&(this.for_reload=!1,this.trigger("reload")),this.disconnect_ts=0;try{this.trigger("connected")}catch(i){console.error("Exception"),console.error(i)}}else e===n.Status.ATTACHED&&console.debug("status: attached")},_addHandlers:function(){this.xmpp.addHandler(this._handlePubSubMessageEvent,this.namespace.pubsubEvent,"message","headline",null,null),this.xmpp.addHandler(this._handleAddFriendRequest,null,"presence","subscribe",null,null),this.xmpp.addHandler(this._handleMessageEvent,this.namespace.client,"message","chat",null,null),this.xmpp.addHandler(this._handleIqSetRoster,this.namespace.roster,"iq","set",null,null,null),this.xmpp.addHandler(this._handleGroupMessageEvent,this.namespace.client,"message","groupchat",null,null),this.xmpp.addHandler(this._handlesetPresenceRequest,this.namespace.client,"presence",null,null,null,null),this.xmpp.addHandler(this._handleDiscoInfoQuery,this.namespace.discoInfo,"iq","get",null,null),this.xmpp.addHandler(this._handleGroupInviteMessage,this.namespace.mucUser,"message",null,null,null),this.xmpp.addHandler(this._handleAdhocInviteMessage,this.namespace.mucUser,"message",null,null,null),this.xmpp.addHandler(this._handleAcceptVoiceInviteMessage,this.namespace.mucUser,"message",null,null,null),this.xmpp.addHandler(this._handleRejectVoiceInviteMessage,this.namespace.mucUser,"message",null,null,null),this.xmpp.addHandler(this._handleCancelVoiceInviteMessage,this.namespace.mucUser,"message",null,null,null),this.xmpp.addHandler(this._handleMucPresence,this.namespace.mucUser,"presence",null,null,null),this.xmpp.addHandler(this._handleChatState,this.namespace.chatStates,"message","chat",null,null),this.xmpp.addHandler(this._handleGroupChatState,this.namespace.chatStates,"message","groupchat",null,null),this.xmpp.addHandler(this._handleMemberPresence,this.namespace.mucUser,"presence",null,null,null),this.xmpp.addHandler(this._allServerPacketHandler)},_sendPing:function(){var e=new Date,t=$iq({to:this.xmpp.domain,type:"get",id:this.xmpp.getUniqueId()});return t.c("query",{xmlns:"urn:xmpp:ping"}),this.xmpp.send(t),!0},_rawInput:function(e){if(this.debugTag){var t=n.getResourceFromJid(this.xmpp.jid);console.log("XMPP RECV("+this.debugTag+" "+t+"): "+e)}else console.log("XMPP RECV: "+e)},_rawOutput:function(e){if(this.debugTag){var t=n.getResourceFromJid(this.xmpp.jid);console.log("XMPP SENT("+this.debugTag+" "+t+"): "+e)}else console.log("XMPP SENT: "+e)},_allServerPacketHandler:function(e){return this.packet_ts=Date.now(),!0},_send:function(e){if(!this.connected){var t=this;this.once("connected",function(){t._send(e)})}else this.xmpp.send(e)},_handleAddFriendRequest:function(e){var t={user_id:e.getAttribute("from")},n=e.getElementsByTagNameNS(this.namespace.vcard,"vCard");if(n.length>0){var r=n[0];n=r.getElementsByTagName("NICKNAME"),n.length>0&&(console.debug("nickname: "+n[0].textContent),t.nickname=n[0].textContent),n=r.getElementsByTagName("PHOTO");if(n.length>0){var i=n[0];n=i.getElementsByTagName("EXTVAL"),n.length>0&&(t.avatar=n[0].textContent)}}if(this.autoAcceptFriends.indexOf(t.user_id)!==-1)this.acceptFriend(t.user_id);else try{this.trigger("friendRequest",t)}catch(s){console.error("Exception"),console.error(s)}return!0},_handlesetPresenceRequest:function(e){var t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");if(t.length!==0)return!0;var r=e.getAttribute("type");if(r===null||r==="unavailable"){var i=e.getElementsByTagNameNS(this.namespace.client,"show"),s=e.getAttribute("from"),o=n.getBareJidFromJid(s),u="online";r==="unavailable"?u="offline":i.length>0?(u=i[0].textContent,u==="invisible"?u="offline":u==="dnd"&&(u="busy")):u="online";var a="";t=e.getElementsByTagNameNS(this.namespace.vcardUpdate,"x");if(t.length>0){var f=t[0];t=f.getElementsByTagNameNS(this.namespace.vcardUpdate,"photo"),t.length>0&&(a=t[0].textContent)}var l={user_id:o,presence:u,avatar_hash:a,jid:s};try{this.trigger("friendPresence",l)}catch(c){console.error("Exception"),console.error(c)}}return!0},_getVcard:function(e){var t=$iq({type:"get",id:this.xmpp.getUniqueId()});t.c("vCard",{xmlns:this.namespace.vcard}),this._send(t)},_createVcard:function(e){var t=new n.Builder("vCard",{xmlns:this.namespace.vcard});return t.c("NICKNAME",null,e.nickname),e.avatar&&e.avatar!==""?(t.c("PHOTO").c("EXTVAL",null,e.avatar),t.up()):t},_handleMessageEvent:function(e){var t=e.getElementsByTagName("body");if(t.length===0)return!0;var r=n.getBareJidFromJid(e.getAttribute("from")),i=t[0].textContent,s=e.getAttribute("id"),o="";t=e.getElementsByTagNameNS(this.namespace.nick,"nick"),t.length>0&&(o=t[0].textContent);var u="";t=e.getElementsByTagNameNS(this.namespace.vcard,"vCard");if(t.length>0){var a=t[0];t=a.getElementsByTagName("PHOTO");if(t.length>0){var f=t[0];t=f.getElementsByTagName("EXTVAL"),t.length>0&&(u=t[0].textContent)}}var l={user_id:r,message:i,nickname:o,message_id:s,avatar:u};try{this.trigger("message",l)}catch(c){console.error("Exception"),console.error(c)}return!0},_getMessageDataFromPacket:function(e){var t=e.getElementsByTagName("body");if(t.length===0)return!0;var r=n.getBareJidFromJid(e.getAttribute("from")),i=t[0].textContent,s=e.getAttribute("id"),o="";t=e.getElementsByTagNameNS(this.namespace.nick,"nick"),t.length>0&&(o=t[0].textContent);var u="";t=e.getElementsByTagNameNS(this.namespace.vcard,"vCard");if(t.length>0){var a=t[0];t=a.getElementsByTagName("PHOTO");if(t.length>0){var f=t[0];t=f.getElementsByTagName("EXTVAL"),t.length>0&&(u=t[0].textContent)}}var l={user_id:r,message:i,nickname:o,message_id:s,avatar:u};return l},_elementToString:function(e){var t=document.createElement("div");return t.appendChild(e),t.innerHTML},_handleIqSetRoster:function(e){var t=this,n=e.getElementsByTagNameNS(this.namespace.roster,"query");if(n.length>0){var r=n[0],i=r.getElementsByTagName("item");if(i.length>0){var s=i[0].getAttribute("subscription"),o=i[0].getAttribute("jid");if(s==="remove"){if(o&&o!=="")try{this.trigger("friendRemoved",{user_id:o})}catch(u){console.error("Exception"),console.error(u)}}else setTimeout(function(){t.trigger("rosterPush",{jid:o,subscription:s,packet:e})},0)}}return!0},_handleGroupMessageEvent:function(e){var t=e.getElementsByTagName("body");if(t.length===0)return!0;var r=n.getBareJidFromJid(e.getAttribute("from")),i=t[0].textContent,s=e.getAttribute("id"),o="";t=e.getElementsByTagNameNS(this.namespace.nick,"nick"),t.length>0&&(o=t[0].textContent);var u="";t=e.getElementsByTagNameNS(this.namespace.vcard,"vCard");if(t.length>0){var a=t[0];t=a.getElementsByTagName("PHOTO");if(t.length>0){var f=t[0];t=f.getElementsByTagName("EXTVAL"),t.length>0&&(u=t[0].textContent)}}var l="";t=e.getElementsByTagNameNS(this.namespace.razerMucMessage,"ext"),t.length>0&&(l=t[0].getAttribute("jid"));var c={chat_id:r,user_id:l,message:i,nickname:o,message_id:s,avatar:u};try{this.trigger("groupMessage",c)}catch(h){console.error("Exception"),console.error(h)}return!0},_generateVerificationString:function(e){var t=["http://jabber.org/protocol/muc","http://jabber.org/protocol/disco#info","razer:muc:channel",e+"+notify","urn:comms:streams+notify","urn:ietf:params:xml:ns:conference-info+notify","urn:xmpp:chat-markers:0"],n="client/web/en/comms_web_1/";for(var r=0;r<t.length;++r)n+="<"+t[r];return d(n)},_sendPresence:function(t){var n=e.extend({show:"",caps:{hash:"",node:"",ver:""},photo_hash:""},t),r=$pres();n.caps.ver!==""&&n.caps.node!==""&&n.caps.hash!==""&&r.c("c",{xmlns:this.namespace.caps,hash:n.caps.hash,node:n.caps.node,ver:n.caps.ver}),n.photo_hash!==""&&r.up().c("x",{xmlns:this.namespace.vcardUpdate}).c("photo").t(n.photo_hash),this._send(r)},_handleDiscoInfoQuery:function(e){var t=$iq({type:"result",id:e.getAttribute("id"),to:e.getAttribute("from")});return t.c("query",{xmlns:this.namespace.discoInfo}).c("identity",{category:"client",type:"web",name:"Comms"}),t.up().c("feature",{"var":this.namespace.muc}),t.up().c("feature",{"var":this.namespace.razerMucChannel}),t.up().c("feature",{"var":this.namespace.discoInfo}),t.up().c("feature",{"var":this.get("user_id")+"+notify"}),t.up().c("feature",{"var":"urn:comms:streams+notify"}),t.up().c("feature",{"var":this.namespace.conferenceInfo}),t.up().c("feature",{"var":this.namespace.conferenceInfo+"+notify"}),this._send(t),!0},_handlePubSubMessageEvent:function(e){var t=e.getAttribute("from"),r=e.getElementsByTagNameNS(this.namespace.pubsubEvent,"event");if(r.length>0){var i=r[0];r=i.getElementsByTagNameNS(this.namespace.pubsubEvent,"items");if(r.length>0){var s=r[0],o=s.getAttribute("node");r=s.getElementsByTagNameNS(this.namespace.pubsubEvent,"item");if(r.length>0){var u=r[0];r=u.getElementsByTagNameNS(this.namespace.json,"json");if(r.length>0){var a=r[0];try{var f=JSON.parse(a.textContent);try{var l={topic:o,message:f,sender:n.getBareJidFromJid(t)};this.trigger("pubsubMessage",l)}catch(c){console.error(c),console.error(c.stack)}}catch(c){console.error("JSON.parse error"),console.error(a.textContent),console.error(c)}}else{r=u.getElementsByTagNameNS(this.namespace.forwarded,"forwarded");if(r.length>0)return this._handleForwardedMessage(e),!0;r=u.getElementsByTagNameNS(this.namespace.pubsubSelf,"mark-message");if(r.length>0)return this._handleMarkMessagePubsub(e),!0;r=u.getElementsByTagNameNS(this.namespace.pubsubSelf,"mark-group-message");if(r.length>0)return this._handleMarkGroupMessagePubsub(e),!0;r=u.getElementsByTagNameNS(this.namespace.pubsubSelf,"leave-group");if(r.length>0)return this._handleLeaveGroupPubSub(e),!0;if(o===this.namespace.conferenceInfo)return this._handleConferenceInfoEvent(e),!0}}}}return!0},_forwardToOtherDevices:function(e){var t=this.get("user_id"),n=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});n.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:t}).c("item").c("forwarded",{xmlns:this.namespace.forwarded}),n.cnode(e.nodeTree),this._send(n)},_publishSyncHistory:function(){var e=this.get("user_id"),t=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});t.c("pubsub",{xmlns:this.namespace.pubsub}).c("publish",{node:e}).c("item").c("sync-chat-history",{xmlns:this.namespace.pubsubSelf}),this._send(t)},_handleForwardedMessage:function(e){var t=e.getAttribute("from"),r=n.getResourceFromJid(t),i=n.getResourceFromJid(this.xmpp.jid);if(r===i)return;var s;s=e.getElementsByTagNameNS(this.namespace.client,"message");if(s.length>0){var o=s[0];if(o.getAttribute("type")==="chat"){var u=o.getAttribute("to"),a=this._getMessageDataFromPacket(o);a.user_id=n.getBareJidFromJid(t),u&&(a.chat_id=n.getBareJidFromJid(u));try{this.trigger("messageForwarded",a)}catch(f){console.error("Exception"),console.error(f)}}}},_handleMarkMessagePubsub:function(e){var t=e.getAttribute("from"),r=n.getResourceFromJid(t),i=n.getResourceFromJid(this.xmpp.jid);if(r===i){console.debug("_handleMarkMessagePubsub: got from my own resource");return}var s=e.getElementsByTagNameNS(this.namespace.pubsubSelf,"sender-id"),o="",u="";s.length>0&&(o=s[0].textContent),s=e.getElementsByTagNameNS(this.namespace.pubsubSelf,"message-id"),s.length>0&&(u=s[0].textContent);if(o!==""&&u!==""){console.debug("_handleMarkMessagePubsub: sender_id: "+o+" message_id: "+u);try{this.trigger("selfMarkMessage",{chat_id:o,message_id:u})}catch(a){console.error("Exception"),console.error(a)}}},_handleMarkGroupMessagePubsub:function(e){var t=e.getAttribute("from"),r=n.getResourceFromJid(t),i=n.getResourceFromJid(this.xmpp.jid);if(r===i){console.debug("_handleMarkGroupMessagePubsub: got from my own resource");return}var s=e.getElementsByTagNameNS(this.namespace.pubsubSelf,"channel-id"),o="",u="";s.length>0&&(o=s[0].textContent),s=e.getElementsByTagNameNS(this.namespace.pubsubSelf,"message-id"),s.length>0&&(u=s[0].textContent);if(o!==""&&u!==""){console.debug("_handleMarkGroupMessagePubsub: lobby_id: "+o+" message_id: "+u);try{this.trigger("selfMarkMessage",{chat_id:o,message_id:u})}catch(a){console.error("Exception"),console.error(a)}}},_handleGroupInviteMessage:function(e){var t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");if(t.length===0)return!0;t=t[0].getElementsByTagName("invite");if(t.length===0)return!0;var r=t[0].getAttribute("from");if(!r||r==="")return!0;r=n.getBareJidFromJid(r),t=e.getElementsByTagNameNS(this.namespace.razerMucChannel,"channel");if(t.length===0)return!0;var i=t[0];t=i.getElementsByTagName("group-id");if(t.length===0)return!0;var s=t[0].textContent;t=i.getElementsByTagName("channel-id");if(t.length===0)return!0;var o=t[0].textContent;if(!o||!s)return!0;console.debug("_handleGroupInviteMessage: group_id: "+s+" channel_id: "+o);try{this.trigger("groupInvite",{user_id:r,group_id:s,lobby_id:o})}catch(u){console.error("Exception"),console.error(u)}return!0},_handleAdhocInviteMessage:function(e){var t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");if(t.length===0)return!0;var r=t[0];t=t[0].getElementsByTagName("invite");if(t.length===0)return!0;var i=t[0].getAttribute("from");if(!i||i==="")return!0;i=n.getBareJidFromJid(i),t=r.getElementsByTagNameNS(this.namespace.razerMucMessage,"ext");if(t.length===0)return!0;var s=t[0],o=s.getAttribute("invite-type");console.debug("_handleAdhocInviteMessage invite_type: "+o);var u="",a="";u=e.getAttribute("from"),t=e.getElementsByTagNameNS(this.namespace.nick,"nick"),t.length>0&&(a=t[0].textContent),console.debug("_handleAdhocInviteMessage:  group_id: "+u+" user_id: "+i+" nickname: "+a);try{o==="voice"?this.trigger("incomingCall",{user_id:i,session_id:u,nickname:a,voice:!0,video:!1}):o==="chat"&&this.trigger("adhocGroupInvite",{user_id:i,group_id:u,nickname:a})}catch(f){console.error("Exception"),console.error(f)}return!0},_handleAcceptVoiceInviteMessage:function(e){var t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");if(t.length===0)return!0;var r=t[0];t=t[0].getElementsByTagNameNS(this.namespace.razerMucMessage,"accept");if(t.length===0)return!0;var i=t[0].getAttribute("from");if(!i||i==="")return!0;i=n.getBareJidFromJid(i),console.debug("_handleAcceptVoiceInviteMessage: from: "+i),t=r.getElementsByTagNameNS(this.namespace.razerMucMessage,"ext");if(t.length===0)return!0;var s=t[0].getAttribute("invite-type");console.debug("_handleAcceptVoiceInviteMessage: invite_type: "+s);if(s!=="voice")return console.warn("invalid invite_type: "+s),!0;var o=e.getAttribute("from");console.debug("_handleAcceptVoiceInviteMessage:  group_id: "+o+" user_id: "+i);try{this.trigger("answerCall",{user_id:i,session_id:o,voice:!0,video:!1})}catch(u){console.error("Exception"),console.error(u)}return!0},_handleRejectVoiceInviteMessage:function(e){var t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");if(t.length===0)return!0;var r=t[0];t=t[0].getElementsByTagNameNS(this.namespace.mucUser,"decline");if(t.length===0)return!0;var i=t[0].getAttribute("from");if(!i||i==="")return!0;i=n.getBareJidFromJid(i),t=r.getElementsByTagNameNS(this.namespace.razerMucMessage,"ext");if(t.length===0)return!0;var s=t[0].getAttribute("invite-type");console.debug("_handleRejectVoiceInviteMessage: from: "+i+" invite_type: "+s);if(s!=="voice")return console.warn("invalid invite_type: "+s),!0;var o=e.getAttribute("from");console.debug("_handleRejectVoiceInviteMessage:  group_id: "+o+" user_id: "+i);try{this.trigger("rejectCall",{user_id:i,session_id:o,voice:!0,video:!1})}catch(u){console.error("Exception"),console.error(u)}return!0},_handleLeaveGroupPubSub:function(e){var t=e.getElementsByTagNameNS(this.namespace.pubsubSelf,"group-id");if(t.length===0)return;var n=t[0].textContent;console.debug("_handleLeaveGroupPubSub: group_id: "+n);try{this.trigger("groupRemoved",{group_id:n})}catch(r){console.error("Exception"),console.error(r)}},_handleMucPresence:function(e){var t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");console.assert(t.length>0);var r=t[0];t=r.getElementsByTagNameNS(this.namespace.mucUser,"destroy");if(t.length>0){var i=e.getAttribute("from");i=n.getBareJidFromJid(i),console.debug("_handleMucPresence: got destroy room, group_id: "+i);try{this.trigger("groupRemoved",{group_id:i,destroy:!0})}catch(s){console.error("Exception"),console.error(s)}return!0}return!0},_handleConferenceInfoEvent:function(e){var t=e.getElementsByTagNameNS(this.namespace.razerMuc,"room");if(t.length===0)return;var n=t[0];t=n.getElementsByTagNameNS(this.namespace.razerMuc,"action");var r="";t.length>0&&(r=t[0].textContent),t=n.getElementsByTagNameNS(this.namespace.razerMuc,"group-id");if(t.length===0)return;var i=t[0].textContent;if(r==="update")try{this.trigger("groupUpdate",{group_id:i})}catch(s){console.error("Exception"),console.error(s)}},_handleChatState:function(e){var t=e.getAttribute("from"),r=n.getBareJidFromJid(t);if(!e.firstChild)return!0;if(e.firstChild.getAttribute("xmlns")!==this.namespace.chatStates)return!0;var i=e.firstChild.localName;if(i!=="composing"&&i!=="paused"&&i!=="active"&&i!=="inactive"&&i!=="gone")return!0;try{this.trigger("typingState",{chat_id:r,state:i})}catch(s){console.error("Exception"),console.error(s)}return!0},_handleGroupChatState:function(e){var t=e.getAttribute("from"),r=n.getBareJidFromJid(t),i=e.childNodes,s="",o="",u="",a=e.getElementsByTagNameNS(this.namespace.razerMucMessage,"ext");a.length>0&&(u=a[0].getAttribute("jid"));if(u===this.user.get("id"))return!0;for(var f=0;f<i.length;f++)if(i[f].getAttribute("xmlns")===this.namespace.chatStates){s=i[f].localName;break}if(s!=="composing"&&s!=="paused"&&s!=="active"&&s!=="inactive"&&s!=="gone")return!0;a=e.getElementsByTagNameNS(this.namespace.nick,"nick"),a.length>0&&(o=a[0].textContent);if(s!==""&&u!==""&&o!==""&&r!=="")try{this.trigger("typingState",{chat_id:r,state:s,nickname:o,group_chat:!0,user_id:u})}catch(l){console.error("Exception"),console.error(l)}return!0},_handleCancelVoiceInviteMessage:function(e){var t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");if(t.length===0)return!0;var r=t[0];t=t[0].getElementsByTagNameNS(this.namespace.razerMucMessage,"cancel");if(t.length===0)return!0;var i=t[0].getAttribute("from");if(!i||i==="")return!0;i=n.getBareJidFromJid(i),t=r.getElementsByTagNameNS(this.namespace.razerMucMessage,"ext");if(t.length===0)return!0;var s=t[0].getAttribute("invite-type");console.debug("_handleCancelVoiceInviteMessage: from: "+i+" invite_type: "+s);if(s!=="voice")return console.warn("invalid invite_type: "+s),!0;var o=e.getAttribute("from");console.debug("_handleCancelVoiceInviteMessage:  group_id: "+o+" user_id: "+i);try{this.trigger("missedCall",{user_id:i,session_id:o,voice:!0,video:!1})}catch(u){console.error("Exception"),console.error(u)}return!0},_handleMemberPresence:function(e){var t;t=e.getElementsByTagNameNS(this.namespace.mucUser,"x");if(t.length===0)return!0;var r=t[0],i=!1,s=e.getAttribute("from");if(!s||s==="")return!0;s=n.getBareJidFromJid(s),t=r.getElementsByTagNameNS(this.namespace.mucUser,"status");for(var o=0;o<t.length;o++){var u=t[o].getAttribute("code");u==="501"&&(console.debug("User joined"),i=!0)}t=r.getElementsByTagNameNS(this.namespace.mucUser,"item");if(t.length===0)return!0;var a=t[0].getAttribute("jid");if(!a||a==="")return!0;var f=n.getBareJidFromJid(a),l="online";e.getAttribute("type")==="unavailable"?l="offline":(t=e.getElementsByTagNameNS(this.namespace.client,"show"),t.length>0&&(l=t[0].textContent,l==="dnd"?l="busy":l==="invisible"&&(l="offline")));var c;t=e.getElementsByTagNameNS(this.namespace.razerPresence,"ext");if(t.length>0){var h=t[0];t=h.getElementsByTagName("audio-status"),t.length>0&&(t[0].textContent==="2"?c=!0:c=!1)}l==="offline"&&(c=!1);var p={chat_id:s,user_id:f,presence:l,jid:a};typeof c!="undefined"&&(p.voice_enabled=c);try{this.trigger("memberPresence",p)}catch(d){console.error("Exception"),console.error(d)}return!0}});return o}),P("razercomms/friendmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{id:"",nick:"",avatar:"",presence:"",is_favorite:!1,is_blocked:!1,is_pending:!1}});return n}),P("razercomms/friendcollection",["underscore","backbone","razercomms/friendmodel"],function(e,t,n){var r=t.Collection.extend({model:n,initialize:function(t,n){e.bindAll(this,"_beforeSend"),n&&(this.options=n)},parse:function(e){return e.data},_beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(this.options.api_key+":"+""))},fetch:function(e){return console.assert(typeof this.options.api_key!="undefined"),console.assert(this.options.api_key!==""),e||(e={}),e.beforeSend=this._beforeSend,t.Collection.prototype.fetch.call(this,e)}});return r}),P("razercomms/friends",["jquery","underscore","backbone","razercomms/friendcollection"],function(e,t,n,r){var i=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(i.prototype,n.Events,{options:{},user_id:null,api_key:null,friendCollection:null,initialize:function(e){t.bindAll(this,"get","add","accept","remove","search","setFavorite","unsetFavorite","block","unblock","getBlocklist"),this.options=t.extend({ChatEngine:null,restBaseUrl:"",api_key:""},e),this.user_id=null,this.api_key=null,this.friendCollection=new r([],{api_key:this.options.api_key})},get:function(e){var t=new r([],{api_key:this.options.api_key});t.url=this.options.restBaseUrl+"/friends?show_presence=true&show_pending=true",t.fetch();var n=this;t.on("sync",function(t){e.success({data:t.toJSON()}),n.trigger("friendList",t.toJSON())}),this.friendCollection=t},add:function(e){console.assert(this.options.ChatEngine),console.assert(typeof e.user_id!="undefined"),this.options.ChatEngine.addFriend(e.user_id)},accept:function(e){console.assert(this.options.ChatEngine),console.assert(typeof e.user_id!="undefined"),this.options.ChatEngine.acceptFriend(e.user_id)},reject:function(e){console.assert(typeof e.user_id!="undefined"),this.options.ChatEngine.rejectFriend(e.user_id)},remove:function(e){console.assert(typeof e.user_id!="undefined"),console.debug("remove: "+JSON.stringify(e)),this.options.ChatEngine.removeFriend(e.user_id)},search:function(t){console.assert(typeof t.query!="undefined"&&t.query!=="");var n=this.options.restBaseUrl+"/users?q="+encodeURIComponent(t.query);n+="&api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success({query:t.query,data:e.data})}).fail(function(e){console.error(e)})},setFavorite:function(n){console.assert(n&&n.user_id&&n.user_id!=="");var r=this;e.ajax({type:"PUT",url:this.options.restBaseUrl+"/friends/"+encodeURIComponent(n.user_id),dataType:"json",data:JSON.stringify({is_favorite:!0}),headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){console.debug("setFavorite: success: "+JSON.stringify(e)),n.success&&n.success();if(r.options.ChatEngine.user){var i=r.options.ChatEngine.user.get("id"),s=t.extend({event:"reloadFriends"},e);r.options.ChatEngine.publishToPubSub(i,s)}}).fail(function(e){console.error(e)})},unsetFavorite:function(n){console.assert(n&&n.user_id&&n.user_id!=="");var r=this;e.ajax({type:"PUT",url:this.options.restBaseUrl+"/friends/"+encodeURIComponent(n.user_id),dataType:"json",data:JSON.stringify({is_favorite:!1}),headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){n.success&&n.success();if(r.options.ChatEngine.user){var i=r.options.ChatEngine.user.get("id"),s=t.extend({event:"reloadFriends"},e);r.options.ChatEngine.publishToPubSub(i,s)}}).fail(function(e){console.error(e)})},block:function(t){console.assert(t&&t.user_id&&t.user_id!=="");var n=this,r=this.options.restBaseUrl+"/blocks/"+encodeURIComponent(t.user_id);r+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"POST",url:r,dataType:"json"}).done(function(e){t.success(e),n.trigger("friendBlocked",{user_id:t.user_id})}).fail(function(e){console.error(e)})},unblock:function(t){console.assert(t&&t.user_id&&t.user_id!=="");var n=this,r=this.options.restBaseUrl+"/blocks/"+encodeURIComponent(t.user_id);r+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"DELETE",url:r,dataType:"json"}).done(function(e){t.success(e),n.trigger("friendUnblocked",{user_id:t.user_id})}).fail(function(e){console.error(e)})},getBlocklist:function(t){var n=this.options.restBaseUrl+"/blocks";n+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success({data:e.data})}).fail(function(e){console.error(e)})}}),i}),P("razercomms/usermodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({options:{},defaults:{id:"",avatar:"",comms_id:"",nickname:""},initialize:function(t,n){e.bindAll(this,"_beforeSend"),n&&(this.options=n)},_beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(this.options.api_key+":"+""))}});return n}),P("razercomms/messagecollection",["underscore","backbone"],function(e,t){var n=t.Collection.extend({unread_count:0,initialize:function(t,n){e.bindAll(this,"_beforeSend"),this.unread_count=0,n&&(this.options=n)},parse:function(e){return typeof e.unread_count!="undefined"&&(this.unread_count=e.unread_count),e.data},_beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(this.options.api_key+":"+""))},fetch:function(e){return console.assert(typeof this.options.api_key!="undefined"),console.assert(this.options.api_key!==""),e||(e={}),t.Collection.prototype.fetch.call(this,e)}});return n}),P("razercomms/recentchatmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{chat_id:"",avatar:"",name:"",message:"",message_id:"",direction:"",group_chat:"",timestamp:0,unread:0,version:0,type:"chat",unread_missed_call:0},idAttribute:"chat_id",initialize:function(){}});return n}),P("razercomms/recentchatcollection",["underscore","backbone","razercomms/recentchatmodel"],function(e,t,n){var r=t.Collection.extend({model:n,initialize:function(t,n){e.bindAll(this,"_beforeSend"),n&&(this.options=n)},parse:function(e){return e.data},_beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(this.options.api_key+":"+""))},fetch:function(e){return console.assert(typeof this.options.api_key!="undefined"),console.assert(this.options.api_key!==""),e||(e={}),t.Collection.prototype.fetch.call(this,e)},comparator:function(e,t){var n=e.get("timestamp"),r=t.get("timestamp");return n>r?-1:n<r?1:0}});return r}),P("razercomms/chathistory",["jquery","underscore","backbone","razercomms/messagecollection","razercomms/recentchatcollection","razercomms/recentchatmodel"],function(e,t,n,r,i,s){var o=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(o.prototype,n.Events,{options:{},user_id:null,api_key:null,recentChatCollection:null,debugTag:null,messages_map:[],initialize:function(e){t.bindAll(this,"markAsRead","getChats","getMessages","deleteMessages","saveCall","_onOutgoingMessage","_onIncomingMessage","_onIncomingGroupMessage","_onRecentChatChange","_onMessageForwarded","_onSelfMarkMessage","_onMissedCall"),t.bindAll(this,"_cacheOutgoingMessage","_cacheIncomingMessage","_cacheGroupMessage","_onCacheCallHistory","_appendToCachedMessages"),t.bindAll(this,"uploadAttachment","saveLinkPreview"),this.options=t.extend({ChatEngine:null,Groups:null,Friends:null,restBaseUrl:"",restBaseUrl2:"",api_key:""},e),console.assert(this.options.ChatEngine&&typeof this.options.ChatEngine!="undefined"),this.user_id=null,this.api_key=null,this.recentChatCollection=new i([],{api_key:this.options.api_key}),this.debugTag=this.options.ChatEngine.debugTag,this.messages_map=[],this.options.ChatEngine.on("outgoingMessage",this._onOutgoingMessage),this.options.ChatEngine.on("message",this._onIncomingMessage),this.options.ChatEngine.on("groupMessage",this._onIncomingGroupMessage),this.options.ChatEngine.on("messageForwarded",this._onMessageForwarded),this.options.ChatEngine.on("selfMarkMessage",this._onSelfMarkMessage),this.options.ChatEngine.on("missedCall",this._onMissedCall),this.on("recentChatChange",this._onRecentChatChange),this.options.ChatEngine.on("outgoingMessage",this._cacheOutgoingMessage),this.options.ChatEngine.on("message",this._cacheIncomingMessage),this.options.ChatEngine.on("groupMessage",this._cacheGroupMessage),this.options.ChatEngine.on("messageForwarded",this._cacheOutgoingMessage),this.on("recentChatChange",this._onCacheCallHistory),this.on("chatDeleted",this._onEmptyCache)},getChats:function(e){var t=this;this.recentChatCollection=new i([],{api_key:this.options.api_key}),this.recentChatCollection.url=this.options.restBaseUrl+"/chathistory/chats",this.recentChatCollection.url+="?show_calls=1",this.recentChatCollection.url+="&api_key="+encodeURIComponent(this.options.api_key),this.recentChatCollection.fetch(),this.recentChatCollection.on("sync",function(t){e&&e.success&&e.success({data:t.toJSON()})})},getMessages:function(e){console.debug("getMessages Chat History: "+JSON.stringify(e));var t=new r([],{api_key:this.options.api_key}),n="";e.chat_id?(t.url=this.options.restBaseUrl+"/chathistory/"+encodeURIComponent(e.chat_id)+"/messages",n=e.chat_id):(t.url=this.options.restBaseUrl+"/chathistory/"+encodeURIComponent(e.user_id)+"/messages",n=e.user_id);var i=!1;typeof e.offset!="undefined"&&(t.url+="?offset="+e.offset,i=!0),typeof e.limit!="undefined"?(i?t.url+="&limit="+e.limit:t.url+="?limit="+e.limit,t.url+="&api_key="+encodeURIComponent(this.options.api_key)):t.url+="?api_key="+encodeURIComponent(this.options.api_key),t.url+="&show_calls=1",t.fetch();var s=this;t.on("sync",function(t){i||(s.messages_map[n]={unread_count:t.unread_count,data:t.toJSON()}),e.success({unread_count:t.unread_count,data:t.toJSON()})})},markAsRead:function(t){console.assert(typeof t!="undefined"),console.assert(typeof t.chat_id!="undefined"),console.assert(typeof t.message_id!="undefined"),console.debug("markAsRead: "+JSON.stringify(t));var n=this,r=this.options.restBaseUrl+"/chathistory/"+encodeURIComponent(t.chat_id);r+="/messages/"+encodeURIComponent(t.message_id)+"/mark",t.adhoc&&(r+="?adhoc=true"),e.ajax({type:"POST",url:r,dataType:"json",headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){t.success&&t.success(e);var r;n.recentChatCollection?(r=n.recentChatCollection.get(t.chat_id),r&&(r.set("unread",0),r.set("unread_missed_call",0))):(console.warn("markAsRead: RecentChatModel not found for chat_id: "+t.chat_id),console.warn(n.recentChatCollection.toJSON())),r||(r=new s({chat_id:t.chat_id,message_id:t.message_id,unread:0})),n.trigger("recentChatChange",r.toJSON()),n.trigger("recentChatChange."+r.get("chat_id"),r.toJSON());if(!n.options.ChatEngine.isGroupChat(t.chat_id)||t.adhoc)n.options.ChatEngine.publishMarkMessage(t.chat_id,t.message_id);else{var i=n.options.Groups.getGroupFromCache(t.chat_id);i?n.options.ChatEngine.publishMarkGroupMessage(i.get("id"),i.get("lobby_id"),t.message_id):console.debug("markAsRead: group not found in cache")}}).fail(function(e){t.error&&t.error(e)})},deleteMessages:function(t){console.assert(t&&t.chat_id&&t.chat_id!=="");var n=this,r=this.options.restBaseUrl+"/chathistory/"+encodeURIComponent(t.chat_id);e.ajax({type:"DELETE",url:r,dataType:"json",headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){t.success&&(n.trigger("chatDeleted",{chat_id:t.chat_id}),t.success(e))}).fail(function(e){console.error("deleteMessages"),console.error(e),t.error&&t.error(e)})},saveCall:function(n){var r=this,i=this.options.ChatEngine.generateMessageId(n.chat_id+n.session_id),s=t.extend({message_id:i,session_id:"",type:"",direction:"",duration:"",chat_id:""},n);console.debug("saveCall: "+JSON.stringify(s)),console.assert(n.chat_id&&n.chat_id!==""),console.assert(n.session_id&&n.session_id!==""),console.assert(n.type&&n.type!==""),console.assert(n.direction&&n.direction!=="");var o=this.options.restBaseUrl+"/calls";e.ajax({type:"POST",url:o,dataType:"json",data:JSON.stringify(s),headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){n.success&&n.success(e);var i;r.recentChatCollection&&(i=r.recentChatCollection.get(n.chat_id),i&&(i.set("direction",s.direction),i.set("type",s.type),i.set("timestamp",Math.floor(Date.now()/1e3)),i.set("message"," "),i.set("message_id",s.message_id),s.duration!==""&&i.set("duration",s.duration),r.options.ChatEngine.isGroupChat(n.chat_id)||i.set("adhoc",!0))),i&&(r.trigger("recentChatChange",i.toJSON()),r.trigger("recentChatChange."+i.get("chat_id"),i.toJSON()));var o=r.options.ChatEngine.user.get("id"),u=t.extend({event:"saveCall"},s);r.options.ChatEngine.publishToPubSub(o,u)}).fail(function(e){console.error("saveCall: error:"),console.error(e)})},uploadAttachment:function(t){console.assert(t&&t.chat_id&&t.chat_id!==""),console.assert(t.data&&t.data!==""),console.assert(this.options.restBaseUrl2!=="");var n=this.options.restBaseUrl2+"/attachments/"+encodeURIComponent(t.chat_id);n+="?api_key="+encodeURIComponent(this.options.api_key);var r={data:t.data};t.type&&t.type!==""&&(r.type=t.type),console.debug("uploadAttachment: type: "+t.type),e.ajax({type:"POST",url:n,dataType:"json",data:JSON.stringify(r)}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error("uploadAttachment: error:"),console.error(e)})},getCachedMessages:function(e){return console.assert(e&&e.chat_id&&e.chat_id!==""),this.messages_map&&this.messages_map[e.chat_id]?this.messages_map[e.chat_id]:null},saveLinkPreview:function(n){console.assert(n);var r=t.extend({chat_id:"",message_id:"",type:"website",data:{}},n);console.assert(r.chat_id!==""),console.assert(r.message_id!=="");var i=this.options.restBaseUrl2+"/attachments";i+="?api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"POST",url:i,dataType:"json",contentType:"application/json",data:JSON.stringify(r)}).done(function(e){n.success&&n.success(e)}).fail(function(e){console.error("saveLinkPreview: error:"),console.error(e),n.error&&n.error(e)})},_onOutgoingMessage:function(e){var t;if(this.recentChatCollection){t=this.recentChatCollection.get(e.chat_id);if(t)t.set({message:e.message,message_id:e.message_id,timestamp:e.timestamp,direction:"outgoing",unread:e.unread,adhoc:!1,type:"chat"});else{t=new s(e);var n=this.options.Friends.friendCollection.get(e.chat_id);n&&(t.set("name",n.get("nick")),t.set("avatar",n.get("avatar"))),this.recentChatCollection.add(t)}}else t=new s(e),this.recentChatCollection.add(t);this.trigger("recentChatChange",t.toJSON()),this.trigger("recentChatChange."+t.get("chat_id"),t.toJSON())},_onIncomingMessage:function(e){var t=1,n={chat_id:e.user_id,name:e.nickname,avatar:e.avatar,direction:"incoming",group_chat:!1,message:e.message,message_id:e.message_id,timestamp:Math.floor(Date.now()/1e3),unread:t,type:"chat",adhoc:!1};console.assert(n.chat_id!==""),console.assert(typeof n.chat_id!="undefined");var r;this.recentChatCollection?(r=this.recentChatCollection.get(e.user_id),r?(t=r.get("unread")+1,r.set({message:n.message,message_id:n.message_id,timestamp:n.timestamp,direction:"incoming",unread:t,type:"chat",adhoc:!1})):(r=new s(n),this.recentChatCollection.add(r))):(r=new s(n),this.recentChatCollection.add(r)),this.trigger("recentChatChange",r.toJSON()),this.trigger("recentChatChange."+r.get("chat_id"),r.toJSON())},_onIncomingGroupMessage:function(e){console.assert(this.options.ChatEngine&&typeof this.options.ChatEngine!="undefined");var t=1,n="incoming";this.options.ChatEngine.user&&e.user_id===this.options.ChatEngine.user.get("id")&&(n="outgoing",t=0),console.assert(e.chat_id&&e.chat_id!=="");var r={chat_id:e.chat_id,direction:n,group_chat:!0,message:e.message,message_id:e.message_id,timestamp:Math.floor(Date.now()/1e3),unread:t,type:"chat",sender:{id:e.user_id,nickname:e.nickname}};console.assert(this.options.Groups&&typeof this.options.Groups!="undefined");var i=this.options.Groups.getGroupFromCache(e.chat_id);i&&(r.name=i.get("name"));var o;this.recentChatCollection?(o=this.recentChatCollection.get(e.chat_id),o?(n==="incoming"&&(t=o.get("unread")+1),o.set({message:r.message,message_id:r.message_id,timestamp:r.timestamp,direction:n,unread:t,sender:r.sender,type:"chat",duration:0})):(o=new s(r),this.recentChatCollection.add(o))):(o=new s(r),this.recentChatCollection.add(o)),this.trigger("recentChatChange",o.toJSON()),this.trigger("recentChatChange."+o.get("chat_id"),o.toJSON())},_onRecentChatChange:function(e){var t=[],n=0;for(n=0;n<this.recentChatCollection.length;++n)t.push({chat_id:this.recentChatCollection.at(n).get("chat_id"),timestamp:this.recentChatCollection.at(n).get("timestamp")});var r=[];this.recentChatCollection.sort();for(n=0;n<this.recentChatCollection.length;++n)r.push({chat_id:this.recentChatCollection.at(n).get("chat_id"),timestamp:this.recentChatCollection.at(n).get("timestamp")});if(JSON.stringify(t)!==JSON.stringify(r)){var i=this;setTimeout(function(){i.trigger("recentChatSort")},100)}},_onMessageForwarded:function(e){console.debug("_onMessageForwarded: data: "+JSON.stringify(e));var t={chat_id:e.chat_id,message:e.message,direction:"outgoing",group_chat:!1,message_id:e.message_id,timestamp:Math.floor(Date.now()/1e3),unread:0};this._onOutgoingMessage(t)},_onSelfMarkMessage:function(e){var t;this.recentChatCollection&&(t=this.recentChatCollection.get(e.chat_id),t&&(t.set({unread:0}),this.trigger("recentChatChange",t.toJSON()),this.trigger("recentChatChange."+t.get("chat_id"),t.toJSON())))},_onMissedCall:function(e){console.debug("_onMissedCall: "+JSON.stringify(e));var t=this,n;if(t.recentChatCollection){n=t.recentChatCollection.get(e.user_id);if(n){n.set("direction","incoming"),n.set("type","missed_call"),n.set("timestamp",Math.floor(Date.now()/1e3)),n.set("message","Missed Call"),n.set("adhoc",!0),n.set("duration",0);var r=n.get("unread_missed_call"),i=n.get("unread");n.set("unread_missed_call",r+1),n.set("unread",i+1)}n&&(t.trigger("recentChatChange",n.toJSON()),t.trigger("recentChatChange."+n.get("chat_id"),n.toJSON()))}},_cacheOutgoingMessage:function(e){var t=e.chat_id,n="",r="",i="",s="";this.options.ChatEngine.user&&(n=this.options.ChatEngine.user.get("comms_id"),r=this.options.ChatEngine.user.get("id"),i=this.options.ChatEngine.user.get("nickname"),s=this.options.ChatEngine.user.get("avatar"));var o={avatar:s,comms_id:n,direction:"outgoing",group_chat:!1,message:e.message,message_id:e.message_id,sender:r,sender_name:i,timestamp:Math.floor(Date.now()/1e3),type:"chat",unread:0};this._appendToCachedMessages(t,o)},_cacheIncomingMessage:function(e){var t;e.chat_id?t=e.chat_id:t=e.user_id,console.debug("chat_id---"+t);var n={avatar:e.avatar,direction:"incoming",group_chat:!1,message:e.message,message_id:e.message_id,sender:e.user_id,sender_name:e.nickname,timestamp:Math.floor(Date.now()/1e3),type:"chat",unread:1};this._appendToCachedMessages(t,n)},_cacheGroupMessage:function(e){var t=e.chat_id,n=1,r="incoming";this.options.ChatEngine.user&&e.user_id===this.options.ChatEngine.user.get("id")&&(r="outgoing",n=0);var i={avatar:e.avatar,direction:r,group_chat:!0,message:e.message,message_id:e.message_id,sender:e.user_id,sender_name:e.nickname,timestamp:Math.floor(Date.now()/1e3),type:"chat",unread:n};this._appendToCachedMessages(t,i)},_onCacheCallHistory:function(e){if(e.type!=="chat"){var t=e.chat_id,n={direction:e.direction,duration:e.duration,group_chat:e.group_chat,message:e.message,message_id:e.message_id,timestamp:Math.floor(Date.now()/1e3),type:e.type,unread:e.unread,unread_missed_call:e.unread_missed_call};this._appendToCachedMessages(t,n)}},_appendToCachedMessages:function(e,t){var n=this.getCachedMessages({chat_id:e});if(n){var r=n.data;r&&(r.push(t),r.length>20&&r.splice(0,1),this.messages_map[e].data=r)}},_onEmptyCache:function(e){var t=e.chat_id,n=this.getCachedMessages({chat_id:t});if(n){var r=n.data;r&&(r=[],this.messages_map[t].data=r)}}}),o}),P("razercomms/groupmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{id:"",lobby_id:"",name:"",owner:"",type:"",icon:"",members:0}});return n}),P("razercomms/groupcollection",["underscore","backbone","razercomms/groupmodel"],function(e,t,n){var r=t.Collection.extend({model:n,initialize:function(t,n){e.bindAll(this,"_beforeSend"),n&&(this.options=n)},parse:function(e){return e.data},_beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(this.options.api_key+":"+""))},fetch:function(e){return console.assert(typeof this.options.api_key!="undefined"),console.assert(this.options.api_key!==""),e||(e={}),e.beforeSend=this._beforeSend,t.Collection.prototype.fetch.call(this,e)}});return r}),P("razercomms/membermodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{id:"",nickname:"",comms_id:"",avatar:"",presence:"",voice_enabled:!1}});return n}),P("razercomms/membercollection",["underscore","backbone","razercomms/membermodel"],function(e,t,n){var r=t.Collection.extend({model:n,parse:function(e){return console.assert(typeof e.data!="undefined"),e.data},comparator:function(e,t){var n=e.get("nickname"),r=t.get("nickname");return n>r?1:n<r?-1:0}});return r}),P("razercomms/groups",["jquery","underscore","backbone","razercomms/groupcollection","razercomms/groupmodel","razercomms/membercollection"],function(e,t,n,r,i,s){var o=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(o.prototype,n.Events,{options:{},groupCollection:null,initialize:function(e){t.bindAll(this,"get","create","update","join","leave","getGroupFromCache","getMembers","getInfo","addMember","convert"),this.options=t.extend({ChatEngine:null,restBaseUrl:"",api_key:"",user_id:""},e),this.groupCollection=new r([],{api_key:this.options.api_key}),console.assert(this.options.api_key!==""),console.assert(this.options.user_id&&this.options.user_id!=="")},get:function(e){var t=this,n=new r([],{api_key:this.options.api_key});n.url=this.options.restBaseUrl+"/groups",n.fetch(),n.once("sync",function(n){n.each(function(e){t.options.ChatEngine.enterGroup(e.get("id")),e.has("lobby_id")&&e.get("lobby_id")!==""?t.options.ChatEngine.enterChannel(e.get("lobby_id")):console.info("group does not have lobby_id: "+JSON.stringify(e.toJSON()))}),e.success({data:n.toJSON()})}),this.groupCollection=n},create:function(n){var r=this,i=t.extend({type:"Private",noname:!1},n),s={name:i.name,type:i.type,noname:i.noname,short_url:!1};e.ajax({type:"POST",url:this.options.restBaseUrl+"/groups",dataType:"json",data:JSON.stringify(s),headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){r.options.ChatEngine.enterGroup(e.id),e.lobby_id&&r.options.ChatEngine.enterChannel(e.lobby_id),n.type==="AdHoc"?r.join({id:e.id,success:function(){n.success&&n.success(e)}}):n.success&&n.success(e);if(r.options.ChatEngine.user){var i=r.options.ChatEngine.user.get("id"),s=t.extend({event:"groupCreated"},e);r.options.ChatEngine.publishToPubSub(i,s)}}).fail(function(e){n.error&&n.error(e)})},update:function(t){console.assert(t&&t.name&&t.name!==""),console.assert(t&&t.id&&t.id!==""),console.debug("update: name: "+t.name);var n={name:t.name};t.icon&&(n.icon=t.icon);var r=this;e.ajax({type:"PUT",url:this.options.restBaseUrl+"/groups/"+encodeURIComponent(t.id),dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){t.success&&(r.options.ChatEngine.publishGroupUpdate(t.id),t.success(e))}).fail(function(e){console.error("update group error:"),console.error(e)})},join:function(t){var n=this;console.assert(typeof t.id!="undefined");var r=this.options.restBaseUrl+"/groups/"+encodeURIComponent(t.id);r+="?short_url=false",r+="&api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:r,dataType:"json",headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){console.debug("join: group_id: "+t.id+" lobby_id: "+e.lobby_id),console.debug("join: got group info: "+JSON.stringify(e)),n.options.ChatEngine.joinGroup(t.id,function(){e.lobby_id?n.options.ChatEngine.enterChannel(e.lobby_id):n.options.ChatEngine.enterGroup(t.id),t.success&&t.success()});var r=new i(e);n.groupCollection.add(r)}).fail(function(e){console.error("get group info error:"),console.error(e)})},leave:function(e){console.assert(e&&e.id&&e.id!==""),this.options.ChatEngine.leaveGroup(e.id);var t=this,n={event:"leaveGroup",group:{id:e.id},member:{id:t.options.user_id}},r=this.groupCollection.get(e.id);r&&(r.has("lobby_id")&&(n.group.lobby_id=r.get("lobby_id")),r.has("name")&&(n.group.name=r.get("name"))),t.options.ChatEngine.user&&(t.options.ChatEngine.user.has("nickname")&&(n.member.nickname=t.options.ChatEngine.user.get("nickname")),t.options.ChatEngine.user.has("avatar")&&(n.member.avatar=t.options.ChatEngine.user.get("avatar"))),this.options.ChatEngine.publishMucEvent(e.id,n,function(){})},destroy:function(e){console.assert(e&&e.id&&e.id!==""),this.options.ChatEngine.destroyGroup(e.id)},getInfo:function(t){console.assert(t&&t.id&&t.id!=="");var n=this.options.restBaseUrl+"/groups/"+encodeURIComponent(t.id);n+="?short_url=false",n+="&api_key="+encodeURIComponent(this.options.api_key),e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success(e)}).fail(function(e){t.error&&t.error(e)})},sendMessage:function(e){return e.adhoc?(console.assert(typeof e.group_id!="undefined"&&e.group_id!==""),this.options.ChatEngine.sendGroupMessage(e.group_id,e.message,null,e.success)):this.options.ChatEngine.sendGroupMessage(e.lobby_id,e.message,null,e.success)},invite:function(e){console.debug("invite: "+JSON.stringify(e)),console.assert(typeof e.user_id!="undefined"),console.assert(typeof e.group_id!="undefined"),console.assert(typeof e.lobby_id!="undefined");var t="",n=this.getGroupFromCache(e.lobby_id);n&&(t=n.get("name")),this.options.ChatEngine.sendGroupInvite(e.user_id,e.group_id,e.lobby_id,t)},adhocInvite:function(e){console.assert(typeof e.user_id!="undefined"),console.assert(typeof e.group_id!="undefined"),this.options.ChatEngine.sendAdhocGroupInvite(e.user_id,e.group_id)},getMembers:function(e){var t=e.group_id,n=e.chat_id;console.assert(t||n),n&&n!==""&&(t=n),console.assert(t!=="");var r=this,i=new s([],{api_key:this.options.api_key});i.url=this.options.restBaseUrl+"/groups/",i.url+=encodeURIComponent(t)+"/members",i.url+="?api_key="+encodeURIComponent(this.options.api_key),i.fetch(),i.on("sync",function(t){e.success({data:t.toJSON()})})},addMember:function(t){console.assert(t&&t.user_id&&t.group_id);var n=this,r=this.options.restBaseUrl+"/groups/";r+=encodeURIComponent(t.group_id),r+="/members",e.ajax({type:"POST",url:r,dataType:"json",data:JSON.stringify({id:t.user_id}),headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){var r;n.groupCollection&&(r=n.groupCollection.get(t.group_id));var i={event:"addMember",group:{id:t.group_id},member:{id:t.user_id},by:{id:n.options.user_id}};r?(i.group.lobby_id=r.get("lobby_id"),i.group.name=r.get("name")):t.lobby_id&&(i.group.lobby_id=t.lobby_id),n.options.ChatEngine.publishMucEvent(t.group_id,i,function(){console.debug("addMember: MUC event success")}),t.success&&t.success()}).fail(function(e){console.error("addMember error:"),console.error(e),t.error&&t.error(e)})},subscribeToPresence:function(e){console.assert(e&&e.lobby_id&&e.lobby_id!==""),this.options.ChatEngine.subscribeToGroupPresence(e.lobby_id,function(){e.success&&e.success()})},unsubscribeToPresence:function(e){console.assert(e&&e.lobby_id&&e.lobby_id!==""),this.options.ChatEngine.unsubscribeToGroupPresence(e.lobby_id,function(){e.success&&e.success()})},getGroupFromCache:function(e){console.assert(this.groupCollection&&typeof this.groupCollection!="undefined");for(var t=0;t<this.groupCollection.length;++t)if(this.groupCollection.at(t).get("lobby_id")===e)return this.groupCollection.at(t);return null},convert:function(t){console.assert(t&&t.session_id&&t.session_id!=="");var n=this;e.ajax({type:"PUT",url:this.options.restBaseUrl+"/groups/"+encodeURIComponent(t.session_id),dataType:"json",data:JSON.stringify({type:"Private"}),headers:{Authorization:"Basic "+btoa(this.options.api_key+":"+"")}}).done(function(e){if(t.success){var r={event:"convertGroup",group:e};n.options.ChatEngine.publishMucEvent(e.id,r,function(){console.debug("convert: MUC event success")}),t.success(e)}}).fail(function(e){console.error("update group error:"),console.error(e)})}}),o}),P("razercomms/pubsubengine",["underscore","backbone","strophe"],function(e,t,n){var r=t.Model.extend({defaults:{server:"wss://comms-cxmpp.razersynapse.com:443/websocket",token:"",user_id:""},pubsubNs:"http://jabber.org/protocol/pubsub",jsonNs:"urn:xmpp:json:0",pubsubDomain:"pubsub.razerzone.com",authJid:"x-razer-comms-token@razerzone.com/generic_chat",anonAuthJid:"razerzone.com/readonly_chat",pubsubEventNs:"http://jabber.org/protocol/pubsub#event",node:"",xmpp:{},connected:!1,pendingNode:"",logout:!1,nodes:[],disconnect_ts:0,packet_ts:0,for_reload:!1,anonymous:!1,initialize:function(){console.debug("initialize"),e.bindAll(this,"_onConnectionStatus","_sendPing","_subscribeToNode","subscribe"),e.bindAll(this,"_handlePubsubResult","_handleMessageEvent","unsubscribe","disconnect"),e.bindAll(this,"publish","_unsubscribeToNode","_allServerPacketHandler","isConnected"),this.node="",this.connected=!1,this.pendingNode="",this.logout=!1,this.nodes=[],this.disconnect_ts=0,this.packet_ts=0,this.for_reload=!1,this.anonymous=!1,this.xmpp=new n.Connection(this.get("server")),!this.has("token")||this.get("token")===""?(console.info("Using anonymous connection"),this.xmpp.connect(this.anonAuthJid,"",this._onConnectionStatus),this.anonymous=!0):(console.info("Using non-anonymous connection: token: "+this.get("token")),this.xmpp.connect(this.authJid,this.get("token"),this._onConnectionStatus),this.anonymous=!1)},subscribe:function(e){console.info("subscribe: node: "+e),this.connected?(this.pendingNode="",this._subscribeToNode(e)):this.pendingNode=e,this.nodes.indexOf(e)===-1&&this.nodes.push(e)},unsubscribe:function(e){console.info("unsubscribe: node: "+e),this.connected&&this._unsubscribeToNode(e);var t=this.nodes.indexOf(e);t>-1&&this.nodes.splice(t,1)},publish:function(e,t){console.info("publish: node: "+e);if(!this.connected){console.warn("publish: not yet connected");var n=this;this.once("connected",function(){console.info("publish, queued, delaying send"),setTimeout(function(){console.info("publish, queued: node: "+e);var r=$iq({to:n.pubsubDomain,type:"set",id:n.xmpp.getUniqueId()});r.c("pubsub",{xmlns:n.pubsubNs}).c("publish",{node:e}).c("item").c("json",{xmlns:n.jsonNs}).t(JSON.stringify(t)),n.xmpp.send(r)},2e3)});return}var r=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});r.c("pubsub",{xmlns:this.pubsubNs}).c("publish",{node:e}).c("item").c("json",{xmlns:this.jsonNs}).t(JSON.stringify(t)),this.xmpp.send(r)},disconnect:function(){console.info("disconnecting"),this.logout=!0,this.xmpp.disconnect(),this.xmpp=null},isConnected:function(){return this.connected},_onConnectionStatus:function(e){if(e===n.Status.CONNECTING)console.debug("status is connecting.");else if(e===n.Status.CONNFAIL)console.info("Strophe failed to connect."),this.connected=!1;else if(e===n.Status.AUTHENTICATING)console.debug("Strophe authenticating");else if(e===n.Status.AUTHFAIL){console.error("Strophe AUTH fail"),this.connected=!1;if(!this.logout){var t=this;setTimeout(function(){console.info("reconnecting..."),t.pendingNode===""&&(console.assert(t.node!==""),t.pendingNode=t.node),t.anonymous?t.xmpp.connect(t.anonAuthJid,"",t._onConnectionStatus):t.xmpp.connect(t.authJid,t.get("token"),t._onConnectionStatus)},1e4)}}else if(e===n.Status.DISCONNECTING)console.debug("status is disconnecting."),this.connected=!1;else if(e===n.Status.DISCONNECTED){console.info("status is disconnected "+this.get("user_id")),this.connected=!1,this.disconnect_ts===0&&(this.disconnect_ts=Date.now());if(this.packet_ts!==0){var r=Date.now()-this.packet_ts;r>12e4?(console.info("no server packet for more than 2 min, page is scheduled to be reloaded"),this.for_reload=!0):console.info("no server packet for "+r/1e3+" secs")}this.trigger("disconnected");if(!this.logout){var t=this;setTimeout(function(){console.info("reconnecting..."),t.pendingNode===""&&(console.assert(t.node!==""),t.pendingNode=t.node),t.anonymous?t.xmpp.connect(t.anonAuthJid,"",t._onConnectionStatus):t.xmpp.connect(t.authJid,t.get("token"),t._onConnectionStatus)},1e4)}}else if(e===n.Status.CONNECTED){console.debug("status is connected. "+this.xmpp.service),this.connected=!0,this.xmpp.addTimedHandler(4e4,this._sendPing),this.xmpp.addHandler(this._handlePubsubResult,this.pubsubNs,"iq","result",null,null),this.xmpp.addHandler(this._handleMessageEvent,this.pubsubEventNs,"message","headline",null,null),this.xmpp.addHandler(this._allServerPacketHandler),this.set("user_id",n.getBareJidFromJid(this.xmpp.jid));for(var i=0;i<this.nodes.length;++i)console.info("subscribing to: "+this.nodes[i]),this._subscribeToNode(this.nodes[i]);if(this.disconnect_ts!==0){var r=Date.now()-this.disconnect_ts;console.info("disconnected for "+r+" ms"),r>12e4?this.trigger("reload"):this.trigger("reconnected")}this.for_reload&&(this.for_reload=!1,this.trigger("reload")),this.disconnect_ts=0,this.trigger("connected")}else e===n.Status.ATTACHED&&console.debug("status: attached")},_sendPing:function(){var e=new Date,t=$iq({to:this.xmpp.domain,type:"get",id:this.xmpp.getUniqueId()});return t.c("query",{xmlns:"urn:xmpp:ping"}),this.xmpp.send(t),!0},_rawInput:function(e){console.log("XMPP RECV: "+e)},_rawOutput:function(e){console.log("XMPP SENT: "+e)},_subscribeToNode:function(e){var t=$iq({to:this.pubsubDomain,type:"set",id:this.xmpp.getUniqueId()});t.c("pubsub",{xmlns:"http://jabber.org/protocol/pubsub"}).c("subscribe",{node:e}),this.xmpp.send(t)},_unsubscribeToNode:function(e){var t=$iq({to:this.pubsubDomain,type:"set",id:"unsubscribe."+e});t.c("pubsub",{xmlns:"http://jabber.org/protocol/pubsub"}).c("unsubscribe",{node:e});var n=this;this.xmpp.addHandler(function(t){return console.info("unsubscribe success: node: "+e),n.trigger("unsubscribe",e),!1},"jabber:client","iq","result","unsubscribe."+e,null,null),this.xmpp.send(t)},_handlePubsubResult:function(e){var t=e.getElementsByTagNameNS(this.pubsubNs,"pubsub");if(t.length>0){var n=t[0];t=n.getElementsByTagNameNS(this.pubsubNs,"subscription");if(t.length>0){var r=t[0],i=r.getAttribute("node");this.node=i;try{console.info("subscribe success: node: "+i),this.trigger("subscribe",i)}catch(s){console.error("Exception"),console.error(s)}}}else console.warn("_handlePubsubResult: no pubsub tag"),console.warn(e);return!0},_handleMessageEvent:function(e){var t=e.getAttribute("from"),r=e.getElementsByTagNameNS(this.pubsubEventNs,"event");if(r.length>0){var i=r[0];r=i.getElementsByTagNameNS(this.pubsubEventNs,"items");if(r.length>0){var s=r[0],o=s.getAttribute("node");r=s.getElementsByTagNameNS(this.pubsubEventNs,"item");if(r.length>0){var u=r[0];r=u.getElementsByTagNameNS(this.jsonNs,"json");if(r.length>0){var a=r[0];try{var f=JSON.parse(a.textContent);f.sender=n.getBareJidFromJid(t);try{this.trigger("message",o,f),this.trigger(f.event,o,f)}catch(l){console.error(l),console.error(l.stack)}}catch(l){console.error("JSON.parse error"),console.error(a.textContent),console.error(l)}}}}}return!0},_allServerPacketHandler:function(e){return this.packet_ts=Date.now(),!0}});return r}),P("razercomms/presencemanager",["jquery","underscore","backbone"],function(e,t,n){var r=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(r.prototype,n.Events,{presence_map:{},initialize:function(e){this.presence_map={}},update:function(e,t,n){console.assert(e&&t&&n),console.assert(e!==""&&t!==""&&n!=="");var r=null;this.presence_map[e]&&(r=this.presence_map[e]);var i,s;if(r){var o=!1;for(s=0;s<r.length;++s)i=r[s],i.jid===t&&(o=!0,i.presence=n,i.ts=Date.now());o||(i={jid:t,presence:n,ts:Date.now()},r.push(i))}else r=[],i={jid:t,presence:n,ts:Date.now()},r.push(i),this.presence_map[e]=r;if(n==="offline"){for(s=0;s<r.length;++s)i=r[s],i.jid===t&&r.splice(s,1);if(r.length>0)for(s=0;s<r.length;++s){if(r[s].presence==="online"){n="online";break}n=r[s].presence}else delete this.presence_map[e]}if(n==="away"&&r.length>1)for(s=0;s<r.length;++s)if(r[s].presence==="online"){n="online";break}return n}}),r}),P("razercomms/callstatemodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{ongoing_call:!1,session_id:"",chat_id:"",adhoc:!1,answered:!1,start_time:"",duration:0,direction:"outgoing"},initialize:function(){var e=this}});return n}),P("RazerComms",["jquery","underscore","backbone","razercomms/chatengine","razercomms/friends","razercomms/usermodel","razercomms/chathistory","razercomms/groups","razercomms/pubsubengine","razercomms/presencemanager","razercomms/callstatemodel"],function(e,t,n,r,i,s,o,u,a,f,l){var c="razerzone.com",h=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(h.prototype,n.Events,{FRIEND_REQUEST_EVENT:"friendRequest",FRIEND_REMOVED_EVENT:"friendRemoved",MESSAGE_EVENT:"message",GROUP_MESSAGE_EVENT:"groupMessage",FRIEND_PRESENCE_EVENT:"friendPresence",MSG_FORWARDED_EVENT:"messageForwarded",GROUP_MSG_FORWARDED_EVENT:"groupMessageForwarded",FRIEND_LIST_EVENT:"friendList",GROUP_INVITE_EVENT:"groupInvite",INCOMING_CALL_EVENT:"incomingCall",ANSWER_CALL_EVENT:"answerCall",HANGUP_CALL_EVENT:"hangupCall",OAUTH_CLIENT_ID:"dfffb249cd183a8a1e47ab53ccaafc408006aebc",OAUTH_SCOPE:"cop",options:{},ChatEngine:null,PubSubEngine:null,Friends:null,ChatHistory:null,Groups:null,user_id:null,api_key:null,user:null,presenceManager:null,callStateModel:null,currentPresence:"online",get_user_retry:0,emilyToken:null,refreshToken:"",initialize:function(e){t.bindAll(this,"close","login","getUser","sendMessage","setCredentials","call","answerCall","callIn","setTypingState","pubsubSubscribe","pubsubUnsubscribe","getOngoingCall","submitFeedback","currentUser","shortenUrl","expandUrl","isCommsIdAvailable","updateProfile","emailInvite","getMetaTags"),t.bindAll(this,"_bindChatEngineEvents","_onFriendRequest","_onMessage","_onFriendRemoved","_onGroupMessage","_onFriendPresence","_onForwardedMessage","_onFriendList","_onGroupInvite","_onIncomingCall","_onAnswerCall","_onRejectCall","_onAdhocGroupInvite","_onGroupRemoved","_onGroupUpdate","_onTypingState","_onPubSubMessage","_getAvatarHash","_onCurrentUser","_onMissedCall","_onCallStateChanged","_onReconnected","_onMemberPresence","_apiLogin"),this.options=t.extend({restBaseUrl:"https://api-dev.comms.razerzone.com",restBaseUrl2:"https://api-dev.comms.razerzone.com:9090",xmppServer:"wss://xmpp-dev.comms.razerzone.com:443/websocket",pubSubServer:"ws://54.179.112.136:4333/websocket",debugXmpp:!1,connect:!0,oAuthEndpoint:"https://api-dev.comms.razerzone.com"},e),this.ChatEngine=null,this.PubSubEngine=null,this.Friends=null,this.ChatHistory=null,this.Groups=null,this.currentPresence="online",this.user_id=null,this.api_key=null,this.user=null,this.user=new s,this.presenceManager=new f,this.callStateModel=new l,this.callStateModel.on("change",this._onCallStateChanged),this.get_user_retry=0,this.emilyToken=null,this.refreshToken=""},login:function(t){var n=this,r={grant_type:"password",username:t.username,password:t.password,client_id:this.OAUTH_CLIENT_ID,scope:this.OAUTH_SCOPE};e.ajax({type:"POST",url:this.options.oAuthEndpoint+"/token",data:r}).done(function(e){n.refreshToken=e.refresh_token;var r={access_token:e.access_token,success:t.success,error:t.errror};n._apiLogin(r)}).fail(function(e){t.error&&t.error(e)})},_apiLogin:function(t){var n=this;e.ajax({type:"POST",url:this.options.restBaseUrl+"/login",dataType:"json",data:JSON.stringify(t)}).done(function(e){n.emilyToken=e.token,t.success&&(n.setCredentials({api_key:e.api_key,uuid:e.uuid,username:t.username}),e.user_id=n.user_id,e.refresh_token=n.refreshToken,t.success(e)),n.trigger("loginSuccess")}).fail(function(e){t.error&&t.error(e)})},setCredentials:function(e){console.assert(e.api_key!==""),console.assert(e.uuid!=="");var t=e.uuid.toLowerCase()+"@"+c;this.user_id=t,this.api_key=e.api_key,this.ChatEngine=new r({server:this.options.xmppServer,api_key:this.api_key,debug:this.options.debugXmpp,connect:this.options.connect}),this._bindChatEngineEvents(),this.ChatEngine.debugTag=e.username,this.Friends=new i({ChatEngine:this.ChatEngine,api_key:this.api_key,restBaseUrl:this.options.restBaseUrl}),this.Friends.on("friendList",this._onFriendList),this.Groups=new u({ChatEngine:this.ChatEngine,api_key:this.api_key,restBaseUrl:this.options.restBaseUrl,user_id:t}),this.ChatHistory=new o({ChatEngine:this.ChatEngine,Groups:this.Groups,Friends:this.Friends,api_key:this.api_key,restBaseUrl:this.options.restBaseUrl,restBaseUrl2:this.options.restBaseUrl2})},_bindChatEngineEvents:function(){var e=this;this.ChatEngine.on(this.FRIEND_REQUEST_EVENT,this._onFriendRequest),this.ChatEngine.on(this.FRIEND_REMOVED_EVENT,this._onFriendRemoved),this.ChatEngine.on(this.MESSAGE_EVENT,this._onMessage),this.ChatEngine.on(this.GROUP_MESSAGE_EVENT,this._onGroupMessage),this.ChatEngine.on(this.FRIEND_PRESENCE_EVENT,this._onFriendPresence),this.ChatEngine.on(this.MSG_FORWARDED_EVENT,this._onForwardedMessage),this.ChatEngine.on(this.GROUP_INVITE_EVENT,this._onGroupInvite),this.ChatEngine.on(this.INCOMING_CALL_EVENT,this._onIncomingCall),this.ChatEngine.on(this.ANSWER_CALL_EVENT,this._onAnswerCall),this.ChatEngine.on("adhocGroupInvite",this._onAdhocGroupInvite),this.ChatEngine.on("groupRemoved",this._onGroupRemoved),this.ChatEngine.on("groupUpdate",this._onGroupUpdate),this.ChatEngine.on("typingState",this._onTypingState),this.ChatEngine.on("pubsubMessage",this._onPubSubMessage),this.ChatEngine.on("currentUser",this._onCurrentUser),this.ChatEngine.on("rejectCall",this._onRejectCall),this.ChatEngine.on("missedCall",this._onMissedCall),this.ChatEngine.on("reload",function(){e.trigger("reload")}),this.ChatEngine.on("reconnected",this._onReconnected),this.ChatEngine.on("memberPresence",this._onMemberPresence),this.ChatEngine.on("reloadFriends",function(){console.info("reloadFriends: "+e.user_id),e.trigger("reloadFriends")})},close:function(){this.PubSubEngine&&(this.PubSubEngine.disconnect(),this.PubSubEngine=null),this.ChatEngine&&(this.ChatEngine.disconnect(),this.ChatEngine=null),this.trigger("logout")},getUser:function(e){console.assert(e&&e.user_id&&e.user_id!=="");var t=this,n=new s({id:e.user_id},{api_key:this.api_key});e.server_cache?n.url=this.options.restBaseUrl+"/users/"+e.user_id+"?nocache=false":n.url=this.options.restBaseUrl+"/users/"+e.user_id+"?nocache=true",n.url+="&api_key="+encodeURIComponent(this.api_key),n.on("sync",function(r){e.user_id===t.user_id&&(t.user=n,t.ChatEngine&&t.ChatEngine.setUserModel(n),setTimeout(function(){t.trigger("userInfo",r.toJSON())},0)),e.success&&e.success(r.toJSON())}),t.get_user_retry++,n.on("error",function(n){e.error&&e.error(n),t.get_user_retry<5&&setTimeout(function(){console.warn("retrying getUser: "+t.get_user_retry),e.server_cache=!0,t.getUser(e)},3e3)}),n.fetch()},sendMessage:function(e){return this.ChatEngine.sendMessage(e.user_id,e.message,null,e.success)},setPresence:function(e){this.ChatEngine.setPresence(e.presence);var t=this;this.Groups.groupCollection&&this.Groups.groupCollection.each(function(n){if(n.has("lobby_id")&&n.get("lobby_id")!==""){var r=t.getOngoingCall(),i=0;r&&r.ongoing_call&&r.session_id==n.get("lobby_id")&&(i=2),t.ChatEngine.sendGroupPresence(n.get("lobby_id"),e.presence,i)}}),this.currentPresence=e.presence},isGroupChat:function(e){return this.ChatEngine.isGroupChat(e)},call:function(e){var t=this;console.assert(e.user_id&&e.user_id!=="");var n="";this.Groups.create({type:"AdHoc",success:function(r){console.debug("call: adhoc group created: "+JSON.stringify(r)),n=r.id,t.Groups.join({id:n,success:function(r){t.callStateModel.set("session_id",n),t.callStateModel.set("chat_id",e.user_id),t.callStateModel.set("direction","outgoing"),t.ChatEngine.inviteToVoice(n,e.user_id),e.success(n)}})}}),this.callStateModel.set("ongoing_call",!0),this.callStateModel.set("adhoc",!0),this.callStateModel.set("answered",!1),this.callStateModel.set("chat_id",e.user_id)},answerCall:function(e){console.assert(e.user_id&&e.user_id!==""),console.assert(e.session_id&&e.session_id!==""),console.debug("answerCall: "+JSON.stringify(e));var t=this;this.Groups.join({id:e.session_id,success:function(e){console.debug("answerCall: joinGroup success")}}),this.ChatEngine.acceptVoiceInvite(e.session_id,e.user_id),this.callStateModel.set("ongoing_call",!0),this.callStateModel.set("direction","incoming"),this.callStateModel.set("chat_id",e.user_id),this.callStateModel.set("session_id",e.session_id),this.callStateModel.set("answered",!0),this.ChatHistory.saveCall({session_id:e.session_id,type:"voice_call_start",direction:this.callStateModel.get("direction"),duration:0,chat_id:this.callStateModel.get("chat_id"),success:function(){}})},hangupCall:function(e){console.assert(e.session_id&&e.session_id!==""),console.debug("hangupCall: session_id: "+e.session_id),console.debug("hangupCall: callStateModel: "+JSON.stringify(this.callStateModel.toJSON())),this.ChatEngine.sendAudioStatus(e.session_id,1,this.currentPresence),this.callStateModel.set("ongoing_call",!1),typeof e.duration!="undefined"&&this.callStateModel.set("duration",e.duration);if(this.callStateModel.get("adhoc")&&!this.callStateModel.get("answered")){console.info("hangupCall: sending cancel-voice-invite");var t=this.callStateModel.get("chat_id");console.assert(t&&t!==""),this.ChatEngine.cancelVoiceInvite(e.session_id,t),this.ChatHistory.saveCall({session_id:e.session_id,type:"canceled_call",direction:this.callStateModel.get("direction"),duration:0,chat_id:this.callStateModel.get("chat_id"),success:function(){}})}else console.assert(e.session_id===this.callStateModel.get("session_id")),this.ChatHistory.saveCall({session_id:e.session_id,type:"voice_call_end",direction:this.callStateModel.get("direction"),duration:this.callStateModel.get("duration"),chat_id:this.callStateModel.get("chat_id"),success:function(){}});var n=this;this.Groups.getInfo({id:e.session_id,success:function(t){t.type==="AdHoc"&&(console.debug("hangupCall: group is adhoc, leaving group..."),n.ChatEngine.leaveGroup(e.session_id))}})},rejectCall:function(e){console.assert(e.user_id&&e.user_id!==""),console.assert(e.session_id&&e.session_id!==""),console.debug("rejectCall: "+JSON.stringify(e)),this.ChatEngine.rejectVoiceInvite(e.session_id,e.user_id),this.callStateModel.set("ongoing_call",!1)},callIn:function(e){console.debug("callIn: "+JSON.stringify(e)),console.assert(e.session_id&&e.session_id!==""),this.ChatEngine.sendAudioStatus(e.session_id,2,this.currentPresence),this.callStateModel.set("ongoing_call",!0),this.callStateModel.set("session_id",e.session_id),this.callStateModel.set("direction","outgoing"),this.callStateModel.set("answered",!0),e.adhoc?this.callStateModel.set("adhoc",!0):(this.callStateModel.set("chat_id",e.session_id),this.callStateModel.set("adhoc",!1)),this.ChatHistory.saveCall({session_id:e.session_id,type:"voice_call_start",direction:"outgoing",duration:0,chat_id:this.callStateModel.get("chat_id"),success:function(){}})},setTypingState:function(e){console.assert(e&&e.chat_id&&e.chat_id!==""),console.assert(e.state);var t=e.state;console.assert(t==="composing"||t==="paused"||t==="active"||t==="inactive"||t==="gone"),this.ChatEngine.setChatState(e.chat_id,e.state)},pubsubSubscribe:function(e){console.assert(e&&e.topic&&e.topic!==""),this.ChatEngine.subscribeToPubSub(e.topic,e.success)},pubsubUnsubscribe:function(e){console.assert(e&&e.topic&&e.topic!==""),this.ChatEngine.unsubscribeToPubSub(e.topic,e.success)},getOngoingCall:function(){return this.callStateModel.get("ongoing_call")?t.extend({},this.callStateModel.toJSON()):null},submitFeedback:function(n){var r=t.extend({title:"",category:"",description:""},n),i=this.options.restBaseUrl+"/feedbacks";e.ajax({type:"POST",url:i,dataType:"json",data:JSON.stringify(r),headers:{Authorization:"Basic "+btoa(this.api_key+":"+"")}}).done(function(e){n.success&&n.success()}).fail(function(e){console.error("submitFeedback:"),console.error(e)})},currentUser:function(){return this.user?this.user.toJSON():null},shortenUrl:function(t){console.assert(t&&t.long_url&&t.long_url!=="");var n=this.options.restBaseUrl+"/url/shortener";n+="?api_key="+encodeURIComponent(this.api_key),e.ajax({type:"POST",url:n,dataType:"json",data:JSON.stringify({long_url:t.long_url})}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error(e)})},expandUrl:function(t){console.assert(t&&t.short_url&&t.short_url!=="");var n=this.options.restBaseUrl+"/url/shortener";n+="?short_url="+encodeURIComponent(t.short_url),n+="&api_key="+encodeURIComponent(this.api_key),e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error(e)})},isCommsIdAvailable:function(t){console.assert(t&&t.comms_id&&t.comms_id!=="");var n=this.options.restBaseUrl2+"/checks";n+="?cid="+encodeURIComponent(t.comms_id),e.ajax({type:"GET",url:n}).done(function(e){t.success&&t.success(e)}).fail(function(e){console.error(e)})},updateProfile:function(n){console.assert(n&&n.nickname&&n.nickname!=="");var r=this,i=this.options.restBaseUrl+"/users/me";i+="?api_key="+encodeURIComponent(this.api_key);var s;n.token?s=n.token:s=this.emilyToken;var o=t.extend({token:s},n);e.ajax({type:"PUT",url:i,dataType:"json",data:JSON.stringify(o)}).done(function(e){n.success&&n.success(e),r.trigger("profileUpdated",e)}).fail(function(e){console.error(e),n.error&&n.error(e)})},emailInvite:function(t){console.assert(t&&t.recipients);var n=this,r=this.options.restBaseUrl2+"/invites";r+="?api_key="+encodeURIComponent(this.api_key),e.ajax({type:"POST",url:r,data:JSON.stringify({type:"email",recipients:t.recipients})}).done(function(e){t.success&&t.success()})},getMetaTags:function(t){console.assert(t&&t.url&&t.url!=="");var n=this,r=this.options.restBaseUrl2+"/metatags";r+="?url="+encodeURIComponent(t.url),r+="&api_key="+encodeURIComponent(this.api_key),e.ajax({type:"GET",url:r,dataType:"json"}).done(function(e){t.success&&t.success(e)}).fail(function(e){t.error&&t.error()})},_getAvatarHash:function(){var t=this,n=this.options.restBaseUrl+"/users/me/avatar";n+="?api_key="+encodeURIComponent(this.api_key),e.ajax({type:"GET",url:n,dataType:"json"}).done(function(e){e.digest&&e.digest!==""&&(t.ChatEngine?t.ChatEngine.setAvatarHash(e.digest):console.debug("_getAvatarHash: ChatEngine is null"))})},_onFriendRequest:function(e){console.debug("_onFriendRequest: "+JSON.stringify(e)),this.trigger(this.FRIEND_REQUEST_EVENT,e)},_onMessage:function(e){if(!e.avatar||e.avatar===""){var t=this.Friends.friendCollection.get(e.user_id);t&&(e.avatar=t.get("avatar"))}var n=this;setTimeout(function(){n.trigger(n.MESSAGE_EVENT,e)},0)},_onGroupMessage:function(e){var t=this;setTimeout(function(){t.trigger(t.GROUP_MESSAGE_EVENT,e)},0)},_onFriendRemoved:function(e){this.trigger(this.FRIEND_REMOVED_EVENT,e)},_onFriendPresence:function(e){var t=this.presenceManager.update(e.user_id,e.jid,e.presence);e.presence=t,this.trigger(this.FRIEND_PRESENCE_EVENT,e)},_onForwardedMessage:function(e){this.trigger(this.MSG_FORWARDED_EVENT,e)},_onFriendList:function(e){this.trigger(this.FRIEND_LIST_EVENT,e)},_onGroupInvite:function(e){this.trigger(this.GROUP_INVITE_EVENT,e)},_onIncomingCall:function(e){this.trigger(this.INCOMING_CALL_EVENT,e)},_onAnswerCall:function(e){console.debug("_onAnswerCall: "+JSON.stringify(e)),this.callStateModel.set("answered",!0),this.trigger(this.ANSWER_CALL_EVENT,e),console.assert(e.session_id===this.callStateModel.get("session_id")),this.ChatHistory.saveCall({session_id:e.session_id,type:"voice_call_start",direction:this.callStateModel.get("direction"),duration:0,chat_id:this.callStateModel.get("chat_id"),success:function(){}})},_onRejectCall:function(e){this.callStateModel.set("ongoing_call",!1),this.trigger("rejectCall",e)},_onAdhocGroupInvite:function(e){var t=this;this.Groups.join({id:e.group_id,success:function(){console.debug("_onAdhocGroupInvite: join success: "+t.user_id),t.trigger("adhocGroupInvite",e)}})},_onGroupRemoved:function(e){this.trigger("groupRemoved",e)},_onGroupUpdate:function(e){this.trigger("groupUpdate",e)},_onTypingState:function(e){if(!e.group_chat){var t=this.Friends.friendCollection.get(e.chat_id);t?e.nickname=t.get("nick"):console.info("onTypingState Friend not found")}this.trigger("typingState",e)},_onPubSubMessage:function(e){var t=this;setTimeout(function(){t.trigger("pubsubMessage",e);if(!e.topic||!e.message)return;e.topic===t.user_id&&e.message.event&&(e.message.event==="saveCall"?(t.trigger("saveCall",e),e.message.chat_id&&t.trigger("saveCall."+e.message.chat_id,e)):e.message.event==="groupCreated"?t.trigger("groupCreated",e):e.message.event==="reloadFriends"&&t.trigger("reloadFriends")),e.topic===t.ChatEngine.namespace.conferenceInfo&&e.message.event&&(e.message.event==="addMember"?(t.trigger("memberAdded",e.message),e.message.group&&e.message.group.lobby_id&&e.message.group.lobby_id!==""&&t.trigger("memberAdded."+e.message.group.lobby_id,e.message)):e.message.event==="leaveGroup"?(t.trigger("memberLeft",e.message),e.message.group&&e.message.group.lobby_id&&e.message.group.lobby_id!==""&&t.trigger("memberLeft."+e.message.group.lobby_id,e.message)):e.message.event==="convertGroup"&&(t.trigger("groupConverted",e.message),e.message.group&&e.message.group.lobby_id&&e.message.group.lobby_id!==""&&t.trigger("groupConverted."+e.message.group.lobby_id,e.message)))},0)},_onCurrentUser:function(e){e.has("avatar")&&e.get("avatar")!==""&&this._getAvatarHash()},_onMissedCall:function(e){var t=this;setTimeout(function(){t.trigger("missedCall",e)},500)},_onCallStateChanged:function(e){this.trigger("callStateChanged",e.toJSON())},_onReconnected:function(){if(!this.Groups)return;var e=this;this.Groups.groupCollection&&this.Groups.groupCollection.length>0?(console.debug("_onReconnected: group collection is cached"),this.Groups.groupCollection.each(function(t){e.ChatEngine.enterGroup(t.get("id")),t.has("lobby_id")&&t.get("lobby_id")!==""?e.ChatEngine.enterChannel(t.get("lobby_id")):console.info("group does not have lobby_id: "+JSON.stringify(t.toJSON()))})):this.Groups.get({success:function(e){console.debug("_onReconnected: groups: "+JSON.stringify(e))}})},_onMemberPresence:function(e){var t=this;setTimeout(function(){t.trigger("memberPresence",e),e.chat_id&&e.chat_id!==""&&t.trigger("memberPresence."+e.chat_id,e)},0)}}),h}),P("jquery",function(){return e}),P("underscore",function(){return _}),P("backbone",function(){return Backbone}),D("RazerComms")}),define("models/windowfocusmodel",["jquery","backbone"],function(e,t){var n=t.Model.extend({defaults:{in_focus:!0},initialize:function(){var t=this;e(window).blur(function(e){t.set("in_focus",!1)}),e(window).focus(function(e){t.set("in_focus",!0)})}});return n}),define("text!templates/calluiview.html",[],function(){return'<div class="callui-container">\n    <div class="content">\n	    <div class="call-state">connecting ...</div>\n		<div class="avatar">\n			<img class="round" src="<%- avatar %>">\n			<div class="presence <%- presence %>"></div>\n		</div>\n		<div class="name"><%= nickname_emoji %></div>\n        <div class="timer">00:00</div>\n        <div class="audio-controls">\n			<div class="centered">\n				<div class="speaker icon"><div class="razericons-sound_medium ficon"></div></div>\n				<div class="mic icon"><div class="razericons-mic ficon"></div></div>\n				<div class="hangup icon"><div class="razericons-call_hangup ficon"></div></div>\n			</div>\n        </div>\n\n        <div class="slider_con"><div class="volume-control"></div></div>\n\n    </div>\n</div>\n'}),define("text!templates/calluiviewgroup.html",[],function(){return'<div class="callui-container">\r\n    <div class="content">\r\n	    <div class="call-state">connecting ...</div>\r\n		<div class="avatar">\r\n			<img class="group" src="<%- icon %>">			\r\n		</div>\r\n		<div class="name"><%= name_emoji %></div>\r\n        <div class="timer">00:00</div>\r\n        <div class="audio-controls">\r\n			<div class="centered">\r\n				<div class="speaker icon"><div class="razericons-sound_medium ficon"></div></div>\r\n				<div class="mic icon"><div class="razericons-mic ficon"></div></div>\r\n				<div class="hangup icon"><div class="razericons-call_hangup ficon"></div></div>\r\n			</div>\r\n        </div>\r\n        \r\n        <div class="slider_con"><div class="volume-control"></div></div>\r\n\r\n    </div>\r\n</div>\r\n'}),define("models/callstatemodel",["jquery","backbone"],function(e,t){var n=t.Model.extend({defaults:{mic_mute:!1,volume_slider_shown:!1,volume:60}});return n}),define("views/callui/calluiview",["jquery","underscore","backbone","text!templates/calluiview.html","text!templates/calluiviewgroup.html","webaudio","models/usermodel","models/groupmodel","models/callstatemodel","jqueryui"],function(e,t,n,r,i,s,o,u,a,f){var l="sessionCreated",c="callAnswered",h="callRejected",p="forceHangup",d=n.View.extend({tagName:"div",className:"callui-view",events:{"click .hangup":"_hangup","click .audio-controls .mic":"_toggleMicMute","click .audio-controls .speaker":"_toggleVolumeSlider"},voiceConnection:null,interval:null,sessionId:null,adhoc:!1,callAnswered:!1,callDeclined:!1,remoteHangup:!1,userModel:null,groupModel:null,is_groupchat:!1,callStateModel:null,startCall:null,initialize:function(e){t.bindAll(this,"render","close","_pad","onTick","startTimer","_showCallState","_onMemberList","_listenForParentEvents","_handleUserListVoiceUpdate","_onUserInfo","_onGroupInfo","_renderAudioControls","_onVolumeSliderChanged","_autoHideVolumeSlider"),this.options=e,this.userTemplate=t.template(r),this.groupTemplate=t.template(i),this.voiceConnection=null,this.interval=null,this.sessionId=null,this.adhoc=!1,this.callAnswered=!1,this.callDeclined=!1,this.remoteHangup=!1,this.options=e,this.callStateModel=new a,this.startCall=null,console.assert(this.options.chat_id&&this.options.chat_id!==""),console.debug("initialize: options"),console.debug(this.options),this.sessionId=this.options.chat_id;var n=this;this.userModel=new o({id:this.options.chat_id}),this.options.comms.isGroupChat(this.options.chat_id)?(this.groupModel=new u,this.options.comms.Groups.getInfo({id:this.options.chat_id,success:this._onGroupInfo}),this.options.comms.Groups.getMembers({chat_id:this.options.chat_id,success:this._onMemberList}),this.adhoc=this.options.adhoc,this.callAnswered=!0,setTimeout(function(){n.startAudio()},1e3)):(console.info("Initiating 1-to-1 call to: "+this.options.chat_id),this.adhoc=!0,this.callAnswered=!1,this.options.comms.getUser({user_id:this.options.chat_id,server_cache:!0,success:this._onUserInfo}),this.is_groupchat=!1),this._listenForParentEvents(),console.debug("URL: "+window.location.href),console.debug("DEV: "+this.options.sharedObjects.dev),this.callStateModel.on("change",this._renderAudioControls),this._autoHideVolumeSlider()},render:function(){return this.is_groupchat?this.$el.html(this.groupTemplate(this.groupModel.toJSON())):this.$el.html(this.userTemplate(this.userModel.toJSON())),this.$(".volume-control").slider({orientation:"vertical",range:"min",animate:!0,value:60,change:this._onVolumeSliderChanged}),this},_onUserInfo:function(e){console.debug("_onUserInfo"),console.debug(e),this.userModel.set(e);var t=this;this.render(),this.$(".presence").show()},_onGroupInfo:function(e){console.debug("_onGroupInfo"),console.debug(e);if(e.type==="Channel"&&e.group)this.groupModel.set(e.group),this.is_groupchat=!0,this.render();else{var t=this;if(e.type==="AdHoc")if(e.members.length===1)this.is_groupchat=!1,this.userModel=new o({id:e.owner}),this.options.comms.getUser({user_id:e.owner,server_cache:!0,success:t._onUserInfo});else{this.is_groupchat=!0,this.groupModel.set(e);var n=e.members.length;this.groupModel.set("members",n),this.render()}}},close:function(){console.debug("close"),this.remove(),this.unbind()},startAudio:function(){var e=this;console.info("startAudio: calling VOE.enable"),VOE.enable(function(t){console.debug("enable response: "),console.debug(t),e.options.sharedObjects.dev?e.voiceConnection=window.createAudioController(e.sessionId,e.options.user_id,e.options.nickname,"labops.comms.razerzone.com"):e.voiceConnection=window.createAudioController(e.sessionId,e.options.user_id,e.options.nickname),console.debug(e.voiceConnection),e.voiceConnection.on("state",function(t){console.debug("VoiceConnection state: "+t),t==="VOICE_CONNECTED"&&(e.adhoc&&!e.callAnswered?e.on(c,function(){e.startTimer(),e.$(".call-state").text(" ")}):e.startTimer()),e._showCallState(t);if(window.opener){console.debug("posting message to window.opener");var n=0;e.startCall&&(n=Math.round((Date.now()-e.startCall)/1e3)),window.opener.postMessage({state:t,session_id:e.sessionId,adhoc:e.adhoc,duration:n},"*")}else console.warn("no window.opener")}),e.voiceConnection.on("userlist",e._handleUserListVoiceUpdate),e.voiceConnection.startCall()})},startTimer:function(){this.startCall=Date.now();var e=this;this.interval=setInterval(this.onTick,1e3)},onTick:function(){var e=Math.round((Date.now()-this.startCall)/1e3);if(e<60)this.$(".timer").text("00:"+this._pad(e,2));else if(e<3600){var t=Math.floor(e/60),n=e-t*60;this.$(".timer").text(this._pad(t,2)+":"+this._pad(n,2))}else{var r=Math.floor(e/3600),t=Math.floor((e-r*3600)/60),n=e-r*3600-t*60;this.$(".timer").text(this._pad(r,2)+":"+this._pad(t,2)+":"+this._pad(n,2))}},_pad:function(e,t){var n=e+"";while(n.length<t)n="0"+n;return n},_hangup:function(){console.debug("_hangup");var e=this;this.voiceConnection&&(this.voiceConnection.state==="VOICE_CONNECTED"?(this.voiceConnection.stopCall(),this.voiceConnection.on("bye",function(t){console.debug("got bye event"),e.voiceConnection.destroy(),e.voiceConnection=null})):(console.debug("force hangup"),this.voiceConnection.stopCall(),this.voiceConnection=null,window.opener.postMessage({state:"FORCE_HANGUP_STATE",session_id:e.sessionId,adhoc:e.adhoc,duration:0},"*"))),clearInterval(this.interval),setTimeout(function(){window.close()},1e3)},_showCallState:function(e){console.debug("_showCallState: '"+e+"' adhoc: "+this.adhoc+" callAnswered: "+this.callAnswered);if(this.adhoc&&this.remoteHangup){this.$(".call-state").text("Remote party hangup");return}if(this.adhoc&&this.callDeclined){this.$(".call-state").text("Call declined");return}if(this.adhoc&&!this.callAnswered){this.$(".call-state").text("ringing ...");return}e==="AUTHENTICATE"?this.$(".call-state").text("authenticating ..."):e==="CONNECTING"?this.$(".call-state").text("connecting ..."):e==="CONNECTED"?this.$(".call-state").text("connected ..."):e==="VOICE_CONNECTING"?this.$(".call-state").text("connecting to voice server ..."):e==="ICE_CHECKING"?this.$(".call-state").text("ICE checking ..."):e==="VOICE_CONNECTED"?this.$(".call-state").text("In a call with ..."):e==="DISCONNECTED"&&this.$(".call-state").text("disconnected")},_onMemberList:function(e){console.debug("_onMemberList: data: "+JSON.stringify(e))},_listenForParentEvents:function(e){var t=this;window.addEventListener("message",function(e){console.debug("Got message from parent window: "),console.debug(e),e.data.action===l?(console.debug("1-to-1 session created: "+e.data.session_id),t.sessionId=e.data.session_id,t.startAudio()):e.data.action===c?(t.callAnswered=!0,t.trigger(c)):e.data.action===h&&(console.debug("Call rejected"),t.$(".call-state").text("Call declined"),t.callDeclined=!0,t._hangup())})},_handleUserListVoiceUpdate:function(e,t){console.debug("_handleUserListVoiceUpdate: session_id: "+e+" adhoc: "+this.adhoc),console.debug("_handleUserListVoiceUpdate: "+JSON.stringify(t)),this.adhoc&&t.length===0&&(this.$(".call-state").text("Remote party hangup"),this.remoteHangup=!0,this._hangup())},_toggleMicMute:function(){console.debug(JSON.stringify(this.callStateModel.toJSON())),this.voiceConnection&&(console.debug(this.voiceConnection),console.debug(window.VOE),this.callStateModel.get("mic_mute")?(this.callStateModel.set("mic_mute",!1),console.debug("calling setSelfMute false"),VOE.setSelfMute(!1)):(this.callStateModel.set("mic_mute",!0),console.debug("calling setSelfMute true"),VOE.setSelfMute(!0)))},_toggleVolumeSlider:function(){console.debug(JSON.stringify(this.callStateModel.toJSON())),this.callStateModel.get("volume_slider_shown")?this.callStateModel.set("volume_slider_shown",!1):this.callStateModel.set("volume_slider_shown",!0)},_renderAudioControls:function(){console.debug("_renderAudioControls: "+JSON.stringify(this.callStateModel.toJSON())),this.callStateModel.get("mic_mute")?(this.$(".audio-controls .mic.icon .ficon").removeClass("razericons-mic"),this.$(".audio-controls .mic.icon .ficon").addClass("razericons-mic_mute")):(this.$(".audio-controls .mic.icon .ficon").addClass("razericons-mic"),this.$(".audio-controls .mic.icon .ficon").removeClass("razericons-mic_mute")),this.callStateModel.get("volume_slider_shown")?this.$(".slider_con").show():this.$(".slider_con").hide();var e="razericons-sound_high razericons-sound_medium razericons-sound_low razericons-sound_mute";this.$(".audio-controls .speaker.icon .ficon").removeClass(e);var t=this.callStateModel.get("volume");t>=66?this.$(".audio-controls .speaker.icon .ficon").addClass("razericons-sound_high"):t>=33?this.$(".audio-controls .speaker.icon .ficon").addClass("razericons-sound_medium"):t===0?this.$(".audio-controls .speaker.icon .ficon").addClass("razericons-sound_mute"):this.$(".audio-controls .speaker.icon .ficon").addClass("razericons-sound_low")},_autoHideVolumeSlider:function(){var t=this;e(document).click(function(n){e(n.target).closest(".ui-slider").length||e(n.target).closest(".speaker.icon").length||t.callStateModel.set("volume_slider_shown",!1)})},_onVolumeSliderChanged:function(e,t){console.debug("_onVolumeSliderChanged: "+t.value),VOE.setOutputVolume(t.value),this.callStateModel.set({volume:t.value})}});return d}),define("models/infostatemodel",["jquery","backbone"],function(e,t){var n=t.Model.extend({defaults:{state:!0},initialize:function(){}});return n}),define("models/windowresizemodel",["jquery","backbone"],function(e,t){var n=t.Model.extend({initialize:function(){var e=this;window.onresize=function(t){t.currentTarget===window&&e.trigger("resize",t)}}});return n}),!function(e,t,n){function r(e,t){return typeof e===t}function i(){var e,t,n,i,s,o,u;for(var a in w)if(w.hasOwnProperty(a)){if(e=[],t=w[a],t.name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(i=r(t.fn,"function")?t.fn():t.fn,s=0;s<e.length;s++)o=e[s],u=o.split("."),1===u.length?S[u[0]]=i:(!S[u[0]]||S[u[0]]instanceof Boolean||(S[u[0]]=new Boolean(S[u[0]])),S[u[0]][u[1]]=i),b.push((i?"":"no-")+u.join("-"))}}function s(e){var t=x.className,n=S._config.classPrefix||"";if(T&&(t=t.baseVal),S._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}S._config.enableClasses&&(t+=" "+n+e.join(" "+n),T?x.className.baseVal=t:x.className=t)}function o(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):T?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function u(){var e=t.body;return e||(e=o(T?"svg":"body"),e.fake=!0),e}function a(e,t){if("object"==typeof e)for(var n in e)N(e,n)&&a(n,e[n]);else{e=e.toLowerCase();var r=e.split("."),i=S[r[0]];if(2==r.length&&(i=i[r[1]]),"undefined"!=typeof i)return S;t="function"==typeof t?t():t,1==r.length?S[r[0]]=t:(!S[r[0]]||S[r[0]]instanceof Boolean||(S[r[0]]=new Boolean(S[r[0]])),S[r[0]][r[1]]=t),s([(t&&0!=t?"":"no-")+r.join("-")]),S._trigger(e,t)}return S}function f(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,n){return t+n.toUpperCase()}).replace(/^-/,"")}function l(e,t){return!!~(""+e).indexOf(t)}function c(e,t){return function(){return e.apply(t,arguments)}}function h(e,t,n){var i;for(var s in e)if(e[s]in t)return n===!1?e[s]:(i=t[e[s]],r(i,"function")?c(i,n||t):i);return!1}function p(e,n,r,i){var s,a,f,l,c="modernizr",h=o("div"),p=u();if(parseInt(r,10))for(;r--;)f=o("div"),f.id=i?i[r]:c+(r+1),h.appendChild(f);return s=o("style"),s.type="text/css",s.id="s"+c,(p.fake?p:h).appendChild(s),p.appendChild(h),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),h.id=c,p.fake&&(p.style.background="",p.style.overflow="hidden",l=x.style.overflow,x.style.overflow="hidden",x.appendChild(p)),a=n(h,e),p.fake?(p.parentNode.removeChild(p),x.style.overflow=l,x.offsetHeight):h.parentNode.removeChild(h),!!a}function d(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function v(t,r){var i=t.length;if("CSS"in e&&"supports"in e.CSS){for(;i--;)if(e.CSS.supports(d(t[i]),r))return!0;return!1}if("CSSSupportsRule"in e){for(var s=[];i--;)s.push("("+d(t[i])+":"+r+")");return s=s.join(" or "),p("@supports ("+s+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return n}function m(e,t,i,s){function u(){c&&(delete M.style,delete M.modElem)}if(s=r(s,"undefined")?!1:s,!r(i,"undefined")){var a=v(e,i);if(!r(a,"undefined"))return a}for(var c,h,p,d,m,g=["modernizr","tspan"];!M.style;)c=!0,M.modElem=o(g.shift()),M.style=M.modElem.style;for(p=e.length,h=0;p>h;h++)if(d=e[h],m=M.style[d],l(d,"-")&&(d=f(d)),M.style[d]!==n){if(s||r(i,"undefined"))return u(),"pfx"==t?d:!0;try{M.style[d]=i}catch(y){}if(M.style[d]!=m)return u(),"pfx"==t?d:!0}return u(),!1}function g(e,t,n,i,s){var o=e.charAt(0).toUpperCase()+e.slice(1),u=(e+" "+L.join(o+" ")+o).split(" ");return r(t,"string")||r(t,"undefined")?m(u,t,i,s):(u=(e+" "+k.join(o+" ")+o).split(" "),h(u,t,n))}function y(e,t,r){return g(e,n,n,t,r)}var b=[],w=[],E={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){w.push({name:e,fn:t,options:n})},addAsyncTest:function(e){w.push({name:null,fn:e})}},S=function(){};S.prototype=E,S=new S,S.addTest("notification",function(){if(!e.Notification||!e.Notification.requestPermission)return!1;if("granted"===e.Notification.permission)return!0;try{new e.Notification("")}catch(t){if("TypeError"===t.name)return!1}return!0}),S.addTest("svg",!!t.createElementNS&&!!t.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),S.addTest("es6object",!!(Object.assign&&Object.is&&Object.setPrototypeOf)),S.addTest("promises",function(){return"Promise"in e&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var t;return new e.Promise(function(e){t=e}),"function"==typeof t}()}),S.addTest("es6string",!!(String.fromCodePoint&&String.raw&&String.prototype.codePointAt&&String.prototype.repeat&&String.prototype.startsWith&&String.prototype.endsWith&&String.prototype.contains)),S.addTest("filereader",!!(e.File&&e.FileList&&e.FileReader)),S.addTest("webworkers","Worker"in e);var x=t.documentElement,T="svg"===x.nodeName.toLowerCase();S.addTest("contenteditable",function(){if("contentEditable"in x){var e=o("div");return e.contentEditable=!0,"true"===e.contentEditable}}),S.addTest("canvas",function(){var e=o("canvas");return!!e.getContext&&!!e.getContext("2d")}),S.addTest("canvastext",function(){return S.canvas===!1?!1:"function"==typeof o("canvas").getContext("2d").fillText}),S.addTest("emoji",function(){if(!S.canvastext)return!1;var t=e.devicePixelRatio||1,n=12*t,r=o("canvas"),i=r.getContext("2d");return i.fillStyle="#f00",i.textBaseline="top",i.font="32px Arial",i.fillText("ðŸ¨",0,0),0!==i.getImageData(n,n,1,1).data[0]});var N;!function(){var e={}.hasOwnProperty;N=r(e,"undefined")||r(e.call,"undefined")?function(e,t){return t in e&&r(e.constructor.prototype[t],"undefined")}:function(t,n){return e.call(t,n)}}(),E._l={},E.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),S.hasOwnProperty(e)&&setTimeout(function(){S._trigger(e,S[e])},0)},E._trigger=function(e,t){if(this._l[e]){var n=this._l[e];setTimeout(function(){var e,r;for(e=0;e<n.length;e++)(r=n[e])(t)},0),delete this._l[e]}},S._q.push(function(){E.addTest=a}),S.addAsyncTest(function(){var n,r,i=function(e){x.contains(e)||x.appendChild(e)},s=function(e){e.fake&&e.parentNode&&e.parentNode.removeChild(e)},f=function(e,t){var n=!!e;if(n&&(n=new Boolean(n),n.blocked="blocked"===e),a("flash",function(){return n}),t&&d.contains(t)){for(;t.parentNode!==d;)t=t.parentNode;d.removeChild(t)}};try{r="ActiveXObject"in e&&"Pan"in new e.ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(l){}if(n=!("plugins"in navigator&&"Shockwave Flash"in navigator.plugins||r),n||T)f(!1);else{var c,h,p=o("embed"),d=u();if(p.type="application/x-shockwave-flash",d.appendChild(p),!("Pan"in p||r))return i(d),f("blocked",p),void s(d);c=function(){return i(d),x.contains(d)?(x.contains(p)?(h=p.style.cssText,""!==h?f("blocked",p):f(!0,p)):f("blocked"),void s(d)):(d=t.body||d,p=o("embed"),p.type="application/x-shockwave-flash",d.appendChild(p),setTimeout(c,1e3))},setTimeout(c,10)}});var C="Moz O ms Webkit",k=E._config.usePrefixes?C.toLowerCase().split(" "):[];E._domPrefixes=k;var L=E._config.usePrefixes?C.split(" "):[];E._cssomPrefixes=L;var A=function(t){var r,i=prefixes.length,s=e.CSSRule;if("undefined"==typeof s)return n;if(!t)return!1;if(t=t.replace(/^@/,""),r=t.replace(/-/g,"_").toUpperCase()+"_RULE",r in s)return"@"+t;for(var o=0;i>o;o++){var u=prefixes[o],a=u.toUpperCase()+"_"+r;if(a in s)return"@-"+u.toLowerCase()+"-"+t}return!1};E.atRule=A;var O={elem:o("modernizr")};S._q.push(function(){delete O.elem});var M={style:O.elem.style};S._q.unshift(function(){delete M.style}),E.testAllProps=g,E.testAllProps=y,S.addTest("cssanimations",y("animationName","a",!0));var _=E.prefixed=function(e,t,n){return 0===e.indexOf("@")?A(e):(-1!=e.indexOf("-")&&(e=f(e)),t?g(e,t,n):g(e,"pfx"))};S.addTest("filesystem",!!_("requestFileSystem",e)),S.addTest("getusermedia",!!_("getUserMedia",navigator)),S.addTest("peerconnection",!!_("RTCPeerConnection",e)),S.addTest("datachannel",function(){if(!S.peerconnection)return!1;for(var t=0,n=k.length;n>t;t++){var r=e[k[t]+"RTCPeerConnection"];if(r){var i=new r({iceServers:[{url:"stun:0"}]});return"createDataChannel"in i}}return!1}),i(),s(b),delete E.addTest,delete E.addAsyncTest;for(var D=0;D<S._q.length;D++)S._q[D]();e.Modernizr=S}(window,document),define("modernizr",function(e){return function(){var t,n;return t||e.Modernizr}}(this)),define("callhandler",["jquery","underscore","backbone","modernizr","webaudiowrapper","communitysdk/pubsubengine2"],function(e,t,n,r,i,s){var o=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(o.prototype,n.Events,{VOICE_CONNECTED:"VOICE_CONNECTED",VOICE_DISCONNECTED:"DISCONNECTED",DEFAULT_VOLUME:60,options:{comms:null},voiceConnection:null,sessionId:null,state:null,callInterval:null,timeStart:null,callDuration:null,adhoc:!1,is_caller:!1,webAudio:null,pubsub:null,hangup:!1,initialize:function(e){t.bindAll(this,"makeCall","hangupCall","_onConnectionState","_onUserList","_initiateCall","_onCallAnswered","_startAudio","answerCall","selfMute","selfUnMute","_onUserInfo"),t.bindAll(this,"_onStartCall","_onEndCall","_onSpeaking"),console.assert(e&&e.comms),this.options=e,this.voiceConnection=null,this.sessionId=null,this.state=null,this.callInterval=null,this.timeStart=null,this.callDuration=0,this.adhoc=!1,this.is_caller=!1,this.webAudio=new i,this.pubsub=null,this.hangup=!1,this.options.comms.on("userInfo",this._onUserInfo),this.on("startCall",this._onStartCall,this),this.on("endCall",this._onEndCall,this);var n=this.options.comms.currentUser();if(n){var r=n.id,s=n.nickname;r&&r!==""&&s&&s!==""&&this.webAudio.setUser(r,s)}},makeCall:function(e){console.debug("makeCall: "+JSON.stringify(e)),console.assert(this.voiceConnection===null);if(this.voiceConnection){console.error("makeCall: already have a voiceConnection");return}var n=this.options.comms.currentUser();if(!n){console.error("makeCall: current user is not yet there");return}if(e.adhoc&&e.create_session&&e.send_invite){this.is_caller=!0,this._initiateCall(e);return}this.is_caller=!1;var r=this,i=t.extend({adhoc:!1,create_session:!1,send_invite:!1},e),s="";s=i.chat_id,this.sessionId=s,this.adhoc=i.adhoc,this.hangup=!1,this._startAudio(),this.trigger("startCall",i.chat_id)},hangupCall:function(){var e=this;this.hangup=!0;if(this.voiceConnection)this.voiceConnection.on("bye",function(t){console.debug("hangupCall: got 'bye' event"),e.voiceConnection&&(e.voiceConnection.destroy(),e.voiceConnection=null),e.trigger("webRtcState",e.VOICE_DISCONNECTED),e.sessionId&&e.sessionId!==""&&e.options.comms.getOngoingCall()&&e.options.comms.hangupCall({session_id:e.sessionId,duration:e.callDuration}),e.callDuration=0,e.sessionId=null}),this.voiceConnection.stopCall();else{console.info("hangupCall: no voiceConnection");var e=this;setTimeout(function(){e.sessionId?(e.options.comms.hangupCall({session_id:e.sessionId,duration:e.callDuration}),e.sessionId=null):console.info("hangupCall: no sessionId")},0)}this.trigger("endCall"),this.callInterval&&(console.debug("hangupCall: duration: "+this.callDuration),clearInterval(this.callInterval),this.timeStart=null,this.callInterval=null),this.options.comms.off("answerCall",null,this),this.options.comms.off("rejectCall",null,this)},answerCall:function(e){console.assert(e&&e.session_id&&e.session_id!==""),console.assert(e&&e.chat_id&&e.chat_id!==""),this.sessionId=e.session_id,this.adhoc=!0,this.hangup=!1,this.is_caller=!1,this.options.comms.answerCall({session_id:e.session_id,user_id:e.chat_id});if(this.voiceConnection){this.hangupCall();var t=this;setTimeout(function(){t.sessionId=e.session_id,t.trigger("startCall",e.chat_id),t._startAudio()},500)}else this.trigger("startCall",e.chat_id),this._startAudio()},selfMute:function(){console.debug("selfMute"),this.webAudio.setSelfMute(!0)},selfUnMute:function(){console.debug("selfUnMute"),this.webAudio.setSelfMute(!1)},_initiateCall:function(e){console.debug("_initiateCall: "+JSON.stringify(e));var t=this;this.adhoc=e.adhoc,this.hangup=!1,this.options.comms.once("answerCall",this._onCallAnswered,this),this.options.comms.once("rejectCall",this.hangupCall,this),this.options.comms.call({user_id:e.chat_id,success:function(e){t.sessionId=e,t._startAudio()}}),this.trigger("startCall",e.chat_id)},_onCallAnswered:function(e){console.debug("_onCallAnswered: "+JSON.stringify(e));var t=this;console.assert(this.sessionId===e.session_id),this.timeStart=Date.now(),this.callInterval=setInterval(function(){t.callDuration=Math.round((Date.now()-t.timeStart)/1e3),t.trigger("timerTick",t.callDuration)},1e3)},_startAudio:function(){var e=this,t=this.options.comms.currentUser();console.assert(t),console.debug("_startAudio: session_id: "+e.sessionId+" user_id: "+t.id+" nickname: "+t.nickname),this.webAudio.enable(function(){if(e.hangup){console.info("_startAudio: already in hangup state"),e.options.comms.hangupCall({session_id:e.sessionId,duration:0}),e.sessionId=null;return}e.voiceConnection=e.webAudio.createAudioController(e.sessionId,t.id,t.nickname),e.voiceConnection.on("state",e._onConnectionState),e.voiceConnection.on("userlist",e._onUserList),e.voiceConnection.on("speaking",e._onSpeaking),e.voiceConnection.startCall()})},_onConnectionState:function(e){console.debug("_onConnectionState: state: "+e);var t=this;this.state=e;switch(e){case this.VOICE_CONNECTED:if(window.nodeRequire){var n=this.webAudio.getOutputVolume();console.log("mk-getspeaker: "+n+", DEFAULT_VOLUME: "+this.DEFAULT_VOLUME),n<this.DEFAULT_VOLUME&&this.webAudio.setOutputVolume(this.DEFAULT_VOLUME)}console.assert(this.sessionId);if(!this.adhoc||!this.is_caller)this.timeStart=Date.now(),this.callInterval=setInterval(function(){t.callDuration=Math.round((Date.now()-t.timeStart)/1e3),t.trigger("timerTick",t.callDuration)},1e3);this.adhoc||this.options.comms.callIn({session_id:this.sessionId,adhoc:this.adhoc});break;case this.VOICE_DISCONNECTED:console.info("Ignoring VOICE_DISCONNECTED");return}this.trigger("webRtcState",e)},_onUserList:function(e,t){console.debug("_onUserList: session_id: "+e+" adhoc: "+this.adhoc),console.debug("_onUserList: "+JSON.stringify(t)),this.adhoc&&t.length===0&&this.hangupCall(),this.trigger("talkingMembers",t)},changeSpeakerVolume:function(e){console.debug("changeSpeaker Volume--"+e),this.webAudio.setOutputVolume(e)},setLocalMute:function(e,t){console.debug("setLocalMute--"+t),this.webAudio.setLocalMute(e,t)},setLocalVolume:function(e,t){console.debug("setLocalVolume--userid--"+e+"--volume--"+t),this.webAudio.setLocalVolume(e,t)},muteAll:function(){console.debug("muteAll"),this.webAudio.setSelfDeaf(!0)},unMuteAll:function(){console.debug("unMuteAll"),this.webAudio.setSelfDeaf(!1)},_onUserInfo:function(e){this.webAudio.setUser(e.id,e.nickname)},_onStartCall:function(e){console.debug("_onStartCall: api_key: "+this.options.comms.api_key+" session_id: "+e),this.pubsub&&this.pubsub.disconnect(),this.pubsub=new s({api_key:this.options.comms.api_key,debugTag:this.options.comms.currentUser().id});var t=this;this.pubsub.connect(),this.pubsub.subscribe({topics:["comms.talkstate."+e],success:function(){console.debug("pubsub subscribe success")}}),this.pubsub.on("message.comms.talkstate."+e,function(e){t.trigger("talkState",e)})},_onEndCall:function(){console.debug("_onEndCall"),this.pubsub?(this.pubsub.off(null,null,this),this.pubsub.disconnect(),this.pubsub=null):console.info("_onEndCall: pubsub is null")},_onSpeaking:function(e,t,n,r){var i={event:"talkState",speaking:r},s="comms.talkstate."+e;console.assert(this.pubsub),this.pubsub&&this.pubsub.publish({topic:s,data:i,success:function(){}})}}),o}),define("text!templates/updatenicknameview.html",[],function(){return'<div class="background">\n <div class="top_bg"/>\n <div class="bottom_bg"/>\n</div>\n<div class="login-container hvalign">\n <img class="logo" src="assets/images/ths_large.svg">\n <div class="content "> \n  <input class="comms-id" type="text" placeholder="Enter Comms ID" name="comms-id"></input>\n  <div class="comms-id info">Minimum of 5 Characters required. Comms ID cannot be modified</div>\n  <div class="status"></div>\n  <input class="nickname" type="text" placeholder="Enter Nickname" name="nickname"></input>\n  <div class="nickname info">Minimum 3 Characters required. This will serve as your display name for Comms. You can change this anytime from your profile page.</div>\n  <div class="btns">\n   <div class="rc-button cancel">CANCEL</div>\n   <div class="rc-button rc-disabled-button done">DONE</div>\n  </div>\n </div>\n <div class="shadow"><img src="assets/images/login_shadow.png"></div>\n</div>\n<div class="tagline">FOR GAMERS. BY GAMERS</div>\n<div class="copyright">Copyright @2016 Razer Inc. All rights reserved.</div>\n'}),define("views/updatenickname/updatenicknameview",["jquery","underscore","backbone","text!templates/updatenicknameview.html"],function(e,t,n,r){var i=13,s=n.View.extend({tagName:"div",className:"update-nickname-view",events:{"keyup input.comms-id":"_onCommsIdKeyup","keyup input.nickname":"_onNicknameKeyup","click .rc-button.cancel":"_onCancelClick","click .rc-button.done":"_onDoneClick"},haveCommsId:!1,haveNickname:!1,commsIdAvailable:!1,initialize:function(e){t.bindAll(this,"close","_showStatus","_checkInput"),this.template=t.template(r),this.options=e,console.assert(this.options.sharedObjects.comms),console.assert(this.options.sharedObjects.router),this.haveCommsId=!1,this.haveNickname=!1,this.commsIdAvailable=!1;var n=this;setTimeout(function(){n.options.sharedObjects.comms.close()},1e3)},render:function(){this.$el.html(this.template());var e=this.options.sharedObjects.comms.currentUser();if(e){var t=this;console.debug("currentUser: "+JSON.stringify(e)),e.comms_id&&e.comms_id!==""?(this.haveCommsId=!0,this.commsIdAvailable=!0,this.$("input.comms-id").val(e.comms_id),this.$("input.comms-id").prop("readonly",!0),this.$("input.comms-id").attr("tabindex","-1"),setTimeout(function(){t.$("input.nickname").focus()},0)):e.nickname&&e.nickname!==""&&(this.$("input.nickname").val(e.nickname),this.haveNickname=!0)}return this},close:function(){this.remove(),this.unbind()},_onCommsIdKeyup:function(e){var t=this.$("input.comms-id").attr("tabindex");if(t&&t==="-1")return;var n=this.$("input.comms-id").val();if(n.length>=5){var r=this;r._showStatus("Checking..."),this.commsIdAvailable=!1,this.options.sharedObjects.comms.isCommsIdAvailable({comms_id:n,success:function(e){console.debug("success: "+JSON.stringify(e)),e.available?(r.commsIdAvailable=!0,r._showStatus(""),console.debug("Comms id is available"),r.$(".rc-button.done").removeClass("rc-disabled-button"),r.haveNickname||r.$("input.nickname").val(n)):(r._showStatus("The Comms ID is not available"),r.$(".rc-button.done").addClass("rc-disabled-button"),r.haveNickname||r.$("input.nickname").val("")),r._checkInput()}})}else this.$(".rc-button.done").addClass("rc-disabled-button"),this.haveNickname||this.$("input.nickname").val("")},_onNicknameKeyup:function(e){this._checkInput(),e.which===13&&(this.$(".rc-button.done").hasClass("rc-disabled-button")?console.debug("done button disabled"):(console.debug("simulate done click"),this.$(".rc-button.done").click()))},_showStatus:function(e){this.$(".status").text(e)},_onCancelClick:function(){this.options.sharedObjects.router.navigate("login",{trigger:!0})},_onDoneClick:function(){console.debug("_onDoneClick"),this.haveCommsId&&console.debug("already have comms ID");var t=this.$("input.comms-id").val(),n=this.$("input.nickname").val();console.debug("comms_id: "+t+" nickname: "+n);var r=this,i=function(t){console.debug("update success"),e("body").removeClass("rc-loading"),console.debug(window.location);var n=window.location.origin+window.location.pathname;window.location.href=n},s=function(e){r.commsIdAvailable=!1,r._showStatus("The Comms ID is not available"),r._checkInput()};console.debug("refresh_token: "+this.options.sharedObjects.comms.refreshToken),e("body").addClass("rc-loading"),this.haveCommsId?this.options.sharedObjects.comms.updateProfile({nickname:n,refresh_token:this.options.sharedObjects.comms.refreshToken,success:i,error:s}):this.options.sharedObjects.comms.updateProfile({comms_id:t,nickname:n,refresh_token:this.options.sharedObjects.comms.refreshToken,success:i,error:s})},_checkInput:function(){var e=this.$("input.comms-id").val(),t=this.$("input.nickname").val();e===""||t===""?this.$(".rc-button.done").addClass("rc-disabled-button"):this.commsIdAvailable?t.length<3?this.$(".rc-button.done").addClass("rc-disabled-button"):this.$(".rc-button.done").removeClass("rc-disabled-button"):this.$(".rc-button.done").addClass("rc-disabled-button")}});return s}),define("models/settingsmodel",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{chat:!0,group_chat:!0,incoming_call:!0,community_announcement:!0,community_mention:!0}}),r=t.Model.extend({defaults:{isVAD:!0,pttKeys:"",audioOutDeviceName:"",audioInDeviceName:""}}),i=t.Model.extend({defaults:{theme:"light",notifications:null,audiosettings:null},initialize:function(){e.bindAll(this,"_save","_load"),this.set("notifications",new n),this.set("audiosettings",new r),this._load(),this.on("change",this._save),this.get("notifications").on("change",this._save),this.getAudioSettings().on("change",this._save)},_save:function(){console.debug("_save"),console.debug(JSON.stringify(this.toJSON())),localStorage.setItem("settings",JSON.stringify(this.toJSON()))},_load:function(){console.debug("_load");var e=localStorage.getItem("settings");if(e){var t=JSON.parse(e);t&&(t.theme&&this.set("theme",t.theme),t.notifications&&this.get("notifications").set(t.notifications),t.audiosettings&&this.getAudioSettings().set(t.audiosettings))}},getAudioSettings:function(){return this.get("audiosettings")}});return i}),define("router",["jquery","underscore","backbone","views/mainview","views/loginview","razercomms","models/windowfocusmodel","views/callui/calluiview","models/infostatemodel","communitysdk/commscommunity","models/windowresizemodel","callhandler","views/updatenickname/updatenicknameview","models/settingsmodel","modernizr"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=n.Router.extend({routes:{login:"login",updatenick:"updateNickname",activity:"activityTab",friends:"friendsTab",groups:"groupsTab",communities:"communitiesTab",activityEmpty:"activityEmpty",compose:"compose",favorites:"favoritesTab","friends/:userId":"friendsMessages","favorites/:userId":"favoritesMessages","groups/:lobbyId":"groupsMessages","activity/:chatId?adhoc=1":"adhocActivityMessages","activity/:chatId":"activityMessages","callui/:chatId/:userId/:nickname?adhoc=1":"callUiAdhoc","callui/:chatId/:userId/:nickname":"callUi","communities/:communityId/:channelId":"showCommunity","communities/discovery":"showCommunityDiscovery","communities/create":"createCommunity"},comms:null,loginView:null,updateNicknameView:null,mainView:null,sharedObjects:null,lastActivity:null,initialize:function(){console.debug("initialize"),t.bindAll(this,"_onUserInfo");var e=!0;this.lastActivity=null,console.debug(window.location.hash),window.location.hash.indexOf("#callui")===0&&(console.debug("initialize: callUI"),e=!1),this.comms=new s({connect:e});var n=!0,r=this._getParameterByName("cache");console.info("cache: "+r);if(r)if(r==="1"||r==="true")n=!0;else if(r==="0"||r==="false")n=!1;var i="",u=window.localStorage.getItem("comms_settings");u&&(u=JSON.parse(u),i=u.theme),i||(i="light");var h=this._getParameterByName("dev");h&&h==="1"?h=!0:h=!1;var v=new c({comms:this.comms}),m=!1;if(d.peerconnection&&d.datachannel&&d.getusermedia)var m=!0;this.sharedObjects={router:this,comms:this.comms,commsCommunity:b,niceScrollOptions:{cursorwidth:"9px",cursorborderradius:"10px",zindex:2},activityCollection:null,friendCollection:null,groupCollection:null,communityCollection:null,windowFocusModel:new o,infoStateModel:new a,activeTab:"",enable_cache:n,dev:h,theme:i,windowResizeModel:new l,callHandler:v,settingsModel:new p,is_webrtc_supported:m};var g=window.localStorage.getItem("comms_api_key"),y=window.localStorage.getItem("comms_uuid");g&&y&&(this.comms.setCredentials({api_key:g,uuid:y}),this.comms.getUser({user_id:this.comms.user_id,success:this._onUserInfo}),this.sharedObjects.apiKey=g),this.comms.on("reload",function(){location.reload()});if(g){var b=new f({api_key:g});this.sharedObjects.commsCommunity=b}},login:function(){console.debug("login"),this.mainView&&(this.mainView.close(),this.mainView=null),this.loginView&&(this.loginView.close(),this.loginView=null),this.updateNicknameView&&(this.updateNicknameView.close(),this.updateNicknameView=null),this.loginView=new i({sharedObjects:this.sharedObjects}),e("body").append(this.loginView.render().el)},updateNickname:function(){this.updateNicknameView&&(this.updateNicknameView.close(),this.updateNicknameView=null),this.mainView&&(this.mainView.close(),this.mainView=null),this.updateNicknameView=new h({sharedObjects:this.sharedObjects}),e("body").append(this.updateNicknameView.render().el)},main:function(){console.debug("main"),this.loginView?(this.loginView.close(),this.loginView=null):console.debug("main: no loginview"),this.mainView&&(this.mainView.close(),this.mainView=null),this.mainView=new r({sharedObjects:this.sharedObjects}),e("body").append(this.mainView.render().el),window.nodeRequire&&this.mainView.$el.addClass("with-title-bar")},activityTab:function(){console.debug("activityTab");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.mainContentView.$el.removeClass("lowerzindex");var e=window.localStorage.getItem("stay_connected");e&&e==="false"&&(window.localStorage.removeItem("comms_api_key"),window.localStorage.removeItem("comms_uuid"),window.localStorage.removeItem("stay_connected")),this.mainView.leftSectionView.activityTab(),this.mainView.leftSectionView.checkForOnboardView(),this.mainView.navigationView.activityTab(),this.mainView.hideCommunity(),this.mainView.hideCommunityDiscovery(),this.mainView.hideCreateCommunity(),this.checkWhatToShow(),this.lastActivity&&this.lastActivity!==null&&this.lastActivity!==undefined&&n.history.getFragment()==="activity"&&(console.info("routing to lastActivity: "+this.lastActivity),this.navigate("activity/"+this.lastActivity+"",{trigger:!0}))},favoritesTab:function(){if(!this._checkComms())return;this.mainView||this.main(),this.mainView.mainContentView||this.mainView.renderMainContentSectionView(),this.mainView.leftSectionView.favoritesTab(),this.mainView.leftSectionView.checkForOnboardView(),this.mainView.navigationView.favoritesTab(),this.mainView.hideCommunity(),this.mainView.hideCommunityDiscovery(),this.mainView.hideCreateCommunity(),this.checkWhatToShow()},activityEmpty:function(){console.debug("activityEmpty");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.mainContentView||this.mainView.renderMainContentSectionView(),this.mainView.mainContentView.$el.removeClass("lowerzindex"),this.mainView.leftSectionView.activityTab(),this.mainView.mainContentView.showEmpty(),this.mainView.hideCommunity(),this.mainView.hideCommunityDiscovery(),this.mainView.hideCreateCommunity(),this.checkWhatToShow()},friendsTab:function(){console.debug("friendsTab");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.mainContentView.$el.removeClass("lowerzindex"),this.mainView.leftSectionView.friendsTab(),this.mainView.closeMessageComposer(),this.mainView.navigationView.friendsTab(),this.mainView.hideCommunity(),this.mainView.hideCommunityDiscovery(),this.mainView.hideCreateCommunity(),this.lastActivity=null,this.checkWhatToShow()},groupsTab:function(){console.debug("groupsTab");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.mainContentView.$el.removeClass("lowerzindex"),this.mainView.leftSectionView.activityTab(),this.mainView.closeMessageComposer()},communitiesTab:function(){console.debug("communitiesTab");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.mainContentView||this.mainView.renderMainContentSectionView(),this.mainView.closeMessageComposer(),this.mainView.mainTabView._onCommunityTab()},activityMessages:function(e){this.lastActivity=e,this.activityTab(),this.mainView.mainContentView.showChatMessages(e),this.mainView.leftSectionView.highlightCurrentGrid(e),this.mainView.leftSectionView.closeOnboardView()},favoritesMessages:function(e){console.debug("favoritesMessages: "+e),this.favoritesTab(),this.mainView.mainContentView.showChatMessages(e),this.mainView.leftSectionView.highlightCurrentGrid(e),this.mainView.leftSectionView.closeOnboardView()},adhocActivityMessages:function(e){console.debug("adhocActivityMessages: "+e),this.activityTab(),this.mainView.mainContentView.showChatMessages(e,!0)},friendsMessages:function(e){console.debug("friendsMessages: "+e),this.friendsTab(),this.mainView.mainContentView.showChatMessages(e),this.mainView.leftSectionView.highlightCurrentGrid(e),this.mainView.leftSectionView.closeOnboardView()},groupsMessages:function(e){console.debug("groupsMessages: "+e),this.activityTab(),this.mainView.mainContentView.showChatMessages(e),this.mainView.leftSectionView.highlightCurrentGrid(e),this.mainView.leftSectionView.closeOnboardView()},_checkComms:function(){return this.comms.ChatEngine?!0:(console.info("Comms not initialized"),console.info("fragment: '"+n.history.getFragment()+"'"),sessionStorage.setItem("fragment",n.history.getFragment()),this.navigate("login",{trigger:!0}),!1)},checkWhatToShow:function(){var t=n.history.fragment,r=t.split("/");e(".main-view").width()<MIN_WIDTH&&(r.length===1?(console.debug("mobile view showing leftsection view and navigation view"),this.mainView.leftSectionView.$el.show(),this.mainView.mainContentView.$el.hide(),this.mainView.mainContentView.callUiView&&this.mainView.mainContentView.callUiView.$el.hide(),this.mainView.navigationView.$el.show()):r.length>1&&(console.debug("mobile view showing maincontentsectionview"),this.mainView.leftSectionView.$el.hide(),this.mainView.mainContentView.$el.show(),this.mainView.mainContentView.callUiView&&this.mainView.mainContentView.callUiView.$el.show(),this.mainView.navigationView.$el.hide(),this.lastActivity=""))},_getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))},compose:function(){console.debug("compose");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.leftSectionView.activityTab(),this.mainView.mainContentView.showEmpty(),this.mainView.composeMessage()},callUi:function(t,n,r){console.debug("callUi: chat_id: "+t+" userid: "+n+" nickname: "+r);var i=new u({chat_id:t,user_id:n,nickname:r,comms:this.comms,adhoc:!1,sharedObjects:this.sharedObjects});e("body").append(i.render().el)},callUiAdhoc:function(t,n,r){console.debug("callUiAdhoc: chat_id: "+t+" userid: "+n+" nickname: "+r);var i=new u({chat_id:t,user_id:n,nickname:r,comms:this.comms,adhoc:!0,sharedObjects:this.sharedObjects});e("body").append(i.render().el)},showCommunity:function(e,t){console.debug("showCommunity: "+e+" channel_id: "+t);if(!this._checkComms())return;this.mainView||this.main(),this.mainView.leftSectionView.closeOnboardView(),this.mainView.mainContentView.showEmpty(),this.mainView.mainContentView.checkCurrentChat(),this.mainView.hideCommunityDiscovery(),this.mainView.hideCreateCommunity(),this.mainView.showCommunity(e,t),this.mainView.navigationView.communitiesView.setLastActiveChannel(e,t),this.mainView.navigationView.$el.show(),this.mainView.mainContentView.$el.addClass("lowerzindex")},_onUserInfo:function(e){console.debug("_onUserInfo: "+JSON.stringify(e));var t=!1;if(!e.nickname||e.nickname==="")t=!0;if(!e.comms_id||e.comms_id==="")t=!0;t&&this.navigate("updatenick",{trigger:!0})},showCommunityDiscovery:function(){console.debug("showCommunityDiscovery: ");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.leftSectionView.closeOnboardView(),this.mainView.mainContentView.showEmpty(),this.mainView.navigationView.unselectTab(),this.mainView.hideCommunity(),this.mainView.hideCreateCommunity(),this.mainView.showCommunityDiscovery(),this.mainView.mainContentView.$el.addClass("lowerzindex"),this.mainView.navigationView.$el.show()},createCommunity:function(){console.debug("createCommunity: ");if(!this._checkComms())return;this.mainView||this.main(),this.mainView.leftSectionView.closeOnboardView(),this.mainView.mainContentView.showEmpty(),this.mainView.navigationView.unselectTab(),this.mainView.hideCommunity(),this.mainView.hideCommunityDiscovery(),this.mainView.mainContentView.$el.addClass("lowerzindex"),this.mainView.showCreateCommunity(),this.mainView.navigationView.$el.show()}});return v}),define("notificationhandler",["jquery","underscore","backbone","modernizr","utils"],function(e,t,n,r,i){var s=function(e){e||(e={}),this.initialize.apply(this,arguments)};return t.extend(s.prototype,n.Events,{options:null,initialize:function(e){t.bindAll(this,"_onDirectMessage","_onGroupMessage","_onIncomingCall","_onUserMentioned"),t.bindAll(this,"_bindCommunityEvents","_onAnnouncement","_isAllowed"),this.options=e;if(r.notification){if(Notification.permission!=="granted")if(Notification.permission!=="denied")Notification.requestPermission(function(e){console.debug("permission: "+e)});else if(Notification.permission==="denied")return;this.options.sharedObjects.comms.on("message",this._onDirectMessage),this.options.sharedObjects.comms.on("groupMessage",this._onGroupMessage),this.options.sharedObjects.comms.on("incomingCall",this._onIncomingCall);if(this.options.sharedObjects.commsCommunity)this._bindCommunityEvents();else{var n=this;this.options.sharedObjects.comms.once("loginSuccess",function(){console.debug("onloginSuccess"),n._bindCommunityEvents()})}}},_bindCommunityEvents:function(){this.options.sharedObjects.commsCommunity.on("mention",this._onUserMentioned),this.options.sharedObjects.commsCommunity.on("post_announcement",this._onAnnouncement)},_isAllowed:function(e){var t=this.options.sharedObjects.settingsModel;return t.get("notifications").get(e)?!0:(console.debug("not allowed"),!1)},_onDirectMessage:function(e){if(!this._isAllowed("chat"))return;var t=e.avatar;t===""&&(t="https://s3.amazonaws.com/comms.razerzone.com/default_user.png");var n=this._limitLength(e.nickname,30),r=e.message;i.isImageUrl(e.message)&&(r="photo");if(window.nodeRequire){const s=nodeRequire("electron").ipcRenderer;var o={name:n,message:r,icon:t,isGroup:!1};s.send("show-notification",o)}else if(!this.options.sharedObjects.windowFocusModel.get("in_focus")){var u={body:r,icon:t},a=new Notification(n,u);setTimeout(a.close.bind(a),5e3),a.onclick=function(){window.focus(),a.close()}}},_onGroupMessage:function(e){if(e.user_id===this.options.sharedObjects.comms.user_id){console.debug("sent by current user");return}if(!this._isAllowed("group_chat"))return;var t=e.message;i.isImageUrl(e.message)&&(t="photo");var n=this.options.sharedObjects.activityCollection.get(e.chat_id);if(n){var r=this._limitLength(e.nickname,30),s=r+" - "+t,o=n.get("avatar");o.indexOf("http")!==0&&(o="https://s3.amazonaws.com/comms.razerzone.com/default_group.png");var u=this._limitLength(n.get("name"),30);if(window.nodeRequire){const a=nodeRequire("electron").ipcRenderer;var f={name:u,message:s,icon:e.avatar,isGroup:!0};a.send("show-notification",f)}else if(!this.options.sharedObjects.windowFocusModel.get("in_focus")){var l={body:s,icon:o},c=new Notification(u,l);setTimeout(c.close.bind(c),5e3),c.onclick=function(){window.focus(),c.close()}}}},_onIncomingCall:function(e){if(!this._isAllowed("incoming_call"))return;if(window.nodeRequire){var t=this.options.sharedObjects.friendCollection.get(e.user_id);if(t){const n=nodeRequire("electron").ipcRenderer;icon=t.get("avatar"),icon===""&&(icon="https://s3.amazonaws.com/comms.razerzone.com/default_user.png");var r={name:this._limitLength(e.nickname,30),message:"Incoming call",icon:icon,isGroup:!1};n.send("show-notification",r)}}else if(!this.options.sharedObjects.windowFocusModel.get("in_focus")){var t=this.options.sharedObjects.friendCollection.get(e.user_id);if(t){var i={body:"Incoming call",icon:t.get("avatar")},s=this._limitLength(e.nickname,30),o=new Notification(s,i);setTimeout(o.close.bind(o),5e3),o.onclick=function(){window.focus(),o.close()}}}},_onUserMentioned:function(t,r){if(!this._isAllowed("community_mention"))return;if(window.nodeRequire){const i=nodeRequire("electron").ipcRenderer;var s=e("<div>"+r.message+"</div>").text(),o=r.icon;o===""&&(o="https://s3.amazonaws.com/comms.razerzone.com/default_user.png");var u={name:this._limitLength(r.sender_name,30),message:s,icon:o,isGroup:!1},a=i.sendSync("show-notification-query-window-in-focus",u);if(a&&this.options.sharedObjects.commsCommunity&&r.community_id){var f=!1,l=n.history.fragment,c=l.split("/");if(c.length===3){var h=c[1];h===r.community_id&&(f=!0)}f||i.send("show-notification-community-not-in-focus",u)}}else if(!this.options.sharedObjects.windowFocusModel.get("in_focus"))this.sendCommunityNotification(r);else if(this.options.sharedObjects.commsCommunity&&r.community_id){var f=!1,l=n.history.fragment,c=l.split("/");if(c.length===3){var h=c[1];h===r.community_id&&(f=!0)}f||this.sendCommunityNotification(r)}},sendCommunityNotification:function(t){var n=e("<div>"+t.message+"</div>").text(),r={body:n,icon:t.icon};r.icon===""&&(r.icon="https://s3.amazonaws.com/comms.razerzone.com/default_user.png");var i=this._limitLength(t.sender_name,30),s=new Notification(i,r);setTimeout(s.close.bind(s),5e3),s.onclick=function(){window.focus(),s.close()}},_limitLength:function(e,t){var n=e.length;return n>t&&(e=e.substr(0,t)+"..."),e},_onAnnouncement:function(e,t){console.debug("_onAnnouncement");if(!this._isAllowed("community_announcement"))return;console.debug("_onAnnouncement: "+JSON.stringify(t)),console.debug(t);if(t.sender===this.options.sharedObjects.comms.user_id){console.info("sent by current user");return}var n=this.options.sharedObjects.commsCommunity,r=n.getCachedCommunity({community_id:t.community_id});console.assert(r),console.debug("Community: "),console.debug(r);var i=r.icon;if(!i||i==="")i="https://cdn.comms.razerzone.com/Community_Def.png";if(window.nodeRequire){const s=nodeRequire("electron").ipcRenderer;var o={name:"Announcement - "+r.name,message:t.announcement.message,icon:i,isGroup:!0};s.send("show-notification",o)}else if(r){var u=new Notification("Announcement - "+r.name,{icon:i,body:t.announcement.message});setTimeout(u.close.bind(u),5e3),u.onclick=function(){window.focus(),u.close()}}}}),s}),define("text!templates/titlebarview.html",[],function(){return'<div>\n    <button class="title-bar-window-button razericons-close"></button>\n    <button class="title-bar-window-button razericons-window_large"></button>\n    <button class="title-bar-window-button razericons-window_small title-bar-window-button-hidden"></button>\n    <button class="title-bar-window-button razericons-align_bottom"></button>\n    <p class="title-bar-title razericons-razer"></p>\n</div>'}),define("views/titlebarview",["jquery","underscore","backbone","text!templates/titlebarview.html"],function(e,t,n,r){var i=n.View.extend({tagName:"div",className:"title-bar-view",initialize:function(e){this.template=t.template(r)},render:function(){return this.$el.html(this.template()),this},events:{"click .title-bar-window-button.razericons-close":"_on_window_close_click","click .title-bar-window-button.razericons-window_large":"_on_window_max_click","click .title-bar-window-button.razericons-align_bottom":"_on_window_min_click","click .title-bar-window-button.razericons-window_small":"_on_window_unmax_click"},_on_window_close_click:function(){if(window.nodeRequire){const e=nodeRequire("electron").ipcRenderer;e.send("hide_mainWindow")}},_on_window_max_click:function(){if(window.nodeRequire){const t=nodeRequire("electron").ipcRenderer;t.send("maximize_mainWindow"),e(".title-bar-window-button.razericons-window_large").addClass("title-bar-window-button-hidden"),e(".title-bar-window-button.razericons-window_small").removeClass("title-bar-window-button-hidden")}},_on_window_min_click:function(){if(window.nodeRequire){const e=nodeRequire("electron").ipcRenderer;e.send("minimize_mainWindow")}},_on_window_unmax_click:function(){if(window.nodeRequire){const t=nodeRequire("electron").ipcRenderer;t.send("maximize_mainWindow"),e(".title-bar-window-button.razericons-window_small").addClass("title-bar-window-button-hidden"),e(".title-bar-window-button.razericons-window_large").removeClass("title-bar-window-button-hidden")}}});return i}),define("app",["jquery","backbone","router","twitch","notificationhandler","views/titlebarview"],function(e,t,n,r,i,s){window.console&&console.debug&&(console.debug=function(){});var o="lhyuo7s5zwfman46gdfszi8beltzcqd",u={init:function(){console.debug("app.init"),navigator&&navigator.platform&&navigator.platform&&navigator.platform.search(/linux/i)!==-1&&(console.info("Linux platform"),e("body").css("font-family","TitilliumWeb")),typeof window.localStorage=="undefined"?console.error("Browser does not support localStorage"):console.info("Browser supports localStorage");if(window.nodeRequire){var u=new s;e("body").append(u.render().el),u.$el.show()}var a=new n;t.history.start();if(window.location.hash===""){var f=window.localStorage.getItem("comms_api_key"),l=window.localStorage.getItem("comms_uuid");f&&l?a.navigate("activity",{trigger:!0}):a.navigate("login",{trigger:!0})}r.init({clientId:o},function(e,t){e?(console.error("Twitch init ERROR"),console.error(e)):console.debug("Twitch loaded")});var c=window.localStorage.getItem("stay_connected");console.debug("stay_connected: "+c+" type: "+typeof c),c&&c==="false"&&(console.info("Removing api_key from localStorage"),window.localStorage.removeItem("comms_api_key"),window.localStorage.removeItem("comms_uuid"),window.localStorage.removeItem("stay_connected"));var h=new i({sharedObjects:a.sharedObjects})}};return u}),require.config({paths:{jquery:"../js/lib/jquery.2.1.0.min",underscore:"../js/lib/underscore-min",backbone:"../js/lib/backbone-min",text:"../js/lib/text",templates:"../templates",razercomms:"../../jssdk/dist/razercomms.min",strophe:"../js/lib/strophe.min",nicescroll:"../js/lib/jquery.nicescroll.min",velocity:"../js/lib/velocity.min","velocity-ui":"../js/lib/velocity.ui.min",twemoji:"../js/lib/twemoji/twemoji.min",rcemoji:"../js/lib/rcemoji",contenteditable:"../js/lib/contentEditable.min",autolinker:"../js/lib/Autolinker.min",w2ui:"../js/lib/w2ui/w2ui-1.3.2.1.min",underscoreStr:"../js/lib/underscore.string.min",jqueryhighlight:"../js/lib/jquery.highlight-4.min",webaudio:"../js/lib/webaudio",rcdialog:"../js/lib/rcdialog",jqueryui:"../js/lib/jquery-ui.min",animatemodal:"../js/lib/animatedModal.min",rcsidetab:"../js/lib/rcsidetab.min",moment:"../js/lib/moment.min",modernizr:"../js/lib/modernizr-custom",communitysdk:"communitysdk/src",cryptojs_sha1:"../js/lib/sha1",utils:"../js/lib/utils",clipboard:"../js/lib/clipboard.min",croppie:"../js/lib/croppie/croppie.min",twitch:"../js/lib/twitch.min"},shim:{strophe:{exports:"Strophe"},velocity:{deps:["jquery"]},"velocity-ui":{deps:["velocity"]},twemoji:{deps:["jquery"],exports:"twemoji"},rcemoji:{exports:"rcEmoji"},contenteditable:{deps:["jquery"],exports:"jQuery.fn.contentEditable"},w2ui:{deps:["jquery"],exports:"w2popup"},underscoreStr:{deps:["underscore"]},jqueryhighlight:{deps:["jquery"],exports:"jQuery.fn.highlight"},rcdialog:{deps:["w2ui"],exports:"rcDialog"},jqueryui:{deps:["jquery"],exports:"jQuery.fn.slider"},animatemodal:{deps:["jquery"],exports:"animateModal"},rcsidetab:{deps:["jquery"],exports:"jQuery.fn.rcSidetab2"},moment:{deps:["jquery"],exports:"moment"},modernizr:{exports:"Modernizr"},cryptojs_sha1:{exports:"CryptoJS"},utils:{exports:"Utils"},twitch:{deps:["jquery"],exports:"Twitch"}}}),window.nodeRequire&&require.config({config:{text:{env:"xhr"}}}),require(["infrastructure"],function(){require(["app"],function(e){e.init()})}),define("main",function(){});